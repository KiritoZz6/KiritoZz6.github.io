<!DOCTYPE html><html lang="zh-Hans" data-theme="light"><head><meta charset="UTF-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width,initial-scale=1"><title>C++集群聊天服务器（细节问题篇） | 🌸樱花酒吧🍻</title><meta name="keywords" content="面试,项目,集群聊天服务器"><meta name="author" content="Sakura."><meta name="copyright" content="Sakura."><meta name="format-detection" content="telephone=no"><meta name="theme-color" content="#ffffff"><meta name="description" content="集群聊天服务器项目相关问题： 为什么客户端不采用P2P的方式通信，而是采用服务器转发消息的方式？这里P2P指的是客户端直接将消息转发给客户端，不经过服务器转发。可以肯定的是，P2P方式不符合现代IM（即时通信）系统的通信方式，以下有两个方面可以反驳P2P  如果消息不经过服务器，那么服务器会失去监管客户端的权力（如果消息违反法律怎么办？） P2P模式下群组聊天功能很吃效率，比如在千人群中总不能客户">
<meta property="og:type" content="article">
<meta property="og:title" content="C++集群聊天服务器（细节问题篇）">
<meta property="og:url" content="http://sakura-pub.top/%E9%9D%A2%E8%AF%95/C++-%E9%9B%86%E7%BE%A4%E8%81%8A%E5%A4%A9%E6%9C%8D%E5%8A%A1%E5%99%A8%EF%BC%88%E7%BB%86%E8%8A%82%E9%97%AE%E9%A2%98%E7%AF%87%EF%BC%89/index.html">
<meta property="og:site_name" content="🌸樱花酒吧🍻">
<meta property="og:description" content="集群聊天服务器项目相关问题： 为什么客户端不采用P2P的方式通信，而是采用服务器转发消息的方式？这里P2P指的是客户端直接将消息转发给客户端，不经过服务器转发。可以肯定的是，P2P方式不符合现代IM（即时通信）系统的通信方式，以下有两个方面可以反驳P2P  如果消息不经过服务器，那么服务器会失去监管客户端的权力（如果消息违反法律怎么办？） P2P模式下群组聊天功能很吃效率，比如在千人群中总不能客户">
<meta property="og:locale">
<meta property="og:image" content="https://p.qlogo.cn/hy_personal/3e28f14aa0516842cca4bda79cde803eb27dc704e582549a4cc8c5dea1360098/0.png">
<meta property="article:published_time" content="2022-09-02T02:41:04.000Z">
<meta property="article:modified_time" content="2022-09-02T02:50:25.588Z">
<meta property="article:author" content="Sakura.">
<meta property="article:tag" content="面试">
<meta property="article:tag" content="项目">
<meta property="article:tag" content="集群聊天服务器">
<meta name="twitter:card" content="summary">
<meta name="twitter:image" content="https://p.qlogo.cn/hy_personal/3e28f14aa0516842cca4bda79cde803eb27dc704e582549a4cc8c5dea1360098/0.png"><link rel="shortcut icon" href="/img/0.png"><link rel="canonical" href="http://sakura-pub.top/%E9%9D%A2%E8%AF%95/C++-%E9%9B%86%E7%BE%A4%E8%81%8A%E5%A4%A9%E6%9C%8D%E5%8A%A1%E5%99%A8%EF%BC%88%E7%BB%86%E8%8A%82%E9%97%AE%E9%A2%98%E7%AF%87%EF%BC%89/"><link rel="preconnect" href="//cdn.jsdelivr.net"/><link rel="preconnect" href="//busuanzi.ibruce.info"/><link rel="stylesheet" href="/css/index.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free/css/all.min.css" media="print" onload="this.media='all'"><script>const GLOBAL_CONFIG = { 
  root: '/',
  algolia: undefined,
  localSearch: undefined,
  translate: {"defaultEncoding":2,"translateDelay":0,"msgToTraditionalChinese":"繁","msgToSimplifiedChinese":"简"},
  noticeOutdate: undefined,
  highlight: {"plugin":"prismjs","highlightCopy":true,"highlightLang":true,"highlightHeightLimit":false},
  copy: {
    success: 'Copy successfully',
    error: 'Copy error',
    noSupport: 'The browser does not support'
  },
  relativeDate: {
    homepage: false,
    post: false
  },
  runtime: 'days',
  date_suffix: {
    just: 'Just',
    min: 'minutes ago',
    hour: 'hours ago',
    day: 'days ago',
    month: 'months ago'
  },
  copyright: undefined,
  lightbox: 'fancybox',
  Snackbar: undefined,
  source: {
    jQuery: 'https://cdn.jsdelivr.net/npm/jquery@latest/dist/jquery.min.js',
    justifiedGallery: {
      js: 'https://cdn.jsdelivr.net/npm/justifiedGallery/dist/js/jquery.justifiedGallery.min.js',
      css: 'https://cdn.jsdelivr.net/npm/justifiedGallery/dist/css/justifiedGallery.min.css'
    },
    fancybox: {
      js: 'https://cdn.jsdelivr.net/npm/@fancyapps/fancybox@latest/dist/jquery.fancybox.min.js',
      css: 'https://cdn.jsdelivr.net/npm/@fancyapps/fancybox@latest/dist/jquery.fancybox.min.css'
    }
  },
  isPhotoFigcaption: false,
  islazyload: false,
  isanchor: false
}</script><script id="config-diff">var GLOBAL_CONFIG_SITE = {
  title: 'C++集群聊天服务器（细节问题篇）',
  isPost: true,
  isHome: false,
  isHighlightShrink: false,
  isToc: true,
  postUpdate: '2022-09-02 10:50:25'
}</script><noscript><style type="text/css">
  #nav {
    opacity: 1
  }
  .justified-gallery img {
    opacity: 1
  }

  #recent-posts time,
  #post-meta time {
    display: inline !important
  }
</style></noscript><script>(win=>{
    win.saveToLocal = {
      set: function setWithExpiry(key, value, ttl) {
        if (ttl === 0) return
        const now = new Date()
        const expiryDay = ttl * 86400000
        const item = {
          value: value,
          expiry: now.getTime() + expiryDay,
        }
        localStorage.setItem(key, JSON.stringify(item))
      },

      get: function getWithExpiry(key) {
        const itemStr = localStorage.getItem(key)

        if (!itemStr) {
          return undefined
        }
        const item = JSON.parse(itemStr)
        const now = new Date()

        if (now.getTime() > item.expiry) {
          localStorage.removeItem(key)
          return undefined
        }
        return item.value
      }
    }
  
    win.getScript = url => new Promise((resolve, reject) => {
      const script = document.createElement('script')
      script.src = url
      script.async = true
      script.onerror = reject
      script.onload = script.onreadystatechange = function() {
        const loadState = this.readyState
        if (loadState && loadState !== 'loaded' && loadState !== 'complete') return
        script.onload = script.onreadystatechange = null
        resolve()
      }
      document.head.appendChild(script)
    })
  
      win.activateDarkMode = function () {
        document.documentElement.setAttribute('data-theme', 'dark')
        if (document.querySelector('meta[name="theme-color"]') !== null) {
          document.querySelector('meta[name="theme-color"]').setAttribute('content', '#0d0d0d')
        }
      }
      win.activateLightMode = function () {
        document.documentElement.setAttribute('data-theme', 'light')
        if (document.querySelector('meta[name="theme-color"]') !== null) {
          document.querySelector('meta[name="theme-color"]').setAttribute('content', '#ffffff')
        }
      }
      const t = saveToLocal.get('theme')
    
          if (t === 'dark') activateDarkMode()
          else if (t === 'light') activateLightMode()
        
      const asideStatus = saveToLocal.get('aside-status')
      if (asideStatus !== undefined) {
        if (asideStatus === 'hide') {
          document.documentElement.classList.add('hide-aside')
        } else {
          document.documentElement.classList.remove('hide-aside')
        }
      }
    })(window)</script><link rel="stylesheet" href="https://sakura-pub.ltd/css/Sakura.css"><link rel="stylesheet" href="https://cdn.bootcss.com/highlight.js/9.2.0/styles/github.min.css"><meta name="generator" content="Hexo 5.4.0"><link rel="alternate" href="/atom.xml" title="🌸樱花酒吧🍻" type="application/atom+xml">
</head><body><div id="loading-box"><div class="loading-left-bg"></div><div class="loading-right-bg"></div><div class="spinner-box"><div class="configure-border-1"><div class="configure-core"></div></div><div class="configure-border-2"><div class="configure-core"></div></div><div class="loading-word">Loading...</div></div></div><div id="web_bg"></div><div id="sidebar"><div id="menu-mask"></div><div id="sidebar-menus"><div class="author-avatar"><img class="avatar-img" src="https://i.loli.net/2021/11/01/ilJyOSYrF7m4M3X.png" onerror="onerror=null;src='/img/friend_404.gif'" alt="avatar"/></div><div class="site-data"><div class="data-item is-center"><div class="data-item-link"><a href="/archives/"><div class="headline">Articles</div><div class="length-num">46</div></a></div></div><div class="data-item is-center"><div class="data-item-link"><a href="/tags/"><div class="headline">Tags</div><div class="length-num">8</div></a></div></div><div class="data-item is-center"><div class="data-item-link"><a href="/categories/"><div class="headline">Categories</div><div class="length-num">7</div></a></div></div></div><hr/><div class="menus_items"><div class="menus_item"><a class="site-page" href="/"><i class="fa-fw fas fa-home"></i><span> 首页</span></a></div><div class="menus_item"><a class="site-page" href="/tags/"><i class="fa-fw fas fa-tags"></i><span> 标签</span></a></div><div class="menus_item"><a class="site-page" href="javascript:void(0);"><i class="fa-fw fas fa-list"></i><span> 目录</span><i class="fas fa-chevron-down expand"></i></a><ul class="menus_item_child"><li><a class="site-page child" href="/categories/"><i class="fa-fw fas fa-folder-open"></i><span> 分类目录</span></a></li><li><a class="site-page child" href="/LeetCode/LeetCode%E5%88%B7%E9%A2%98%E7%AC%94%E8%AE%B0%E7%AC%AC%E4%B8%80%E6%9C%9F/"><i class="fa-fw fas-archive"></i><span> LeetCode刷题笔记</span></a></li><li><a class="site-page child" href="/categories/%E8%AE%B0%E4%BA%8B/"><span> 记事</span></a></li></ul></div><div class="menus_item"><a class="site-page" href="/%E8%AE%B0%E4%BA%8B/%E5%85%B3%E4%BA%8E%E6%88%91/"><i class="fa-fw fas fa-heart"></i><span> 关于</span></a></div></div></div></div><div class="post" id="body-wrap"><header class="post-bg" id="page-header" style="background-image: url('https://p.qlogo.cn/hy_personal/3e28f14aa0516842cca4bda79cde803eb27dc704e582549a4cc8c5dea1360098/0.png')"><nav id="nav"><span id="blog_name"><a id="site-name" href="/">🌸樱花酒吧🍻</a></span><div id="menus"><div class="menus_items"><div class="menus_item"><a class="site-page" href="/"><i class="fa-fw fas fa-home"></i><span> 首页</span></a></div><div class="menus_item"><a class="site-page" href="/tags/"><i class="fa-fw fas fa-tags"></i><span> 标签</span></a></div><div class="menus_item"><a class="site-page" href="javascript:void(0);"><i class="fa-fw fas fa-list"></i><span> 目录</span><i class="fas fa-chevron-down expand"></i></a><ul class="menus_item_child"><li><a class="site-page child" href="/categories/"><i class="fa-fw fas fa-folder-open"></i><span> 分类目录</span></a></li><li><a class="site-page child" href="/LeetCode/LeetCode%E5%88%B7%E9%A2%98%E7%AC%94%E8%AE%B0%E7%AC%AC%E4%B8%80%E6%9C%9F/"><i class="fa-fw fas-archive"></i><span> LeetCode刷题笔记</span></a></li><li><a class="site-page child" href="/categories/%E8%AE%B0%E4%BA%8B/"><span> 记事</span></a></li></ul></div><div class="menus_item"><a class="site-page" href="/%E8%AE%B0%E4%BA%8B/%E5%85%B3%E4%BA%8E%E6%88%91/"><i class="fa-fw fas fa-heart"></i><span> 关于</span></a></div></div><div id="toggle-menu"><a class="site-page"><i class="fas fa-bars fa-fw"></i></a></div></div></nav><div id="post-info"><h1 class="post-title">C++集群聊天服务器（细节问题篇）</h1><div id="post-meta"><div class="meta-firstline"><span class="post-meta-date"><i class="far fa-calendar-alt fa-fw post-meta-icon"></i><span class="post-meta-label">Created</span><time class="post-meta-date-created" datetime="2022-09-02T02:41:04.000Z" title="Created 2022-09-02 10:41:04">2022-09-02</time><span class="post-meta-separator">|</span><i class="fas fa-history fa-fw post-meta-icon"></i><span class="post-meta-label">Updated</span><time class="post-meta-date-updated" datetime="2022-09-02T02:50:25.588Z" title="Updated 2022-09-02 10:50:25">2022-09-02</time></span><span class="post-meta-categories"><span class="post-meta-separator">|</span><i class="fas fa-inbox fa-fw post-meta-icon"></i><a class="post-meta-categories" href="/categories/%E9%9D%A2%E8%AF%95/">面试</a><i class="fas fa-angle-right post-meta-separator"></i><i class="fas fa-inbox fa-fw post-meta-icon"></i><a class="post-meta-categories" href="/categories/%E9%9D%A2%E8%AF%95/%E9%A1%B9%E7%9B%AE/">项目</a><i class="fas fa-angle-right post-meta-separator"></i><i class="fas fa-inbox fa-fw post-meta-icon"></i><a class="post-meta-categories" href="/categories/%E9%9D%A2%E8%AF%95/%E9%A1%B9%E7%9B%AE/%E9%9B%86%E7%BE%A4%E8%81%8A%E5%A4%A9%E6%9C%8D%E5%8A%A1%E5%99%A8/">集群聊天服务器</a></span></div><div class="meta-secondline"><span class="post-meta-separator">|</span><span class="post-meta-pv-cv" id="" data-flag-title="C++集群聊天服务器（细节问题篇）"><i class="far fa-eye fa-fw post-meta-icon"></i><span class="post-meta-label">Post View:</span><span id="busuanzi_value_page_pv"></span></span><span class="post-meta-separator">|</span><span class="post-meta-commentcount"><i class="far fa-comments fa-fw post-meta-icon"></i><span class="post-meta-label">Comments:</span><a href="/%E9%9D%A2%E8%AF%95/C++-%E9%9B%86%E7%BE%A4%E8%81%8A%E5%A4%A9%E6%9C%8D%E5%8A%A1%E5%99%A8%EF%BC%88%E7%BB%86%E8%8A%82%E9%97%AE%E9%A2%98%E7%AF%87%EF%BC%89/#post-comment" itemprop="discussionUrl"><span class="valine-comment-count" data-xid="/%E9%9D%A2%E8%AF%95/C++-%E9%9B%86%E7%BE%A4%E8%81%8A%E5%A4%A9%E6%9C%8D%E5%8A%A1%E5%99%A8%EF%BC%88%E7%BB%86%E8%8A%82%E9%97%AE%E9%A2%98%E7%AF%87%EF%BC%89/" itemprop="commentCount"></span></a></span></div></div></div></header><main class="layout" id="content-inner"><div id="post"><article class="post-content" id="article-container"><p>集群聊天服务器项目相关问题：</p>
<h1 id="为什么客户端不采用P2P的方式通信，而是采用服务器转发消息的方式？"><a href="#为什么客户端不采用P2P的方式通信，而是采用服务器转发消息的方式？" class="headerlink" title="为什么客户端不采用P2P的方式通信，而是采用服务器转发消息的方式？"></a>为什么客户端不采用P2P的方式通信，而是采用服务器转发消息的方式？</h1><p>这里P2P指的是客户端直接将消息转发给客户端，不经过服务器转发。可以肯定的是，P2P方式不符合现代IM（即时通信）系统的通信方式，以下有两个方面可以反驳P2P</p>
<ol>
<li>如果消息不经过服务器，那么服务器会失去监管客户端的权力（如果消息违反法律怎么办？）</li>
<li>P2P模式下群组聊天功能很吃效率，比如在千人群中总不能客户端自己一个人转发一千多次吧</li>
</ol>
<h1 id="怎么保证消息按顺序显示（两个方案，一个可行一个不可行）"><a href="#怎么保证消息按顺序显示（两个方案，一个可行一个不可行）" class="headerlink" title="怎么保证消息按顺序显示（两个方案，一个可行一个不可行）"></a>怎么保证消息按顺序显示（两个方案，一个可行一个不可行）</h1><p>这里有篇文章写得很好<a target="_blank" rel="noopener" href="https://www.cnblogs.com/imteck4713/p/13925791.html">零基础IM开发入门(四)：什么是IM系统的消息时序一致性？</a></p>
<h2 id="首先考虑添加时间戳的方案（不可行）"><a href="#首先考虑添加时间戳的方案（不可行）" class="headerlink" title="首先考虑添加时间戳的方案（不可行）"></a>首先考虑添加时间戳的方案（不可行）</h2><p>假设有两个客户端甲和乙，然后甲向乙发送两个消息</p>
<p>​    你好吗？（23:10:01）</p>
<p>​    你有什么打算（23:10:05）</p>
<p>这会导致一个问题↓</p>
<h3 id="谁先到达服务端？"><a href="#谁先到达服务端？" class="headerlink" title="谁先到达服务端？"></a>谁先到达服务端？</h3><p>第一条消息<strong>不一定</strong>是早到达服务端的，因为有可能选择的路由节点是比较拥堵，停留时间比较长，而第二条消息的路由节点则比较通畅。这种情况下就会导致第二条消息比第一条消息早到达服务端</p>
<p>同样的，将消息从服务端传到客户端也会导致类似的乱序到达问题</p>
<h3 id="客户端还要进行排序"><a href="#客户端还要进行排序" class="headerlink" title="客户端还要进行排序"></a>客户端还要进行排序</h3><p>消息到达客户端后，因为是乱序的所以可能会想到按时间段来排序来解决这个问题，比如说在05秒这一秒内的消息按序排好再输出</p>
<p>可另外一个问题又来了，第一条消息是01秒的，不在排序的时间段中，时间段外的消息还是没得排好序，所以这个时间戳方案是<strong>不可行</strong>的</p>
<p>而且，因为服务器是集群的，<strong>在不同服务器下时钟可能是不一样的</strong>，这个也是一个需要考虑的问题</p>
<h2 id="另一个方案——维护一个seq标志位（可行）"><a href="#另一个方案——维护一个seq标志位（可行）" class="headerlink" title="另一个方案——维护一个seq标志位（可行）"></a>另一个方案——维护一个seq标志位（可行）</h2><p>在每个客户端中要维护一个标志位seq（注意要用<strong>原子量</strong>，可以设置成unsigned int），并且这个seq是对每个目标用户都是独立的，比如在A用户中，它与B用户和与C用户聊天都是独立的seq，并不是一个全局的变量，群组聊天也不例外。</p>
<p>初始化时seq为0，代表下一个需要接收的消息标志号为0，当接收到指定的消息后seq++变成了1，以此类推</p>
<h3 id="发送消息又怎么编写发送的seq号呢？"><a href="#发送消息又怎么编写发送的seq号呢？" class="headerlink" title="发送消息又怎么编写发送的seq号呢？"></a>发送消息又怎么编写发送的seq号呢？</h3><p>这时候又来了个问题，假如A要发送一个消息，那么它怎么知道对方接收的seq序号是要多少呢？</p>
<p>其实很容易解决，让这个seq是用作与双方用户的就好了，刚开始双方seq都是0，当A向B发送一个消息时，seq++变成了1，这个1代表着A的seq，也代表着B的seq，此时不管是A还是B发送消息，都是以1来作为seq发送就好了</p>
<h3 id="确定收到消息后才seq-（消息的传输的可靠性）"><a href="#确定收到消息后才seq-（消息的传输的可靠性）" class="headerlink" title="确定收到消息后才seq++（消息的传输的可靠性）"></a>确定收到消息后才seq++（消息的传输的可靠性）</h3><p>因为seq是用作于双方用户，所以要确保发送消息对方接收了才seq++，这里又是一个难点，因为你<strong>要保证消息传输的可靠性</strong>，这个话题到时候再开一个讨论</p>
<h3 id="群聊的seq又得怎么样呢？（不要求消息顺序到达服务器，但要求顺序显示在每个客户端）"><a href="#群聊的seq又得怎么样呢？（不要求消息顺序到达服务器，但要求顺序显示在每个客户端）" class="headerlink" title="群聊的seq又得怎么样呢？（不要求消息顺序到达服务器，但要求顺序显示在每个客户端）"></a>群聊的seq又得怎么样呢？（不要求消息顺序到达服务器，但要求顺序显示在每个客户端）</h3><p>首先，群聊的时候不能像点对点聊天那样每个客户端都保存一个独立的seq，因为发送方不一样，而且可能每时每刻都有人发送消息，很难保证每个客户端的seq一致，再加上<strong>群聊可以在小范围内出现消息顺序不一致到达服务器</strong>，所以在群组聊天中<strong>客户端发送消息到服务器的过程</strong>就不用带seq了</p>
<p>这里，我们要求<strong>每个客户端的群组消息显示顺序是一致的</strong>，于是这里可以等消息到了服务器才从底层（可以是数据库）中拿一个<strong>唯一seq</strong>，然后附在消息上面发送给每个客户端，客户端根据这个seq进行排序显示。这样就保证了显示顺序一致了。</p>
<h3 id="再优化"><a href="#再优化" class="headerlink" title="再优化"></a>再优化</h3><p>上面提到唯一seq需要从底层（可能是数据库）中拿取，这样并发量大的时候可能会造成性能上的损失，有什么方法优化呢？</p>
<p>下面是一些解决方案：</p>
<ol>
<li>使用Redis缓存（我个人的想法），借助Redis数据存储于内存的机制来提高效率，不足的地方就是万一Redis崩了会导致消息只能按随机顺序发送给客户端</li>
<li>将消息传到一个相同的服务器集中管理添加seq（网上的方案），由一个服务器来本地管理这个群的seq，消息集中发送过来这里添加好seq后再传给客户端，相当于一个中继站，缺点是耗时（消息每次都要经过这个服务器），但起码比存在数据库中每次都提取好一些。</li>
</ol>
<h2 id="总结"><a href="#总结" class="headerlink" title="总结"></a>总结</h2><p>IM系统架构下，消息的绝对时序是很困难的，原因多种多样，比如：没有全局时钟、多发送方、多接收方、多线程、网络传输不确定性等。</p>
<p>一对一单聊时，其实只需要保证发出的时序与接收的时序一致，就基本能让用户感觉不到乱序了。</p>
<p>多对多的群聊情况下，保证同一群内的所有接收方消息时序一致，也就能让用户感觉不到乱序了</p>
<h1 id="如何确保消息的可靠性？（消息不丢，消息不重）"><a href="#如何确保消息的可靠性？（消息不丢，消息不重）" class="headerlink" title="如何确保消息的可靠性？（消息不丢，消息不重）"></a>如何确保消息的可靠性？（消息不丢，消息不重）</h1><p>同样也是一篇写得比较好的文章：<a target="_blank" rel="noopener" href="http://www.52im.net/thread-3182-1-1.html">零基础IM开发入门(三)：什么是IM系统的可靠性？</a></p>
<p>这里的消息可靠性包括两个方面：</p>
<ol>
<li>消息不会丢失</li>
<li>消息不会重复</li>
</ol>
<p>当然，我们还要注意消息分为<strong>在线消息</strong>和离线消息两种方式，这两个方式都要保证可靠性</p>
<h2 id="TCP并不能保证在线消息的“可靠性”"><a href="#TCP并不能保证在线消息的“可靠性”" class="headerlink" title="TCP并不能保证在线消息的“可靠性”"></a>TCP并不能保证在线消息的“可靠性”</h2><p>TCP是网络层的协议，它虽然能够保证网络连接时网络层的“可靠性”，但是网络层上到业务层的过程中并不能保证其“可靠性”。</p>
<p>什么意思呢？比如说数据到达网络层，而程序需要把数据放入数据库中，这时候程序可能会出现崩溃，就会导致数据还没保存到数据库中就“消失了”。</p>
<p>因此，即使TCP可靠，可随着项目的功能越来越多，网络层向上的处理出错率也越大</p>
<h2 id="那么在线消息怎么保证其可靠性呢？"><a href="#那么在线消息怎么保证其可靠性呢？" class="headerlink" title="那么在线消息怎么保证其可靠性呢？"></a>那么在线消息怎么保证其可靠性呢？</h2><p>可以参考TCP的超时重传机制，在指定的时间内没有收到ACK进行数据重新发送</p>
<p><img src="https://p.qlogo.cn/hy_personal/3e28f14aa0516842074b7cc521085313a11bf9aea6669666f7a7bbbaf78f2ae7/0.png" alt="在线消息可靠性流程图.png"></p>
<p>第一阶段（A-&gt;server）：</p>
<ol>
<li>A发送消息msg给server</li>
<li>server接收到消息，回给A一个ACK确认包msg-ack</li>
<li>A在超时时间内收到ACK代表成功发送消息，第一阶段结束</li>
</ol>
<p>如果msg或者msg-ack任意一个发送失败，都会导致客户端A无法收到ACK，这时候就可以提示用户发送消息失败，进行重新发送</p>
<p>第二阶段（server-&gt;B）：</p>
<ol>
<li>server向B推送消息notify-req</li>
<li>B收到消息，回复notify-ack给server</li>
<li>server收到ack，代表第二阶段以及整个消息转发完成</li>
</ol>
<p>和第一阶段一样，无论notify-req还是notify-ack其中一个发送失败，都会导致server无法收到ack，此时则要超时重传</p>
<h2 id="离线消息也要保证可靠性"><a href="#离线消息也要保证可靠性" class="headerlink" title="离线消息也要保证可靠性"></a>离线消息也要保证可靠性</h2><p>离线消息也会有发送消息丢失的状况，比如从数据库中取出数据传给客户端过程中，万一客户端此时断开了，那么数据库的数据也删除了，消息也在传输过程中丢失了。</p>
<p>这里也有对应的解决方案，也是利用超时重传的机制</p>
<p><img src="https://p.qlogo.cn/hy_personal/3e28f14aa0516842074b7cc5210853134a507149f14dfb7e992462b915767e8e/0.png" alt="离线消息可靠性流程图.png"></p>
<p>先看左边客户端A的阶段，这是发送一个消息给服务器，服务器检测到需要作为离线消息存放在数据库的过程：</p>
<ol>
<li>客户端A发送msg给server</li>
<li>server检测到属于离线消息类型，需要存放在数据库中</li>
<li>存放好后，server发送ack回复给客户端A，此时A不管消息类型是在线还是离线，都是代表A的消息成功发出去了</li>
</ol>
<p>然后是比较重要的取出离线消息的阶段：</p>
<ol>
<li>客户端B上线，向server请求检查是否有属于它的离线消息</li>
<li>server从数据库中取出数据（注意此时还没删除）</li>
<li>server将取出的数据发送给B</li>
<li>B收到后回复给server一个ack</li>
<li>server只有在收到ack后才将数据库中的离线消息删除</li>
</ol>
<p>当然，<strong>上面的操作还可以进一步优化</strong></p>
<p>每次B取出一条数据就要向server回一个ack，如果消息量大起来时候会增大了双方的压力。</p>
<p>对于这种情况我们可以使用<strong>接收批量消息才回复一个ack的方式</strong>，将多个消息划分成组发送，一个组发送成功客户端才回复一个ack，如果某个组超时了则重新发送这一组的消息就好了。</p>
<h2 id="消息不丢失保证了，那消息重复怎么办呢？？"><a href="#消息不丢失保证了，那消息重复怎么办呢？？" class="headerlink" title="消息不丢失保证了，那消息重复怎么办呢？？"></a>消息不丢失保证了，那消息重复怎么办呢？？</h2><p>对于消息重复的情况很简单解决，就是根据一个<strong>唯一的消息id</strong>来将消息过滤</p>
<ol>
<li>对于客户端：可以通过一个哈希表<code>unordered_map</code>来维护已收到过的消息id，当再次收到该id时将消息丢弃</li>
<li>对于服务端：将从客户端接收的消息id<strong>往数据库中查询</strong>(不能用保存在内存中的哈希表，因为服务端是集群部署的)，如果数据库中已经存在该id则将消息丢弃。但是<strong>仍然要回复ACK给客户端</strong>（因为这条消息有可能是客户端主动发送手动重传的）；</li>
</ol>
<p>既然做了id机制了，那么按顺序到达的功能也可以完成了（ps：这两个问题的关联性，惊了）</p>
<h1 id="扩展：另种随机UID生成算法–Snowflake（雪花算法）"><a href="#扩展：另种随机UID生成算法–Snowflake（雪花算法）" class="headerlink" title="扩展：另种随机UID生成算法–Snowflake（雪花算法）"></a>扩展：另种随机UID生成算法–Snowflake（雪花算法）</h1><p><a target="_blank" rel="noopener" href="https://www.e-learn.cn/topic/3715693">忘掉 Snowflake，感受一下性能高出 587 倍的全局唯一 ID 生成算法</a></p>
<p>大名鼎鼎的 Snowflake<br>Twitter 于 2010 年开源了内部团队在用的一款全局唯一 ID 生成算法 Snowflake，翻译过来叫做雪花算法。Snowflake 不借助数据库，可直接由编程语言生成，它通过巧妙的位设计使得 ID 能够满足递增属性，且生成的 ID 并不是依次连续的，能够满足上面提到的全局唯一 ID 的 4 个属性。它连续生成的 3 个 ID 看起来像这样：</p>
<p>563583455628754944<br>563583466173235200<br>563583552944996352<br>Snowflake 以 64 bit 来存储组成 ID 的4 个部分：</p>
<p>1、最高位占1 bit，值固定为 0，以保证生成的 ID 为正数；</p>
<p>2、中位占 41 bit，值为毫秒级时间戳；</p>
<p>3、中下位占 10 bit，值为工作机器的 ID，值的上限为 1024；</p>
<p>4、末位占 12 bit，值为当前毫秒内生成的不同 ID，值的上限为 4096；</p>
<p>Snowflake 的代码实现网上有很多款，基本上各大语言都能找到实现参考。我之前在做实验的时候在网上找到一份 Golang 的代码实现：</p>
<h1 id="消息明文传输的安全问题"><a href="#消息明文传输的安全问题" class="headerlink" title="消息明文传输的安全问题"></a>消息明文传输的安全问题</h1><p>明文传输会有给劫持信息，泄露内容的风险，肯定是不可以直接使用明文传输的。</p>
<p>所以我们要使用加密技术来保证安全性，至于要用什么加密方式则是着重要思考的问题。</p>
<h2 id="要选择什么加密方式呢？"><a href="#要选择什么加密方式呢？" class="headerlink" title="要选择什么加密方式呢？"></a>要选择什么加密方式呢？</h2><p>我们可以参考所学到的知识，比如HTTPS就是一个很好的例子，使用非对称加密传输通信随机码，再使用通信随机码对称加密信息来传输正常的数据</p>
<h2 id="自己想到的一个新问题：HTTPS是应用在端对端通信过程，如果是项目这种服务器中继站模式的怎么实现加密呢？"><a href="#自己想到的一个新问题：HTTPS是应用在端对端通信过程，如果是项目这种服务器中继站模式的怎么实现加密呢？" class="headerlink" title="自己想到的一个新问题：HTTPS是应用在端对端通信过程，如果是项目这种服务器中继站模式的怎么实现加密呢？"></a>自己想到的一个新问题：HTTPS是应用在端对端通信过程，如果是项目这种服务器中继站模式的怎么实现加密呢？</h2><p>这个问题的意思是，HTTPS是直接两个终端进行通信，而对称加密与非对称加密传输之间是直接根据两个终端的公私钥来加密并且传输的，加密传输只有一段路。</p>
<p>可是放到聊天服务器中，数据报文要先传给服务器，服务器再负责转发给目标用户，这就形成了三个终端两段路了，此时我们应该怎么加密呢？</p>
<h3 id="两个不可取的思路："><a href="#两个不可取的思路：" class="headerlink" title="两个不可取的思路："></a>两个不可取的思路：</h3><ol>
<li>A到服务器加一次密，服务器解密解析之后再发送给B过程再加一次密？<strong>不可取</strong>，这样很影响服务器效率</li>
<li>A在与B聊天前建立加密通信秘钥，然后服务器只负责转发不会解密？<strong>不可取</strong>，这样又影响到了客户端的效率，万一是群组聊天怕不是每个客户端都要进行建立通信秘钥呢。。。</li>
</ol>
<h3 id="两全其美的方案："><a href="#两全其美的方案：" class="headerlink" title="两全其美的方案："></a>两全其美的方案：</h3><p>网上找到个好方法，就是将前面两个方案结合。数据报文<strong>暴露出目标用户</strong>以及<strong>发送用户</strong>作为数据的<strong>控制层</strong>，控制层是用于给服务器转发消息用的，所以这个暴露了也没关系。而真正存储数据的<strong>内容层才是需要加密</strong>，这样就解决了上面第一个方案1的问题，避免服务器解密计算</p>
<p>而关于群组聊天如何加密，这里也有个方案</p>
<p>Signal Protocol协议 在群组聊天中的设计与二人聊天又有所不同，由于群聊的保密性要求相对低一些，只采用了 KDF 链棘轮+公钥签名来进行加密通讯以保障加密的前向安全。</p>
<pre class="line-numbers language-markdown" data-language="markdown"><code class="language-markdown">群组聊天的加解密通讯流程如下：

1）每个群组成员都要首先生成随机 32 字节的 KDF 链密钥(Chain Key)，用于生成消息密钥，以保障消息密钥的前向安全性，同时还要生成一个随机 Curve25519 签名密钥对，用于消息签名；
2）每个群组成员用向其它成员单独加密发送链密钥(Chain Key)和签名公钥。此时每一个成员都拥有群内所有成员的链密钥和签名公钥；
3）当一名成员发送消息时，首先用 KDF 链棘轮算法生成的消息密钥加密消息，然后使用私钥签名，再将消息发给服务器，由服务器发送给其它成员；
4）其它成员收到加密消息后，首先使用发送人的签名公钥验证，验证成功后，使用相应的链密钥生成消息密钥，并用消息密钥解密；
5）当群组成员离开时，所有的群组成员都清除自己链密钥和签名公钥并重新生成，再次单独发给每一位成员。这样操作，离开的成员就无法查看群组内的消息了。<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>





<h2 id="扩展：一些关于传输安全的文章"><a href="#扩展：一些关于传输安全的文章" class="headerlink" title="扩展：一些关于传输安全的文章"></a>扩展：一些关于传输安全的文章</h2><p><a target="_blank" rel="noopener" href="http://www.52im.net/thread-4026-1-1.html"><strong>即时通讯安全篇（十一）：IM聊天系统安全手段之传输内容端到端加密技术</strong></a>——&gt;介绍了群组聊天加密</p>
<p><a target="_blank" rel="noopener" href="http://www.52im.net/thread-2866-1-1.html"><strong>即时通讯安全篇（八）：你知道，HTTPS用的是对称加密还是非对称加密？</strong></a></p>
<p><a target="_blank" rel="noopener" href="http://www.52im.net/thread-217-1-1.html"><strong>主流的加密算法介绍以及探讨组合加密算法在IM中的应用</strong></a></p>
<h1 id="TODO-为什么选用消息队列（消息队列意义）"><a href="#TODO-为什么选用消息队列（消息队列意义）" class="headerlink" title="TODO:为什么选用消息队列（消息队列意义）"></a>TODO:为什么选用消息队列（消息队列意义）</h1><p>PS: 这论坛是真好用，<a target="_blank" rel="noopener" href="http://www.52im.net/thread-1979-1-1.html">IM开发基础知识补课(五)：通俗易懂，正确理解并用好MQ消息队列</a></p>
<h1 id="为什么要用Redis作为跨服务器通信的中间件"><a href="#为什么要用Redis作为跨服务器通信的中间件" class="headerlink" title="为什么要用Redis作为跨服务器通信的中间件"></a>为什么要用Redis作为跨服务器通信的中间件</h1><p>因为项目中用到跨服务器通信地方是在点对点聊天以及群聊天功能上，当A服务器的用户发送的消息涉及到B服务器的用户时，首先服务器会在数据库中查看该用户是否在线，如果在线则代表在另外一个服务器的在线列表中，此时则需要把数据包发送给消息队列，然后由订阅了目标用户的服务器接收。</p>
<p>因为服务器用到消息队列的地方较少并且Redis消息队列代码实现比较方便，所以才考虑用到Redis的发布-订阅功能作为服务器的消息队列，！（这里我通过压力测试，不断向服务器发送一个必须跨服务器通信的数据包，压力测试在xxx通信量下，Redis还是能顺利完成通信）</p>
<p>当然不排除当数据量大的时候Redis存在挂掉的现象，这时候就可以考虑采取设置消息量阈值、更换重型的消息队列框架（如Kafka、RabbitMQ）等消息队列来作为跨服务器通信的中间件</p>
<h1 id="Redis不稳定挂掉了怎么办"><a href="#Redis不稳定挂掉了怎么办" class="headerlink" title="Redis不稳定挂掉了怎么办"></a>Redis不稳定挂掉了怎么办</h1><p>emm，没有哪个服务器是可以保证绝对稳定的，当数据量达到一定值的时候，只能选择如抛弃消息策略（可以设置一个阈值，当消息量达到这个阈值时则不再继续接收消息）、扩展服务器硬件、采用更专业的消息队列架构如Kafka、RabbitMQ、RocketMQ、ZeroMQ等等</p>
<p>Redis的发布-订阅还存在数据丢失问题，分别是在<strong>消费者下线</strong>、<strong>Redis宕机</strong>、<strong>消息堆积</strong>这三个情况会出现。</p>
<p>关于第一种情况消费者下线服务器已经有处理方法了，就是在发布跨服务器的数据包前会在服务器检测目标用户是否在线，如果不在线就直接转为离线消息放在数据库中存储；</p>
<p>而关于Redis宕机导致消息丢失的问题，可以考虑使用更趋于成熟的队列：<strong>Stream</strong>，该类型的队列可以支持AOF和RDB持久化，一旦Redis宕机也可以恢复消息；</p>
<p>而消息堆积问题，Stream选择的是丢弃旧的消息选择新的消息，实际上消息丢失问题还是会存在，这时候就要选择更加专业的消息队列了</p>
<h1 id="为什么各个Server不能相互直接通信呢？"><a href="#为什么各个Server不能相互直接通信呢？" class="headerlink" title="为什么各个Server不能相互直接通信呢？"></a>为什么各个Server不能相互直接通信呢？</h1><p>项目中每台服务器有特定的用户在线列表，这也是要求项目拥有跨服务器通信功能的原因之一，但是因为引入了多台服务器，我们就要对此加以管理。</p>
<p>首先考虑服务器之间直接相互连接的情况，这种方式服务器作为服务端又作为客户端，如果服务器数量一大，则会导致难以管理连接。比如说想要增加一台服务器的时候，就要将这台新的服务器与当前在线的服务器建立连接，耗时长并且在维持连接的过程中还要时不时发送一个心跳包来查看对方服务器是否在线从而判断连接是否正常。因此服务器相互直连的方式是淘汰的，连接量多，建立连接复杂，管理难。</p>
<p>项目中考虑的是消息队列作为跨服器中间件的情况，用这种方案的话连接量会对比直接连接方案的连接量大大减小，每台服务器只用保持与消息队列一条连接就行，并且每当新增一台服务器的时候其它服务器并不需要知道有服务器新增加进来了，这台新增加的服务器只用和消息队列连接就行了，连接管理也是简单很多。</p>
<h1 id="数据库表是怎么设计的"><a href="#数据库表是怎么设计的" class="headerlink" title="数据库表是怎么设计的"></a>数据库表是怎么设计的</h1><p>一共有五个表，分别是用户表、群组信息表（不同群组的信息）、群组成员表（某个群中所有的成员信息）、离线信息表（存放每个用户的离线信息Json）、以及一个好友表（一对多的关系）</p>
<h2 id="用户表"><a href="#用户表" class="headerlink" title="用户表"></a>用户表</h2><p>用户表存放用户的登录账号（id）、名称、加盐哈希后的密码、盐值、在线状态</p>
<h2 id="好友表（两种设计方案）"><a href="#好友表（两种设计方案）" class="headerlink" title="好友表（两种设计方案）"></a>好友表（两种设计方案）</h2><p><a target="_blank" rel="noopener" href="https://zhuanlan.zhihu.com/p/25648654">两种好友关系表的设计方案</a></p>
<h3 id="第一种方案"><a href="#第一种方案" class="headerlink" title="第一种方案"></a>第一种方案</h3><p>第一种方案是和我项目中的一样</p>
<pre class="line-numbers language-mysql" data-language="mysql"><code class="language-mysql"># 好友列表，点对点的关系
CREATE TABLE &#96;friend&#96; (
  &#96;userid&#96; int NOT NULL COMMENT &#39;用户id&#39;,
  &#96;friendid&#96; int NOT NULL COMMENT &#39;好友id&#39;,
  PRIMARY KEY (&#96;userid&#96;,&#96;friendid&#96;)
) ENGINE&#x3D;InnoDB DEFAULT CHARSET&#x3D;gbk;<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<p>当A添加B为好友后，会添加两条数据：“A与B是好友”，以及“B与A是好友”</p>
<p>这种方案优点是：表结构的存取逻辑简单</p>
<p>缺点是：表内容存在冗余的数据</p>
<h3 id="第二种方案"><a href="#第二种方案" class="headerlink" title="第二种方案"></a>第二种方案</h3><p>第二种方案网上示例如下：</p>
<pre class="line-numbers language-mysql" data-language="mysql"><code class="language-mysql">CREATE TABLE &#96;user_relation&#96; (
  &#96;id&#96; int(11) unsigned NOT NULL AUTO_INCREMENT,
  &#96;user_id&#96; int(11) DEFAULT NULL,
  &#96;friend_id&#96; int(11) DEFAULT NULL,
  &#96;sorted_key&#96; varchar(255) DEFAULT NULL,
  PRIMARY KEY (&#96;id&#96;),
  UNIQUE KEY &#96;user_id&#96; (&#96;user_id&#96;,&#96;friend_id&#96;),
  KEY &#96;sorted_uniq_key&#96; (&#96;sorted_key&#96;)
) ENGINE&#x3D;InnoDB AUTO_INCREMENT&#x3D;3 DEFAULT CHARSET&#x3D;utf8;<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<p>每次用户A添加用户B为好友后，即在数据库中添加一条记录：</p>
<pre class="line-numbers language-text" data-language="text"><code class="language-text">user_id: 10001, friend_id: 10002, sorted_key: 10001-10002<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>

<p>sorted_key是将（user_id和friend_id）升序排序后的拼接，作为两个用户为好友关系的唯一验证</p>
<p>即：使用A添加B为好友后，不用也不可以再使用B添加A好友命令，因为相同的sorted_key已经存在</p>
<p>但是查找好友关系时还是比较麻烦</p>
<p>获取用户A的朋时 SQL</p>
<pre class="line-numbers language-text" data-language="text"><code class="language-text">SELECT friend_id FROM user_relation WHERE user_id &#x3D; 10001;
SELECT user_id FROM user_relation WHERE friend_id &#x3D; 10001;

或

SELECT friend_id as user_id FROM user_relation WHERE user_id &#x3D; 10001  
UNION
SELECT user_id FROM user_relation WHERE friend_id &#x3D; 10001;<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<p>这种方法有点是：没有数据冗余</p>
<p>缺点：获取逻辑比较复杂，唯一验证字段也要占空间</p>
<p>个人比较倾向于第一种方案，第二种虽然数据库冗余少，但是逻辑比较复杂，而且查询sql复杂，性能上肯定比第一种差不少</p>
<h2 id="群组信息表"><a href="#群组信息表" class="headerlink" title="群组信息表"></a>群组信息表</h2><p>存放群组id、群组名称和群组描述</p>
<h2 id="群组成员"><a href="#群组成员" class="headerlink" title="群组成员"></a>群组成员</h2><p>存放群组id内的成员id，以及该成员id在群中的群组角色</p>
<h2 id="离线信息表"><a href="#离线信息表" class="headerlink" title="离线信息表"></a>离线信息表</h2><p>存放Json格式的用户离线消息，待到对应用户上线则将离线消息推送成功再从数据库删除该离线消息</p>
<h1 id="TODO-离线消息怎么存储（加密？还是明文？）"><a href="#TODO-离线消息怎么存储（加密？还是明文？）" class="headerlink" title="TODO:离线消息怎么存储（加密？还是明文？）"></a>TODO:离线消息怎么存储（加密？还是明文？）</h1><h1 id="TODO-容灾方案"><a href="#TODO-容灾方案" class="headerlink" title="TODO:容灾方案"></a>TODO:容灾方案</h1></article><div class="post-copyright"><div class="post-copyright__author"><span class="post-copyright-meta">Author: </span><span class="post-copyright-info"><a href="mailto:undefined">Sakura.</a></span></div><div class="post-copyright__type"><span class="post-copyright-meta">Link: </span><span class="post-copyright-info"><a href="http://sakura-pub.top/%E9%9D%A2%E8%AF%95/C++-%E9%9B%86%E7%BE%A4%E8%81%8A%E5%A4%A9%E6%9C%8D%E5%8A%A1%E5%99%A8%EF%BC%88%E7%BB%86%E8%8A%82%E9%97%AE%E9%A2%98%E7%AF%87%EF%BC%89/">http://sakura-pub.top/%E9%9D%A2%E8%AF%95/C++-%E9%9B%86%E7%BE%A4%E8%81%8A%E5%A4%A9%E6%9C%8D%E5%8A%A1%E5%99%A8%EF%BC%88%E7%BB%86%E8%8A%82%E9%97%AE%E9%A2%98%E7%AF%87%EF%BC%89/</a></span></div><div class="post-copyright__notice"><span class="post-copyright-meta">Copyright Notice: </span><span class="post-copyright-info">All articles in this blog are licensed under <a target="_blank" rel="noopener" href="https://creativecommons.org/licenses/by-nc-sa/4.0/">CC BY-NC-SA 4.0</a> unless stating additionally.</span></div></div><div class="tag_share"><div class="post-meta__tag-list"><a class="post-meta__tags" href="/tags/%E9%9D%A2%E8%AF%95/">面试</a><a class="post-meta__tags" href="/tags/%E9%A1%B9%E7%9B%AE/">项目</a><a class="post-meta__tags" href="/tags/%E9%9B%86%E7%BE%A4%E8%81%8A%E5%A4%A9%E6%9C%8D%E5%8A%A1%E5%99%A8/">集群聊天服务器</a></div><div class="post_share"><div class="social-share" data-image="https://p.qlogo.cn/hy_personal/3e28f14aa0516842cca4bda79cde803eb27dc704e582549a4cc8c5dea1360098/0.png" data-sites="facebook,twitter,wechat,weibo,qq"></div><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/social-share.js/dist/css/share.min.css" media="print" onload="this.media='all'"><script src="https://cdn.jsdelivr.net/npm/social-share.js/dist/js/social-share.min.js" defer></script></div></div><nav class="pagination-post" id="pagination"><div class="next-post pull-full"><a href="/%E9%9D%A2%E8%AF%95/C++-%E9%9B%86%E7%BE%A4%E8%81%8A%E5%A4%A9%E6%9C%8D%E5%8A%A1%E5%99%A8%EF%BC%88%E4%BC%98%E5%8C%96%E7%AF%87%EF%BC%89/"><img class="next-cover" src="https://pic.rmb.bdstatic.com/bjh/f4a9fb349489af60d0af1b1ccfca71fe.jpeg" onerror="onerror=null;src='/img/404.jpg'" alt="cover of next post"><div class="pagination-info"><div class="label">Next Post</div><div class="next_info">C++集群聊天服务器（优化篇）</div></div></a></div></nav><div class="relatedPosts"><div class="headline"><i class="fas fa-thumbs-up fa-fw"></i><span> Related Articles</span></div><div class="relatedPosts-list"><div><a href="/面试/C++集群聊天服务器（正式内容篇）/" title="C++集群聊天服务器（正式内容篇）"><img class="cover" src="https://pic.rmb.bdstatic.com/bjh/5c2c84703a1bba59b28ba5819bf00b1e.jpeg" alt="cover"><div class="content is-center"><div class="date"><i class="far fa-calendar-alt fa-fw"></i> 2022-07-17</div><div class="title">C++集群聊天服务器（正式内容篇）</div></div></a></div><div><a href="/面试/暑假冲刺秋招项目-C++集群聊天服务器（预备知识篇）/" title="暑假冲刺秋招项目--C++集群聊天服务器（预备知识篇）"><img class="cover" src="https://pic.rmb.bdstatic.com/bjh/d488e66d13da478d5eab285e068bdcd3.jpeg" alt="cover"><div class="content is-center"><div class="date"><i class="far fa-calendar-alt fa-fw"></i> 2022-07-16</div><div class="title">暑假冲刺秋招项目--C++集群聊天服务器（预备知识篇）</div></div></a></div><div><a href="/面试/C++-集群聊天服务器（优化篇）/" title="C++集群聊天服务器（优化篇）"><img class="cover" src="https://pic.rmb.bdstatic.com/bjh/f4a9fb349489af60d0af1b1ccfca71fe.jpeg" alt="cover"><div class="content is-center"><div class="date"><i class="far fa-calendar-alt fa-fw"></i> 2022-07-24</div><div class="title">C++集群聊天服务器（优化篇）</div></div></a></div><div><a href="/面试/WebServer项目解析/" title="WebServer项目解析"><img class="cover" src="https://pic.rmb.bdstatic.com/bjh/39c69a365c6f2c263d521ff2b80a1efd.png" alt="cover"><div class="content is-center"><div class="date"><i class="far fa-calendar-alt fa-fw"></i> 2022-06-15</div><div class="title">WebServer项目解析</div></div></a></div><div><a href="/面试/进程间通信/" title="进程间通信"><img class="cover" src="https://pic.rmb.bdstatic.com/bjh/ffd91bf2df53f05f2a1335acb23ae44f.jpeg" alt="cover"><div class="content is-center"><div class="date"><i class="far fa-calendar-alt fa-fw"></i> 2022-07-14</div><div class="title">进程间通信</div></div></a></div><div><a href="/面试/C++知识点总结/" title="C++知识点总结"><img class="cover" src="https://img30.360buyimg.com/pop/jfs/t1/143950/1/26833/298507/61ea0bf4E4b3dfa6e/cba671ea7f81ef12.jpg" alt="cover"><div class="content is-center"><div class="date"><i class="far fa-calendar-alt fa-fw"></i> 2022-01-11</div><div class="title">C++知识点总结</div></div></a></div></div></div><hr/><div id="post-comment"><div class="comment-head"><div class="comment-headline"><i class="fas fa-comments fa-fw"></i><span> Comment</span></div></div><div class="comment-wrap"><div><div class="vcomment" id="vcomment"></div></div></div></div></div><div class="aside-content" id="aside-content"><div class="card-widget card-info"><div class="card-info-avatar is-center"><img class="avatar-img" src="https://i.loli.net/2021/11/01/ilJyOSYrF7m4M3X.png" onerror="this.onerror=null;this.src='/img/friend_404.gif'" alt="avatar"/><div class="author-info__name">Sakura.</div><div class="author-info__description">升起的烟花,从下面看?还是从侧面看?</div></div><div class="card-info-data"><div class="card-info-data-item is-center"><a href="/archives/"><div class="headline">Articles</div><div class="length-num">46</div></a></div><div class="card-info-data-item is-center"><a href="/tags/"><div class="headline">Tags</div><div class="length-num">8</div></a></div><div class="card-info-data-item is-center"><a href="/categories/"><div class="headline">Categories</div><div class="length-num">7</div></a></div></div><a class="button--animated" id="card-info-btn" target="_blank" rel="noopener" href="https://github.com/KiritoZz6"><i class="fab fa-github"></i><span>关注我</span></a><div class="card-info-social-icons is-center"><a class="social-icon" href="https://github.com/KiritoZz6" target="_blank" title="Github"><i class="fab fa-github"></i></a><a class="social-icon" href="/sakura_zz@163.com" target="_blank" title="Email"><i class="fas fa-envelope"></i></a></div></div><div class="card-widget card-announcement"><div class="item-headline"><i class="fas fa-bullhorn card-announcement-animation"></i><span>Announcement</span></div><div class="announcement_content">欢迎来到我的个人博客！如果对文章有问题或者发现错误可以发邮件给我，Email：sakura_zz@163.com</div></div><div class="sticky_layout"><div class="card-widget" id="card-toc"><div class="item-headline"><i class="fas fa-stream"></i><span>Catalog</span></div><div class="toc-content"><ol class="toc"><li class="toc-item toc-level-1"><a class="toc-link" href="#%E4%B8%BA%E4%BB%80%E4%B9%88%E5%AE%A2%E6%88%B7%E7%AB%AF%E4%B8%8D%E9%87%87%E7%94%A8P2P%E7%9A%84%E6%96%B9%E5%BC%8F%E9%80%9A%E4%BF%A1%EF%BC%8C%E8%80%8C%E6%98%AF%E9%87%87%E7%94%A8%E6%9C%8D%E5%8A%A1%E5%99%A8%E8%BD%AC%E5%8F%91%E6%B6%88%E6%81%AF%E7%9A%84%E6%96%B9%E5%BC%8F%EF%BC%9F"><span class="toc-number">1.</span> <span class="toc-text">为什么客户端不采用P2P的方式通信，而是采用服务器转发消息的方式？</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#%E6%80%8E%E4%B9%88%E4%BF%9D%E8%AF%81%E6%B6%88%E6%81%AF%E6%8C%89%E9%A1%BA%E5%BA%8F%E6%98%BE%E7%A4%BA%EF%BC%88%E4%B8%A4%E4%B8%AA%E6%96%B9%E6%A1%88%EF%BC%8C%E4%B8%80%E4%B8%AA%E5%8F%AF%E8%A1%8C%E4%B8%80%E4%B8%AA%E4%B8%8D%E5%8F%AF%E8%A1%8C%EF%BC%89"><span class="toc-number">2.</span> <span class="toc-text">怎么保证消息按顺序显示（两个方案，一个可行一个不可行）</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#%E9%A6%96%E5%85%88%E8%80%83%E8%99%91%E6%B7%BB%E5%8A%A0%E6%97%B6%E9%97%B4%E6%88%B3%E7%9A%84%E6%96%B9%E6%A1%88%EF%BC%88%E4%B8%8D%E5%8F%AF%E8%A1%8C%EF%BC%89"><span class="toc-number">2.1.</span> <span class="toc-text">首先考虑添加时间戳的方案（不可行）</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E8%B0%81%E5%85%88%E5%88%B0%E8%BE%BE%E6%9C%8D%E5%8A%A1%E7%AB%AF%EF%BC%9F"><span class="toc-number">2.1.1.</span> <span class="toc-text">谁先到达服务端？</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%AE%A2%E6%88%B7%E7%AB%AF%E8%BF%98%E8%A6%81%E8%BF%9B%E8%A1%8C%E6%8E%92%E5%BA%8F"><span class="toc-number">2.1.2.</span> <span class="toc-text">客户端还要进行排序</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%8F%A6%E4%B8%80%E4%B8%AA%E6%96%B9%E6%A1%88%E2%80%94%E2%80%94%E7%BB%B4%E6%8A%A4%E4%B8%80%E4%B8%AAseq%E6%A0%87%E5%BF%97%E4%BD%8D%EF%BC%88%E5%8F%AF%E8%A1%8C%EF%BC%89"><span class="toc-number">2.2.</span> <span class="toc-text">另一个方案——维护一个seq标志位（可行）</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%8F%91%E9%80%81%E6%B6%88%E6%81%AF%E5%8F%88%E6%80%8E%E4%B9%88%E7%BC%96%E5%86%99%E5%8F%91%E9%80%81%E7%9A%84seq%E5%8F%B7%E5%91%A2%EF%BC%9F"><span class="toc-number">2.2.1.</span> <span class="toc-text">发送消息又怎么编写发送的seq号呢？</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E7%A1%AE%E5%AE%9A%E6%94%B6%E5%88%B0%E6%B6%88%E6%81%AF%E5%90%8E%E6%89%8Dseq-%EF%BC%88%E6%B6%88%E6%81%AF%E7%9A%84%E4%BC%A0%E8%BE%93%E7%9A%84%E5%8F%AF%E9%9D%A0%E6%80%A7%EF%BC%89"><span class="toc-number">2.2.2.</span> <span class="toc-text">确定收到消息后才seq++（消息的传输的可靠性）</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E7%BE%A4%E8%81%8A%E7%9A%84seq%E5%8F%88%E5%BE%97%E6%80%8E%E4%B9%88%E6%A0%B7%E5%91%A2%EF%BC%9F%EF%BC%88%E4%B8%8D%E8%A6%81%E6%B1%82%E6%B6%88%E6%81%AF%E9%A1%BA%E5%BA%8F%E5%88%B0%E8%BE%BE%E6%9C%8D%E5%8A%A1%E5%99%A8%EF%BC%8C%E4%BD%86%E8%A6%81%E6%B1%82%E9%A1%BA%E5%BA%8F%E6%98%BE%E7%A4%BA%E5%9C%A8%E6%AF%8F%E4%B8%AA%E5%AE%A2%E6%88%B7%E7%AB%AF%EF%BC%89"><span class="toc-number">2.2.3.</span> <span class="toc-text">群聊的seq又得怎么样呢？（不要求消息顺序到达服务器，但要求顺序显示在每个客户端）</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%86%8D%E4%BC%98%E5%8C%96"><span class="toc-number">2.2.4.</span> <span class="toc-text">再优化</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E6%80%BB%E7%BB%93"><span class="toc-number">2.3.</span> <span class="toc-text">总结</span></a></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#%E5%A6%82%E4%BD%95%E7%A1%AE%E4%BF%9D%E6%B6%88%E6%81%AF%E7%9A%84%E5%8F%AF%E9%9D%A0%E6%80%A7%EF%BC%9F%EF%BC%88%E6%B6%88%E6%81%AF%E4%B8%8D%E4%B8%A2%EF%BC%8C%E6%B6%88%E6%81%AF%E4%B8%8D%E9%87%8D%EF%BC%89"><span class="toc-number">3.</span> <span class="toc-text">如何确保消息的可靠性？（消息不丢，消息不重）</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#TCP%E5%B9%B6%E4%B8%8D%E8%83%BD%E4%BF%9D%E8%AF%81%E5%9C%A8%E7%BA%BF%E6%B6%88%E6%81%AF%E7%9A%84%E2%80%9C%E5%8F%AF%E9%9D%A0%E6%80%A7%E2%80%9D"><span class="toc-number">3.1.</span> <span class="toc-text">TCP并不能保证在线消息的“可靠性”</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E9%82%A3%E4%B9%88%E5%9C%A8%E7%BA%BF%E6%B6%88%E6%81%AF%E6%80%8E%E4%B9%88%E4%BF%9D%E8%AF%81%E5%85%B6%E5%8F%AF%E9%9D%A0%E6%80%A7%E5%91%A2%EF%BC%9F"><span class="toc-number">3.2.</span> <span class="toc-text">那么在线消息怎么保证其可靠性呢？</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E7%A6%BB%E7%BA%BF%E6%B6%88%E6%81%AF%E4%B9%9F%E8%A6%81%E4%BF%9D%E8%AF%81%E5%8F%AF%E9%9D%A0%E6%80%A7"><span class="toc-number">3.3.</span> <span class="toc-text">离线消息也要保证可靠性</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E6%B6%88%E6%81%AF%E4%B8%8D%E4%B8%A2%E5%A4%B1%E4%BF%9D%E8%AF%81%E4%BA%86%EF%BC%8C%E9%82%A3%E6%B6%88%E6%81%AF%E9%87%8D%E5%A4%8D%E6%80%8E%E4%B9%88%E5%8A%9E%E5%91%A2%EF%BC%9F%EF%BC%9F"><span class="toc-number">3.4.</span> <span class="toc-text">消息不丢失保证了，那消息重复怎么办呢？？</span></a></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#%E6%89%A9%E5%B1%95%EF%BC%9A%E5%8F%A6%E7%A7%8D%E9%9A%8F%E6%9C%BAUID%E7%94%9F%E6%88%90%E7%AE%97%E6%B3%95%E2%80%93Snowflake%EF%BC%88%E9%9B%AA%E8%8A%B1%E7%AE%97%E6%B3%95%EF%BC%89"><span class="toc-number">4.</span> <span class="toc-text">扩展：另种随机UID生成算法–Snowflake（雪花算法）</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#%E6%B6%88%E6%81%AF%E6%98%8E%E6%96%87%E4%BC%A0%E8%BE%93%E7%9A%84%E5%AE%89%E5%85%A8%E9%97%AE%E9%A2%98"><span class="toc-number">5.</span> <span class="toc-text">消息明文传输的安全问题</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#%E8%A6%81%E9%80%89%E6%8B%A9%E4%BB%80%E4%B9%88%E5%8A%A0%E5%AF%86%E6%96%B9%E5%BC%8F%E5%91%A2%EF%BC%9F"><span class="toc-number">5.1.</span> <span class="toc-text">要选择什么加密方式呢？</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E8%87%AA%E5%B7%B1%E6%83%B3%E5%88%B0%E7%9A%84%E4%B8%80%E4%B8%AA%E6%96%B0%E9%97%AE%E9%A2%98%EF%BC%9AHTTPS%E6%98%AF%E5%BA%94%E7%94%A8%E5%9C%A8%E7%AB%AF%E5%AF%B9%E7%AB%AF%E9%80%9A%E4%BF%A1%E8%BF%87%E7%A8%8B%EF%BC%8C%E5%A6%82%E6%9E%9C%E6%98%AF%E9%A1%B9%E7%9B%AE%E8%BF%99%E7%A7%8D%E6%9C%8D%E5%8A%A1%E5%99%A8%E4%B8%AD%E7%BB%A7%E7%AB%99%E6%A8%A1%E5%BC%8F%E7%9A%84%E6%80%8E%E4%B9%88%E5%AE%9E%E7%8E%B0%E5%8A%A0%E5%AF%86%E5%91%A2%EF%BC%9F"><span class="toc-number">5.2.</span> <span class="toc-text">自己想到的一个新问题：HTTPS是应用在端对端通信过程，如果是项目这种服务器中继站模式的怎么实现加密呢？</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E4%B8%A4%E4%B8%AA%E4%B8%8D%E5%8F%AF%E5%8F%96%E7%9A%84%E6%80%9D%E8%B7%AF%EF%BC%9A"><span class="toc-number">5.2.1.</span> <span class="toc-text">两个不可取的思路：</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E4%B8%A4%E5%85%A8%E5%85%B6%E7%BE%8E%E7%9A%84%E6%96%B9%E6%A1%88%EF%BC%9A"><span class="toc-number">5.2.2.</span> <span class="toc-text">两全其美的方案：</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E6%89%A9%E5%B1%95%EF%BC%9A%E4%B8%80%E4%BA%9B%E5%85%B3%E4%BA%8E%E4%BC%A0%E8%BE%93%E5%AE%89%E5%85%A8%E7%9A%84%E6%96%87%E7%AB%A0"><span class="toc-number">5.3.</span> <span class="toc-text">扩展：一些关于传输安全的文章</span></a></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#TODO-%E4%B8%BA%E4%BB%80%E4%B9%88%E9%80%89%E7%94%A8%E6%B6%88%E6%81%AF%E9%98%9F%E5%88%97%EF%BC%88%E6%B6%88%E6%81%AF%E9%98%9F%E5%88%97%E6%84%8F%E4%B9%89%EF%BC%89"><span class="toc-number">6.</span> <span class="toc-text">TODO:为什么选用消息队列（消息队列意义）</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#%E4%B8%BA%E4%BB%80%E4%B9%88%E8%A6%81%E7%94%A8Redis%E4%BD%9C%E4%B8%BA%E8%B7%A8%E6%9C%8D%E5%8A%A1%E5%99%A8%E9%80%9A%E4%BF%A1%E7%9A%84%E4%B8%AD%E9%97%B4%E4%BB%B6"><span class="toc-number">7.</span> <span class="toc-text">为什么要用Redis作为跨服务器通信的中间件</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#Redis%E4%B8%8D%E7%A8%B3%E5%AE%9A%E6%8C%82%E6%8E%89%E4%BA%86%E6%80%8E%E4%B9%88%E5%8A%9E"><span class="toc-number">8.</span> <span class="toc-text">Redis不稳定挂掉了怎么办</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#%E4%B8%BA%E4%BB%80%E4%B9%88%E5%90%84%E4%B8%AAServer%E4%B8%8D%E8%83%BD%E7%9B%B8%E4%BA%92%E7%9B%B4%E6%8E%A5%E9%80%9A%E4%BF%A1%E5%91%A2%EF%BC%9F"><span class="toc-number">9.</span> <span class="toc-text">为什么各个Server不能相互直接通信呢？</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#%E6%95%B0%E6%8D%AE%E5%BA%93%E8%A1%A8%E6%98%AF%E6%80%8E%E4%B9%88%E8%AE%BE%E8%AE%A1%E7%9A%84"><span class="toc-number">10.</span> <span class="toc-text">数据库表是怎么设计的</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#%E7%94%A8%E6%88%B7%E8%A1%A8"><span class="toc-number">10.1.</span> <span class="toc-text">用户表</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%A5%BD%E5%8F%8B%E8%A1%A8%EF%BC%88%E4%B8%A4%E7%A7%8D%E8%AE%BE%E8%AE%A1%E6%96%B9%E6%A1%88%EF%BC%89"><span class="toc-number">10.2.</span> <span class="toc-text">好友表（两种设计方案）</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E7%AC%AC%E4%B8%80%E7%A7%8D%E6%96%B9%E6%A1%88"><span class="toc-number">10.2.1.</span> <span class="toc-text">第一种方案</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E7%AC%AC%E4%BA%8C%E7%A7%8D%E6%96%B9%E6%A1%88"><span class="toc-number">10.2.2.</span> <span class="toc-text">第二种方案</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E7%BE%A4%E7%BB%84%E4%BF%A1%E6%81%AF%E8%A1%A8"><span class="toc-number">10.3.</span> <span class="toc-text">群组信息表</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E7%BE%A4%E7%BB%84%E6%88%90%E5%91%98"><span class="toc-number">10.4.</span> <span class="toc-text">群组成员</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E7%A6%BB%E7%BA%BF%E4%BF%A1%E6%81%AF%E8%A1%A8"><span class="toc-number">10.5.</span> <span class="toc-text">离线信息表</span></a></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#TODO-%E7%A6%BB%E7%BA%BF%E6%B6%88%E6%81%AF%E6%80%8E%E4%B9%88%E5%AD%98%E5%82%A8%EF%BC%88%E5%8A%A0%E5%AF%86%EF%BC%9F%E8%BF%98%E6%98%AF%E6%98%8E%E6%96%87%EF%BC%9F%EF%BC%89"><span class="toc-number">11.</span> <span class="toc-text">TODO:离线消息怎么存储（加密？还是明文？）</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#TODO-%E5%AE%B9%E7%81%BE%E6%96%B9%E6%A1%88"><span class="toc-number">12.</span> <span class="toc-text">TODO:容灾方案</span></a></li></ol></div></div><div class="card-widget card-recent-post"><div class="item-headline"><i class="fas fa-history"></i><span>Recent Post</span></div><div class="aside-list"><div class="aside-list-item"><a class="thumbnail" href="/%E9%9D%A2%E8%AF%95/C++-%E9%9B%86%E7%BE%A4%E8%81%8A%E5%A4%A9%E6%9C%8D%E5%8A%A1%E5%99%A8%EF%BC%88%E7%BB%86%E8%8A%82%E9%97%AE%E9%A2%98%E7%AF%87%EF%BC%89/" title="C++集群聊天服务器（细节问题篇）"><img src="https://p.qlogo.cn/hy_personal/3e28f14aa0516842cca4bda79cde803eb27dc704e582549a4cc8c5dea1360098/0.png" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="C++集群聊天服务器（细节问题篇）"/></a><div class="content"><a class="title" href="/%E9%9D%A2%E8%AF%95/C++-%E9%9B%86%E7%BE%A4%E8%81%8A%E5%A4%A9%E6%9C%8D%E5%8A%A1%E5%99%A8%EF%BC%88%E7%BB%86%E8%8A%82%E9%97%AE%E9%A2%98%E7%AF%87%EF%BC%89/" title="C++集群聊天服务器（细节问题篇）">C++集群聊天服务器（细节问题篇）</a><time datetime="2022-09-02T02:41:04.000Z" title="Created 2022-09-02 10:41:04">2022-09-02</time></div></div><div class="aside-list-item"><a class="thumbnail" href="/%E9%9D%A2%E8%AF%95/C++-%E9%9B%86%E7%BE%A4%E8%81%8A%E5%A4%A9%E6%9C%8D%E5%8A%A1%E5%99%A8%EF%BC%88%E4%BC%98%E5%8C%96%E7%AF%87%EF%BC%89/" title="C++集群聊天服务器（优化篇）"><img src="https://pic.rmb.bdstatic.com/bjh/f4a9fb349489af60d0af1b1ccfca71fe.jpeg" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="C++集群聊天服务器（优化篇）"/></a><div class="content"><a class="title" href="/%E9%9D%A2%E8%AF%95/C++-%E9%9B%86%E7%BE%A4%E8%81%8A%E5%A4%A9%E6%9C%8D%E5%8A%A1%E5%99%A8%EF%BC%88%E4%BC%98%E5%8C%96%E7%AF%87%EF%BC%89/" title="C++集群聊天服务器（优化篇）">C++集群聊天服务器（优化篇）</a><time datetime="2022-07-24T15:10:26.000Z" title="Created 2022-07-24 23:10:26">2022-07-24</time></div></div><div class="aside-list-item"><a class="thumbnail" href="/%E9%9D%A2%E8%AF%95/C++%E9%9B%86%E7%BE%A4%E8%81%8A%E5%A4%A9%E6%9C%8D%E5%8A%A1%E5%99%A8%EF%BC%88%E6%AD%A3%E5%BC%8F%E5%86%85%E5%AE%B9%E7%AF%87%EF%BC%89/" title="C++集群聊天服务器（正式内容篇）"><img src="https://pic.rmb.bdstatic.com/bjh/5c2c84703a1bba59b28ba5819bf00b1e.jpeg" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="C++集群聊天服务器（正式内容篇）"/></a><div class="content"><a class="title" href="/%E9%9D%A2%E8%AF%95/C++%E9%9B%86%E7%BE%A4%E8%81%8A%E5%A4%A9%E6%9C%8D%E5%8A%A1%E5%99%A8%EF%BC%88%E6%AD%A3%E5%BC%8F%E5%86%85%E5%AE%B9%E7%AF%87%EF%BC%89/" title="C++集群聊天服务器（正式内容篇）">C++集群聊天服务器（正式内容篇）</a><time datetime="2022-07-17T03:56:18.000Z" title="Created 2022-07-17 11:56:18">2022-07-17</time></div></div><div class="aside-list-item"><a class="thumbnail" href="/%E9%9D%A2%E8%AF%95/%E6%9A%91%E5%81%87%E5%86%B2%E5%88%BA%E7%A7%8B%E6%8B%9B%E9%A1%B9%E7%9B%AE-C++%E9%9B%86%E7%BE%A4%E8%81%8A%E5%A4%A9%E6%9C%8D%E5%8A%A1%E5%99%A8%EF%BC%88%E9%A2%84%E5%A4%87%E7%9F%A5%E8%AF%86%E7%AF%87%EF%BC%89/" title="暑假冲刺秋招项目--C++集群聊天服务器（预备知识篇）"><img src="https://pic.rmb.bdstatic.com/bjh/d488e66d13da478d5eab285e068bdcd3.jpeg" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="暑假冲刺秋招项目--C++集群聊天服务器（预备知识篇）"/></a><div class="content"><a class="title" href="/%E9%9D%A2%E8%AF%95/%E6%9A%91%E5%81%87%E5%86%B2%E5%88%BA%E7%A7%8B%E6%8B%9B%E9%A1%B9%E7%9B%AE-C++%E9%9B%86%E7%BE%A4%E8%81%8A%E5%A4%A9%E6%9C%8D%E5%8A%A1%E5%99%A8%EF%BC%88%E9%A2%84%E5%A4%87%E7%9F%A5%E8%AF%86%E7%AF%87%EF%BC%89/" title="暑假冲刺秋招项目--C++集群聊天服务器（预备知识篇）">暑假冲刺秋招项目--C++集群聊天服务器（预备知识篇）</a><time datetime="2022-07-16T06:38:33.000Z" title="Created 2022-07-16 14:38:33">2022-07-16</time></div></div><div class="aside-list-item"><a class="thumbnail" href="/%E9%9D%A2%E8%AF%95/%E8%BF%9B%E7%A8%8B%E9%97%B4%E9%80%9A%E4%BF%A1/" title="进程间通信"><img src="https://pic.rmb.bdstatic.com/bjh/ffd91bf2df53f05f2a1335acb23ae44f.jpeg" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="进程间通信"/></a><div class="content"><a class="title" href="/%E9%9D%A2%E8%AF%95/%E8%BF%9B%E7%A8%8B%E9%97%B4%E9%80%9A%E4%BF%A1/" title="进程间通信">进程间通信</a><time datetime="2022-07-13T16:15:46.000Z" title="Created 2022-07-14 00:15:46">2022-07-14</time></div></div></div></div></div></div></main><footer id="footer"><div id="footer-wrap"><div class="copyright">&copy;2020 - 2022 By Sakura.</div><div class="framework-info"><span>Framework </span><a target="_blank" rel="noopener" href="https://hexo.io">Hexo</a><span class="footer-separator">|</span><span>Theme </span><a target="_blank" rel="noopener" href="https://github.com/jerryc127/hexo-theme-butterfly">Butterfly</a></div></div></footer></div><div id="rightside"><div id="rightside-config-hide"><button id="readmode" type="button" title="Read Mode"><i class="fas fa-book-open"></i></button><button id="translateLink" type="button" title="Toggle Between Traditional Chinese And Simplified Chinese">繁</button><button id="darkmode" type="button" title="Toggle Between Light And Dark Mode"><i class="fas fa-adjust"></i></button><button id="hide-aside-btn" type="button" title="Toggle between single-column and double-column"><i class="fas fa-arrows-alt-h"></i></button></div><div id="rightside-config-show"><button id="rightside_config" type="button" title="Setting"><i class="fas fa-cog fa-spin"></i></button><button class="close" id="mobile-toc-button" type="button" title="Table Of Contents"><i class="fas fa-list-ul"></i></button><a id="to_comment" href="#post-comment" title="Scroll To Comments"><i class="fas fa-comments"></i></a><button id="go-up" type="button" title="Back To Top"><i class="fas fa-arrow-up"></i></button></div></div><div><script src="/js/utils.js"></script><script src="/js/main.js"></script><script src="/js/tw_cn.js"></script><script>var preloader = {
  endLoading: () => {
    document.body.style.overflow = 'auto';
    document.getElementById('loading-box').classList.add("loaded")
  },
  initLoading: () => {
    document.body.style.overflow = '';
    document.getElementById('loading-box').classList.remove("loaded")

  }
}
window.addEventListener('load',preloader.endLoading())</script><div class="js-pjax"><script>function loadValine () {
  function initValine () {
    const valine = new Valine(Object.assign({
      el: '#vcomment',
      appId: 'uoCtAtvANzWpqnPNGCNRPK7g-gzGzoHsz',
      appKey: 'NIjj8lYmojE9cbwXtTlGUh6F',
      placeholder: '记得留下你的昵称和邮箱....可以快速收到回复',
      avatar: 'monsterid',
      meta: 'nick,mail,link'.split(','),
      pageSize: '10',
      lang: 'zh-CN',
      recordIP: true,
      serverURLs: '',
      emojiCDN: '',
      emojiMaps: "",
      enableQQ: false,
      path: window.location.pathname,
      requiredFields: ["nick,mail"],
      visitor: false
    }, null))
  }

  if (typeof Valine === 'function') initValine() 
  else getScript('https://cdn.jsdelivr.net/npm/valine/dist/Valine.min.js').then(initValine)
}

if ('Valine' === 'Valine' || !false) {
  if (false) btf.loadComment(document.getElementById('vcomment'),loadValine)
  else setTimeout(loadValine, 0)
} else {
  function loadOtherComment () {
    loadValine()
  }
}</script></div><script defer src="/live2d-widget/autoload.js"></script><script src="/cdn.bootcss.com/highlight.js/9.2.0/highlight.min.js"></script><script src="https://cdn.jsdelivr.net/npm/butterfly-extsrc@1/dist/activate-power-mode.min.js"></script><script>POWERMODE.colorful = true;
POWERMODE.shake = false;
POWERMODE.mobile = false;
document.body.addEventListener('input', POWERMODE);
</script><script id="click-heart" src="https://cdn.jsdelivr.net/npm/butterfly-extsrc@1/dist/click-heart.min.js" async="async" mobile="true"></script><script async data-pjax src="//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script></div></body></html>