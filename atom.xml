<?xml version="1.0" encoding="utf-8"?>
<feed xmlns="http://www.w3.org/2005/Atom">
  <title>🌸樱花酒吧🍻</title>
  
  <subtitle>🌸Sakura-Pub🍻</subtitle>
  <link href="http://sakura-pub.ltd/atom.xml" rel="self"/>
  
  <link href="http://sakura-pub.ltd/"/>
  <updated>2021-08-05T07:07:43.002Z</updated>
  <id>http://sakura-pub.ltd/</id>
  
  <author>
    <name>Sakura.</name>
    
  </author>
  
  <generator uri="https://hexo.io/">Hexo</generator>
  
  <entry>
    <title>Unity笔记29-制作主菜单界面</title>
    <link href="http://sakura-pub.ltd/UnityNotes/Unity%E7%AC%94%E8%AE%B029-%E5%88%B6%E4%BD%9C%E4%B8%BB%E8%8F%9C%E5%8D%95%E7%95%8C%E9%9D%A2/"/>
    <id>http://sakura-pub.ltd/UnityNotes/Unity%E7%AC%94%E8%AE%B029-%E5%88%B6%E4%BD%9C%E4%B8%BB%E8%8F%9C%E5%8D%95%E7%95%8C%E9%9D%A2/</id>
    <published>2021-08-05T01:15:59.000Z</published>
    <updated>2021-08-05T07:07:43.002Z</updated>
    
    <content type="html"><![CDATA[<p>本章我们来为游戏制作一个主菜单界面</p><h1 id="在新场景中绘制画布"><a href="#在新场景中绘制画布" class="headerlink" title="在新场景中绘制画布"></a>在新场景中绘制画布</h1><p>我们要专门为我们的菜单新建一个场景，而菜单则是在这个新场景中绘制的</p><p>我这里先把场景搭建好了，注意我们在摆放人物的时候可以点击右键菜单进行<code>脱包</code>处理，这样我们移除组件时就不会影响到素材里面的模板了</p><img src="https://i.loli.net/2021/08/05/29wfpAg8ZEyLdDG.png" style="zoom:80%;" /><p>然后我们也把UI摆放好</p><img src="https://i.loli.net/2021/08/05/sHZyaWhDmL6qEvK.png" style="zoom:80%;" /><p>同时我们也可以给UI添加一些视觉效果的处理</p><h2 id="将UI添加立体效果"><a href="#将UI添加立体效果" class="headerlink" title="将UI添加立体效果"></a>将UI添加立体效果</h2><p>这里可以添加一种效果，我想点击new game 时候相机会穿过标题UI然后靠近传送门的样式，下面就来实现一下</p><p>我们选中画布，然后如下图设置，将<code>Render Mode</code>选择为<code>Camera</code>，再把摄像机拖到下面的框框里</p><img src="https://i.loli.net/2021/08/05/VQnMjOfywAeiNTh.png" style="zoom:80%;" /><p>这时候点击运行会发现按钮给场景遮挡住了，这时候我们可以调一下<code>Plane Distance</code>，比如改成1，按钮就又可以看到了</p><p>最后我们再把<code>Render Mode</code>改为<code>World Space</code>，然后尝试向前移动相机，就可以发现达成了相机穿越标题的效果了，之所以要经过上面的步骤是因为可以让Unity自动调节UI的合适位置</p><h1 id="编写代码"><a href="#编写代码" class="headerlink" title="编写代码"></a>编写代码</h1><p>UI建立好之后我们就要来实现按钮的功能了</p><img src="https://i.loli.net/2021/08/05/uZCjd6oGp7DJqe3.png" style="zoom:80%;" /><p>按钮最主要就是监听事件，下面先单独来写各种功能的方法，最后再配上整个代码文件</p><h2 id="Exit"><a href="#Exit" class="headerlink" title="Exit"></a>Exit</h2><p>其中最简单的就是退出游戏，一行搞定</p><pre class="line-numbers language-csharp" data-language="csharp"><code class="language-csharp"><span class="token return-type class-name"><span class="token keyword">void</span></span> <span class="token function">QuitGame</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span><span class="token comment">//退出游戏功能</span>        Application<span class="token punctuation">.</span><span class="token function">Quit</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre><h2 id="NewGame"><a href="#NewGame" class="headerlink" title="NewGame"></a>NewGame</h2><p>然后是创建新游戏，这里就要涉及多个代码文件</p><pre class="line-numbers language-csharp" data-language="csharp"><code class="language-csharp"><span class="token comment">//MainMenu.cs</span><span class="token return-type class-name"><span class="token keyword">void</span></span> <span class="token function">NewGame</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>        <span class="token comment">//清楚所有存档</span>        PlayerPrefs<span class="token punctuation">.</span><span class="token function">DeleteAll</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token comment">//转换场景</span>        <span class="token comment">//会在SceneController里面完成</span>        SceneController<span class="token punctuation">.</span>Instance<span class="token punctuation">.</span><span class="token function">TransitionToFirstLevel</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">//加载第一个场景</span>    <span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><pre class="line-numbers language-csharp" data-language="csharp"><code class="language-csharp"><span class="token comment">//SceneController.cs</span><span class="token comment">//转换场景，可用于在标题界面过渡到第一个界面中</span>    <span class="token return-type class-name">IEnumerator</span> <span class="token function">LoadLevel</span><span class="token punctuation">(</span><span class="token class-name"><span class="token keyword">string</span></span> scene<span class="token punctuation">)</span><span class="token punctuation">&#123;</span>        <span class="token keyword">if</span><span class="token punctuation">(</span>scene<span class="token operator">!=</span><span class="token string">""</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span><span class="token comment">//传入参数不为空</span>            <span class="token comment">//加载场景</span>            <span class="token keyword">yield</span> <span class="token keyword">return</span> SceneManager<span class="token punctuation">.</span><span class="token function">LoadSceneAsync</span><span class="token punctuation">(</span>scene<span class="token punctuation">)</span><span class="token punctuation">;</span>            <span class="token comment">//加载人物，在GMaeManager中创建了一个用于获得初始位置的方法</span>            <span class="token keyword">yield</span> <span class="token keyword">return</span> player <span class="token operator">=</span> <span class="token function">Instantiate</span><span class="token punctuation">(</span>playerPrefab<span class="token punctuation">,</span>            GameManager<span class="token punctuation">.</span>Instance<span class="token punctuation">.</span><span class="token function">GetEntrance</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span>position<span class="token punctuation">,</span>            GameManager<span class="token punctuation">.</span>Instance<span class="token punctuation">.</span><span class="token function">GetEntrance</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span>rotation<span class="token punctuation">)</span><span class="token punctuation">;</span>            <span class="token comment">//保存数据</span>            SaveManager<span class="token punctuation">.</span>Instance<span class="token punctuation">.</span><span class="token function">SavePlayerData</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>            <span class="token keyword">yield</span> <span class="token keyword">break</span><span class="token punctuation">;</span><span class="token comment">//结束协程</span>        <span class="token punctuation">&#125;</span>    <span class="token punctuation">&#125;</span>    <span class="token comment">//加载第一个场景，可以将这个直接放在标题界面的功能里</span>    <span class="token keyword">public</span> <span class="token return-type class-name"><span class="token keyword">void</span></span> <span class="token function">TransitionToFirstLevel</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>        <span class="token function">StartCoroutine</span><span class="token punctuation">(</span><span class="token function">LoadLevel</span><span class="token punctuation">(</span><span class="token string">"3D RPG"</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><pre class="line-numbers language-csharp" data-language="csharp"><code class="language-csharp"><span class="token comment">//GmaeManager.cs</span><span class="token comment">//获得场景加载入口，这里是标题界面进入主场景时用于获得落地点</span>    <span class="token keyword">public</span> <span class="token return-type class-name">Transform</span> <span class="token function">GetEntrance</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>        <span class="token keyword">foreach</span><span class="token punctuation">(</span><span class="token class-name"><span class="token keyword">var</span></span> item <span class="token keyword">in</span> <span class="token generic-method"><span class="token function">FindObjectsOfType</span><span class="token generic class-name"><span class="token punctuation">&lt;</span>TransitionDestination<span class="token punctuation">></span></span></span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>            <span class="token keyword">if</span><span class="token punctuation">(</span>item<span class="token punctuation">.</span>destinationTag<span class="token operator">==</span>TransitionDestination<span class="token punctuation">.</span>DestinationTag<span class="token punctuation">.</span>ENTER<span class="token punctuation">)</span>                <span class="token keyword">return</span> item<span class="token punctuation">.</span>transform<span class="token punctuation">;</span>        <span class="token punctuation">&#125;</span>        <span class="token keyword">return</span> <span class="token keyword">null</span><span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>注意要把几个Manager对象复制到标题场景中</p><h2 id="Continue"><a href="#Continue" class="headerlink" title="Continue"></a>Continue</h2><p>由于我们游戏有多个场景，因此在加载功能中我们还要记住上次保存玩家是停留在哪一个场景，从而在加载存档时判断要加载哪一个场景的画面</p><p>也是有多个代码文件需要修改，需要注意区分</p><pre class="line-numbers language-csharp" data-language="csharp"><code class="language-csharp"><span class="token comment">//SaveManager.cs</span><span class="token class-name"><span class="token keyword">string</span></span> sceneName<span class="token operator">=</span><span class="token string">""</span><span class="token punctuation">;</span><span class="token comment">//记录保存场景的名字</span>    <span class="token keyword">public</span> <span class="token return-type class-name"><span class="token keyword">string</span></span> SceneName<span class="token punctuation">&#123;</span><span class="token keyword">get</span><span class="token punctuation">&#123;</span><span class="token keyword">return</span> PlayerPrefs<span class="token punctuation">.</span><span class="token function">GetString</span><span class="token punctuation">(</span>sceneName<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">&#125;</span><span class="token punctuation">&#125;</span>    <span class="token return-type class-name"><span class="token keyword">void</span></span> <span class="token function">Save</span><span class="token punctuation">(</span><span class="token class-name">UnityEngine<span class="token punctuation">.</span>Object</span> data<span class="token punctuation">,</span><span class="token class-name"><span class="token keyword">string</span></span> key<span class="token punctuation">)</span><span class="token punctuation">&#123;</span>        <span class="token class-name"><span class="token keyword">var</span></span> jsonData <span class="token operator">=</span> JsonUtility<span class="token punctuation">.</span><span class="token function">ToJson</span><span class="token punctuation">(</span>data<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">//转换为json</span>        PlayerPrefs<span class="token punctuation">.</span><span class="token function">SetString</span><span class="token punctuation">(</span>key<span class="token punctuation">,</span>jsonData<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">//再建立键值保存</span>        <span class="token comment">//在保存数据同时保存玩家停留在哪个场景</span>        PlayerPrefs<span class="token punctuation">.</span><span class="token function">SetString</span><span class="token punctuation">(</span>sceneName<span class="token punctuation">,</span>SceneManager<span class="token punctuation">.</span><span class="token function">GetActiveScene</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span>name<span class="token punctuation">)</span><span class="token punctuation">;</span>        PlayerPrefs<span class="token punctuation">.</span><span class="token function">Save</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><pre class="line-numbers language-csharp" data-language="csharp"><code class="language-csharp"><span class="token comment">//SceneController.cs</span><span class="token comment">//Continue</span>    <span class="token comment">//用于加载游戏的加载方法</span>    <span class="token keyword">public</span> <span class="token return-type class-name"><span class="token keyword">void</span></span> <span class="token function">TransitionToLoadGame</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>        <span class="token class-name"><span class="token keyword">string</span></span> sceneName <span class="token operator">=</span> SaveManager<span class="token punctuation">.</span>Instance<span class="token punctuation">.</span>SceneName<span class="token punctuation">;</span><span class="token comment">//获得上次保存场景名称，可能为空</span>        <span class="token keyword">if</span><span class="token punctuation">(</span>sceneName<span class="token operator">!=</span><span class="token string">""</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>            <span class="token comment">//不为空的话就加载场景</span>            <span class="token function">StartCoroutine</span><span class="token punctuation">(</span><span class="token function">LoadLevel</span><span class="token punctuation">(</span>sceneName<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token punctuation">&#125;</span>    <span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><pre class="line-numbers language-csharp" data-language="csharp"><code class="language-csharp"><span class="token comment">//PlayerController.cs</span><span class="token return-type class-name"><span class="token keyword">void</span></span> <span class="token function">OnEnable</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span><span class="token comment">//素材启用时注册事件</span>MouseManager<span class="token punctuation">.</span>Instance<span class="token punctuation">.</span>OnMouseClicked<span class="token operator">+=</span>MoveToTarget<span class="token punctuation">;</span>MouseManager<span class="token punctuation">.</span>Instance<span class="token punctuation">.</span>OnEnemyClicked<span class="token operator">+=</span>EventAttact<span class="token punctuation">;</span>GameManager<span class="token punctuation">.</span>Instance<span class="token punctuation">.</span><span class="token function">RigisterPlayer</span><span class="token punctuation">(</span>charcterStates<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">//注册GmaeManager</span><span class="token punctuation">&#125;</span><span class="token return-type class-name"><span class="token keyword">void</span></span> <span class="token function">Start</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span><span class="token comment">//加载人物数据</span>SaveManager<span class="token punctuation">.</span>Instance<span class="token punctuation">.</span><span class="token function">LoadPlayerData</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><pre class="line-numbers language-csharp" data-language="csharp"><code class="language-csharp"><span class="token comment">//MainMenu.cs</span>    <span class="token return-type class-name"><span class="token keyword">void</span></span> <span class="token function">ContinueGame</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>        <span class="token comment">//转换场景，读取进度</span>        SceneController<span class="token punctuation">.</span>Instance<span class="token punctuation">.</span><span class="token function">TransitionToLoadGame</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span></span></code></pre><h2 id="游戏中Esc返回主菜单"><a href="#游戏中Esc返回主菜单" class="headerlink" title="游戏中Esc返回主菜单"></a>游戏中Esc返回主菜单</h2><p>我们还有一个功能是在游戏内必要的，就是返回主菜单功能，这里也来实现一下</p><pre class="line-numbers language-csharp" data-language="csharp"><code class="language-csharp"><span class="token comment">//SaveManager.cs</span><span class="token return-type class-name"><span class="token keyword">void</span></span> <span class="token function">Update</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>       <span class="token keyword">if</span><span class="token punctuation">(</span>Input<span class="token punctuation">.</span><span class="token function">GetKeyDown</span><span class="token punctuation">(</span>KeyCode<span class="token punctuation">.</span>Escape<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>           <span class="token comment">//游戏中Esc回到主菜单</span>           SceneController<span class="token punctuation">.</span>Instance<span class="token punctuation">.</span><span class="token function">TransitionToMain</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>       <span class="token punctuation">&#125;</span>       <span class="token keyword">if</span><span class="token punctuation">(</span>Input<span class="token punctuation">.</span><span class="token function">GetKey</span><span class="token punctuation">(</span>KeyCode<span class="token punctuation">.</span>S<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token comment">//保存</span>           <span class="token function">SavePlayerData</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>       <span class="token keyword">if</span><span class="token punctuation">(</span>Input<span class="token punctuation">.</span><span class="token function">GetKey</span><span class="token punctuation">(</span>KeyCode<span class="token punctuation">.</span>L<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token comment">//读取</span>           <span class="token function">LoadPlayerData</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>   <span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><pre class="line-numbers language-csharp" data-language="csharp"><code class="language-csharp"><span class="token comment">//SceneController.cs</span><span class="token comment">//加载标题场景协程</span>    <span class="token return-type class-name">IEnumerator</span> <span class="token function">LoadMain</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>        <span class="token keyword">yield</span> <span class="token keyword">return</span> SceneManager<span class="token punctuation">.</span><span class="token function">LoadSceneAsync</span><span class="token punctuation">(</span><span class="token string">"Main"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token keyword">yield</span> <span class="token keyword">break</span><span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span>    <span class="token comment">//加载标题方法</span>    <span class="token keyword">public</span> <span class="token return-type class-name"><span class="token keyword">void</span></span> <span class="token function">TransitionToMain</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>        <span class="token function">StartCoroutine</span><span class="token punctuation">(</span><span class="token function">LoadMain</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>到这我们就成功实现了主菜单到游戏再到主菜单的过渡效果</p>]]></content>
    
    
      
      
    <summary type="html">&lt;p&gt;本章我们来为游戏制作一个主菜单界面&lt;/p&gt;
&lt;h1 id=&quot;在新场景中绘制画布&quot;&gt;&lt;a href=&quot;#在新场景中绘制画布&quot; class=&quot;headerlink&quot; title=&quot;在新场景中绘制画布&quot;&gt;&lt;/a&gt;在新场景中绘制画布&lt;/h1&gt;&lt;p&gt;我们要专门为我们的菜单新建一个场景</summary>
      
    
    
    
    <category term="Unity学习笔记" scheme="http://sakura-pub.ltd/categories/Unity%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/"/>
    
    
    <category term="Unity" scheme="http://sakura-pub.ltd/tags/Unity/"/>
    
  </entry>
  
  <entry>
    <title>Unity笔记28-保存数据</title>
    <link href="http://sakura-pub.ltd/UnityNotes/Unity%E7%AC%94%E8%AE%B028-%E4%BF%9D%E5%AD%98%E6%95%B0%E6%8D%AE/"/>
    <id>http://sakura-pub.ltd/UnityNotes/Unity%E7%AC%94%E8%AE%B028-%E4%BF%9D%E5%AD%98%E6%95%B0%E6%8D%AE/</id>
    <published>2021-08-04T01:32:04.000Z</published>
    <updated>2021-08-04T02:53:20.289Z</updated>
    
    <content type="html"><![CDATA[<p>这一章比较简单，我们来学习如何保存数据，用到的有两个重要的API，文章中会有介绍到</p><h1 id="认识API"><a href="#认识API" class="headerlink" title="认识API"></a>认识API</h1><p>这里我们用到两个API，一个是**<a href="https://docs.unity.cn/cn/2020.3/ScriptReference/EditorPrefs.html">PlayerPrefs</a><strong>类，虽然官方文档写的是EditorPrefs，但是他们的方法是一样的，另外一个要用到的API是</strong><a href="https://docs.unity.cn/cn/2020.3/ScriptReference/JsonUtility.ToJson.html">JsonUtility.ToJson</a>**方法</p><p>PlayerPrefs：用于本地持久化保存与读取的类，PlayerPrefs类工作原理非常简单，以键值对的形式将数据保存在文件中，然后程序可以根据这个名称取出上次保存的数值</p><p>JsonUtility.ToJson：生成对象的公共字段的 JSON 表示形式。</p><h1 id="编写代码"><a href="#编写代码" class="headerlink" title="编写代码"></a>编写代码</h1><p>我们新建一个<code>SaveManager.cs</code>然后来编写专门管理保存读取的类</p><pre class="line-numbers language-csharp" data-language="csharp"><code class="language-csharp"><span class="token keyword">using</span> <span class="token namespace">UnityEngine</span><span class="token punctuation">;</span><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">SaveManager</span> <span class="token punctuation">:</span> <span class="token type-list"><span class="token class-name">Singleton<span class="token punctuation">&lt;</span>SaveManager<span class="token punctuation">></span></span></span> <span class="token punctuation">&#123;</span>    <span class="token keyword">protected</span> <span class="token keyword">override</span> <span class="token return-type class-name"><span class="token keyword">void</span></span> <span class="token function">Awake</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>        <span class="token keyword">base</span><span class="token punctuation">.</span><span class="token function">Awake</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token function">DontDestroyOnLoad</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">//切换场景不销毁</span>    <span class="token punctuation">&#125;</span>    <span class="token return-type class-name"><span class="token keyword">void</span></span> <span class="token function">Update</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>        <span class="token keyword">if</span><span class="token punctuation">(</span>Input<span class="token punctuation">.</span><span class="token function">GetKey</span><span class="token punctuation">(</span>KeyCode<span class="token punctuation">.</span>S<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token comment">//保存</span>            <span class="token function">SavePlayerData</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token keyword">if</span><span class="token punctuation">(</span>Input<span class="token punctuation">.</span><span class="token function">GetKey</span><span class="token punctuation">(</span>KeyCode<span class="token punctuation">.</span>L<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token comment">//读取</span>            <span class="token function">LoadPlayerData</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span>    <span class="token keyword">public</span> <span class="token return-type class-name"><span class="token keyword">void</span></span> <span class="token function">SavePlayerData</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>        <span class="token class-name"><span class="token keyword">var</span></span> PlayerData <span class="token operator">=</span> GameManager<span class="token punctuation">.</span>Instance<span class="token punctuation">.</span>playerStates<span class="token punctuation">.</span>characterData<span class="token punctuation">;</span>        <span class="token function">Save</span><span class="token punctuation">(</span>PlayerData<span class="token punctuation">,</span>GameManager<span class="token punctuation">.</span>Instance<span class="token punctuation">.</span>playerStates<span class="token punctuation">.</span>characterData<span class="token punctuation">.</span>name<span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span>    <span class="token keyword">public</span> <span class="token return-type class-name"><span class="token keyword">void</span></span> <span class="token function">LoadPlayerData</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>        <span class="token class-name"><span class="token keyword">var</span></span> PlayerData <span class="token operator">=</span> GameManager<span class="token punctuation">.</span>Instance<span class="token punctuation">.</span>playerStates<span class="token punctuation">.</span>characterData<span class="token punctuation">;</span>        <span class="token function">Load</span><span class="token punctuation">(</span>PlayerData<span class="token punctuation">,</span>GameManager<span class="token punctuation">.</span>Instance<span class="token punctuation">.</span>playerStates<span class="token punctuation">.</span>characterData<span class="token punctuation">.</span>name<span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span>    <span class="token return-type class-name"><span class="token keyword">void</span></span> <span class="token function">Save</span><span class="token punctuation">(</span><span class="token class-name">UnityEngine<span class="token punctuation">.</span>Object</span> data<span class="token punctuation">,</span><span class="token class-name"><span class="token keyword">string</span></span> key<span class="token punctuation">)</span><span class="token punctuation">&#123;</span>        <span class="token class-name"><span class="token keyword">var</span></span> jsonData <span class="token operator">=</span> JsonUtility<span class="token punctuation">.</span><span class="token function">ToJson</span><span class="token punctuation">(</span>data<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">//转换为json</span>        PlayerPrefs<span class="token punctuation">.</span><span class="token function">SetString</span><span class="token punctuation">(</span>key<span class="token punctuation">,</span>jsonData<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">//再建立键值保存</span>        PlayerPrefs<span class="token punctuation">.</span><span class="token function">Save</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span>    <span class="token return-type class-name"><span class="token keyword">void</span></span> <span class="token function">Load</span><span class="token punctuation">(</span><span class="token class-name">UnityEngine<span class="token punctuation">.</span>Object</span> data<span class="token punctuation">,</span><span class="token class-name"><span class="token keyword">string</span></span> key<span class="token punctuation">)</span><span class="token punctuation">&#123;</span>        <span class="token keyword">if</span><span class="token punctuation">(</span>PlayerPrefs<span class="token punctuation">.</span><span class="token function">HasKey</span><span class="token punctuation">(</span>key<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span><span class="token comment">//如果键值存在的话就读取</span>            JsonUtility<span class="token punctuation">.</span><span class="token function">FromJsonOverwrite</span><span class="token punctuation">(</span>PlayerPrefs<span class="token punctuation">.</span><span class="token function">GetString</span><span class="token punctuation">(</span>key<span class="token punctuation">)</span><span class="token punctuation">,</span>data<span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token punctuation">&#125;</span>    <span class="token punctuation">&#125;</span><span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>此时我们就可以进游戏体验一下了，按<code>S</code>键是保存玩家当前数据，按<code>L</code>键是读取，并且保存后在下一次游戏启动时仍然可以读取数据</p><p>Windows系统可以在注册表上看到保存的数据</p><img src="https://i.loli.net/2021/08/04/jTPgFrdWL1wH96N.png" style="zoom:80%;" /><h1 id="跨场景保存读取"><a href="#跨场景保存读取" class="headerlink" title="跨场景保存读取"></a>跨场景保存读取</h1><p>既然我们在下一次开启游戏也可以读取玩家数据，那么跨场景也不在话下</p><p>去到<code>SceneController.cs</code>修改一下代码</p><pre class="line-numbers language-csharp" data-language="csharp"><code class="language-csharp"><span class="token return-type class-name">IEnumerator</span> <span class="token function">Transition</span><span class="token punctuation">(</span><span class="token class-name"><span class="token keyword">string</span></span> sceneName<span class="token punctuation">,</span><span class="token class-name">TransitionDestination<span class="token punctuation">.</span>DestinationTag</span> destinationTag<span class="token punctuation">)</span><span class="token punctuation">&#123;</span>        <span class="token comment">//保存数据</span>        SaveManager<span class="token punctuation">.</span>Instance<span class="token punctuation">.</span><span class="token function">SavePlayerData</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>                <span class="token keyword">if</span><span class="token punctuation">(</span>SceneManager<span class="token punctuation">.</span><span class="token function">GetActiveScene</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span>name<span class="token operator">!=</span>sceneName<span class="token punctuation">)</span><span class="token punctuation">&#123;</span>            <span class="token comment">//不同场景的话</span>            <span class="token keyword">yield</span> <span class="token keyword">return</span> SceneManager<span class="token punctuation">.</span><span class="token function">LoadSceneAsync</span><span class="token punctuation">(</span>sceneName<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">//协程加载场景</span>            <span class="token keyword">yield</span> <span class="token keyword">return</span> <span class="token function">Instantiate</span><span class="token punctuation">(</span>playerPrefab<span class="token punctuation">,</span>                <span class="token function">GetDestination</span><span class="token punctuation">(</span>destinationTag<span class="token punctuation">)</span><span class="token punctuation">.</span>transform<span class="token punctuation">.</span>position<span class="token punctuation">,</span>                <span class="token function">GetDestination</span><span class="token punctuation">(</span>destinationTag<span class="token punctuation">)</span><span class="token punctuation">.</span>transform<span class="token punctuation">.</span>rotation<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">//加载玩家素材对象</span>                        <span class="token comment">//读取玩家数据</span>            SaveManager<span class="token punctuation">.</span>Instance<span class="token punctuation">.</span><span class="token function">LoadPlayerData</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>                        <span class="token keyword">yield</span> <span class="token keyword">break</span><span class="token punctuation">;</span><span class="token comment">//加载好后跳出协程</span>                    <span class="token punctuation">&#125;</span><span class="token keyword">else</span><span class="token punctuation">&#123;</span>            <span class="token comment">//相同场景</span>            <span class="token comment">//先获得玩家的对象</span>            player <span class="token operator">=</span> GameManager<span class="token punctuation">.</span>Instance<span class="token punctuation">.</span>playerStates<span class="token punctuation">.</span>gameObject<span class="token punctuation">;</span>            <span class="token comment">//获得目的地传送门对象</span>            <span class="token class-name"><span class="token keyword">var</span></span> td <span class="token operator">=</span> <span class="token function">GetDestination</span><span class="token punctuation">(</span>destinationTag<span class="token punctuation">)</span><span class="token punctuation">;</span>            <span class="token comment">//关闭导航移动</span>            player<span class="token punctuation">.</span><span class="token generic-method"><span class="token function">GetComponent</span><span class="token generic class-name"><span class="token punctuation">&lt;</span>NavMeshAgent<span class="token punctuation">></span></span></span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span>enabled <span class="token operator">=</span> <span class="token boolean">false</span><span class="token punctuation">;</span>            <span class="token comment">//设置对象的坐标和旋转角度</span>            player<span class="token punctuation">.</span>transform<span class="token punctuation">.</span><span class="token function">SetPositionAndRotation</span><span class="token punctuation">(</span>td<span class="token punctuation">.</span>transform<span class="token punctuation">.</span>position<span class="token punctuation">,</span>td<span class="token punctuation">.</span>transform<span class="token punctuation">.</span>rotation<span class="token punctuation">)</span><span class="token punctuation">;</span>            <span class="token comment">//恢复导航移动</span>            player<span class="token punctuation">.</span><span class="token generic-method"><span class="token function">GetComponent</span><span class="token generic class-name"><span class="token punctuation">&lt;</span>NavMeshAgent<span class="token punctuation">></span></span></span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span>enabled <span class="token operator">=</span> <span class="token boolean">true</span><span class="token punctuation">;</span>            <span class="token keyword">yield</span> <span class="token keyword">return</span> <span class="token keyword">null</span><span class="token punctuation">;</span>        <span class="token punctuation">&#125;</span>    <span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>这里我们在加载另外一个场景前会先保存数据，在加载场景完后我们先读取数据再退出协程</p><p>这样就实现了人物数据的保存了，当然这只是保存读取了人物的生命值、经验值等数据，其它数据也可以自由发挥</p>]]></content>
    
    
      
      
    <summary type="html">&lt;p&gt;这一章比较简单，我们来学习如何保存数据，用到的有两个重要的API，文章中会有介绍到&lt;/p&gt;
&lt;h1 id=&quot;认识API&quot;&gt;&lt;a href=&quot;#认识API&quot; class=&quot;headerlink&quot; title=&quot;认识API&quot;&gt;&lt;/a&gt;认识API&lt;/h1&gt;&lt;p&gt;这里我们用到两个A</summary>
      
    
    
    
    <category term="Unity学习笔记" scheme="http://sakura-pub.ltd/categories/Unity%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/"/>
    
    
    <category term="Unity" scheme="http://sakura-pub.ltd/tags/Unity/"/>
    
  </entry>
  
  <entry>
    <title>Unity笔记27-不同场景的传送</title>
    <link href="http://sakura-pub.ltd/UnityNotes/Unity%E7%AC%94%E8%AE%B027-%E4%B8%8D%E5%90%8C%E5%9C%BA%E6%99%AF%E7%9A%84%E4%BC%A0%E9%80%81/"/>
    <id>http://sakura-pub.ltd/UnityNotes/Unity%E7%AC%94%E8%AE%B027-%E4%B8%8D%E5%90%8C%E5%9C%BA%E6%99%AF%E7%9A%84%E4%BC%A0%E9%80%81/</id>
    <published>2021-08-03T01:05:23.000Z</published>
    <updated>2021-08-03T03:25:32.587Z</updated>
    
    <content type="html"><![CDATA[<p>这一章我们来实现不同场景的传送</p><p>首先，我们要把另外一个场景搭建好先，随后才可以进行下一步的工作，这里就自己发挥吧</p><p>搭建好场景后，我们就可以正式开始来实现如何跨场景传送了</p><h1 id="设置好传送门属性"><a href="#设置好传送门属性" class="headerlink" title="设置好传送门属性"></a>设置好传送门属性</h1><p>首先就是要把两个不同场景的传送门属性设置好，注意要选择不同场景传送并把名字填上</p><p>下面是主世界的传送门属性</p><img src="https://i.loli.net/2021/08/03/qSY69TCAibHz8wP.png" style="zoom:80%;" /><p>以及另外一个世界传送门的属性</p><img src="https://i.loli.net/2021/08/03/O4ymdIfH3CVZA2L.png" style="zoom:80%;" /><h1 id="编写代码"><a href="#编写代码" class="headerlink" title="编写代码"></a>编写代码</h1><p>下面的代码可能有点分散，需要修改的文件比较多，会有注释写出来在哪个文件</p><pre class="line-numbers language-csharp" data-language="csharp"><code class="language-csharp"><span class="token comment">//SceneController.cs，添加了不同场景加载时的代码</span><span class="token keyword">public</span> <span class="token class-name">GameObject</span> playerPrefab<span class="token punctuation">;</span><span class="token comment">//玩家素材对象，用来不同场景时进行加载</span>    <span class="token keyword">public</span> <span class="token return-type class-name"><span class="token keyword">void</span></span> <span class="token function">TransitiToDestination</span><span class="token punctuation">(</span><span class="token class-name">TransitionPoint</span> transitionPoint<span class="token punctuation">)</span><span class="token punctuation">&#123;</span>        <span class="token comment">//考虑是同场景还是不同场景的传送</span>        <span class="token keyword">switch</span><span class="token punctuation">(</span>transitionPoint<span class="token punctuation">.</span>transitionType<span class="token punctuation">)</span><span class="token punctuation">&#123;</span>            <span class="token keyword">case</span> TransitionPoint<span class="token punctuation">.</span>TransitionType<span class="token punctuation">.</span>SameScene<span class="token punctuation">:</span>                <span class="token comment">//同场景可以不用异步，直接传送</span>                <span class="token comment">//这里第一个参数是获得当前活动窗口的名字</span>                <span class="token function">StartCoroutine</span><span class="token punctuation">(</span><span class="token function">Transition</span><span class="token punctuation">(</span>SceneManager<span class="token punctuation">.</span><span class="token function">GetActiveScene</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span>name<span class="token punctuation">,</span>transitionPoint<span class="token punctuation">.</span>destinationTag<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>                <span class="token keyword">break</span><span class="token punctuation">;</span>            <span class="token keyword">case</span> TransitionPoint<span class="token punctuation">.</span>TransitionType<span class="token punctuation">.</span>DifferentScene<span class="token punctuation">:</span>                <span class="token comment">//不同场景，用异步加载的方式</span>                <span class="token function">StartCoroutine</span><span class="token punctuation">(</span><span class="token function">Transition</span><span class="token punctuation">(</span>transitionPoint<span class="token punctuation">.</span>sceneName<span class="token punctuation">,</span>transitionPoint<span class="token punctuation">.</span>destinationTag<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>                <span class="token keyword">break</span><span class="token punctuation">;</span>        <span class="token punctuation">&#125;</span>    <span class="token punctuation">&#125;</span><span class="token return-type class-name">IEnumerator</span> <span class="token function">Transition</span><span class="token punctuation">(</span><span class="token class-name"><span class="token keyword">string</span></span> sceneName<span class="token punctuation">,</span><span class="token class-name">TransitionDestination<span class="token punctuation">.</span>DestinationTag</span> destinationTag<span class="token punctuation">)</span><span class="token punctuation">&#123;</span>        <span class="token comment">//TODO:保存数据</span>                <span class="token keyword">if</span><span class="token punctuation">(</span>SceneManager<span class="token punctuation">.</span><span class="token function">GetActiveScene</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span>name<span class="token operator">!=</span>sceneName<span class="token punctuation">)</span><span class="token punctuation">&#123;</span>            <span class="token comment">//不同场景的话</span>            <span class="token keyword">yield</span> <span class="token keyword">return</span> SceneManager<span class="token punctuation">.</span><span class="token function">LoadSceneAsync</span><span class="token punctuation">(</span>sceneName<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">//协程加载场景</span>            <span class="token keyword">yield</span> <span class="token keyword">return</span> <span class="token function">Instantiate</span><span class="token punctuation">(</span>playerPrefab<span class="token punctuation">,</span>                <span class="token function">GetDestination</span><span class="token punctuation">(</span>destinationTag<span class="token punctuation">)</span><span class="token punctuation">.</span>transform<span class="token punctuation">.</span>position<span class="token punctuation">,</span>                <span class="token function">GetDestination</span><span class="token punctuation">(</span>destinationTag<span class="token punctuation">)</span><span class="token punctuation">.</span>transform<span class="token punctuation">.</span>rotation<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">//加载玩家素材对象</span>            <span class="token keyword">yield</span> <span class="token keyword">break</span><span class="token punctuation">;</span><span class="token comment">//加载好后跳出协程</span>                    <span class="token punctuation">&#125;</span><span class="token keyword">else</span><span class="token punctuation">&#123;</span>            <span class="token comment">//相同场景</span>            <span class="token comment">//先获得玩家的对象</span>            player <span class="token operator">=</span> GameManager<span class="token punctuation">.</span>Instance<span class="token punctuation">.</span>playerStates<span class="token punctuation">.</span>gameObject<span class="token punctuation">;</span>            <span class="token comment">//获得目的地传送门对象</span>            <span class="token class-name"><span class="token keyword">var</span></span> td <span class="token operator">=</span> <span class="token function">GetDestination</span><span class="token punctuation">(</span>destinationTag<span class="token punctuation">)</span><span class="token punctuation">;</span>            <span class="token comment">//关闭导航移动</span>            player<span class="token punctuation">.</span><span class="token generic-method"><span class="token function">GetComponent</span><span class="token generic class-name"><span class="token punctuation">&lt;</span>NavMeshAgent<span class="token punctuation">></span></span></span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span>enabled <span class="token operator">=</span> <span class="token boolean">false</span><span class="token punctuation">;</span>            <span class="token comment">//设置对象的坐标和旋转角度</span>            player<span class="token punctuation">.</span>transform<span class="token punctuation">.</span><span class="token function">SetPositionAndRotation</span><span class="token punctuation">(</span>td<span class="token punctuation">.</span>transform<span class="token punctuation">.</span>position<span class="token punctuation">,</span>td<span class="token punctuation">.</span>transform<span class="token punctuation">.</span>rotation<span class="token punctuation">)</span><span class="token punctuation">;</span>            <span class="token comment">//恢复导航移动</span>            player<span class="token punctuation">.</span><span class="token generic-method"><span class="token function">GetComponent</span><span class="token generic class-name"><span class="token punctuation">&lt;</span>NavMeshAgent<span class="token punctuation">></span></span></span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span>enabled <span class="token operator">=</span> <span class="token boolean">true</span><span class="token punctuation">;</span>            <span class="token keyword">yield</span> <span class="token keyword">return</span> <span class="token keyword">null</span><span class="token punctuation">;</span>        <span class="token punctuation">&#125;</span>    <span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>注意这里我们要外界把人物的素材拖进去代码中，以保证传送到另外一个场景时可以加载人物出来</p><img src="https://i.loli.net/2021/08/03/xDbVRIcpGHqTy4h.png" style="zoom:80%;" /><h1 id="修复问题"><a href="#修复问题" class="headerlink" title="修复问题"></a>修复问题</h1><h2 id="传送报错"><a href="#传送报错" class="headerlink" title="传送报错"></a>传送报错</h2><p>此时我们传送时会报错，有好几个问题我们慢慢来看</p><p>第一个问题是要把场景放在<code>Scene in Build</code>的设置当中</p><img src="https://i.loli.net/2021/08/03/dpRCZcfYrDAUx1V.png" style="zoom:80%;" /><p>第二个问题就是我们传送到新场景后，那些Manager文件都会不存在，因此我们要把它们加入<code>DontDestory</code>的清单里</p><pre class="line-numbers language-csharp" data-language="csharp"><code class="language-csharp"><span class="token comment">//在GameManager.cs  SceneController.cs  MouseManager.cs加上这行代码</span><span class="token keyword">protected</span> <span class="token keyword">override</span> <span class="token return-type class-name"><span class="token keyword">void</span></span> <span class="token function">Awake</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>    <span class="token keyword">base</span><span class="token punctuation">.</span><span class="token function">Awake</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token function">DontDestroyOnLoad</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">//防止此Manager文件在切换场景时给销毁</span><span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>我们要在<code>GameManager.cs</code>  <code>SceneController.cs</code>  <code>MouseManager.cs</code>加上上面代码，并且是要<strong>继承单例模式的代码文件</strong></p><h2 id="人物传送后无法移动"><a href="#人物传送后无法移动" class="headerlink" title="人物传送后无法移动"></a>人物传送后无法移动</h2><p>这时候人物可以传送到另外一个场景了，但是不能移动，可能有下面问题</p><p>第一个可能存在的问题就是我们第二个场景的地板没有设置成<code>Ground</code>标签，我们要设置一下</p><p>第二个问题是我们在<code>PlayerController.cs</code>中的<code>OnMouseClicked</code>事件没有加载出来</p><pre class="line-numbers language-csharp" data-language="csharp"><code class="language-csharp"><span class="token return-type class-name"><span class="token keyword">void</span></span> <span class="token function">OnEnable</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span><span class="token comment">//素材启用时注册事件</span>MouseManager<span class="token punctuation">.</span>Instance<span class="token punctuation">.</span>OnMouseClicked<span class="token operator">+=</span>MoveToTarget<span class="token punctuation">;</span>MouseManager<span class="token punctuation">.</span>Instance<span class="token punctuation">.</span>OnEnemyClicked<span class="token operator">+=</span>EventAttact<span class="token punctuation">;</span><span class="token punctuation">&#125;</span><span class="token return-type class-name"><span class="token keyword">void</span></span> <span class="token function">Start</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span><span class="token comment">//KeyManager.Instance.OnKeyInputMove+=MoveToTarget;</span>GameManager<span class="token punctuation">.</span>Instance<span class="token punctuation">.</span><span class="token function">RigisterPlayer</span><span class="token punctuation">(</span>charcterStates<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">&#125;</span><span class="token return-type class-name"><span class="token keyword">void</span></span> <span class="token function">OnDisable</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span><span class="token comment">//素材禁用时注销事件</span>MouseManager<span class="token punctuation">.</span>Instance<span class="token punctuation">.</span>OnMouseClicked<span class="token operator">-=</span>MoveToTarget<span class="token punctuation">;</span>MouseManager<span class="token punctuation">.</span>Instance<span class="token punctuation">.</span>OnEnemyClicked<span class="token operator">-=</span>EventAttact<span class="token punctuation">;</span><span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h2 id="人物传送回来相机没有跟随"><a href="#人物传送回来相机没有跟随" class="headerlink" title="人物传送回来相机没有跟随"></a>人物传送回来相机没有跟随</h2><p>接着还有一个问题就是当我们从另外一个场景传送回来时，相机的跟随就会失效，这里来修复这个问题</p><pre class="line-numbers language-csharp" data-language="csharp"><code class="language-csharp"><span class="token comment">//GameManager.cs</span><span class="token keyword">public</span> <span class="token return-type class-name"><span class="token keyword">void</span></span> <span class="token function">RigisterPlayer</span><span class="token punctuation">(</span><span class="token class-name">CharacterStates</span> player<span class="token punctuation">)</span><span class="token punctuation">&#123;</span>        <span class="token comment">//通过外界注册的方式来获得对象的playerStates</span>        <span class="token keyword">this</span><span class="token punctuation">.</span>playerStates <span class="token operator">=</span> player<span class="token punctuation">;</span>        <span class="token comment">//外界人物对象注册同时让相机进行跟随</span>        followCamera <span class="token operator">=</span> <span class="token generic-method"><span class="token function">FindObjectOfType</span><span class="token generic class-name"><span class="token punctuation">&lt;</span>CinemachineFreeLook<span class="token punctuation">></span></span></span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">//在地图中查找相机</span>        <span class="token keyword">if</span><span class="token punctuation">(</span>followCamera<span class="token operator">!=</span><span class="token keyword">null</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span><span class="token comment">//如果找到相机就让它跟随</span>            followCamera<span class="token punctuation">.</span>Follow <span class="token operator">=</span> playerStates<span class="token punctuation">.</span>transform<span class="token punctuation">;</span>            followCamera<span class="token punctuation">.</span>LookAt <span class="token operator">=</span> playerStates<span class="token punctuation">.</span>transform<span class="token punctuation">;</span>        <span class="token punctuation">&#125;</span>    <span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>]]></content>
    
    
      
      
    <summary type="html">&lt;p&gt;这一章我们来实现不同场景的传送&lt;/p&gt;
&lt;p&gt;首先，我们要把另外一个场景搭建好先，随后才可以进行下一步的工作，这里就自己发挥吧&lt;/p&gt;
&lt;p&gt;搭建好场景后，我们就可以正式开始来实现如何跨场景传送了&lt;/p&gt;
&lt;h1 id=&quot;设置好传送门属性&quot;&gt;&lt;a href=&quot;#设置好传送门</summary>
      
    
    
    
    <category term="Unity学习笔记" scheme="http://sakura-pub.ltd/categories/Unity%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/"/>
    
    
    <category term="Unity" scheme="http://sakura-pub.ltd/tags/Unity/"/>
    
  </entry>
  
  <entry>
    <title>Unity笔记26-实现同场景的传送</title>
    <link href="http://sakura-pub.ltd/UnityNotes/Unity%E7%AC%94%E8%AE%B026-%E5%AE%9E%E7%8E%B0%E5%90%8C%E5%9C%BA%E6%99%AF%E7%9A%84%E4%BC%A0%E9%80%81/"/>
    <id>http://sakura-pub.ltd/UnityNotes/Unity%E7%AC%94%E8%AE%B026-%E5%AE%9E%E7%8E%B0%E5%90%8C%E5%9C%BA%E6%99%AF%E7%9A%84%E4%BC%A0%E9%80%81/</id>
    <published>2021-08-02T01:49:40.000Z</published>
    <updated>2021-08-02T04:18:18.335Z</updated>
    
    <content type="html"><![CDATA[<p>这里我们实现同场景的传送效果</p><h1 id="调整传送门"><a href="#调整传送门" class="headerlink" title="调整传送门"></a>调整传送门</h1><p>在这之前，我们要把不同的传送门摆放好先</p><p>另外我们可能会发现点击不了传送门，这是因为传送门的box collider挡住了我们鼠标的射线，这里把它的大小改一下就行了</p><img src="https://i.loli.net/2021/08/02/LHvS6JN4idPbQOA.png" style="zoom:80%;" /><p>给传送门加上<code>Portal</code>的标签，然后再去<code>MouseManager.cs</code>修改一下鼠标的图样</p><pre class="line-numbers language-csharp" data-language="csharp"><code class="language-csharp"><span class="token return-type class-name"><span class="token keyword">void</span></span> <span class="token function">SetCursorTexture</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span><span class="token class-name">Ray</span> ray <span class="token operator">=</span> Camera<span class="token punctuation">.</span>main<span class="token punctuation">.</span><span class="token function">ScreenPointToRay</span><span class="token punctuation">(</span>Input<span class="token punctuation">.</span>mousePosition<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token keyword">if</span><span class="token punctuation">(</span>Physics<span class="token punctuation">.</span><span class="token function">Raycast</span><span class="token punctuation">(</span>ray<span class="token punctuation">,</span><span class="token keyword">out</span> hitInfo<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span><span class="token comment">//TODO:切换鼠标贴图</span><span class="token keyword">switch</span><span class="token punctuation">(</span>hitInfo<span class="token punctuation">.</span>collider<span class="token punctuation">.</span>gameObject<span class="token punctuation">.</span>tag<span class="token punctuation">)</span><span class="token punctuation">&#123;</span><span class="token keyword">case</span> <span class="token string">"Ground"</span><span class="token punctuation">:</span><span class="token operator">/</span><span class="token operator">/</span>地面行走的图标Cursor<span class="token punctuation">.</span><span class="token function">SetCursor</span><span class="token punctuation">(</span>arrow<span class="token punctuation">,</span><span class="token keyword">new</span> <span class="token constructor-invocation class-name">Vector2</span><span class="token punctuation">(</span><span class="token number">16</span><span class="token punctuation">,</span><span class="token number">16</span><span class="token punctuation">)</span><span class="token punctuation">,</span>CursorMode<span class="token punctuation">.</span>Auto<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token keyword">break</span><span class="token punctuation">;</span><span class="token keyword">case</span> <span class="token string">"Enemy"</span><span class="token punctuation">:</span><span class="token operator">/</span><span class="token operator">/</span>点击敌人的图标Cursor<span class="token punctuation">.</span><span class="token function">SetCursor</span><span class="token punctuation">(</span>attack<span class="token punctuation">,</span><span class="token keyword">new</span> <span class="token constructor-invocation class-name">Vector2</span><span class="token punctuation">(</span><span class="token number">16</span><span class="token punctuation">,</span><span class="token number">16</span><span class="token punctuation">)</span><span class="token punctuation">,</span>CursorMode<span class="token punctuation">.</span>Auto<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token keyword">break</span><span class="token punctuation">;</span><span class="token keyword">case</span> <span class="token string">"Portal"</span><span class="token punctuation">:</span><span class="token operator">/</span><span class="token operator">/</span>点击传送门图标Cursor<span class="token punctuation">.</span><span class="token function">SetCursor</span><span class="token punctuation">(</span>doorway<span class="token punctuation">,</span><span class="token keyword">new</span> <span class="token constructor-invocation class-name">Vector2</span><span class="token punctuation">(</span><span class="token number">16</span><span class="token punctuation">,</span><span class="token number">16</span><span class="token punctuation">)</span><span class="token punctuation">,</span>CursorMode<span class="token punctuation">.</span>Auto<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token keyword">break</span><span class="token punctuation">;</span><span class="token keyword">default</span><span class="token punctuation">:</span>Cursor<span class="token punctuation">.</span><span class="token function">SetCursor</span><span class="token punctuation">(</span>point<span class="token punctuation">,</span><span class="token keyword">new</span> <span class="token constructor-invocation class-name">Vector2</span><span class="token punctuation">(</span><span class="token number">16</span><span class="token punctuation">,</span><span class="token number">16</span><span class="token punctuation">)</span><span class="token punctuation">,</span>CursorMode<span class="token punctuation">.</span>Auto<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token keyword">break</span><span class="token punctuation">;</span><span class="token punctuation">&#125;</span><span class="token punctuation">&#125;</span><span class="token comment">//if</span><span class="token punctuation">&#125;</span><span class="token return-type class-name"><span class="token keyword">void</span></span> <span class="token function">MouseControl</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span><span class="token keyword">if</span><span class="token punctuation">(</span>Input<span class="token punctuation">.</span><span class="token function">GetMouseButtonDown</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span> <span class="token operator">&amp;&amp;</span> hitInfo<span class="token punctuation">.</span>collider <span class="token operator">!=</span> <span class="token keyword">null</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span><span class="token keyword">if</span><span class="token punctuation">(</span>hitInfo<span class="token punctuation">.</span>collider<span class="token punctuation">.</span><span class="token function">CompareTag</span><span class="token punctuation">(</span><span class="token string">"Ground"</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>OnMouseClicked<span class="token punctuation">?.</span><span class="token function">Invoke</span><span class="token punctuation">(</span>hitInfo<span class="token punctuation">.</span>point<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">&#125;</span><span class="token keyword">if</span><span class="token punctuation">(</span>hitInfo<span class="token punctuation">.</span>collider<span class="token punctuation">.</span><span class="token function">CompareTag</span><span class="token punctuation">(</span><span class="token string">"Portal"</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span><span class="token comment">//点击传送门</span>OnMouseClicked<span class="token punctuation">?.</span><span class="token function">Invoke</span><span class="token punctuation">(</span>hitInfo<span class="token punctuation">.</span>point<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">&#125;</span><span class="token keyword">if</span><span class="token punctuation">(</span>hitInfo<span class="token punctuation">.</span>collider<span class="token punctuation">.</span><span class="token function">CompareTag</span><span class="token punctuation">(</span><span class="token string">"Enemy"</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>OnEnemyClicked<span class="token punctuation">?.</span><span class="token function">Invoke</span><span class="token punctuation">(</span>hitInfo<span class="token punctuation">.</span>collider<span class="token punctuation">.</span>gameObject<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">//点击敌人传递敌人的gameObject</span><span class="token punctuation">&#125;</span><span class="token keyword">if</span><span class="token punctuation">(</span>hitInfo<span class="token punctuation">.</span>collider<span class="token punctuation">.</span><span class="token function">CompareTag</span><span class="token punctuation">(</span><span class="token string">"Attackable"</span><span class="token punctuation">)</span><span class="token punctuation">)</span>OnEnemyClicked<span class="token punctuation">?.</span><span class="token function">Invoke</span><span class="token punctuation">(</span>hitInfo<span class="token punctuation">.</span>collider<span class="token punctuation">.</span>gameObject<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">&#125;</span><span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h1 id="编写传送管理代码"><a href="#编写传送管理代码" class="headerlink" title="编写传送管理代码"></a>编写传送管理代码</h1><p>我们创建一个<code>SceneController.cs</code>，之所以不是用Manager是因为在Unity有个<code>SceneManager</code>同名的文件存在</p><img src="https://i.loli.net/2021/08/02/FLvOK3csbIP45Xz.png" style="zoom:80%;" /><p>注意此文件继承的是<strong>单例模式</strong>类</p><pre class="line-numbers language-csharp" data-language="csharp"><code class="language-csharp"><span class="token keyword">using</span> <span class="token namespace">System<span class="token punctuation">.</span>Collections</span><span class="token punctuation">;</span><span class="token keyword">using</span> <span class="token namespace">UnityEngine</span><span class="token punctuation">;</span><span class="token keyword">using</span> <span class="token namespace">UnityEngine<span class="token punctuation">.</span>SceneManagement</span><span class="token punctuation">;</span><span class="token keyword">using</span> <span class="token namespace">UnityEngine<span class="token punctuation">.</span>AI</span><span class="token punctuation">;</span><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">SceneController</span> <span class="token punctuation">:</span> <span class="token type-list"><span class="token class-name">Singleton<span class="token punctuation">&lt;</span>SceneController<span class="token punctuation">></span></span></span><span class="token punctuation">&#123;</span>    <span class="token class-name">GameObject</span> player<span class="token punctuation">;</span><span class="token comment">//玩家</span>    <span class="token keyword">public</span> <span class="token return-type class-name"><span class="token keyword">void</span></span> <span class="token function">TransitiToDestination</span><span class="token punctuation">(</span><span class="token class-name">TransitionPoint</span> transitionPoint<span class="token punctuation">)</span><span class="token punctuation">&#123;</span>        <span class="token comment">//考虑是同场景还是不同场景的传送</span>        <span class="token keyword">switch</span><span class="token punctuation">(</span>transitionPoint<span class="token punctuation">.</span>transitionType<span class="token punctuation">)</span><span class="token punctuation">&#123;</span>            <span class="token keyword">case</span> TransitionPoint<span class="token punctuation">.</span>TransitionType<span class="token punctuation">.</span>SameScene<span class="token punctuation">:</span>            <span class="token comment">//同场景可以不用异步，直接传送</span>            <span class="token comment">//这里第一个参数是获得当前活动窗口的名字</span>            <span class="token function">StartCoroutine</span><span class="token punctuation">(</span><span class="token function">Transition</span><span class="token punctuation">(</span>SceneManager<span class="token punctuation">.</span><span class="token function">GetActiveScene</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span>name<span class="token punctuation">,</span>transitionPoint<span class="token punctuation">.</span>destinationTag<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>                <span class="token keyword">break</span><span class="token punctuation">;</span>            <span class="token keyword">case</span> TransitionPoint<span class="token punctuation">.</span>TransitionType<span class="token punctuation">.</span>DifferentScene<span class="token punctuation">:</span>            <span class="token comment">//不同场景，用异步加载的方式</span>                <span class="token keyword">break</span><span class="token punctuation">;</span>        <span class="token punctuation">&#125;</span>    <span class="token punctuation">&#125;</span>    <span class="token return-type class-name">IEnumerator</span> <span class="token function">Transition</span><span class="token punctuation">(</span><span class="token class-name"><span class="token keyword">string</span></span> sceneName<span class="token punctuation">,</span><span class="token class-name">TransitionDestination<span class="token punctuation">.</span>DestinationTag</span> destinationTag<span class="token punctuation">)</span><span class="token punctuation">&#123;</span>        <span class="token comment">//先获得玩家的对象</span>        player <span class="token operator">=</span> GameManager<span class="token punctuation">.</span>Instance<span class="token punctuation">.</span>playerStates<span class="token punctuation">.</span>gameObject<span class="token punctuation">;</span>        <span class="token comment">//获得目的地传送门对象</span>        <span class="token class-name"><span class="token keyword">var</span></span> td <span class="token operator">=</span> <span class="token function">GetDestination</span><span class="token punctuation">(</span>destinationTag<span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token comment">//关闭导航移动</span>        player<span class="token punctuation">.</span><span class="token generic-method"><span class="token function">GetComponent</span><span class="token generic class-name"><span class="token punctuation">&lt;</span>NavMeshAgent<span class="token punctuation">></span></span></span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span>enabled <span class="token operator">=</span> <span class="token boolean">false</span><span class="token punctuation">;</span>        <span class="token comment">//设置对象的坐标和旋转角度</span>        player<span class="token punctuation">.</span>transform<span class="token punctuation">.</span><span class="token function">SetPositionAndRotation</span><span class="token punctuation">(</span>td<span class="token punctuation">.</span>transform<span class="token punctuation">.</span>position<span class="token punctuation">,</span>td<span class="token punctuation">.</span>transform<span class="token punctuation">.</span>rotation<span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token comment">//恢复导航移动</span>        player<span class="token punctuation">.</span><span class="token generic-method"><span class="token function">GetComponent</span><span class="token generic class-name"><span class="token punctuation">&lt;</span>NavMeshAgent<span class="token punctuation">></span></span></span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span>enabled <span class="token operator">=</span> <span class="token boolean">true</span><span class="token punctuation">;</span>        <span class="token keyword">yield</span> <span class="token keyword">return</span> <span class="token keyword">null</span><span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span>    <span class="token keyword">private</span> <span class="token return-type class-name">TransitionDestination</span> <span class="token function">GetDestination</span><span class="token punctuation">(</span><span class="token class-name">TransitionDestination<span class="token punctuation">.</span>DestinationTag</span> destinationTag<span class="token punctuation">)</span><span class="token punctuation">&#123;</span>        <span class="token comment">//通过传送门目的地的标签寻找目的地传送门所在位置</span>        <span class="token class-name"><span class="token keyword">var</span></span> entrances <span class="token operator">=</span> <span class="token generic-method"><span class="token function">FindObjectsOfType</span><span class="token generic class-name"><span class="token punctuation">&lt;</span>TransitionDestination<span class="token punctuation">></span></span></span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token keyword">for</span><span class="token punctuation">(</span><span class="token class-name"><span class="token keyword">int</span></span> i<span class="token operator">=</span><span class="token number">0</span><span class="token punctuation">;</span>i<span class="token operator">&lt;</span>entrances<span class="token punctuation">.</span>Length<span class="token punctuation">;</span><span class="token operator">++</span>i<span class="token punctuation">)</span><span class="token punctuation">&#123;</span>            <span class="token keyword">if</span><span class="token punctuation">(</span>entrances<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">.</span>destinationTag <span class="token operator">==</span> destinationTag<span class="token punctuation">)</span><span class="token comment">//目的地传送门标签匹配的话</span>                <span class="token keyword">return</span> entrances<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">;</span>        <span class="token punctuation">&#125;</span>        <span class="token keyword">return</span> <span class="token keyword">null</span><span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span><span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>另外当我们玩家到达传送门，我希望它可以按键触发传送的，所以这里去到<code>TransitionPoint.cs</code></p><pre class="line-numbers language-csharp" data-language="csharp"><code class="language-csharp"><span class="token comment">//触发器设置</span><span class="token keyword">private</span> <span class="token class-name"><span class="token keyword">bool</span></span> canTrans<span class="token punctuation">;</span><span class="token comment">//是否触发传送</span><span class="token return-type class-name"><span class="token keyword">void</span></span> <span class="token function">Update</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>    <span class="token keyword">if</span><span class="token punctuation">(</span>Input<span class="token punctuation">.</span><span class="token function">GetKeyDown</span><span class="token punctuation">(</span>KeyCode<span class="token punctuation">.</span>E<span class="token punctuation">)</span> <span class="token operator">&amp;&amp;</span> canTrans<span class="token punctuation">)</span><span class="token punctuation">&#123;</span>        <span class="token comment">//按键触发传送</span>        SceneController<span class="token punctuation">.</span>Instance<span class="token punctuation">.</span><span class="token function">TransitiToDestination</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span><span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>还有一个工作就是要把我们的<code>TransitionDestination.cs</code>作为组件添加在传送门子对象的点上</p><img src="https://i.loli.net/2021/08/02/3Jm9QXySOEiqdRF.png" style="zoom:80%;" /><img src="https://i.loli.net/2021/08/02/Hen9PBroRJYcFjp.png" style="zoom:80%;" /><p>这个点是用来设置当前的点是属于哪一个标签的，我们就把一个传送门当做入口设为<code>ENTER</code>，另一个传送门当做目的地设为<code>A</code></p><p>另外去到传送门中，目的地也要进行对应的设置，入口传送门的目的地是<code>A</code>，反过来另外一个传送门想过来就要设置目的地为<code>ENTER</code></p><p><strong>注意</strong>：我们最好不要设置多个同一标签的传送门，可能会出现问题</p><p>最后，建立一个空对象，并把<code>SceneController.cs</code>作为组件附上去</p><img src="https://i.loli.net/2021/08/02/caN1CyLrJU76bnI.png" style="zoom:80%;" /><h1 id="Trigger无法触发问题"><a href="#Trigger无法触发问题" class="headerlink" title="Trigger无法触发问题"></a>Trigger无法触发问题</h1><p>如果函数内的Trigger事件没有触发的话，可能是玩家上没有添加钢体的原因，把钢体添加在主动碰撞的物体上（这里是玩家），然后把传送门和玩家的碰撞体组件中<code>IsTrigger</code>勾选上就可以了</p>]]></content>
    
    
      
      
    <summary type="html">&lt;p&gt;这里我们实现同场景的传送效果&lt;/p&gt;
&lt;h1 id=&quot;调整传送门&quot;&gt;&lt;a href=&quot;#调整传送门&quot; class=&quot;headerlink&quot; title=&quot;调整传送门&quot;&gt;&lt;/a&gt;调整传送门&lt;/h1&gt;&lt;p&gt;在这之前，我们要把不同的传送门摆放好先&lt;/p&gt;
&lt;p&gt;另外我们可能会发现</summary>
      
    
    
    
    <category term="Unity学习笔记" scheme="http://sakura-pub.ltd/categories/Unity%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/"/>
    
    
    <category term="Unity" scheme="http://sakura-pub.ltd/tags/Unity/"/>
    
  </entry>
  
  <entry>
    <title>Unity笔记25-制作传送门</title>
    <link href="http://sakura-pub.ltd/UnityNotes/Unity%E7%AC%94%E8%AE%B025-%E5%88%B6%E4%BD%9C%E4%BC%A0%E9%80%81%E9%97%A8/"/>
    <id>http://sakura-pub.ltd/UnityNotes/Unity%E7%AC%94%E8%AE%B025-%E5%88%B6%E4%BD%9C%E4%BC%A0%E9%80%81%E9%97%A8/</id>
    <published>2021-08-01T01:53:22.000Z</published>
    <updated>2021-08-01T03:53:51.612Z</updated>
    
    <content type="html"><![CDATA[<p>我们这一章来制作一个传送门以供后面玩家切换不同场景时使用</p><h1 id="制作传送门Shader"><a href="#制作传送门Shader" class="headerlink" title="制作传送门Shader"></a>制作传送门Shader</h1><p>首先就是要来制作传送门的Shader，新建一个<code>Lit Shader Graph</code>，这是一个有光影响的shader，菜单中还有一个叫做Unlit Shader Graph就是没有光影响的</p><p>这里建好后起名为<code>Portal Shader</code></p><img src="https://i.loli.net/2021/08/01/pd7nMhKZHVBm4ar.png" style="zoom:80%;" /><p>注意里边的设置，Surface选择<code>Transparent</code>就是有透明通道的意思，然后勾选<code>Two Sided</code>显示两面</p><img src="https://i.loli.net/2021/08/01/k7eZSNDKwTt2Y43.png" style="zoom:80%;" /><p>这里直接上做好的图，颜色的属性面板中注意要选择<code>HDR</code></p><img src="https://i.loli.net/2021/08/01/nwoQLuWKhYSR8lp.png" style="zoom:80%;" /><p>做好后点击左上角<code>Save Asset</code>保存，然后右键<code>Shder Graph</code>创建为一个<code>Materials</code></p><img src="https://i.loli.net/2021/08/01/ecxz9EY5KfGgMOq.png" style="zoom:80%;" /><p>这样一个传送门的Shader就创建好了</p><h1 id="制作传送门"><a href="#制作传送门" class="headerlink" title="制作传送门"></a>制作传送门</h1><p>回到地图上，我们创建一个<code>Quad</code></p><img src="https://i.loli.net/2021/08/01/1ULfhYbuIgzD529.png" style="zoom:80%;" /><p>然后把刚刚的传送门材质附上去，然后就可以看到传送门的雏形了</p><img src="https://i.loli.net/2021/08/01/oGMurVFip1O8sjA.png" style="zoom:80%;" /><p>之后可以创建一个子对象，表示传送点，以后当玩家触碰这个点便可以触发传送事件</p><img src="https://i.loli.net/2021/08/01/z65KBjWylxAvGIo.png" style="zoom:80%;" /><p>如图我还将这个点附上了一个蓝色图标，代表这两个传送门是互通的，一对的，可以起到一个标记作用</p><h1 id="编写传送门基本代码"><a href="#编写传送门基本代码" class="headerlink" title="编写传送门基本代码"></a>编写传送门基本代码</h1><p>这里编写一下基本的传送门代码，详细的代码完善留在下一章节</p><img src="https://i.loli.net/2021/08/01/aVGXZyRzq36d8pt.png" style="zoom:80%;" /><p>这里的<code>TransitionPoint</code>挂载在传送门上，而<code>TransitionDestination</code>挂载在蓝色的点上</p><p>我们先来编辑TransitionPoint.cs</p><pre class="line-numbers language-csharp" data-language="csharp"><code class="language-csharp"><span class="token comment">//TransitionPoint.cs</span><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">TransitionPoint</span> <span class="token punctuation">:</span> <span class="token type-list"><span class="token class-name">MonoBehaviour</span></span><span class="token punctuation">&#123;</span>        <span class="token keyword">public</span> <span class="token keyword">enum</span> <span class="token class-name">TransitionType</span><span class="token punctuation">&#123;</span><span class="token comment">//传送状态</span>        SameScene<span class="token punctuation">,</span>DifferentScene    <span class="token punctuation">&#125;</span>        <span class="token punctuation">[</span><span class="token attribute"><span class="token class-name">Header</span><span class="token attribute-arguments"><span class="token punctuation">(</span><span class="token string">"Transition Info（传送门设置）"</span><span class="token punctuation">)</span></span></span><span class="token punctuation">]</span>    <span class="token keyword">public</span> <span class="token class-name"><span class="token keyword">string</span></span> sceneName<span class="token punctuation">;</span><span class="token comment">//记录场景名称</span>    <span class="token keyword">public</span> <span class="token class-name">TransitionType</span> transitionType<span class="token punctuation">;</span><span class="token comment">//记录传送状态，同场景传送就外边选择第一个，不同场景就选择第二个</span>    <span class="token keyword">public</span> <span class="token class-name">TransitionDestination<span class="token punctuation">.</span>DestinationTag</span> destinationTag<span class="token punctuation">;</span><span class="token comment">//传送点目的地</span>    <span class="token comment">//触发器设置</span>    <span class="token keyword">private</span> <span class="token class-name"><span class="token keyword">bool</span></span> canTrans<span class="token punctuation">;</span><span class="token comment">//是否触发传送</span>    <span class="token return-type class-name"><span class="token keyword">void</span></span> <span class="token function">OnTriggerStay</span><span class="token punctuation">(</span><span class="token class-name">Collider</span> other<span class="token punctuation">)</span><span class="token punctuation">&#123;</span>        <span class="token comment">//玩家在传送门区域内</span>        <span class="token keyword">if</span><span class="token punctuation">(</span>other<span class="token punctuation">.</span><span class="token function">CompareTag</span><span class="token punctuation">(</span><span class="token string">"Player"</span><span class="token punctuation">)</span><span class="token punctuation">)</span>            canTrans <span class="token operator">=</span> <span class="token boolean">true</span><span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span>    <span class="token return-type class-name"><span class="token keyword">void</span></span> <span class="token function">OnTriggerExit</span><span class="token punctuation">(</span><span class="token class-name">Collider</span> other<span class="token punctuation">)</span><span class="token punctuation">&#123;</span>        <span class="token comment">//玩家离开了传送门区域</span>        <span class="token keyword">if</span><span class="token punctuation">(</span>other<span class="token punctuation">.</span><span class="token function">CompareTag</span><span class="token punctuation">(</span><span class="token string">"Player"</span><span class="token punctuation">)</span><span class="token punctuation">)</span>            canTrans <span class="token operator">=</span> <span class="token boolean">false</span><span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span><span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>其中传送点目的地对应的在TransitionDestination.cs中</p><pre class="line-numbers language-csharp" data-language="csharp"><code class="language-csharp"><span class="token comment">//TransitionDestination.cs</span><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">TransitionDestination</span> <span class="token punctuation">:</span> <span class="token type-list"><span class="token class-name">MonoBehaviour</span></span><span class="token punctuation">&#123;</span>    <span class="token keyword">public</span> <span class="token keyword">enum</span> <span class="token class-name">DestinationTag</span><span class="token punctuation">&#123;</span><span class="token comment">//传送点标签</span>        ENTER<span class="token punctuation">,</span>A<span class="token punctuation">,</span>B<span class="token punctuation">,</span>C    <span class="token punctuation">&#125;</span>    <span class="token keyword">public</span> <span class="token class-name">DestinationTag</span> destinationTag<span class="token punctuation">;</span><span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>这里的A,B,C可以自行修改，表示的是不同传送门中的不同地方，类似于一个站牌</p><p>我们还注意到在前面<code>TransitionPoint.cs</code>中有触发的代码，这里要到Unity属性面板中把触发<code>isTrigger</code>选项勾上，否则不能触发<code>OnTriggerStay()</code>和<code>OnTriggerExit()</code>方法</p><img src="https://i.loli.net/2021/08/01/G7DPlvBtNd5Lw9Y.png" style="zoom:80%;" /><p>当然，现在用到的是<code>Mesh Collider</code>，这里触发面积只是一个平面，我们可以换成<code>Box Collider</code>，让它的触发面积更大一些</p><img src="https://i.loli.net/2021/08/01/mPRClNHWdA6jufi.png" style="zoom:80%;" /><p>弄好这些后，记得把传送门保存为一个素材</p>]]></content>
    
    
      
      
    <summary type="html">&lt;p&gt;我们这一章来制作一个传送门以供后面玩家切换不同场景时使用&lt;/p&gt;
&lt;h1 id=&quot;制作传送门Shader&quot;&gt;&lt;a href=&quot;#制作传送门Shader&quot; class=&quot;headerlink&quot; title=&quot;制作传送门Shader&quot;&gt;&lt;/a&gt;制作传送门Shader&lt;/h1&gt;&lt;</summary>
      
    
    
    
    <category term="Unity学习笔记" scheme="http://sakura-pub.ltd/categories/Unity%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/"/>
    
    
    <category term="Unity" scheme="http://sakura-pub.ltd/tags/Unity/"/>
    
  </entry>
  
  <entry>
    <title>Unity笔记24-制作玩家状态条</title>
    <link href="http://sakura-pub.ltd/UnityNotes/Unity%E7%AC%94%E8%AE%B024-%E5%88%B6%E4%BD%9C%E7%8E%A9%E5%AE%B6%E7%8A%B6%E6%80%81%E6%9D%A1/"/>
    <id>http://sakura-pub.ltd/UnityNotes/Unity%E7%AC%94%E8%AE%B024-%E5%88%B6%E4%BD%9C%E7%8E%A9%E5%AE%B6%E7%8A%B6%E6%80%81%E6%9D%A1/</id>
    <published>2021-07-31T02:35:09.000Z</published>
    <updated>2021-07-31T03:56:36.736Z</updated>
    
    <content type="html"><![CDATA[<p>本章来制作玩家的状态条，如血量条，经验条等</p><h1 id="编辑UI布局"><a href="#编辑UI布局" class="headerlink" title="编辑UI布局"></a>编辑UI布局</h1><p>第一步也是建立一个画布，模式使用默认的<code>Screen Space</code>覆盖屏幕</p><p>值得注意是为了使状态条可以随着屏幕的分辨率大小而切换，我们的<code>UI Scale Mode</code>要设置成<code>Scale With Scree</code></p><img src="https://www.hualigs.cn/image/6104bb2a28b1d.jpg" style="zoom:80%;" /><p>之后创建好UI，可以在<code>Scene</code>视图的2D模式下调整到合适的位置，然后在<code>Game</code>视图下预览效果，可以自行多多尝试</p><p>最后的效果如下</p><img src="https://i.loli.net/2021/07/31/xh2a6d1GFWIAQB3.png" style="zoom:80%;" /><p>注意这里的文字我用了自定义的字体，在Unity中只用把你想要用的物体拖拽进来分类好，就可以直接在文字UI设置面板上选择使用了</p><h1 id="编写代码"><a href="#编写代码" class="headerlink" title="编写代码"></a>编写代码</h1><p>接下来就是编写代码来管理我们的UI了</p><img src="https://i.loli.net/2021/07/31/WEluxrQkRazFKf5.png" style="zoom:80%;" /><p>然后把代码作为组件添加到上面创建的画布当中，接着就是编写代码了</p><pre class="line-numbers language-csharp" data-language="csharp"><code class="language-csharp"><span class="token keyword">using</span> <span class="token namespace">UnityEngine</span><span class="token punctuation">;</span><span class="token keyword">using</span> <span class="token namespace">UnityEngine<span class="token punctuation">.</span>UI</span><span class="token punctuation">;</span><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">PlayerHealthUI</span> <span class="token punctuation">:</span> <span class="token type-list"><span class="token class-name">MonoBehaviour</span></span><span class="token punctuation">&#123;</span>    <span class="token comment">//由于我们的人物信息栏最终会保存为一个prefab</span>    <span class="token comment">//因此我们可以不使用拖拽gameobject方式来获得对象</span>    <span class="token comment">//可以直接使用获得对象的子对象方式</span>    <span class="token class-name">Text</span> levelText<span class="token punctuation">;</span><span class="token comment">//获得text文本</span>    <span class="token class-name">Image</span> healthSlider<span class="token punctuation">;</span><span class="token comment">//生命值拖拽条</span>    <span class="token class-name">Image</span> expSlider<span class="token punctuation">;</span><span class="token comment">//经验拖拽条</span>    <span class="token return-type class-name"><span class="token keyword">void</span></span> <span class="token function">Awake</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>        <span class="token comment">//注意GetChild填写的参数类似于数组下标，第一个对象的索引是0</span>        levelText <span class="token operator">=</span> transform<span class="token punctuation">.</span><span class="token function">GetChild</span><span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token generic-method"><span class="token function">GetComponent</span><span class="token generic class-name"><span class="token punctuation">&lt;</span>Text<span class="token punctuation">></span></span></span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">//获得文字对象</span>        healthSlider <span class="token operator">=</span> transform<span class="token punctuation">.</span><span class="token function">GetChild</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">GetChild</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token generic-method"><span class="token function">GetComponent</span><span class="token generic class-name"><span class="token punctuation">&lt;</span>Image<span class="token punctuation">></span></span></span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">//获得生命拖拽条</span>        expSlider <span class="token operator">=</span> transform<span class="token punctuation">.</span><span class="token function">GetChild</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">GetChild</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token generic-method"><span class="token function">GetComponent</span><span class="token generic class-name"><span class="token punctuation">&lt;</span>Image<span class="token punctuation">></span></span></span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">//获得经验值拖拽条</span>    <span class="token punctuation">&#125;</span>    <span class="token return-type class-name"><span class="token keyword">void</span></span> <span class="token function">Update</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>        <span class="token function">UpdateExp</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token function">UpdateHealth</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        levelText<span class="token punctuation">.</span>text <span class="token operator">=</span> <span class="token string">"Level  "</span> <span class="token operator">+</span>             GameManager<span class="token punctuation">.</span>Instance<span class="token punctuation">.</span>playerStates<span class="token punctuation">.</span>characterData<span class="token punctuation">.</span>currentLevel<span class="token punctuation">.</span><span class="token function">ToString</span><span class="token punctuation">(</span><span class="token string">"00"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token comment">//00是规定给它的一个格式，比如01 02....</span>    <span class="token punctuation">&#125;</span>    <span class="token return-type class-name"><span class="token keyword">void</span></span> <span class="token function">UpdateHealth</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>        <span class="token comment">//可以通过GameManager类来获得player的states</span>        <span class="token class-name"><span class="token keyword">float</span></span> sliderPercent <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token keyword">float</span><span class="token punctuation">)</span>            GameManager<span class="token punctuation">.</span>Instance<span class="token punctuation">.</span>playerStates<span class="token punctuation">.</span>currentHealth<span class="token operator">/</span>            GameManager<span class="token punctuation">.</span>Instance<span class="token punctuation">.</span>playerStates<span class="token punctuation">.</span>MaxHealth<span class="token punctuation">;</span>        <span class="token comment">//更新图片填充</span>        healthSlider<span class="token punctuation">.</span>fillAmount <span class="token operator">=</span> sliderPercent<span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span>    <span class="token return-type class-name"><span class="token keyword">void</span></span> <span class="token function">UpdateExp</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>        <span class="token class-name"><span class="token keyword">float</span></span> sliderPercent <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token keyword">float</span><span class="token punctuation">)</span>            GameManager<span class="token punctuation">.</span>Instance<span class="token punctuation">.</span>playerStates<span class="token punctuation">.</span>characterData<span class="token punctuation">.</span>currentExp<span class="token operator">/</span>            GameManager<span class="token punctuation">.</span>Instance<span class="token punctuation">.</span>playerStates<span class="token punctuation">.</span>characterData<span class="token punctuation">.</span>baseExp<span class="token punctuation">;</span>        <span class="token comment">//更新图片填充</span>        expSlider<span class="token punctuation">.</span>fillAmount <span class="token operator">=</span> sliderPercent<span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span><span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>这里是借助了<code>GameManager.cs</code>中的单例模式实例化的方式来获得player的状态信息，因为先前我用了外界注册的方式把玩家的信息赋予了GameManager里面的成员变量</p><p>到这我们就大功告成了</p>]]></content>
    
    
      
      
    <summary type="html">&lt;p&gt;本章来制作玩家的状态条，如血量条，经验条等&lt;/p&gt;
&lt;h1 id=&quot;编辑UI布局&quot;&gt;&lt;a href=&quot;#编辑UI布局&quot; class=&quot;headerlink&quot; title=&quot;编辑UI布局&quot;&gt;&lt;/a&gt;编辑UI布局&lt;/h1&gt;&lt;p&gt;第一步也是建立一个画布，模式使用默认的&lt;code&gt;</summary>
      
    
    
    
    <category term="Unity学习笔记" scheme="http://sakura-pub.ltd/categories/Unity%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/"/>
    
    
    <category term="Unity" scheme="http://sakura-pub.ltd/tags/Unity/"/>
    
  </entry>
  
  <entry>
    <title>Unity笔记23-制作玩家的升级</title>
    <link href="http://sakura-pub.ltd/UnityNotes/Unity%E7%AC%94%E8%AE%B023-%E5%88%B6%E4%BD%9C%E7%8E%A9%E5%AE%B6%E7%9A%84%E5%8D%87%E7%BA%A7/"/>
    <id>http://sakura-pub.ltd/UnityNotes/Unity%E7%AC%94%E8%AE%B023-%E5%88%B6%E4%BD%9C%E7%8E%A9%E5%AE%B6%E7%9A%84%E5%8D%87%E7%BA%A7/</id>
    <published>2021-07-30T02:05:51.000Z</published>
    <updated>2021-07-31T04:10:05.890Z</updated>
    
    <content type="html"><![CDATA[<p>在本章中我们来制作玩家的经验系统，并附有升级功能</p><h1 id="扩展CharacterData-SO"><a href="#扩展CharacterData-SO" class="headerlink" title="扩展CharacterData_SO"></a>扩展CharacterData_SO</h1><p>我们首先打开<code>CharacterData_SO.cs</code>添加一些额外的属性进去，同时写一个升级时处理的方法</p><pre class="line-numbers language-csharp" data-language="csharp"><code class="language-csharp"><span class="token punctuation">[</span><span class="token attribute"><span class="token class-name">CreateAssetMenu</span><span class="token attribute-arguments"><span class="token punctuation">(</span>fileName <span class="token operator">=</span> <span class="token string">"New Data"</span><span class="token punctuation">,</span>menuName <span class="token operator">=</span> <span class="token string">"Character States/Data"</span><span class="token punctuation">)</span></span></span><span class="token punctuation">]</span><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">CharacterData_SO</span> <span class="token punctuation">:</span> <span class="token type-list"><span class="token class-name">ScriptableObject</span></span><span class="token punctuation">&#123;</span>    <span class="token punctuation">[</span><span class="token attribute"><span class="token class-name">Header</span><span class="token attribute-arguments"><span class="token punctuation">(</span><span class="token string">"States Info（属性信息）"</span><span class="token punctuation">)</span></span></span><span class="token punctuation">]</span>    <span class="token keyword">public</span> <span class="token class-name"><span class="token keyword">int</span></span> maxHealth<span class="token punctuation">;</span><span class="token comment">//最大生命值</span>    <span class="token keyword">public</span> <span class="token class-name"><span class="token keyword">int</span></span> currentHealth<span class="token punctuation">;</span><span class="token comment">//当前生命值</span>    <span class="token keyword">public</span> <span class="token class-name"><span class="token keyword">int</span></span> baseDefence<span class="token punctuation">;</span><span class="token comment">//基础防御值</span>    <span class="token keyword">public</span> <span class="token class-name"><span class="token keyword">int</span></span> currentDefence<span class="token punctuation">;</span><span class="token comment">//当前防御值</span>    <span class="token punctuation">[</span><span class="token attribute"><span class="token class-name">Header</span><span class="token attribute-arguments"><span class="token punctuation">(</span><span class="token string">"Kill（击杀信息）"</span><span class="token punctuation">)</span></span></span><span class="token punctuation">]</span>    <span class="token keyword">public</span> <span class="token class-name"><span class="token keyword">int</span></span> killPoint<span class="token punctuation">;</span><span class="token comment">//击杀后掉落的经验值</span>    <span class="token punctuation">[</span><span class="token attribute"><span class="token class-name">Header</span><span class="token attribute-arguments"><span class="token punctuation">(</span><span class="token string">"Level（等级信息）"</span><span class="token punctuation">)</span></span></span><span class="token punctuation">]</span>    <span class="token keyword">public</span> <span class="token class-name"><span class="token keyword">int</span></span> currentLevel<span class="token punctuation">;</span><span class="token comment">//当前等级</span>    <span class="token keyword">public</span> <span class="token class-name"><span class="token keyword">int</span></span> maxLevel<span class="token punctuation">;</span><span class="token comment">//最大等级数</span>    <span class="token keyword">public</span> <span class="token class-name"><span class="token keyword">int</span></span> baseExp<span class="token punctuation">;</span><span class="token comment">//基础经验值</span>    <span class="token keyword">public</span> <span class="token class-name"><span class="token keyword">int</span></span> currentExp<span class="token punctuation">;</span><span class="token comment">//当前经验值</span>    <span class="token keyword">public</span> <span class="token class-name"><span class="token keyword">float</span></span> levelBuff<span class="token punctuation">;</span><span class="token comment">//每次升级整体属性提升的百分比</span>    <span class="token keyword">public</span> <span class="token return-type class-name"><span class="token keyword">float</span></span> LevelMultiplier<span class="token punctuation">&#123;</span>        <span class="token comment">//升级提升属性加的倍率</span>        <span class="token keyword">get</span><span class="token punctuation">&#123;</span><span class="token keyword">return</span> <span class="token number">1</span> <span class="token operator">+</span> <span class="token punctuation">(</span>currentLevel<span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">)</span> <span class="token operator">*</span> levelBuff<span class="token punctuation">;</span><span class="token punctuation">&#125;</span>    <span class="token punctuation">&#125;</span>    <span class="token keyword">public</span> <span class="token return-type class-name"><span class="token keyword">void</span></span> <span class="token function">UpdateExp</span><span class="token punctuation">(</span><span class="token class-name"><span class="token keyword">int</span></span> point<span class="token punctuation">)</span><span class="token punctuation">&#123;</span>        currentExp <span class="token operator">+=</span> point<span class="token punctuation">;</span><span class="token comment">//把外界的经验加进来</span>        <span class="token keyword">if</span><span class="token punctuation">(</span>currentExp <span class="token operator">>=</span> baseExp<span class="token punctuation">)</span>            <span class="token function">LevelUp</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span>    <span class="token keyword">private</span> <span class="token return-type class-name"><span class="token keyword">void</span></span> <span class="token function">LevelUp</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>        <span class="token comment">//这个方法中添加升级时想提升的数据</span>        <span class="token comment">//将current+1限制在[0,maxLevel]闭区间中</span>        currentLevel <span class="token operator">=</span> Mathf<span class="token punctuation">.</span><span class="token function">Clamp</span><span class="token punctuation">(</span>currentLevel<span class="token operator">+</span><span class="token number">1</span><span class="token punctuation">,</span><span class="token number">0</span><span class="token punctuation">,</span>maxLevel<span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token comment">//将经验和生命值按照每一等级不同倍率增长（也可以使用固定值level buff）</span>        baseExp <span class="token operator">+=</span> <span class="token punctuation">(</span><span class="token keyword">int</span><span class="token punctuation">)</span><span class="token punctuation">(</span>baseExp<span class="token operator">*</span>LevelMultiplier<span class="token punctuation">)</span><span class="token punctuation">;</span>        maxHealth <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token keyword">int</span><span class="token punctuation">)</span><span class="token punctuation">(</span>maxHealth <span class="token operator">*</span> LevelMultiplier<span class="token punctuation">)</span><span class="token punctuation">;</span>        currentHealth <span class="token operator">=</span> maxHealth<span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span><span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>接着再去到<code>CharacterStates.cs</code>做最后的修改</p><pre class="line-numbers language-csharp" data-language="csharp"><code class="language-csharp"><span class="token keyword">public</span> <span class="token return-type class-name"><span class="token keyword">void</span></span> <span class="token function">TakeDamage</span><span class="token punctuation">(</span><span class="token class-name">CharacterStates</span> attacker<span class="token punctuation">,</span><span class="token class-name">CharacterStates</span> defener<span class="token punctuation">)</span><span class="token punctuation">&#123;</span>    <span class="token comment">//计算伤害数值</span>    <span class="token comment">//当前攻击力减去目标的防御力，如果防御力过高就是0伤害</span>    <span class="token class-name"><span class="token keyword">int</span></span> damage <span class="token operator">=</span> Mathf<span class="token punctuation">.</span><span class="token function">Max</span><span class="token punctuation">(</span>attacker<span class="token punctuation">.</span><span class="token function">CurrentDamage</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">-</span>defener<span class="token punctuation">.</span>currentDefence<span class="token punctuation">,</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    currentHealth <span class="token operator">=</span> Mathf<span class="token punctuation">.</span><span class="token function">Max</span><span class="token punctuation">(</span>currentHealth<span class="token operator">-</span>damage<span class="token punctuation">,</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">//血量也是最小值锁在0</span>    Debug<span class="token punctuation">.</span><span class="token function">LogFormat</span><span class="token punctuation">(</span><span class="token string">"&#123;0&#125;攻击了&#123;1&#125;，造成了&#123;2&#125;点伤害"</span><span class="token punctuation">,</span>attacker<span class="token punctuation">.</span>gameObject<span class="token punctuation">.</span>name<span class="token punctuation">,</span>defener<span class="token punctuation">.</span>gameObject<span class="token punctuation">.</span>name<span class="token punctuation">,</span>damage<span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token keyword">if</span><span class="token punctuation">(</span>attacker<span class="token punctuation">.</span>isCritical<span class="token punctuation">)</span><span class="token comment">//判断被打者是否受到暴击并且播放受伤动画</span>        defener<span class="token punctuation">.</span><span class="token generic-method"><span class="token function">GetComponent</span><span class="token generic class-name"><span class="token punctuation">&lt;</span>Animator<span class="token punctuation">></span></span></span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">SetTrigger</span><span class="token punctuation">(</span><span class="token string">"Hit"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token comment">//将来要做的事情</span>    <span class="token comment">//血量条UI</span>    UpdateHealthBarOnAttack<span class="token punctuation">?.</span><span class="token function">Invoke</span><span class="token punctuation">(</span>currentHealth<span class="token punctuation">,</span>MaxHealth<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">//如果事件不为空则调用</span>    <span class="token comment">//打死怪后加经验</span>    <span class="token keyword">if</span><span class="token punctuation">(</span>defener<span class="token punctuation">.</span>currentHealth <span class="token operator">&lt;=</span> <span class="token number">0</span><span class="token punctuation">)</span>        attacker<span class="token punctuation">.</span>characterData<span class="token punctuation">.</span><span class="token function">UpdateExp</span><span class="token punctuation">(</span>defener<span class="token punctuation">.</span>characterData<span class="token punctuation">.</span>killPoint<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">&#125;</span><span class="token keyword">public</span> <span class="token return-type class-name"><span class="token keyword">void</span></span> <span class="token function">TakeDamage</span><span class="token punctuation">(</span><span class="token class-name"><span class="token keyword">int</span></span> damage<span class="token punctuation">,</span><span class="token class-name">CharacterStates</span> defener<span class="token punctuation">)</span><span class="token punctuation">&#123;</span>    <span class="token comment">//石头反击石头人的攻击方式</span>    <span class="token class-name"><span class="token keyword">int</span></span> dam <span class="token operator">=</span> Mathf<span class="token punctuation">.</span><span class="token function">Max</span><span class="token punctuation">(</span>damage <span class="token operator">-</span> defener<span class="token punctuation">.</span>currentDefence<span class="token punctuation">,</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    defener<span class="token punctuation">.</span>currentHealth <span class="token operator">=</span> Mathf<span class="token punctuation">.</span><span class="token function">Max</span><span class="token punctuation">(</span>defener<span class="token punctuation">.</span>currentHealth <span class="token operator">-</span> dam<span class="token punctuation">,</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token comment">//血条事件</span>    UpdateHealthBarOnAttack<span class="token punctuation">?.</span><span class="token function">Invoke</span><span class="token punctuation">(</span>currentHealth<span class="token punctuation">,</span>MaxHealth<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">//如果事件不为空则调用</span>    <span class="token comment">//TODO:加经验</span>    <span class="token comment">//可以通过GameManager来访问玩家的属性</span>    <span class="token keyword">if</span> <span class="token punctuation">(</span>defener<span class="token punctuation">.</span>currentHealth <span class="token operator">&lt;=</span> <span class="token number">0</span><span class="token punctuation">)</span>    GameManager<span class="token punctuation">.</span>Instance<span class="token punctuation">.</span>playerStates<span class="token punctuation">.</span>characterData<span class="token punctuation">.</span><span class="token function">UpdateExp</span><span class="token punctuation">(</span>defener<span class="token punctuation">.</span>characterData<span class="token punctuation">.</span>killPoint<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>最后我们去到人物的<code>PlayerData</code>还有每个敌人的<code>Data</code>添加属性就可以了</p><img src="https://p6-tt.byteimg.com/origin/pgc-image/bc33680758884eb88e5bfed71402eaa5.png" alt="1.png" style="zoom:80%;" />]]></content>
    
    
      
      
    <summary type="html">&lt;p&gt;在本章中我们来制作玩家的经验系统，并附有升级功能&lt;/p&gt;
&lt;h1 id=&quot;扩展CharacterData-SO&quot;&gt;&lt;a href=&quot;#扩展CharacterData-SO&quot; class=&quot;headerlink&quot; title=&quot;扩展CharacterData_SO&quot;&gt;&lt;/a&gt;</summary>
      
    
    
    
    <category term="Unity学习笔记" scheme="http://sakura-pub.ltd/categories/Unity%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/"/>
    
    
    <category term="Unity" scheme="http://sakura-pub.ltd/tags/Unity/"/>
    
  </entry>
  
  <entry>
    <title>Unity笔记22-制作血量条UI</title>
    <link href="http://sakura-pub.ltd/UnityNotes/Unity%E7%AC%94%E8%AE%B022-%E5%88%B6%E4%BD%9C%E8%A1%80%E9%87%8F%E6%9D%A1UI/"/>
    <id>http://sakura-pub.ltd/UnityNotes/Unity%E7%AC%94%E8%AE%B022-%E5%88%B6%E4%BD%9C%E8%A1%80%E9%87%8F%E6%9D%A1UI/</id>
    <published>2021-07-29T01:28:59.000Z</published>
    <updated>2021-07-29T10:01:08.942Z</updated>
    
    <content type="html"><![CDATA[<p>这一章我们来制作一下敌人的血量条</p><h1 id="创建血条UI"><a href="#创建血条UI" class="headerlink" title="创建血条UI"></a>创建血条UI</h1><h2 id="创建血条基础形状（Canvas与Image）"><a href="#创建血条基础形状（Canvas与Image）" class="headerlink" title="创建血条基础形状（Canvas与Image）"></a>创建血条基础形状（Canvas与Image）</h2><p>首先在<code>Hierachy</code>窗口中创建一个<code>Canvas</code>（画布），并将它命名为<code>HealthBarCanvas</code></p><img src="https://p26-tt.byteimg.com/origin/pgc-image/a4bddbb255de4c87825a7866dd064269.png" alt="1.png" style="zoom:80%;" /><p>之后我们改一下<code>HealthBarCanvas</code>设置，并把坐标重置</p><img src="https://p26-tt.byteimg.com/origin/pgc-image/7c8fa921e76f4decb29167a49ad882f1.png" alt="2.png" style="zoom:80%;" /><p>随后我们在这个画布的基础上创建一个<code>Image</code>，并将它命名为<code>Bar Holder</code>，然后在把它的坐标改一下，改成像一个血条的大小</p><img src="https://p6-tt.byteimg.com/origin/pgc-image/48339de2f8e6417f94b09466da3b7428.png" alt="3.png" style="zoom:80%;" /><p>我们就可以在Scene窗口上看到血条的初始样子了</p><img src="https://p6-tt.byteimg.com/origin/pgc-image/ccf344e88ab44a2e92fc6563d1339523.png" alt="4.png" style="zoom:80%;" /><h2 id="创建血条底层图像（Source-Image）"><a href="#创建血条底层图像（Source-Image）" class="headerlink" title="创建血条底层图像（Source Image）"></a>创建血条底层图像（Source Image）</h2><p>接着我们要为<code>Bar Holder</code>导入一个<code>Source Image</code>作为血条的底层，这里就选择自己创建一个图像作为它的底层</p><p>首先要打开<code>Package Manager</code>安装一下<code>2D Sprite</code></p><img src="https://p26-tt.byteimg.com/origin/pgc-image/7c103cd1256d4e5cb07ed10165846528.png" alt="5.png" style="zoom:80%;" /><p>接着我们创建一个路径专门存放UI相关的对象，这里创建一个<code>Square</code>方形图像</p><img src="https://p9-tt.byteimg.com/origin/pgc-image/73d842b512f940698760bf2547bbf82c.png" alt="6.png" style="zoom:80%;" /><p>再把这个方形图像应用在刚刚的<code>Source Image</code>中就行了</p><p>由于现在我们创建出来的是一个血条的底层，那么我们可以把它的颜色设置为红色底，待会有个上层图像设置成绿色，这样弄出来就有血条的样子了</p><p>因此我们这里把颜色改为红色（这里我把颜色的透明度改成了 150 ）</p><img src="https://p3-tt.byteimg.com/origin/pgc-image/9d082235f7dc478ca60891914aaa2de1.png" alt="7.png" style="zoom:80%;" /><h2 id="创建血条上层图像"><a href="#创建血条上层图像" class="headerlink" title="创建血条上层图像"></a>创建血条上层图像</h2><p>我们在<code>Bar Holder</code>的基础上再创建一个图像<code>Image</code>，命名为<code>Current Health</code>，并将宽度和高度设置成和底层一样（2.5和0.25）</p><img src="https://p26-tt.byteimg.com/origin/pgc-image/13abb2c92ea14215973e66d999182fa4.png" alt="8.png" style="zoom:80%;" /><p>同时<code>Source Image</code>还是和刚刚一样，颜色调为绿色</p><p>唯一不同的是图片的类型<code>Image Type</code>要调为<strong>填充</strong><code>Filled</code>，填充的方式为<strong>水平填充</strong><code>Horizontal</code>，之后我们就可以通过调节填充数量<code>Fill Amount</code>来控制绿色条的长度，从而代表血量的多少了</p><img src="https://p6-tt.byteimg.com/origin/pgc-image/f5d505bfb9e74b98a2e2ffdaa4b81b15.png" alt="9.png" style="zoom:80%;" /><p>效果图如下</p><img src="https://p6-tt.byteimg.com/origin/pgc-image/72681600544d4713a09b34e971078333.png" alt="10.png" style="zoom:80%;" /><p>这样一个简陋的血条就弄好了，我们将它保存为一个素材</p><img src="https://p5-tt.byteimg.com/origin/pgc-image/7d681c103df74db1921f9235c27f02e1.png" alt="11.png" style="zoom:80%;" /><h2 id="设置血条在敌人上方的位置"><a href="#设置血条在敌人上方的位置" class="headerlink" title="设置血条在敌人上方的位置"></a>设置血条在敌人上方的位置</h2><p>由于我们每个敌人高矮不同，就导致了血条在不同敌人的位置也不一样，同时也是为了方便我们后面的代码，这里我们要为每个敌人设置一下血条应该出现的位置</p><p>最直接的办法就是为每个敌人对象再创建一个子对象来记录血条位置</p><p>我们打开<code>Prefabs ---&gt; Characters</code>目录编辑敌人素材，这里拿史莱姆为例子</p><img src="https://p3-tt.byteimg.com/origin/pgc-image/a4ed16108baa4e62a2c591cb1d263eb6.png" alt="13.png" style="zoom:80%;" /><p>像上面图片这样，我们创建了一个<code>HealthBar Point</code>的空对象来记录血条的位置，这样就很方便我们代码的编写了</p><p>最后按照同样的方式给每个敌人都安放<code>HealthBar Point</code></p><h1 id="编写血条代码"><a href="#编写血条代码" class="headerlink" title="编写血条代码"></a>编写血条代码</h1><h2 id="创建事件"><a href="#创建事件" class="headerlink" title="创建事件"></a>创建事件</h2><p>在创建血条代码之前，我们先在<code>CharacterStates.cs</code>中创建一个事件，即在造成伤害时要触发的血条变动事件</p><pre class="line-numbers language-csharp" data-language="csharp"><code class="language-csharp"><span class="token comment">//造成伤害时血条改变的事件</span><span class="token keyword">public</span> <span class="token keyword">event</span> <span class="token class-name">Action<span class="token punctuation">&lt;</span><span class="token keyword">int</span><span class="token punctuation">,</span><span class="token keyword">int</span><span class="token punctuation">></span></span> UpdateHealthBarOnAttack<span class="token punctuation">;</span><span class="token comment">//在造成伤害时调用</span><span class="token keyword">public</span> <span class="token return-type class-name"><span class="token keyword">void</span></span> <span class="token function">TakeDamage</span><span class="token punctuation">(</span><span class="token class-name">CharacterStates</span> attacker<span class="token punctuation">,</span><span class="token class-name">CharacterStates</span> defener<span class="token punctuation">)</span><span class="token punctuation">&#123;</span>    <span class="token class-name"><span class="token keyword">int</span></span> damage <span class="token operator">=</span> Mathf<span class="token punctuation">.</span><span class="token function">Max</span><span class="token punctuation">(</span>attacker<span class="token punctuation">.</span><span class="token function">CurrentDamage</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">-</span>defener<span class="token punctuation">.</span>currentDefence<span class="token punctuation">,</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    currentHealth <span class="token operator">=</span> Mathf<span class="token punctuation">.</span><span class="token function">Max</span><span class="token punctuation">(</span>currentHealth<span class="token operator">-</span>damage<span class="token punctuation">,</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    Debug<span class="token punctuation">.</span><span class="token function">LogFormat</span><span class="token punctuation">(</span><span class="token string">"&#123;0&#125;攻击了&#123;1&#125;，造成了&#123;2&#125;点伤害"</span><span class="token punctuation">,</span>attacker<span class="token punctuation">.</span>gameObject<span class="token punctuation">.</span>name<span class="token punctuation">,</span>defener<span class="token punctuation">.</span>gameObject<span class="token punctuation">.</span>name<span class="token punctuation">,</span>damage<span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token keyword">if</span><span class="token punctuation">(</span>attacker<span class="token punctuation">.</span>isCritical<span class="token punctuation">)</span>        defener<span class="token punctuation">.</span><span class="token generic-method"><span class="token function">GetComponent</span><span class="token generic class-name"><span class="token punctuation">&lt;</span>Animator<span class="token punctuation">></span></span></span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">SetTrigger</span><span class="token punctuation">(</span><span class="token string">"Hit"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token comment">//TODO:血量条UI</span>    UpdateHealthBarOnAttack<span class="token punctuation">?.</span><span class="token function">Invoke</span><span class="token punctuation">(</span>currentHealth<span class="token punctuation">,</span>MaxHealth<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">//如果事件不为空则调用</span><span class="token punctuation">&#125;</span><span class="token keyword">public</span> <span class="token return-type class-name"><span class="token keyword">void</span></span> <span class="token function">TakeDamage</span><span class="token punctuation">(</span><span class="token class-name"><span class="token keyword">int</span></span> damage<span class="token punctuation">,</span><span class="token class-name">CharacterStates</span> defener<span class="token punctuation">)</span><span class="token punctuation">&#123;</span>    <span class="token class-name"><span class="token keyword">int</span></span> dam <span class="token operator">=</span> Mathf<span class="token punctuation">.</span><span class="token function">Max</span><span class="token punctuation">(</span>damage <span class="token operator">-</span> defener<span class="token punctuation">.</span>currentDefence<span class="token punctuation">,</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    defener<span class="token punctuation">.</span>currentHealth <span class="token operator">=</span> Mathf<span class="token punctuation">.</span><span class="token function">Max</span><span class="token punctuation">(</span>defener<span class="token punctuation">.</span>currentHealth <span class="token operator">-</span> dam<span class="token punctuation">,</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token comment">//血条事件</span>    UpdateHealthBarOnAttack<span class="token punctuation">?.</span><span class="token function">Invoke</span><span class="token punctuation">(</span>currentHealth<span class="token punctuation">,</span>MaxHealth<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">//如果事件不为空则调用</span><span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h2 id="创建血条代码"><a href="#创建血条代码" class="headerlink" title="创建血条代码"></a>创建血条代码</h2><p>接下来我们就来写控制血条的脚本代码</p><p>在下图目录创建一个脚本，起名为<code>HealthBarUI.cs</code></p><img src="https://p6-tt.byteimg.com/origin/pgc-image/19ea0718eaf34586b42b44476b56da6c.png" alt="12.png" style="zoom:80%;" /><p>然后打开编写代码</p><pre class="line-numbers language-csharp" data-language="csharp"><code class="language-csharp"><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">HealthBarUI</span> <span class="token punctuation">:</span> <span class="token type-list"><span class="token class-name">MonoBehaviour</span></span><span class="token punctuation">&#123;</span>    <span class="token keyword">public</span> <span class="token class-name">GameObject</span> healthUIPrefab<span class="token punctuation">;</span><span class="token comment">//供外界提供一个血条素材</span>    <span class="token keyword">public</span> <span class="token class-name">Transform</span> barPoint<span class="token punctuation">;</span><span class="token comment">//记录血量条该显示在敌人的哪个位置</span>    <span class="token punctuation">[</span><span class="token attribute"><span class="token class-name">Header</span><span class="token attribute-arguments"><span class="token punctuation">(</span><span class="token string">"血条显示设置"</span><span class="token punctuation">)</span></span></span><span class="token punctuation">]</span>    <span class="token keyword">public</span> <span class="token class-name"><span class="token keyword">bool</span></span> alwaysVisible<span class="token punctuation">;</span><span class="token comment">//血条是否一直可见</span>    <span class="token keyword">public</span> <span class="token class-name"><span class="token keyword">float</span></span> visibleTime<span class="token punctuation">;</span><span class="token comment">//血条显示时间（如果不是一直可见的情况下）</span>    <span class="token keyword">private</span> <span class="token class-name"><span class="token keyword">float</span></span> timeLeft<span class="token punctuation">;</span><span class="token comment">//剩余的显示时间</span>    <span class="token class-name">Image</span> healthSlider<span class="token punctuation">;</span><span class="token comment">//拿到血条上层图像</span>    <span class="token class-name">Transform</span> UIbar<span class="token punctuation">;</span><span class="token comment">//记录生成的血条在的位置</span>    <span class="token class-name">Transform</span> cam<span class="token punctuation">;</span><span class="token comment">//拿到摄像机位置以处理血条一直面向我们摄像机</span>    <span class="token class-name">CharacterStates</span> currentStates<span class="token punctuation">;</span><span class="token comment">//获取当前人物的states</span>    <span class="token return-type class-name"><span class="token keyword">void</span></span> <span class="token function">Awake</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>        currentStates <span class="token operator">=</span> <span class="token generic-method"><span class="token function">GetComponent</span><span class="token generic class-name"><span class="token punctuation">&lt;</span>CharacterStates<span class="token punctuation">></span></span></span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        currentStates<span class="token punctuation">.</span>UpdateHealthBarOnAttack <span class="token operator">+=</span> UpdateHealthBar<span class="token punctuation">;</span><span class="token comment">//注册事件</span>    <span class="token punctuation">&#125;</span>    <span class="token return-type class-name"><span class="token keyword">void</span></span> <span class="token function">OnEnable</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>        <span class="token comment">//OnEnable在每次切换地图时都会调用一次</span>        cam <span class="token operator">=</span> Camera<span class="token punctuation">.</span>main<span class="token punctuation">.</span>transform<span class="token punctuation">;</span><span class="token comment">//获取主相机位置</span>        <span class="token keyword">foreach</span><span class="token punctuation">(</span><span class="token class-name">Canvas</span> canvas <span class="token keyword">in</span> <span class="token generic-method"><span class="token function">FindObjectsOfType</span><span class="token generic class-name"><span class="token punctuation">&lt;</span>Canvas<span class="token punctuation">></span></span></span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>            <span class="token comment">//遍历每一个画布</span>            <span class="token keyword">if</span><span class="token punctuation">(</span>canvas<span class="token punctuation">.</span>renderMode <span class="token operator">==</span> RenderMode<span class="token punctuation">.</span>WorldSpace<span class="token punctuation">)</span><span class="token punctuation">&#123;</span>                <span class="token comment">//找到血条所在的画布，有多种方法来获得</span>                <span class="token comment">//也可以供外界提供此画布，更严谨一点</span>                UIbar <span class="token operator">=</span> <span class="token function">Instantiate</span><span class="token punctuation">(</span>healthUIPrefab<span class="token punctuation">,</span>canvas<span class="token punctuation">.</span>transform<span class="token punctuation">)</span><span class="token punctuation">.</span>transform<span class="token punctuation">;</span>                <span class="token comment">//获得上层图像（绿色条）的对象，下标为0</span>                healthSlider <span class="token operator">=</span> UIbar<span class="token punctuation">.</span><span class="token function">GetChild</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token generic-method"><span class="token function">GetComponent</span><span class="token generic class-name"><span class="token punctuation">&lt;</span>Image<span class="token punctuation">></span></span></span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>                <span class="token comment">//是否一直可见</span>                UIbar<span class="token punctuation">.</span>gameObject<span class="token punctuation">.</span><span class="token function">SetActive</span><span class="token punctuation">(</span>alwaysVisible<span class="token punctuation">)</span><span class="token punctuation">;</span>            <span class="token punctuation">&#125;</span>        <span class="token punctuation">&#125;</span>    <span class="token punctuation">&#125;</span>    <span class="token return-type class-name"><span class="token keyword">void</span></span> <span class="token function">UpdateHealthBar</span><span class="token punctuation">(</span><span class="token class-name"><span class="token keyword">int</span></span> currentHealth<span class="token punctuation">,</span><span class="token class-name"><span class="token keyword">int</span></span> maxHealth<span class="token punctuation">)</span><span class="token punctuation">&#123;</span>        <span class="token comment">//更新血量</span>        <span class="token keyword">if</span><span class="token punctuation">(</span>currentHealth <span class="token operator">&lt;=</span> <span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>            <span class="token comment">//如果当前血量小于等于0，就销毁UIbar</span>            <span class="token function">Destroy</span><span class="token punctuation">(</span>UIbar<span class="token punctuation">.</span>gameObject<span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token punctuation">&#125;</span>        <span class="token comment">//每次更新时必然可见</span>        UIbar<span class="token punctuation">.</span>gameObject<span class="token punctuation">.</span><span class="token function">SetActive</span><span class="token punctuation">(</span><span class="token boolean">true</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token comment">//得到血量百分比</span>        <span class="token class-name"><span class="token keyword">float</span></span> sliderPercent <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token keyword">float</span><span class="token punctuation">)</span>currentHealth <span class="token operator">/</span> maxHealth<span class="token punctuation">;</span>        <span class="token comment">//更新血条长度</span>        healthSlider<span class="token punctuation">.</span>fillAmount <span class="token operator">=</span> sliderPercent<span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span>    <span class="token return-type class-name"><span class="token keyword">void</span></span> <span class="token function">LateUpdate</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>        <span class="token comment">//在Update后一帧执行</span>        <span class="token comment">//更新血条跟随敌人位置</span>        <span class="token comment">//这里先检测UIbar有没有给销毁</span>        <span class="token keyword">if</span><span class="token punctuation">(</span>UIbar <span class="token operator">!=</span> <span class="token keyword">null</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>            UIbar<span class="token punctuation">.</span>position <span class="token operator">=</span> barPoint<span class="token punctuation">.</span>position<span class="token punctuation">;</span><span class="token comment">//更新到敌人位置</span>            UIbar<span class="token punctuation">.</span>forward <span class="token operator">=</span> cam<span class="token punctuation">.</span>forward<span class="token punctuation">;</span><span class="token comment">//面朝摄像机（即摄像机的方向）</span>            <span class="token comment">//血条剩余显示时间</span>            <span class="token keyword">if</span><span class="token punctuation">(</span>timeLeft <span class="token operator">&lt;=</span> <span class="token number">0</span> <span class="token operator">&amp;&amp;</span> <span class="token operator">!</span>alwaysVisible<span class="token punctuation">)</span><span class="token punctuation">&#123;</span>                timeLeft <span class="token operator">=</span> visibleTime<span class="token punctuation">;</span>                UIbar<span class="token punctuation">.</span>gameObject<span class="token punctuation">.</span><span class="token function">SetActive</span><span class="token punctuation">(</span><span class="token boolean">false</span><span class="token punctuation">)</span><span class="token punctuation">;</span>            <span class="token punctuation">&#125;</span>            <span class="token keyword">else</span>                timeLeft <span class="token operator">-=</span> Time<span class="token punctuation">.</span>deltaTime<span class="token punctuation">;</span>        <span class="token punctuation">&#125;</span>    <span class="token punctuation">&#125;</span><span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>最后把代码脚本挂载到每个敌人身上，再调整数据就可以运行试试看效果了</p>]]></content>
    
    
      
      
    <summary type="html">&lt;p&gt;这一章我们来制作一下敌人的血量条&lt;/p&gt;
&lt;h1 id=&quot;创建血条UI&quot;&gt;&lt;a href=&quot;#创建血条UI&quot; class=&quot;headerlink&quot; title=&quot;创建血条UI&quot;&gt;&lt;/a&gt;创建血条UI&lt;/h1&gt;&lt;h2 id=&quot;创建血条基础形状（Canvas与Image）&quot;&gt;&lt;</summary>
      
    
    
    
    <category term="Unity学习笔记" scheme="http://sakura-pub.ltd/categories/Unity%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/"/>
    
    
    <category term="Unity" scheme="http://sakura-pub.ltd/tags/Unity/"/>
    
  </entry>
  
  <entry>
    <title>Unity笔记21-反击石头人</title>
    <link href="http://sakura-pub.ltd/UnityNotes/Unity%E7%AC%94%E8%AE%B021-%E5%8F%8D%E5%87%BB%E7%9F%B3%E5%A4%B4%E4%BA%BA/"/>
    <id>http://sakura-pub.ltd/UnityNotes/Unity%E7%AC%94%E8%AE%B021-%E5%8F%8D%E5%87%BB%E7%9F%B3%E5%A4%B4%E4%BA%BA/</id>
    <published>2021-07-27T13:54:34.000Z</published>
    <updated>2021-07-28T01:59:34.199Z</updated>
    
    <content type="html"><![CDATA[<p> 这一章中我们来实现石头人丢出石头来击飞玩家并且造成伤害的效果，同时玩家还可以利用石头反击石头人</p><h1 id="实现石头击飞玩家并造成伤害"><a href="#实现石头击飞玩家并造成伤害" class="headerlink" title="实现石头击飞玩家并造成伤害"></a>实现石头击飞玩家并造成伤害</h1><p>我们打开<code>Rock.cs</code>，我们要有区分性的触发伤害，对于玩家和敌人可以造成伤害，但是对于丢到地面的情况是不能造成伤害的，所以这里可以利用一个枚举来区分开来</p><pre class="line-numbers language-csharp" data-language="csharp"><code class="language-csharp"><span class="token keyword">public</span> <span class="token keyword">enum</span> <span class="token class-name">RockStates</span><span class="token punctuation">&#123;</span>HitPlayer<span class="token punctuation">,</span>HitEnemy<span class="token punctuation">,</span>HitNothing<span class="token punctuation">&#125;</span><span class="token punctuation">;</span><span class="token keyword">public</span>  <span class="token class-name">RockStates</span> rockStates<span class="token punctuation">;</span><span class="token comment">//枚举实例</span><span class="token keyword">public</span> <span class="token class-name"><span class="token keyword">int</span></span> damage<span class="token punctuation">;</span><span class="token comment">//造成的伤害是多少</span><span class="token return-type class-name"><span class="token keyword">void</span></span> <span class="token function">OnCollisionEnter</span><span class="token punctuation">(</span><span class="token class-name">Collision</span> other<span class="token punctuation">)</span><span class="token punctuation">&#123;</span><span class="token comment">//other指被石头打到的对象</span>    <span class="token comment">//当发生碰撞时会执行这个函数</span>    <span class="token keyword">switch</span><span class="token punctuation">(</span>rockStates<span class="token punctuation">)</span><span class="token punctuation">&#123;</span>        <span class="token keyword">case</span> RockStates<span class="token punctuation">.</span>HitPlayer<span class="token punctuation">:</span>            <span class="token keyword">if</span><span class="token punctuation">(</span>other<span class="token punctuation">.</span>gameObject<span class="token punctuation">.</span><span class="token function">CompareTag</span><span class="token punctuation">(</span><span class="token string">"Player"</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>                other<span class="token punctuation">.</span>gameObject<span class="token punctuation">.</span><span class="token generic-method"><span class="token function">GetComponent</span><span class="token generic class-name"><span class="token punctuation">&lt;</span>NavMeshAgent<span class="token punctuation">></span></span></span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span>isStopped <span class="token operator">=</span> <span class="token boolean">true</span><span class="token punctuation">;</span>                other<span class="token punctuation">.</span>gameObject<span class="token punctuation">.</span><span class="token generic-method"><span class="token function">GetComponent</span><span class="token generic class-name"><span class="token punctuation">&lt;</span>NavMeshAgent<span class="token punctuation">></span></span></span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span>velocity <span class="token operator">=</span> direction <span class="token operator">*</span> force<span class="token punctuation">;</span><span class="token comment">//击退玩家</span>                other<span class="token punctuation">.</span>gameObject<span class="token punctuation">.</span><span class="token generic-method"><span class="token function">GetComponent</span><span class="token generic class-name"><span class="token punctuation">&lt;</span>Animator<span class="token punctuation">></span></span></span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">SetTrigger</span><span class="token punctuation">(</span><span class="token string">"Dizzy"</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">//眩晕</span>                <span class="token comment">//这里的TakeDamage是重载的其中一个方法</span>                <span class="token comment">//造成伤害</span>                other<span class="token punctuation">.</span>gameObject<span class="token punctuation">.</span><span class="token generic-method"><span class="token function">GetComponent</span><span class="token generic class-name"><span class="token punctuation">&lt;</span>CharacterStates<span class="token punctuation">></span></span></span><span class="token punctuation">(</span><span class="token punctuation">)</span>                    <span class="token punctuation">.</span><span class="token function">TakeDamage</span><span class="token punctuation">(</span>damage<span class="token punctuation">,</span>other<span class="token punctuation">.</span>gameObject<span class="token punctuation">.</span><span class="token generic-method"><span class="token function">GetComponent</span><span class="token generic class-name"><span class="token punctuation">&lt;</span>CharacterStates<span class="token punctuation">></span></span></span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>                rockStates <span class="token operator">=</span> RockStates<span class="token punctuation">.</span>HitNothing<span class="token punctuation">;</span><span class="token comment">//复原状态以防一直执行</span>            <span class="token punctuation">&#125;</span>            <span class="token keyword">break</span><span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span><span class="token comment">//end switch</span><span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>我们看到其中的<code>TakeDamage()</code>是一个重载方法，打开<code>CharacterStates.cs</code>我们这里补充一下</p><pre class="line-numbers language-csharp" data-language="csharp"><code class="language-csharp"><span class="token comment">//函数重载</span><span class="token keyword">public</span> <span class="token return-type class-name"><span class="token keyword">void</span></span> <span class="token function">TakeDamage</span><span class="token punctuation">(</span><span class="token class-name"><span class="token keyword">int</span></span> damage<span class="token punctuation">,</span><span class="token class-name">CharacterStates</span> defener<span class="token punctuation">)</span><span class="token punctuation">&#123;</span>    <span class="token class-name"><span class="token keyword">int</span></span> dam <span class="token operator">=</span> Mathf<span class="token punctuation">.</span><span class="token function">Max</span><span class="token punctuation">(</span>damage <span class="token operator">-</span> defener<span class="token punctuation">.</span>currentDefence<span class="token punctuation">,</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    defener<span class="token punctuation">.</span>currentHealth <span class="token operator">=</span> Mathf<span class="token punctuation">.</span><span class="token function">Max</span><span class="token punctuation">(</span>defener<span class="token punctuation">.</span>currentHealth <span class="token operator">-</span> dam<span class="token punctuation">,</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>然后保存关闭，别忘了要在外边石头对象上赋予一个初始伤害值</p><img src="https://p9-tt.byteimg.com/origin/pgc-image/87f552555d2d4f60b4fe62d0d9c10da6.png" alt="1.png" style="zoom:80%;" /><p>这样我们就实现了石头的第一个状态</p><h1 id="实现石头攻击石头人"><a href="#实现石头攻击石头人" class="headerlink" title="实现石头攻击石头人"></a>实现石头攻击石头人</h1><p>先把代码完善好</p><pre class="line-numbers language-csharp" data-language="csharp"><code class="language-csharp"><span class="token keyword">case</span> RockStates<span class="token punctuation">.</span>HitEnemy<span class="token punctuation">:</span><span class="token keyword">if</span><span class="token punctuation">(</span>other<span class="token punctuation">.</span>gameObject<span class="token punctuation">.</span><span class="token generic-method"><span class="token function">GetComponent</span><span class="token generic class-name"><span class="token punctuation">&lt;</span>Golem<span class="token punctuation">></span></span></span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>    <span class="token comment">//获得了石头人代码组件的就是石头人的，否则返回的是空</span>    <span class="token class-name"><span class="token keyword">var</span></span> otherStates <span class="token operator">=</span> other<span class="token punctuation">.</span>gameObject<span class="token punctuation">.</span><span class="token generic-method"><span class="token function">GetComponent</span><span class="token generic class-name"><span class="token punctuation">&lt;</span>CharacterStates<span class="token punctuation">></span></span></span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    otherStates<span class="token punctuation">.</span><span class="token function">TakeDamage</span><span class="token punctuation">(</span>damage<span class="token punctuation">,</span>otherStates<span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token function">Destroy</span><span class="token punctuation">(</span>gameObject<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">&#125;</span><span class="token keyword">break</span><span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>因为我们这里是反击石头人，所以要有个判断鼠标点击到了石头，一个最直接的办法就是给我们的石头添加一个标签，然后再修改一下鼠标点击时的方法</p><img src="https://p3-tt.byteimg.com/origin/pgc-image/e18b4dde9c5b4129bba36dd1c9f553b2.png" alt="2.png" style="zoom:80%;" /><p>回到<code>PlayerController.cs</code>修改一下</p><pre class="line-numbers language-csharp" data-language="csharp"><code class="language-csharp"><span class="token return-type class-name"><span class="token keyword">void</span></span> <span class="token function">Hit</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>    <span class="token keyword">if</span><span class="token punctuation">(</span>attactTarget<span class="token punctuation">.</span><span class="token function">CompareTag</span><span class="token punctuation">(</span><span class="token string">"Attackable"</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>        <span class="token comment">//如果点击的对象不是敌人而是其它另类可攻击对象，如石头</span>        <span class="token keyword">if</span><span class="token punctuation">(</span>attactTarget<span class="token punctuation">.</span><span class="token generic-method"><span class="token function">GetComponent</span><span class="token generic class-name"><span class="token punctuation">&lt;</span>Rock<span class="token punctuation">></span></span></span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">&amp;&amp;</span> attactTarget<span class="token punctuation">.</span><span class="token generic-method"><span class="token function">GetComponent</span><span class="token generic class-name"><span class="token punctuation">&lt;</span>Rock<span class="token punctuation">></span></span></span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span>rockStates            <span class="token operator">==</span> Rock<span class="token punctuation">.</span>RockStates<span class="token punctuation">.</span>HitNothing<span class="token punctuation">)</span><span class="token punctuation">&#123;</span>            <span class="token comment">//如果是石头并且石头不在空中而是落地之后</span>            attactTarget<span class="token punctuation">.</span><span class="token generic-method"><span class="token function">GetComponent</span><span class="token generic class-name"><span class="token punctuation">&lt;</span>Rock<span class="token punctuation">></span></span></span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span>rockStates <span class="token operator">=</span> Rock<span class="token punctuation">.</span>RockStates<span class="token punctuation">.</span>HitEnemy<span class="token punctuation">;</span>            <span class="token comment">//防止攻击那一刹那速度小于1导致石头状态发生改变</span>            attactTarget<span class="token punctuation">.</span><span class="token generic-method"><span class="token function">GetComponent</span><span class="token generic class-name"><span class="token punctuation">&lt;</span>Rigidbody<span class="token punctuation">></span></span></span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span>velocity <span class="token operator">=</span> Vector3<span class="token punctuation">.</span>one<span class="token punctuation">;</span>                        <span class="token comment">//添加一个玩家朝向的力，力的大小暂时定 40</span>            attactTarget<span class="token punctuation">.</span><span class="token generic-method"><span class="token function">GetComponent</span><span class="token generic class-name"><span class="token punctuation">&lt;</span>Rigidbody<span class="token punctuation">></span></span></span><span class="token punctuation">(</span><span class="token punctuation">)</span>                <span class="token punctuation">.</span><span class="token function">AddForce</span><span class="token punctuation">(</span>transform<span class="token punctuation">.</span>forward <span class="token operator">*</span> <span class="token number">40</span><span class="token punctuation">,</span>ForceMode<span class="token punctuation">.</span>Impulse<span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token punctuation">&#125;</span>    <span class="token punctuation">&#125;</span><span class="token keyword">else</span><span class="token punctuation">&#123;</span>        <span class="token class-name"><span class="token keyword">var</span></span> targetStates <span class="token operator">=</span> attactTarget<span class="token punctuation">.</span><span class="token generic-method"><span class="token function">GetComponent</span><span class="token generic class-name"><span class="token punctuation">&lt;</span>CharacterStates<span class="token punctuation">></span></span></span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token comment">//计算伤害</span>        targetStates<span class="token punctuation">.</span><span class="token function">TakeDamage</span><span class="token punctuation">(</span>charcterStates<span class="token punctuation">,</span>targetStates<span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span><span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>我们可以看到条件中有一个是判断是否为<code>HitNothing</code>，我们可以利用判断石头是否为接近于静止时为条件，这里我们就要回去<code>Rock.cs</code>做一些修改了</p><pre class="line-numbers language-csharp" data-language="csharp"><code class="language-csharp"><span class="token return-type class-name"><span class="token keyword">void</span></span> <span class="token function">Start</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>    rb <span class="token operator">=</span> <span class="token generic-method"><span class="token function">GetComponent</span><span class="token generic class-name"><span class="token punctuation">&lt;</span>Rigidbody<span class="token punctuation">></span></span></span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    rb<span class="token punctuation">.</span>velocity <span class="token operator">=</span> Vector3<span class="token punctuation">.</span>one<span class="token punctuation">;</span><span class="token comment">//防止石头一生成时速度为0导致状态发生改变</span>    <span class="token function">FlyToTarget</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">&#125;</span><span class="token return-type class-name"><span class="token keyword">void</span></span> <span class="token function">FixedUpdate</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>    <span class="token comment">//固定帧更新</span>    <span class="token keyword">if</span><span class="token punctuation">(</span>rb<span class="token punctuation">.</span>velocity<span class="token punctuation">.</span>sqrMagnitude <span class="token operator">&lt;</span> <span class="token number">1f</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span><span class="token comment">//向量的平方</span>        rockStates <span class="token operator">=</span> RockStates<span class="token punctuation">.</span>HitNothing<span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span><span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>最后别忘了在<code>MouseManager.cs</code>加上代码</p><pre class="line-numbers language-csharp" data-language="csharp"><code class="language-csharp"><span class="token return-type class-name"><span class="token keyword">void</span></span> <span class="token function">MouseControl</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>    <span class="token keyword">if</span><span class="token punctuation">(</span>Input<span class="token punctuation">.</span><span class="token function">GetMouseButtonDown</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span> <span class="token operator">&amp;&amp;</span> hitInfo<span class="token punctuation">.</span>collider <span class="token operator">!=</span> <span class="token keyword">null</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>        <span class="token keyword">if</span><span class="token punctuation">(</span>hitInfo<span class="token punctuation">.</span>collider<span class="token punctuation">.</span><span class="token function">CompareTag</span><span class="token punctuation">(</span><span class="token string">"Ground"</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>            OnMouseClicked<span class="token punctuation">?.</span><span class="token function">Invoke</span><span class="token punctuation">(</span>hitInfo<span class="token punctuation">.</span>point<span class="token punctuation">)</span><span class="token punctuation">;</span>            <span class="token class-name"><span class="token keyword">var</span></span> point <span class="token operator">=</span> hitInfo<span class="token punctuation">.</span>point<span class="token punctuation">;</span>        <span class="token punctuation">&#125;</span>        <span class="token keyword">if</span><span class="token punctuation">(</span>hitInfo<span class="token punctuation">.</span>collider<span class="token punctuation">.</span><span class="token function">CompareTag</span><span class="token punctuation">(</span><span class="token string">"Enemy"</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>            OnEnemyClicked<span class="token punctuation">?.</span><span class="token function">Invoke</span><span class="token punctuation">(</span>hitInfo<span class="token punctuation">.</span>collider<span class="token punctuation">.</span>gameObject<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">//点击敌人传递敌人的gameObject</span>        <span class="token punctuation">&#125;</span>        <span class="token keyword">if</span><span class="token punctuation">(</span>hitInfo<span class="token punctuation">.</span>collider<span class="token punctuation">.</span><span class="token function">CompareTag</span><span class="token punctuation">(</span><span class="token string">"Attackable"</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token comment">//点击石头等对象用</span>            OnEnemyClicked<span class="token punctuation">?.</span><span class="token function">Invoke</span><span class="token punctuation">(</span>hitInfo<span class="token punctuation">.</span>collider<span class="token punctuation">.</span>gameObject<span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span><span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h1 id="为石头加上爆裂特效"><a href="#为石头加上爆裂特效" class="headerlink" title="为石头加上爆裂特效"></a>为石头加上爆裂特效</h1><p>最后我们想在石头打到石头人时有一个爆裂碎石特效，这里就要用到<code>Particle System</code>了</p><img src="https://p6-tt.byteimg.com/origin/pgc-image/efcac51c11a3459cb6e1cfad55ff677a.png" alt="3.png" style="zoom:80%;" /><p>创建好之后我们按照下图参考设置</p><img src="https://p26-tt.byteimg.com/origin/pgc-image/2a5fef602fe948eab2649b98a3f07f83.png" alt="5.png" style="zoom:80%;" /><img src="https://p5-tt.byteimg.com/origin/pgc-image/529e6ea5fe1141afb30b34135e7b8018.png" alt="6.png" style="zoom:80%;" /><img src="https://p6-tt.byteimg.com/origin/pgc-image/e34343a1983440909f77ce88719261e3.png" alt="7.png" style="zoom:80%;" /><img src="https://p5-tt.byteimg.com/origin/pgc-image/973530a9742240a7bc989b50a5ce86fb.png" alt="8.png" style="zoom:80%;" /><p>自己多多测试一下效果，满意之后我们就可以改个名将它保存为一个素材放好先，然后不要忘了把地图上刚刚调试的删除</p><img src="https://p6-tt.byteimg.com/origin/pgc-image/4b40b473872f4223a4aafecdb889c930.png" alt="9.png" style="zoom:80%;" /><p>最后再在<code>Rock.cs</code>上修改一下代码</p><pre class="line-numbers language-csharp" data-language="csharp"><code class="language-csharp"><span class="token keyword">public</span> <span class="token class-name">GameObject</span> RockBreakParticle<span class="token punctuation">;</span><span class="token comment">//石头爆裂特效，供外界拖拽进来</span><span class="token keyword">case</span> RockStates<span class="token punctuation">.</span>HitEnemy<span class="token punctuation">:</span><span class="token keyword">if</span><span class="token punctuation">(</span>other<span class="token punctuation">.</span>gameObject<span class="token punctuation">.</span><span class="token generic-method"><span class="token function">GetComponent</span><span class="token generic class-name"><span class="token punctuation">&lt;</span>Golem<span class="token punctuation">></span></span></span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>    <span class="token comment">//获得了石头人代码组件的就是石头人的，否则返回的是空</span>    <span class="token class-name"><span class="token keyword">var</span></span> otherStates <span class="token operator">=</span> other<span class="token punctuation">.</span>gameObject<span class="token punctuation">.</span><span class="token generic-method"><span class="token function">GetComponent</span><span class="token generic class-name"><span class="token punctuation">&lt;</span>CharacterStates<span class="token punctuation">></span></span></span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    otherStates<span class="token punctuation">.</span><span class="token function">TakeDamage</span><span class="token punctuation">(</span>damage<span class="token punctuation">,</span>otherStates<span class="token punctuation">)</span><span class="token punctuation">;</span>    Instantiate        <span class="token punctuation">(</span>RockBreakParticle<span class="token punctuation">,</span>transform<span class="token punctuation">.</span>position<span class="token punctuation">,</span>Quaternion<span class="token punctuation">.</span>identity<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">//击中敌人时产生爆裂特效</span>    <span class="token function">Destroy</span><span class="token punctuation">(</span>gameObject<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">&#125;</span><span class="token keyword">break</span><span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>最后不要忘了把石头爆裂的特效拖进去设置面板里</p><img src="https://p9-tt.byteimg.com/origin/pgc-image/272290cea6af4b3a8f67fbe952186662.png" alt="10.png" style="zoom:80%;" />]]></content>
    
    
      
      
    <summary type="html">&lt;p&gt; 这一章中我们来实现石头人丢出石头来击飞玩家并且造成伤害的效果，同时玩家还可以利用石头反击石头人&lt;/p&gt;
&lt;h1 id=&quot;实现石头击飞玩家并造成伤害&quot;&gt;&lt;a href=&quot;#实现石头击飞玩家并造成伤害&quot; class=&quot;headerlink&quot; title=&quot;实现石头击飞玩家并造</summary>
      
    
    
    
    <category term="Unity学习笔记" scheme="http://sakura-pub.ltd/categories/Unity%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/"/>
    
    
    <category term="Unity" scheme="http://sakura-pub.ltd/tags/Unity/"/>
    
  </entry>
  
  <entry>
    <title>Unity笔记20-实现石头人丢出石头</title>
    <link href="http://sakura-pub.ltd/UnityNotes/Unity%E7%AC%94%E8%AE%B020-%E5%AE%9E%E7%8E%B0%E7%9F%B3%E5%A4%B4%E4%BA%BA%E4%B8%A2%E5%87%BA%E7%9F%B3%E5%A4%B4/"/>
    <id>http://sakura-pub.ltd/UnityNotes/Unity%E7%AC%94%E8%AE%B020-%E5%AE%9E%E7%8E%B0%E7%9F%B3%E5%A4%B4%E4%BA%BA%E4%B8%A2%E5%87%BA%E7%9F%B3%E5%A4%B4/</id>
    <published>2021-07-26T01:12:34.000Z</published>
    <updated>2021-07-26T03:00:21.294Z</updated>
    
    <content type="html"><![CDATA[<p>这一章我们实现一下石头人的特殊攻击，也就是生成一个石头然后丢向我们玩家</p><h1 id="编辑石头"><a href="#编辑石头" class="headerlink" title="编辑石头"></a>编辑石头</h1><p>首先我们找到石头素材拖出来，由于我们要给它施加一个力，因此这里就要用到<code>Rigidbody(钢体)</code>组件了</p><img src="https://p9-tt.byteimg.com/origin/pgc-image/63ea4e8d49e540acb69a7ded75d37782.png" alt="2.png" style="zoom:80%;" /><p>同时石头还要与地面发生碰撞，因此还要添加一个碰撞体，这里选择的是<code>MeshCollider</code>，勾选<code>Convex</code>可以看到碰撞体积刚好适配我们的石头形状</p><img src="https://p26-tt.byteimg.com/origin/pgc-image/ddc484a234c94603b2b16b9dd5ea0a42.png" alt="3.png" style="zoom:80%;" /><p>然后我们就要来进行写代码了</p><img src="https://p3-tt.byteimg.com/origin/pgc-image/0a42c8f078f8441ea47b3ef4af3302f8.png" alt="1.png" style="zoom:80%;" /><pre class="line-numbers language-csharp" data-language="csharp"><code class="language-csharp"><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">Rock</span> <span class="token punctuation">:</span> <span class="token type-list"><span class="token class-name">MonoBehaviour</span></span><span class="token punctuation">&#123;</span>    <span class="token keyword">private</span> <span class="token class-name">Rigidbody</span> rb<span class="token punctuation">;</span>    <span class="token punctuation">[</span><span class="token attribute"><span class="token class-name">Header</span><span class="token attribute-arguments"><span class="token punctuation">(</span><span class="token string">"Basic Settings(扔出石头参数设置)"</span><span class="token punctuation">)</span></span></span><span class="token punctuation">]</span>    <span class="token keyword">public</span> <span class="token class-name"><span class="token keyword">float</span></span> force<span class="token punctuation">;</span><span class="token comment">//丢出去的冲击力大小</span>    <span class="token keyword">public</span> <span class="token class-name">GameObject</span> target<span class="token punctuation">;</span><span class="token comment">//丢向的目标</span>    <span class="token keyword">private</span> <span class="token class-name">Vector3</span> direction<span class="token punctuation">;</span><span class="token comment">//丢出去的方向</span>    <span class="token return-type class-name"><span class="token keyword">void</span></span> <span class="token function">Start</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>        rb <span class="token operator">=</span> <span class="token generic-method"><span class="token function">GetComponent</span><span class="token generic class-name"><span class="token punctuation">&lt;</span>Rigidbody<span class="token punctuation">></span></span></span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token function">FlyToTarget</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span>    <span class="token keyword">public</span> <span class="token return-type class-name"><span class="token keyword">void</span></span> <span class="token function">FlyToTarget</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>        <span class="token comment">//防止丢出去那一刹那玩家脱离丢失目标导致石头生成不出来</span>        <span class="token keyword">if</span><span class="token punctuation">(</span>target <span class="token operator">==</span> <span class="token keyword">null</span><span class="token punctuation">)</span>            target <span class="token operator">=</span> <span class="token generic-method"><span class="token function">FindObjectOfType</span><span class="token generic class-name"><span class="token punctuation">&lt;</span>PlayerController<span class="token punctuation">></span></span></span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span>gameObject<span class="token punctuation">;</span>                <span class="token comment">//Vector3.up是想在石头丢出去的时候上升一个高度</span>        direction <span class="token operator">=</span> <span class="token punctuation">(</span>target<span class="token punctuation">.</span>transform<span class="token punctuation">.</span>position <span class="token operator">-</span> transform<span class="token punctuation">.</span>position <span class="token operator">+</span> Vector3<span class="token punctuation">.</span>up<span class="token punctuation">)</span><span class="token punctuation">.</span>normalized<span class="token punctuation">;</span>        <span class="token comment">//Impulse是冲击力的模式</span>        rb<span class="token punctuation">.</span><span class="token function">AddForce</span><span class="token punctuation">(</span>direction <span class="token operator">*</span> force<span class="token punctuation">,</span>ForceMode<span class="token punctuation">.</span>Impulse<span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span><span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>然后我们将石头素材保存一个模板对象</p><img src="https://p26-tt.byteimg.com/origin/pgc-image/735c192da1924614a7f5e0f0ee01b428.png" alt="4.png" style="zoom:80%;" /><h1 id="进一步完善石头人"><a href="#进一步完善石头人" class="headerlink" title="进一步完善石头人"></a>进一步完善石头人</h1><p>随后我们再次编辑石头人，因为我们的石头是从石头人的手上丢出去的，因此我们就要获得手的坐标，即下面的对象坐标</p><img src="https://p26-tt.byteimg.com/origin/pgc-image/0cdbbddf408c42e6a443e151c343ce6b.png" alt="5.png" style="zoom:80%;" /><p>知道这个后我们暂时放在一边，来编写一下石头人的代码</p><pre class="line-numbers language-csharp" data-language="csharp"><code class="language-csharp"><span class="token punctuation">[</span><span class="token attribute"><span class="token class-name">Header</span><span class="token attribute-arguments"><span class="token punctuation">(</span><span class="token string">"Rock Settings（丢石头攻击的相关设置）"</span><span class="token punctuation">)</span></span></span><span class="token punctuation">]</span><span class="token keyword">public</span> <span class="token class-name">GameObject</span> rockPrefab<span class="token punctuation">;</span><span class="token comment">//石头素材</span><span class="token keyword">public</span> <span class="token class-name">Transform</span> handPos<span class="token punctuation">;</span><span class="token comment">//丢出石头的手的坐标</span><span class="token keyword">public</span> <span class="token return-type class-name"><span class="token keyword">void</span></span> <span class="token function">ThrowRock</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>    <span class="token keyword">if</span><span class="token punctuation">(</span>attackTarget <span class="token operator">!=</span> <span class="token keyword">null</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>        <span class="token comment">//创建石头对象，第三个参数是旋转，这里选择维持初始旋转</span>        <span class="token class-name">GameObject</span> rock <span class="token operator">=</span> <span class="token function">Instantiate</span><span class="token punctuation">(</span>rockPrefab<span class="token punctuation">,</span>handPos<span class="token punctuation">.</span>position<span class="token punctuation">,</span>Quaternion<span class="token punctuation">.</span>identity<span class="token punctuation">)</span><span class="token punctuation">;</span>        rock<span class="token punctuation">.</span><span class="token generic-method"><span class="token function">GetComponent</span><span class="token generic class-name"><span class="token punctuation">&lt;</span>Rock<span class="token punctuation">></span></span></span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span>target <span class="token operator">=</span> attackTarget<span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span><span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>然后我们把石头人的动画事件添加上去</p><img src="https://p5-tt.byteimg.com/origin/pgc-image/6ec880f34ce24caab5c2270d61e5d04a.png" alt="6.png" style="zoom:80%;" /><p>最后别忘了还要选择石头的素材（就是我们刚刚保存好的素材模板），以及手的坐标</p><img src="https://p6-tt.byteimg.com/origin/pgc-image/29b7a5e0ae72481a933c5728c35ca1b9.png" alt="7.png" style="zoom:80%;" />]]></content>
    
    
      
      
    <summary type="html">&lt;p&gt;这一章我们实现一下石头人的特殊攻击，也就是生成一个石头然后丢向我们玩家&lt;/p&gt;
&lt;h1 id=&quot;编辑石头&quot;&gt;&lt;a href=&quot;#编辑石头&quot; class=&quot;headerlink&quot; title=&quot;编辑石头&quot;&gt;&lt;/a&gt;编辑石头&lt;/h1&gt;&lt;p&gt;首先我们找到石头素材拖出来，由于我们要</summary>
      
    
    
    
    <category term="Unity学习笔记" scheme="http://sakura-pub.ltd/categories/Unity%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/"/>
    
    
    <category term="Unity" scheme="http://sakura-pub.ltd/tags/Unity/"/>
    
  </entry>
  
  <entry>
    <title>Unity笔记19-设置石头人</title>
    <link href="http://sakura-pub.ltd/UnityNotes/Unity%E7%AC%94%E8%AE%B019-%E8%AE%BE%E7%BD%AE%E7%9F%B3%E5%A4%B4%E4%BA%BA/"/>
    <id>http://sakura-pub.ltd/UnityNotes/Unity%E7%AC%94%E8%AE%B019-%E8%AE%BE%E7%BD%AE%E7%9F%B3%E5%A4%B4%E4%BA%BA/</id>
    <published>2021-07-25T04:09:19.000Z</published>
    <updated>2021-07-25T06:52:30.857Z</updated>
    
    <content type="html"><![CDATA[<p>这一章节我们来设置石头人，由于和设置兽人相差不大，篇幅比较少</p><h1 id="设置动画"><a href="#设置动画" class="headerlink" title="设置动画"></a>设置动画</h1><p>我们去浏览石头人的动画可以发现，<code>Attack01</code>是类似拿起石头丢我们，它才是技能攻击，而<code>Attack02</code>是击晕玩家的攻击动画，可以作为普通攻击来使，因此我们在调整攻击动画时要注意分清</p><p>我们的动画控制器文件就选择是基于<code>兽人</code>的动画来完成，创建一个<code>New Animator Override Controller</code>，模板选择为兽人，然后再一个个动画替换上去</p><img src="https://p3-tt.byteimg.com/origin/pgc-image/cbf3634f05844a5f98fed856698b1a5a.png" alt="1.png" style="zoom:80%;" /><p>其中<code>Run</code>并没有自带动画，我们可以用<code>Walk</code>代替</p><h1 id="编写代码文件"><a href="#编写代码文件" class="headerlink" title="编写代码文件"></a>编写代码文件</h1><p>我们像兽人代码文件那样单独创一个代码文件给石头人用，并且也是要继承<code>EnemyController</code></p><pre class="line-numbers language-csharp" data-language="csharp"><code class="language-csharp"><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">Golem</span> <span class="token punctuation">:</span> <span class="token type-list"><span class="token class-name">EnemyController</span></span><span class="token punctuation">&#123;</span>    <span class="token punctuation">[</span><span class="token attribute"><span class="token class-name">Header</span><span class="token attribute-arguments"><span class="token punctuation">(</span><span class="token string">"Skill（石头人特殊攻击设置）"</span><span class="token punctuation">)</span></span></span><span class="token punctuation">]</span>    <span class="token keyword">public</span> <span class="token class-name"><span class="token keyword">float</span></span> kickForce <span class="token operator">=</span> <span class="token number">20</span><span class="token punctuation">;</span><span class="token comment">//推开敌人距离</span>    <span class="token return-type class-name"><span class="token keyword">void</span></span> <span class="token function">kickOff</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>        <span class="token comment">//石头人击飞玩家</span>        <span class="token keyword">if</span><span class="token punctuation">(</span>attackTarget <span class="token operator">!=</span> <span class="token keyword">null</span> <span class="token operator">&amp;&amp;</span> transform<span class="token punctuation">.</span><span class="token function">IsFacingTarget</span><span class="token punctuation">(</span>attackTarget<span class="token punctuation">.</span>transform<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>            <span class="token class-name"><span class="token keyword">var</span></span> targetState <span class="token operator">=</span> attackTarget<span class="token punctuation">.</span><span class="token generic-method"><span class="token function">GetComponent</span><span class="token generic class-name"><span class="token punctuation">&lt;</span>CharacterStates<span class="token punctuation">></span></span></span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>            transform<span class="token punctuation">.</span><span class="token function">LookAt</span><span class="token punctuation">(</span>attackTarget<span class="token punctuation">.</span>transform<span class="token punctuation">)</span><span class="token punctuation">;</span>            <span class="token class-name">Vector3</span> direction <span class="token operator">=</span> <span class="token punctuation">(</span>attackTarget<span class="token punctuation">.</span>transform<span class="token punctuation">.</span>position <span class="token operator">-</span> transform<span class="token punctuation">.</span>position<span class="token punctuation">)</span><span class="token punctuation">.</span>normalized<span class="token punctuation">;</span>            attackTarget<span class="token punctuation">.</span><span class="token generic-method"><span class="token function">GetComponent</span><span class="token generic class-name"><span class="token punctuation">&lt;</span>NavMeshAgent<span class="token punctuation">></span></span></span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span>isStopped <span class="token operator">=</span> <span class="token boolean">true</span><span class="token punctuation">;</span>            attackTarget<span class="token punctuation">.</span><span class="token generic-method"><span class="token function">GetComponent</span><span class="token generic class-name"><span class="token punctuation">&lt;</span>NavMeshAgent<span class="token punctuation">></span></span></span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span>velocity <span class="token operator">=</span> direction<span class="token operator">*</span>kickForce<span class="token punctuation">;</span>            targetState<span class="token punctuation">.</span><span class="token function">TakeDamage</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>characterStates<span class="token punctuation">,</span>targetState<span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token punctuation">&#125;</span>    <span class="token punctuation">&#125;</span><span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>最后再添加动画事件就行了</p>]]></content>
    
    
      
      
    <summary type="html">&lt;p&gt;这一章节我们来设置石头人，由于和设置兽人相差不大，篇幅比较少&lt;/p&gt;
&lt;h1 id=&quot;设置动画&quot;&gt;&lt;a href=&quot;#设置动画&quot; class=&quot;headerlink&quot; title=&quot;设置动画&quot;&gt;&lt;/a&gt;设置动画&lt;/h1&gt;&lt;p&gt;我们去浏览石头人的动画可以发现，&lt;code&gt;At</summary>
      
    
    
    
    <category term="Unity学习笔记" scheme="http://sakura-pub.ltd/categories/Unity%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/"/>
    
    
    <category term="Unity" scheme="http://sakura-pub.ltd/tags/Unity/"/>
    
  </entry>
  
  <entry>
    <title>Unity笔记18-扩展方法</title>
    <link href="http://sakura-pub.ltd/UnityNotes/Unity%E7%AC%94%E8%AE%B018-%E6%89%A9%E5%B1%95%E6%96%B9%E6%B3%95/"/>
    <id>http://sakura-pub.ltd/UnityNotes/Unity%E7%AC%94%E8%AE%B018-%E6%89%A9%E5%B1%95%E6%96%B9%E6%B3%95/</id>
    <published>2021-07-24T04:55:12.000Z</published>
    <updated>2021-07-24T06:02:15.450Z</updated>
    
    <content type="html"><![CDATA[<p>这一章我们来熟悉一下扩展方法，所谓扩展方法就是在不继承一个类，但是可以额外编写一个类来扩展这个类的功能，比如这一章我们想让我们控制主角在兽人后面时兽人攻击不会造成伤害，这里就要用到<code>transfrom</code>类，但是<code>transfrom</code>里边没有这个方法，我们就要来扩展它</p><h1 id="扩展方法"><a href="#扩展方法" class="headerlink" title="扩展方法"></a>扩展方法</h1><p>要想我们的兽人敌人对身后玩家造成不了伤害，我们就可以来写一个方法，这个方法专门来判断玩家是否在兽人正前方扇形区域，如果在则返回<code>true</code>否则返回<code>false</code>，然后我们可以将这个方法加到计算伤害的<code>Hit()</code>函数里边进行一个判断，玩家在兽人视野范围内就造成伤害，反之不造成</p><p>这个扩展方法我们创建一个新的代码文件</p><img src="https://p9-tt.byteimg.com/origin/pgc-image/1d4a90fb719d4281b68a709f01232cd2.png" alt="1.png" style="zoom:80%;" /><p>打开编写它</p><pre class="line-numbers language-csharp" data-language="csharp"><code class="language-csharp"><span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">class</span> <span class="token class-name">ExtensionMethod</span><span class="token punctuation">&#123;</span>    <span class="token comment">//扩展方法类</span>    <span class="token keyword">private</span> <span class="token keyword">const</span> <span class="token class-name"><span class="token keyword">float</span></span> dotThreshold <span class="token operator">=</span> <span class="token number">0.5f</span><span class="token punctuation">;</span> <span class="token comment">//视野范围大小</span>    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token return-type class-name"><span class="token keyword">bool</span></span> <span class="token function">IsFacingTarget</span><span class="token punctuation">(</span><span class="token keyword">this</span> <span class="token class-name">Transform</span> transform <span class="token punctuation">,</span> <span class="token class-name">Transform</span> target<span class="token punctuation">)</span><span class="token punctuation">&#123;</span>        <span class="token comment">//判断目标是否在视野范围内</span>        <span class="token class-name"><span class="token keyword">var</span></span> vectorToTarget <span class="token operator">=</span> target<span class="token punctuation">.</span>position <span class="token operator">-</span> transform<span class="token punctuation">.</span>position<span class="token punctuation">;</span><span class="token comment">//获得敌人和玩家的相对位置</span>        vectorToTarget<span class="token punctuation">.</span><span class="token function">Normalize</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">//向量化</span>        <span class="token comment">//Dot:两个矢量的点积。 点积是一个浮点值，等于两个矢量的大小相乘，然后乘以它们之间的角度的余弦。</span>        <span class="token class-name"><span class="token keyword">float</span></span> dot <span class="token operator">=</span> Vector3<span class="token punctuation">.</span><span class="token function">Dot</span><span class="token punctuation">(</span>transform<span class="token punctuation">.</span>forward<span class="token punctuation">,</span>vectorToTarget<span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token keyword">return</span> dot <span class="token operator">></span> dotThreshold<span class="token punctuation">;</span><span class="token comment">//如果玩家在敌人夹角120°(cos120 = 0.5)视野范围内则返回true</span>    <span class="token punctuation">&#125;</span><span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>这里我们使用<code>Vector3.Dot()</code>方法，官方API在<a href="http://docs.unity3d.com/ScriptReference/Vector3.Dot.html">这里</a>，同时也用了<code>transform.forward</code>来表示敌人面对的方向</p><p>同时还要注意到参数有个<code>this</code>，这样可以让方法加入到<code>Transform</code>类里面，变成它的一个方法</p><img src="https://p9-tt.byteimg.com/origin/pgc-image/f180df5587214500b2f7e3cb8e63072a.png" alt="2.png" style="zoom:80%;" /><p>最后我们回到<code>Hit()</code>函数中，把判断条件加上就完成了</p><pre class="line-numbers language-csharp" data-language="csharp"><code class="language-csharp"><span class="token return-type class-name"><span class="token keyword">void</span></span> <span class="token function">Hit</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>    <span class="token comment">//由于在敌人追主角的过程中主角可能会跑开，这时候如果攻击的话目标就丢失了</span>    <span class="token comment">//所以我们在攻击前判断目标是否为空，以防报错</span>    <span class="token comment">//同时还判断了玩家是否在敌人的视野范围内，在的话才造成伤害</span>    <span class="token keyword">if</span><span class="token punctuation">(</span>attackTarget <span class="token operator">!=</span> <span class="token keyword">null</span> <span class="token operator">&amp;&amp;</span> transform<span class="token punctuation">.</span><span class="token function">IsFacingTarget</span><span class="token punctuation">(</span>attackTarget<span class="token punctuation">.</span>transform<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>        <span class="token class-name"><span class="token keyword">var</span></span> targetStates <span class="token operator">=</span> attackTarget<span class="token punctuation">.</span><span class="token generic-method"><span class="token function">GetComponent</span><span class="token generic class-name"><span class="token punctuation">&lt;</span>CharacterStates<span class="token punctuation">></span></span></span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        targetStates<span class="token punctuation">.</span><span class="token function">TakeDamage</span><span class="token punctuation">(</span>characterStates<span class="token punctuation">,</span>targetStates<span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span><span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>这样，当我们的玩家走到敌人后边的时候就不会受到伤害</p>]]></content>
    
    
      
      
    <summary type="html">&lt;p&gt;这一章我们来熟悉一下扩展方法，所谓扩展方法就是在不继承一个类，但是可以额外编写一个类来扩展这个类的功能，比如这一章我们想让我们控制主角在兽人后面时兽人攻击不会造成伤害，这里就要用到&lt;code&gt;transfrom&lt;/code&gt;类，但是&lt;code&gt;transfrom&lt;/code</summary>
      
    
    
    
    <category term="Unity学习笔记" scheme="http://sakura-pub.ltd/categories/Unity%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/"/>
    
    
    <category term="Unity" scheme="http://sakura-pub.ltd/tags/Unity/"/>
    
  </entry>
  
  <entry>
    <title>Unity笔记17-设置兽人敌人</title>
    <link href="http://sakura-pub.ltd/UnityNotes/Unity%E7%AC%94%E8%AE%B017-%E8%AE%BE%E7%BD%AE%E5%85%BD%E4%BA%BA%E6%95%8C%E4%BA%BA/"/>
    <id>http://sakura-pub.ltd/UnityNotes/Unity%E7%AC%94%E8%AE%B017-%E8%AE%BE%E7%BD%AE%E5%85%BD%E4%BA%BA%E6%95%8C%E4%BA%BA/</id>
    <published>2021-07-23T02:01:51.000Z</published>
    <updated>2021-07-23T03:47:43.441Z</updated>
    
    <content type="html"><![CDATA[<p> 在这一章节中我们来设置一下兽人敌人，由于它的<code>Attack02</code>动画包含一个推人的效果，我们可以对它进行单独的测试，而不是继续沿用之前的<code>EnemyController</code>，但是我们可以在它基础上进行添加，所以可以选择继承类方式改写</p><h1 id="继承EnemyController并添加推开人物方法"><a href="#继承EnemyController并添加推开人物方法" class="headerlink" title="继承EnemyController并添加推开人物方法"></a>继承EnemyController并添加推开人物方法</h1><p>因为兽人是用继承的代码，我们要专门创建一个文件夹放特定敌人的<code>EnemyController</code>子类代码</p><img src="https://p5-tt.byteimg.com/origin/pgc-image/2a7f1d824413463f8bbb1701fb464525.png" alt="1.png" style="zoom:80%;" /><p>同时也把这个代码挂载到兽人身上</p><pre class="line-numbers language-csharp" data-language="csharp"><code class="language-csharp"><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">Grunt</span> <span class="token punctuation">:</span> <span class="token type-list"><span class="token class-name">EnemyController</span></span><span class="token punctuation">&#123;</span>    <span class="token punctuation">[</span><span class="token attribute"><span class="token class-name">Header</span><span class="token attribute-arguments"><span class="token punctuation">(</span><span class="token string">"Skill（兽人特殊攻击设置）"</span><span class="token punctuation">)</span></span></span><span class="token punctuation">]</span>    <span class="token keyword">public</span> <span class="token class-name"><span class="token keyword">float</span></span> kickForce <span class="token operator">=</span> <span class="token number">15</span><span class="token punctuation">;</span><span class="token comment">//推开敌人距离</span>    <span class="token keyword">public</span> <span class="token return-type class-name"><span class="token keyword">void</span></span> <span class="token function">kickOff</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>        <span class="token comment">//如果访问不了attackTarget要返回父类修改为protect属性</span>        <span class="token keyword">if</span><span class="token punctuation">(</span>attackTarget <span class="token operator">!=</span> <span class="token keyword">null</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>            transform<span class="token punctuation">.</span><span class="token function">LookAt</span><span class="token punctuation">(</span>attackTarget<span class="token punctuation">.</span>transform<span class="token punctuation">)</span><span class="token punctuation">;</span>            <span class="token class-name">Vector3</span> direction <span class="token operator">=</span> attackTarget<span class="token punctuation">.</span>transform<span class="token punctuation">.</span>position<span class="token operator">-</span>transform<span class="token punctuation">.</span>position<span class="token punctuation">;</span>            direction<span class="token punctuation">.</span><span class="token function">Normalize</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">//量化推开的方向</span>            attackTarget<span class="token punctuation">.</span><span class="token generic-method"><span class="token function">GetComponent</span><span class="token generic class-name"><span class="token punctuation">&lt;</span>NavMeshAgent<span class="token punctuation">></span></span></span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span>isStopped <span class="token operator">=</span> <span class="token boolean">true</span><span class="token punctuation">;</span>            <span class="token comment">//velocity表示速度，这里给了主角一个反向速度，达到给推开的效果</span>            attackTarget<span class="token punctuation">.</span><span class="token generic-method"><span class="token function">GetComponent</span><span class="token generic class-name"><span class="token punctuation">&lt;</span>NavMeshAgent<span class="token punctuation">></span></span></span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span>velocity <span class="token operator">=</span> direction<span class="token operator">*</span>kickForce<span class="token punctuation">;</span>                        attackTarget<span class="token punctuation">.</span><span class="token generic-method"><span class="token function">GetComponent</span><span class="token generic class-name"><span class="token punctuation">&lt;</span>Animator<span class="token punctuation">></span></span></span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">SetTrigger</span><span class="token punctuation">(</span><span class="token string">"Dizzy"</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">//人物进入眩晕状态</span>        <span class="token punctuation">&#125;</span>    <span class="token punctuation">&#125;</span><span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>然后我们把动画事件添加上，<code>Attack02</code>用的事件是我们上面写的<code>kickOff()</code></p><p>同时这里有个眩晕状态，我们把眩晕动画如下添加好，同时眩晕动画速度我改为了2，让它播放快一点</p><img src="https://p5-tt.byteimg.com/origin/pgc-image/e375df607aa64f32b0779527e3494c29.png" alt="2.png" style="zoom:80%;" /><h1 id="替换动画并且添加一个动画行为"><a href="#替换动画并且添加一个动画行为" class="headerlink" title="替换动画并且添加一个动画行为"></a>替换动画并且添加一个动画行为</h1><p>我们把史莱姆的动画复制一份给兽人，然后为了保持兽人在推开人物时人物进入眩晕状态并且不能移动，我们还要添加一个动画行为（<code>Behaviour</code>）</p><p>替换动画过程不再描述，但是注意这里<strong>不能</strong>采用动画控制器继承的方式</p><p>这里就说一下动画行为，找到人物的<code>Dizzy</code>动画，点击<code>Add Behaviour</code>，创建一个叫做<code>Stop Agent</code>的行为，实际上就是一个代码文件，创建好后我们把这个代码文件归类放好</p><img src="https://p9-tt.byteimg.com/origin/pgc-image/3b6e539cae684b47ae1971d9d95485de.png" alt="3.png" style="zoom:80%;" /><img src="https://p9-tt.byteimg.com/origin/pgc-image/752bc9fca53d4a6a80c77a7381d9a0f0.png" alt="4.png" style="zoom:80%;" /><p>这个代码文件打开就已经有一些注释在那了，我们可以直接取消我们要用方法的注释，这里用到的就是进入动画、动画播放时以及动画结束时刻的代码</p><pre class="line-numbers language-csharp" data-language="csharp"><code class="language-csharp"><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">StopAgent</span> <span class="token punctuation">:</span> <span class="token type-list"><span class="token class-name">StateMachineBehaviour</span></span><span class="token punctuation">&#123;</span>    <span class="token comment">// OnStateEnter is called when a transition starts and the state machine starts to evaluate this state</span>    <span class="token keyword">override</span> <span class="token keyword">public</span> <span class="token return-type class-name"><span class="token keyword">void</span></span> <span class="token function">OnStateEnter</span><span class="token punctuation">(</span><span class="token class-name">Animator</span> animator<span class="token punctuation">,</span> <span class="token class-name">AnimatorStateInfo</span> stateInfo<span class="token punctuation">,</span> <span class="token class-name"><span class="token keyword">int</span></span> layerIndex<span class="token punctuation">)</span>    <span class="token punctuation">&#123;</span>        animator<span class="token punctuation">.</span><span class="token generic-method"><span class="token function">GetComponent</span><span class="token generic class-name"><span class="token punctuation">&lt;</span>NavMeshAgent<span class="token punctuation">></span></span></span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span>isStopped <span class="token operator">=</span> <span class="token boolean">true</span><span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span>    <span class="token comment">// OnStateUpdate is called on each Update frame between OnStateEnter and OnStateExit callbacks</span>    <span class="token keyword">override</span> <span class="token keyword">public</span> <span class="token return-type class-name"><span class="token keyword">void</span></span> <span class="token function">OnStateUpdate</span><span class="token punctuation">(</span><span class="token class-name">Animator</span> animator<span class="token punctuation">,</span> <span class="token class-name">AnimatorStateInfo</span> stateInfo<span class="token punctuation">,</span> <span class="token class-name"><span class="token keyword">int</span></span> layerIndex<span class="token punctuation">)</span>    <span class="token punctuation">&#123;</span>        animator<span class="token punctuation">.</span><span class="token generic-method"><span class="token function">GetComponent</span><span class="token generic class-name"><span class="token punctuation">&lt;</span>NavMeshAgent<span class="token punctuation">></span></span></span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span>isStopped <span class="token operator">=</span> <span class="token boolean">true</span><span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span>    <span class="token comment">// OnStateExit is called when a transition ends and the state machine finishes evaluating this state</span>    <span class="token keyword">override</span> <span class="token keyword">public</span> <span class="token return-type class-name"><span class="token keyword">void</span></span> <span class="token function">OnStateExit</span><span class="token punctuation">(</span><span class="token class-name">Animator</span> animator<span class="token punctuation">,</span> <span class="token class-name">AnimatorStateInfo</span> stateInfo<span class="token punctuation">,</span> <span class="token class-name"><span class="token keyword">int</span></span> layerIndex<span class="token punctuation">)</span>    <span class="token punctuation">&#123;</span>       animator<span class="token punctuation">.</span><span class="token generic-method"><span class="token function">GetComponent</span><span class="token generic class-name"><span class="token punctuation">&lt;</span>NavMeshAgent<span class="token punctuation">></span></span></span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span>isStopped <span class="token operator">=</span> <span class="token boolean">true</span><span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span>    <span class="token comment">// OnStateMove is called right after Animator.OnAnimatorMove()</span>    <span class="token comment">//override public void OnStateMove(Animator animator, AnimatorStateInfo stateInfo, int layerIndex)</span>    <span class="token comment">//&#123;</span>    <span class="token comment">//    // Implement code that processes and affects root motion</span>    <span class="token comment">//&#125;</span>    <span class="token comment">// OnStateIK is called right after Animator.OnAnimatorIK()</span>    <span class="token comment">//override public void OnStateIK(Animator animator, AnimatorStateInfo stateInfo, int layerIndex)</span>    <span class="token comment">//&#123;</span>    <span class="token comment">//    // Implement code that sets up animation IK (inverse kinematics)</span>    <span class="token comment">//&#125;</span><span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>之后我们可以把行为放进人物的眩晕、受伤等动画，甚至是敌人的攻击动画</p><p>注意的是添加到敌人攻击动画时可能会有一个报错，原因是我们可能把敌人打死了，导致行为无法获得agent，解决办法如下，我们去到<code>EnemyController.cs</code>修改敌人死了之后的状态</p><pre class="line-numbers language-csharp" data-language="csharp"><code class="language-csharp"><span class="token keyword">case</span> EnemyStates<span class="token punctuation">.</span>DEAD<span class="token punctuation">:</span>collider<span class="token punctuation">.</span>enabled <span class="token operator">=</span> <span class="token boolean">false</span><span class="token punctuation">;</span><span class="token comment">//防止时候开业再次攻击</span><span class="token comment">//agent.enabled = false;//直接关闭导航组件</span>agent<span class="token punctuation">.</span>radius <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span><span class="token comment">//把agent的范围缩小</span><span class="token function">Destroy</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>gameObject<span class="token punctuation">,</span><span class="token number">2f</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">//销毁游戏对象，延迟为2秒</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>这里我们原本想关闭agent以达到agent没有体积效果，所以可以把agent.enabled = false;语句改为了直接把agent范围缩小到0，也是同样的效果</p><p>到这我们就初步设置好了兽人了</p>]]></content>
    
    
      
      
    <summary type="html">&lt;p&gt; 在这一章节中我们来设置一下兽人敌人，由于它的&lt;code&gt;Attack02&lt;/code&gt;动画包含一个推人的效果，我们可以对它进行单独的测试，而不是继续沿用之前的&lt;code&gt;EnemyController&lt;/code&gt;，但是我们可以在它基础上进行添加，所以可以选择继承类方式改</summary>
      
    
    
    
    <category term="Unity学习笔记" scheme="http://sakura-pub.ltd/categories/Unity%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/"/>
    
    
    <category term="Unity" scheme="http://sakura-pub.ltd/tags/Unity/"/>
    
  </entry>
  
  <entry>
    <title>Unity笔记16-制作更多的敌人</title>
    <link href="http://sakura-pub.ltd/UnityNotes/Unity%E7%AC%94%E8%AE%B016-%E5%88%B6%E4%BD%9C%E6%9B%B4%E5%A4%9A%E7%9A%84%E6%95%8C%E4%BA%BA/"/>
    <id>http://sakura-pub.ltd/UnityNotes/Unity%E7%AC%94%E8%AE%B016-%E5%88%B6%E4%BD%9C%E6%9B%B4%E5%A4%9A%E7%9A%84%E6%95%8C%E4%BA%BA/</id>
    <published>2021-07-22T01:53:09.000Z</published>
    <updated>2021-07-22T15:31:27.489Z</updated>
    
    <content type="html"><![CDATA[<p> 这一章我们把我们的敌人数量制作地多一些，更加地去完善游戏</p><h1 id="制作多一个史莱姆"><a href="#制作多一个史莱姆" class="headerlink" title="制作多一个史莱姆"></a>制作多一个史莱姆</h1><p>制作多一个史莱姆很简单，只用对着之前的史莱姆<code>Ctrl + D</code>复制一下就可以</p><p>但是这之中也有存在问题，就是史莱姆会共用一个<code>Character Data</code>，这可以在每次开始游戏时创建一个临时<code>Data</code>给他们来解决</p><p>打开<code>Character States.cs</code></p><pre class="line-numbers language-csharp" data-language="csharp"><code class="language-csharp"><span class="token keyword">public</span> <span class="token class-name">CharacterData_SO</span> characterData<span class="token punctuation">;</span><span class="token keyword">public</span> <span class="token class-name">CharacterData_SO</span> templateData<span class="token punctuation">;</span><span class="token return-type class-name"><span class="token keyword">void</span></span> <span class="token function">Awake</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>    <span class="token keyword">if</span><span class="token punctuation">(</span>templateData <span class="token operator">!=</span> <span class="token keyword">null</span><span class="token punctuation">)</span><span class="token comment">//复制一个临时模板Data</span>        characterData <span class="token operator">=</span> <span class="token function">Instantiate</span><span class="token punctuation">(</span>templateData<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">//生成多一个data</span><span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>然后史莱姆身上的<code>Data</code>如下设置</p><img src="https://p6-tt.byteimg.com/origin/pgc-image/e780aba5845e41caa4a1b38673b38708.png" alt="2.png" style="zoom:80%;" /><h1 id="放置一个刺刺龟"><a href="#放置一个刺刺龟" class="headerlink" title="放置一个刺刺龟"></a>放置一个刺刺龟</h1><p>我们的史莱姆素材文件夹下有另外一个敌人刺刺龟，我们也可以把它放置上来</p><p>由于它也是依赖<code>EnemyController.cs</code>的，所以我们在之前还要添加一行强制附带组件代码</p><pre class="line-numbers language-csharp" data-language="csharp"><code class="language-csharp"><span class="token punctuation">[</span><span class="token attribute"><span class="token class-name">RequireComponent</span><span class="token attribute-arguments"><span class="token punctuation">(</span><span class="token keyword">typeof</span><span class="token punctuation">(</span><span class="token type-expression class-name">CharacterStates</span><span class="token punctuation">)</span><span class="token punctuation">)</span></span></span><span class="token punctuation">]</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><p>这样就可以强制附带<code>CharacterStates</code>代码组件了</p><p>在素材中找到刺刺龟把它放置在地图上</p><img src="https://p9-tt.byteimg.com/origin/pgc-image/c0a6ab51762547b5855e2d4d808bb14c.png" alt="3.png" style="zoom:80%;" /><p>然后为它添加<code>EnemyController.cs</code>，以及设置好基本信息</p><img src="https://p9-tt.byteimg.com/origin/pgc-image/82f0fc3573f7434aa1a235f4fbe931c3.png" alt="4.png" style="zoom:80%;" /><p>还有一个关键的地方在于动画的切换，这里我们可以利用一个技巧，把史莱姆原来的<code>Animations</code>复制一个出来直接覆盖替换动画</p><p>我们在右键创建时选择<code>Animator Override Controller</code>就可以了</p><img src="https://p3-tt.byteimg.com/origin/pgc-image/61c8eb67c769464eb07f58ab37b2c59d.png" alt="5.png" style="zoom:80%;" /><p>然后属性面板中第一个选项就会问我们要依靠哪个<code>Animation</code>为模板，我们选择史莱姆原来的动画</p><img src="https://p5-tt.byteimg.com/origin/pgc-image/60d1f5873d4b440ba04764b3bdfd5cda.png" alt="6.png" style="zoom:80%;" /><p>之后再将它们替换就可以了，别忘了<code>Attack01</code>和<code>Attack02</code>要单独复制出来以及添加帧事件</p><h1 id="兽人和石头人"><a href="#兽人和石头人" class="headerlink" title="兽人和石头人"></a>兽人和石头人</h1><p>还有需要添加的就是兽人和石头人，这里我们暂时添加好素材再把它们移到地图上就好了，之后的事情下一章节再处理</p><img src="https://p6-tt.byteimg.com/origin/pgc-image/712fe6fd05d24f17a782e3bbd8937ab7.png" alt="7.png" style="zoom:80%;" /><img src="https://p5-tt.byteimg.com/origin/pgc-image/c884e6e35d714f3988fb0a5b4109a5cc.png" alt="8.png" style="zoom:80%;" />]]></content>
    
    
      
      
    <summary type="html">&lt;p&gt; 这一章我们把我们的敌人数量制作地多一些，更加地去完善游戏&lt;/p&gt;
&lt;h1 id=&quot;制作多一个史莱姆&quot;&gt;&lt;a href=&quot;#制作多一个史莱姆&quot; class=&quot;headerlink&quot; title=&quot;制作多一个史莱姆&quot;&gt;&lt;/a&gt;制作多一个史莱姆&lt;/h1&gt;&lt;p&gt;制作多一个史莱姆很</summary>
      
    
    
    
    <category term="Unity学习笔记" scheme="http://sakura-pub.ltd/categories/Unity%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/"/>
    
    
    <category term="Unity" scheme="http://sakura-pub.ltd/tags/Unity/"/>
    
  </entry>
  
  <entry>
    <title>Unity笔记15-使用接口实现观察者模式的订阅和广播</title>
    <link href="http://sakura-pub.ltd/UnityNotes/Unity%E7%AC%94%E8%AE%B015-%E4%BD%BF%E7%94%A8%E6%8E%A5%E5%8F%A3%E5%AE%9E%E7%8E%B0%E8%A7%82%E5%AF%9F%E8%80%85%E6%A8%A1%E5%BC%8F%E7%9A%84%E8%AE%A2%E9%98%85%E5%92%8C%E5%B9%BF%E6%92%AD/"/>
    <id>http://sakura-pub.ltd/UnityNotes/Unity%E7%AC%94%E8%AE%B015-%E4%BD%BF%E7%94%A8%E6%8E%A5%E5%8F%A3%E5%AE%9E%E7%8E%B0%E8%A7%82%E5%AF%9F%E8%80%85%E6%A8%A1%E5%BC%8F%E7%9A%84%E8%AE%A2%E9%98%85%E5%92%8C%E5%B9%BF%E6%92%AD/</id>
    <published>2021-07-21T01:30:13.000Z</published>
    <updated>2021-07-22T04:22:22.553Z</updated>
    
    <content type="html"><![CDATA[<p> 这一章我们使用接口来实现观察者模式的订阅和广播，同时也来实现玩家死了游戏结束之后敌人的获胜动画</p><h1 id="编写接口"><a href="#编写接口" class="headerlink" title="编写接口"></a>编写接口</h1><p>在<code>Tools</code>文件夹下我们新建一个代码文件<code>IEndGameObserver.cs</code>表示游戏结束之后的接口</p><pre class="line-numbers language-csharp" data-language="csharp"><code class="language-csharp"><span class="token keyword">public</span> <span class="token keyword">interface</span> <span class="token class-name">IEndGameObserver</span><span class="token punctuation">&#123;</span>    <span class="token comment">//注意接口只写声明不写定义</span>    <span class="token comment">//游戏结束要操作的都在这个接口实现</span>    <span class="token keyword">public</span> <span class="token return-type class-name"><span class="token keyword">void</span></span> <span class="token function">EndNotify</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>然后我们来到<code>EnemyController.cs</code>编写一个广播方法</p><pre class="line-numbers language-csharp" data-language="csharp"><code class="language-csharp"><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">EnemyController</span> <span class="token punctuation">:</span> <span class="token type-list"><span class="token class-name">MonoBehaviour</span><span class="token punctuation">,</span><span class="token class-name">IEndGameObserver</span></span><span class="token punctuation">&#123;</span>    <span class="token keyword">public</span> <span class="token return-type class-name"><span class="token keyword">void</span></span> <span class="token function">EndNotify</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>        <span class="token comment">//获胜动画</span>        <span class="token comment">//停止所有移动</span>        <span class="token comment">//停止Agent</span>        isChase <span class="token operator">=</span> <span class="token boolean">false</span><span class="token punctuation">;</span>        isWalk <span class="token operator">=</span> <span class="token boolean">false</span><span class="token punctuation">;</span>        attackTarget <span class="token operator">=</span> <span class="token keyword">null</span><span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span><span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>其它要在游戏结束时要有操作的代码也可以像这种方式来继承接口并实现操作</p><h1 id="订阅接口"><a href="#订阅接口" class="headerlink" title="订阅接口"></a>订阅接口</h1><p>因为我们会有很多不同的代码文件都会继承这个接口，怎样来管理订阅也是值得考虑的事情</p><p>打开上一章创建的<code>GameManager.cs</code></p><pre class="line-numbers language-csharp" data-language="csharp"><code class="language-csharp"><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">GameManager</span> <span class="token punctuation">:</span> <span class="token type-list"><span class="token class-name">Sigltion<span class="token punctuation">&lt;</span>GameManager<span class="token punctuation">></span></span></span><span class="token punctuation">&#123;</span>    <span class="token keyword">public</span> <span class="token class-name">CharacterStates</span> playerStates<span class="token punctuation">;</span>    <span class="token comment">//游戏结束时调用的方法的数组</span>    List<span class="token operator">&lt;</span>IEndGameObserver<span class="token operator">></span>endGameObservers <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token constructor-invocation class-name">List<span class="token punctuation">&lt;</span>IEndGameObserver<span class="token punctuation">></span></span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token keyword">public</span> <span class="token return-type class-name"><span class="token keyword">void</span></span> <span class="token function">RigisterPlayer</span><span class="token punctuation">(</span><span class="token class-name">CharacterStates</span> player<span class="token punctuation">)</span><span class="token punctuation">&#123;</span>        <span class="token comment">//通过外界注册的方式来获得对象的playerStates</span>        <span class="token keyword">this</span><span class="token punctuation">.</span>playerStates <span class="token operator">=</span> player<span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span>    <span class="token keyword">public</span> <span class="token return-type class-name"><span class="token keyword">void</span></span> <span class="token function">AddObserve</span><span class="token punctuation">(</span><span class="token class-name">IEndGameObserver</span> gameObserver<span class="token punctuation">)</span><span class="token punctuation">&#123;</span>        <span class="token comment">//加入待操作数组</span>        endGameObservers<span class="token punctuation">.</span><span class="token function">Add</span><span class="token punctuation">(</span>gameObserver<span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span>    <span class="token keyword">public</span> <span class="token return-type class-name"><span class="token keyword">void</span></span> <span class="token function">RemoveObserve</span><span class="token punctuation">(</span><span class="token class-name">IEndGameObserver</span> gameObserver<span class="token punctuation">)</span><span class="token punctuation">&#123;</span>        <span class="token comment">//将特定的观察者在待操作数组中删除</span>        endGameObservers<span class="token punctuation">.</span><span class="token function">Remove</span><span class="token punctuation">(</span>gameObserver<span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span>    <span class="token keyword">public</span> <span class="token return-type class-name"><span class="token keyword">void</span></span> <span class="token function">NotifyObserves</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>        <span class="token comment">//调用待操作数组中每一个观察者</span>        <span class="token keyword">foreach</span><span class="token punctuation">(</span><span class="token class-name">IEndGameObserver</span> gameObserver <span class="token keyword">in</span> endGameObservers<span class="token punctuation">)</span><span class="token punctuation">&#123;</span>            gameObserver<span class="token punctuation">.</span><span class="token function">EndNotify</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token punctuation">&#125;</span>    <span class="token punctuation">&#125;</span><span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>因为我们是要在主角死了之后开始游戏结束的操作，所以回到<code>PlayerController.cs</code>在判断主角死了之后调用广播</p><pre class="line-numbers language-csharp" data-language="csharp"><code class="language-csharp"><span class="token return-type class-name"><span class="token keyword">void</span></span> <span class="token function">Update</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>    <span class="token keyword">if</span><span class="token punctuation">(</span>charcterStates<span class="token punctuation">.</span>currentHealth <span class="token operator">==</span> <span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span><span class="token comment">//判断死亡</span>        isDead <span class="token operator">=</span> <span class="token boolean">true</span><span class="token punctuation">;</span>        GameManager<span class="token punctuation">.</span>Instance<span class="token punctuation">.</span><span class="token function">NotifyObserves</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span><span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>同时我们在<code>EnemyController.cs</code>中还要补充一个加入待操作数组方法和移除方法</p><pre class="line-numbers language-csharp" data-language="csharp"><code class="language-csharp"><span class="token comment">//void OnEnable()&#123;//Unity的一个启动游戏时自动调用的函数</span><span class="token comment">//  GameManager.Instance.AddObserve(this);</span><span class="token comment">// &#125;</span><span class="token return-type class-name"><span class="token keyword">void</span></span> <span class="token function">Start</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>    <span class="token comment">//开始游戏时先检测是否勾选了守卫状态</span>    <span class="token keyword">if</span><span class="token punctuation">(</span>isGuard<span class="token punctuation">)</span><span class="token punctuation">&#123;</span>        enemyStates <span class="token operator">=</span> EnemyStates<span class="token punctuation">.</span>GUARD<span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span><span class="token keyword">else</span><span class="token punctuation">&#123;</span>        enemyStates <span class="token operator">=</span> EnemyStates<span class="token punctuation">.</span>PATROL<span class="token punctuation">;</span>        <span class="token function">GetNewWayPoint</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span><span class="token comment">//FIXME:场景切换做好后修改掉</span>    GameManager<span class="token punctuation">.</span>Instance<span class="token punctuation">.</span><span class="token function">AddObserve</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">&#125;</span><span class="token return-type class-name"><span class="token keyword">void</span></span> <span class="token function">OnDisable</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>    <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token operator">!</span>GameManager<span class="token punctuation">.</span>IsInitialized<span class="token punctuation">)</span>         <span class="token keyword">return</span><span class="token punctuation">;</span><span class="token comment">//如果GameManager没有给构建的话就直接return</span>        GameManager<span class="token punctuation">.</span>Instance<span class="token punctuation">.</span><span class="token function">RemoveObserve</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>由于<code>OnEnable()</code>是在游戏开始时早期就调用的，这时候我们这样写会发生报错，我们要等到后面写场景加载时才用这种方法，这里暂时把加入待操作数组代码单独写到<code>Start()</code>里</p><img src="https://p9-tt.byteimg.com/origin/pgc-image/5e902802764e44b099915b6323377dfb.png" alt="1.png" style="zoom:80%;" /><h1 id="配置敌人胜利动画"><a href="#配置敌人胜利动画" class="headerlink" title="配置敌人胜利动画"></a>配置敌人胜利动画</h1><p>我们打开动画管理器，配置敌人在打死主角后的动画</p><p>新建一个<code>Victory Layer</code>（注意权重值为1），以及一个<code>Win</code>布尔值控制动画触发</p><img src="https://p6-tt.byteimg.com/origin/pgc-image/85512e9ac113448c808c81d1b29dc079.png" alt="1.png" style="zoom:80%;" /><p>返回<code>EnemyController.cs</code>代码我们要配置动画变量什么时候触发</p><pre class="line-numbers language-csharp" data-language="csharp"><code class="language-csharp"><span class="token return-type class-name"><span class="token keyword">void</span></span> <span class="token function">Update</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>    <span class="token keyword">if</span><span class="token punctuation">(</span>charcterStates<span class="token punctuation">.</span>currentHealth <span class="token operator">==</span> <span class="token number">0</span><span class="token punctuation">)</span>        isDead <span class="token operator">=</span> <span class="token boolean">true</span><span class="token punctuation">;</span><span class="token comment">//血量变0则死亡状态为真</span>    <span class="token keyword">else</span><span class="token punctuation">&#123;</span><span class="token comment">//加了个else是防止死后敌人在胜利动画下一帧又给切换回普通动画</span>        <span class="token function">SwitchEnemyStates</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token function">SwitchAnimation</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        lastAttackTime<span class="token operator">-=</span>Time<span class="token punctuation">.</span>deltaTime<span class="token punctuation">;</span><span class="token comment">//每一帧都减冷却</span>    <span class="token punctuation">&#125;</span><span class="token punctuation">&#125;</span><span class="token keyword">public</span> <span class="token return-type class-name"><span class="token keyword">void</span></span> <span class="token function">EndNotify</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>    <span class="token comment">//获胜动画</span>    <span class="token comment">//停止所有移动</span>    <span class="token comment">//停止Agent</span>    anim<span class="token punctuation">.</span><span class="token function">SetBool</span><span class="token punctuation">(</span><span class="token string">"Win"</span><span class="token punctuation">,</span><span class="token boolean">true</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    isChase <span class="token operator">=</span> <span class="token boolean">false</span><span class="token punctuation">;</span>    isWalk <span class="token operator">=</span> <span class="token boolean">false</span><span class="token punctuation">;</span>    attackTarget <span class="token operator">=</span> <span class="token keyword">null</span><span class="token punctuation">;</span><span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>最后我们发现主角死了之后还是可以控制移动，这里我们在<code>PlyaerController.cs</code>修复一下</p><pre class="line-numbers language-csharp" data-language="csharp"><code class="language-csharp"><span class="token return-type class-name"><span class="token keyword">void</span></span> <span class="token function">MoveToTarget</span><span class="token punctuation">(</span><span class="token class-name">Vector3</span> target<span class="token punctuation">)</span><span class="token punctuation">&#123;</span>agent<span class="token punctuation">.</span>isStopped <span class="token operator">=</span> <span class="token boolean">false</span><span class="token punctuation">;</span><span class="token keyword">if</span><span class="token punctuation">(</span>isDead<span class="token punctuation">)</span> <span class="token keyword">return</span><span class="token punctuation">;</span><span class="token comment">//如果死了就不能移动</span><span class="token function">StopAllCoroutines</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">//终止其它移动命令</span>agent<span class="token punctuation">.</span>destination <span class="token operator">=</span> target<span class="token punctuation">;</span><span class="token punctuation">&#125;</span><span class="token return-type class-name"><span class="token keyword">void</span></span> <span class="token function">EventAttact</span><span class="token punctuation">(</span><span class="token class-name">GameObject</span> target<span class="token punctuation">)</span><span class="token punctuation">&#123;</span><span class="token keyword">if</span><span class="token punctuation">(</span>isDead<span class="token punctuation">)</span> <span class="token keyword">return</span><span class="token punctuation">;</span><span class="token comment">//如果死了就不能移动</span>                <span class="token keyword">if</span><span class="token punctuation">(</span>target<span class="token operator">!=</span><span class="token keyword">null</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span><span class="token comment">//如果鼠标点击的目标不为空，或者点击的敌人不是属于死亡状态</span>attactTarget <span class="token operator">=</span> target<span class="token punctuation">;</span><span class="token comment">//判断是否暴击</span>charcterStates<span class="token punctuation">.</span>isCritical <span class="token operator">=</span> Random<span class="token punctuation">.</span><span class="token keyword">value</span> <span class="token operator">&lt;</span> charcterStates<span class="token punctuation">.</span>attackData<span class="token punctuation">.</span>criticalChance<span class="token punctuation">;</span><span class="token function">StartCoroutine</span><span class="token punctuation">(</span><span class="token function">MoveToAttackTarget</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">&#125;</span>    <span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>]]></content>
    
    
      
      
    <summary type="html">&lt;p&gt; 这一章我们使用接口来实现观察者模式的订阅和广播，同时也来实现玩家死了游戏结束之后敌人的获胜动画&lt;/p&gt;
&lt;h1 id=&quot;编写接口&quot;&gt;&lt;a href=&quot;#编写接口&quot; class=&quot;headerlink&quot; title=&quot;编写接口&quot;&gt;&lt;/a&gt;编写接口&lt;/h1&gt;&lt;p&gt;在&lt;code</summary>
      
    
    
    
    <category term="Unity学习笔记" scheme="http://sakura-pub.ltd/categories/Unity%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/"/>
    
    
    <category term="Unity" scheme="http://sakura-pub.ltd/tags/Unity/"/>
    
  </entry>
  
  <entry>
    <title>Unity笔记14-泛型单例模式</title>
    <link href="http://sakura-pub.ltd/UnityNotes/Unity%E7%AC%94%E8%AE%B014-%E6%B3%9B%E5%9E%8B%E5%8D%95%E4%BE%8B%E6%A8%A1%E5%BC%8F/"/>
    <id>http://sakura-pub.ltd/UnityNotes/Unity%E7%AC%94%E8%AE%B014-%E6%B3%9B%E5%9E%8B%E5%8D%95%E4%BE%8B%E6%A8%A1%E5%BC%8F/</id>
    <published>2021-07-20T01:52:36.000Z</published>
    <updated>2021-07-21T01:34:24.792Z</updated>
    
    <content type="html"><![CDATA[<p>这一章我们来编写一个泛型单例模式的代码，这是因为我们的项目中会有很多的<code>Manager</code>，如果每个都使用单例模式会更好地去管理和使用</p><p>例如其中控制我们游戏的开始暂停等一般是用<code>Game Manager</code>来命名，我们来创建一个代码文件以及一个空对象使得代码可以依附在它上面</p><img src="https://p6-tt.byteimg.com/origin/pgc-image/d8bf83d3ad554952a66a0b00aafc1b96.png" alt="1.png" style="zoom:80%;" /><p>这个代码我们先放在一边之后再补充，先把泛型单例模式代码写了先</p><h1 id="泛型单例模式"><a href="#泛型单例模式" class="headerlink" title="泛型单例模式"></a>泛型单例模式</h1><p>创建目录文件如下</p><img src="https://p26-tt.byteimg.com/origin/pgc-image/86a804f3de9a4c9b960af8c63dd89626.png" alt="2.png" style="zoom:80%;" /><pre class="line-numbers language-csharp" data-language="csharp"><code class="language-csharp"><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">Sigltion<span class="token punctuation">&lt;</span>T<span class="token punctuation">></span></span> <span class="token punctuation">:</span> <span class="token type-list"><span class="token class-name">MonoBehaviour</span></span> <span class="token keyword">where</span> <span class="token class-name">T</span> <span class="token punctuation">:</span> <span class="token type-list"><span class="token class-name">Sigltion<span class="token punctuation">&lt;</span>T<span class="token punctuation">></span></span></span><span class="token punctuation">&#123;</span>    <span class="token keyword">private</span> <span class="token keyword">static</span> <span class="token class-name">T</span> instance<span class="token punctuation">;</span>    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token return-type class-name">T</span> Instance<span class="token punctuation">&#123;</span>        <span class="token keyword">get</span><span class="token punctuation">&#123;</span>            <span class="token keyword">return</span> instance<span class="token punctuation">;</span>        <span class="token punctuation">&#125;</span>    <span class="token punctuation">&#125;</span>    <span class="token comment">//允许子类对Awake进行重写</span>    <span class="token keyword">protected</span> <span class="token keyword">virtual</span> <span class="token return-type class-name"><span class="token keyword">void</span></span> <span class="token function">Awake</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>        <span class="token keyword">if</span><span class="token punctuation">(</span>instance <span class="token operator">!=</span> <span class="token keyword">null</span><span class="token punctuation">)</span>            <span class="token function">Destroy</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>gameObject<span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token keyword">else</span>            instance <span class="token operator">=</span> <span class="token punctuation">(</span>T<span class="token punctuation">)</span><span class="token keyword">this</span><span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span>    <span class="token comment">//检测单例是否生成</span>    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token return-type class-name"><span class="token keyword">bool</span></span> IsInitialized<span class="token punctuation">&#123;</span>        <span class="token keyword">get</span><span class="token punctuation">&#123;</span><span class="token keyword">return</span> instance <span class="token operator">!=</span> <span class="token keyword">null</span><span class="token punctuation">;</span><span class="token punctuation">&#125;</span>    <span class="token punctuation">&#125;</span>    <span class="token comment">//允许子类修改销毁时的操作</span>    <span class="token keyword">protected</span> <span class="token keyword">virtual</span> <span class="token return-type class-name"><span class="token keyword">void</span></span> <span class="token function">OnDestroy</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>        <span class="token keyword">if</span><span class="token punctuation">(</span>instance <span class="token operator">==</span> <span class="token keyword">this</span><span class="token punctuation">)</span>            instance <span class="token operator">=</span> <span class="token keyword">null</span><span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span><span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>这样一旦一个A类继承了<code>Sigltion&lt;A&gt;</code>之后，我们就可以在其它类中调用A类的单例，如：<code>A.Instance</code></p>]]></content>
    
    
      
      
    <summary type="html">&lt;p&gt;这一章我们来编写一个泛型单例模式的代码，这是因为我们的项目中会有很多的&lt;code&gt;Manager&lt;/code&gt;，如果每个都使用单例模式会更好地去管理和使用&lt;/p&gt;
&lt;p&gt;例如其中控制我们游戏的开始暂停等一般是用&lt;code&gt;Game Manager&lt;/code&gt;来命名，我们来</summary>
      
    
    
    
    <category term="Unity学习笔记" scheme="http://sakura-pub.ltd/categories/Unity%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/"/>
    
    
    <category term="Unity" scheme="http://sakura-pub.ltd/tags/Unity/"/>
    
  </entry>
  
  <entry>
    <title>Unity笔记13-敌人的守卫状态和死亡状态</title>
    <link href="http://sakura-pub.ltd/UnityNotes/Unity%E7%AC%94%E8%AE%B013-%E6%95%8C%E4%BA%BA%E7%9A%84%E5%AE%88%E5%8D%AB%E7%8A%B6%E6%80%81%E5%92%8C%E6%AD%BB%E4%BA%A1%E7%8A%B6%E6%80%81/"/>
    <id>http://sakura-pub.ltd/UnityNotes/Unity%E7%AC%94%E8%AE%B013-%E6%95%8C%E4%BA%BA%E7%9A%84%E5%AE%88%E5%8D%AB%E7%8A%B6%E6%80%81%E5%92%8C%E6%AD%BB%E4%BA%A1%E7%8A%B6%E6%80%81/</id>
    <published>2021-07-19T01:43:57.000Z</published>
    <updated>2021-07-19T04:08:52.903Z</updated>
    
    <content type="html"><![CDATA[<p> 这一章节我们来制作敌人的守卫状态和死亡状态</p><h1 id="敌人的守卫状态（Guard）"><a href="#敌人的守卫状态（Guard）" class="headerlink" title="敌人的守卫状态（Guard）"></a>敌人的守卫状态（Guard）</h1><p>打开<code>EnemyController.cs</code></p><pre class="line-numbers language-csharp" data-language="csharp"><code class="language-csharp"><span class="token keyword">private</span> <span class="token class-name">Quaternion</span> guardRotation<span class="token punctuation">;</span><span class="token comment">//记录敌人最初的旋转角度，用于脱离追击回去守卫点砖头转头</span><span class="token return-type class-name"><span class="token keyword">void</span></span> <span class="token function">Awake</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>    <span class="token comment">//...</span>    guardRotation <span class="token operator">=</span> transform<span class="token punctuation">.</span>rotation<span class="token punctuation">;</span><span class="token comment">//获得最初旋转角度</span><span class="token punctuation">&#125;</span><span class="token return-type class-name"><span class="token keyword">void</span></span> <span class="token function">SwitchEnemyStates</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span><span class="token comment">//...</span>    <span class="token keyword">switch</span><span class="token punctuation">(</span>enemyStates<span class="token punctuation">)</span><span class="token punctuation">&#123;</span>        <span class="token keyword">case</span> EnemyStates<span class="token punctuation">.</span>GUARD<span class="token punctuation">:</span><span class="token operator">/</span><span class="token operator">/</span>守卫状态            isChase <span class="token operator">=</span> <span class="token boolean">false</span><span class="token punctuation">;</span><span class="token comment">//脱离追击状态</span>            <span class="token comment">//如果在追击主角时回到守卫状态，就要跑回守卫点</span>            <span class="token keyword">if</span><span class="token punctuation">(</span>transform<span class="token punctuation">.</span>position <span class="token operator">!=</span> guardPos<span class="token punctuation">)</span><span class="token punctuation">&#123;</span>                isWalk <span class="token operator">=</span> <span class="token boolean">true</span><span class="token punctuation">;</span><span class="token comment">//播放走路动画</span>                agent<span class="token punctuation">.</span>isStopped <span class="token operator">=</span> <span class="token boolean">false</span><span class="token punctuation">;</span>                <span class="token comment">//导航回最初守卫点</span>                agent<span class="token punctuation">.</span>destination <span class="token operator">=</span> guardPos<span class="token punctuation">;</span>                <span class="token keyword">if</span><span class="token punctuation">(</span>Vector3<span class="token punctuation">.</span><span class="token function">SqrMagnitude</span><span class="token punctuation">(</span>guardPos <span class="token operator">-</span> transform<span class="token punctuation">.</span>position<span class="token punctuation">)</span><span class="token operator">&lt;=</span>agent<span class="token punctuation">.</span>stoppingDistance<span class="token punctuation">)</span><span class="token punctuation">&#123;</span>                    <span class="token comment">//SqrMagnitude也是可以用于比较距离的方法，比起Distance稍微快一些</span>                    <span class="token comment">//这里是判断是否到达最初守卫点可以停止范围</span>                    isWalk <span class="token operator">=</span> <span class="token boolean">false</span><span class="token punctuation">;</span>                    <span class="token comment">//慢慢转头。第三个参数越接近1转得越快</span>                    transform<span class="token punctuation">.</span>rotation <span class="token operator">=</span> Quaternion<span class="token punctuation">.</span><span class="token function">Lerp</span><span class="token punctuation">(</span>transform<span class="token punctuation">.</span>rotation<span class="token punctuation">,</span>guardRotation<span class="token punctuation">,</span><span class="token number">0.01f</span><span class="token punctuation">)</span><span class="token punctuation">;</span>                <span class="token punctuation">&#125;</span>            <span class="token punctuation">&#125;</span>            <span class="token keyword">break</span><span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span><span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>这里我们就写好了守卫状态的代码，其中<code>SqrMagnitude()</code>作用和<code>Distance()</code>一样都是比较两个点的距离，然后我们还加了慢慢转头的效果，否则敌人回到守卫点是不会转头的</p><h1 id="死亡状态"><a href="#死亡状态" class="headerlink" title="死亡状态"></a>死亡状态</h1><p>我们希望当敌人血量为0时播放死亡动画并且尸体消失掉</p><h2 id="设置死亡动画"><a href="#设置死亡动画" class="headerlink" title="设置死亡动画"></a>设置死亡动画</h2><p>打开动画控制器，我们新建一个<code>Death Layer</code>，不要忘了权重设为1</p><img src="https://p5-tt.byteimg.com/origin/pgc-image/32be87ac0205413280a7f42a61d7296e.png" alt="1.png" style="zoom:80%;" /><p>这里有个<code>GetHit</code>是用来做暴击伤害受伤效果的，它有左边的<code>Hit</code>触发，而我们的死亡动画<code>Die</code>连着<code>Any State</code>表示任何状态都能转移过来，由布尔值<code>Death</code>控制</p><p><strong>特别要注意的地方：</strong>关于死亡动画的设置<code>Can Transition To</code>一定不能勾选，不然会发生鬼畜</p><img src="https://p6-tt.byteimg.com/origin/pgc-image/497e554f53c24b17be551acb0694058c.png" alt="2.png" style="zoom:80%;" /><p>接下来主角的动画也是如此设置</p><img src="https://p6-tt.byteimg.com/origin/pgc-image/66e702dd2c644d058b5e628fbcf052c6.png" alt="3.png" style="zoom:80%;" /><h2 id="编写动画状态转移代码"><a href="#编写动画状态转移代码" class="headerlink" title="编写动画状态转移代码"></a>编写动画状态转移代码</h2><p>回到我们的<code>EnemyController.cs</code>中</p><pre class="line-numbers language-csharp" data-language="csharp"><code class="language-csharp"><span class="token keyword">private</span> <span class="token class-name">Collider</span> collider<span class="token punctuation">;</span><span class="token comment">//碰撞体组件</span><span class="token keyword">private</span> <span class="token class-name"><span class="token keyword">bool</span></span> isDead<span class="token punctuation">;</span><span class="token comment">//死亡状态控制</span><span class="token return-type class-name"><span class="token keyword">void</span></span> <span class="token function">Awake</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>    <span class="token comment">//...</span>    collider <span class="token operator">=</span> <span class="token generic-method"><span class="token function">GetComponent</span><span class="token generic class-name"><span class="token punctuation">&lt;</span>Collider<span class="token punctuation">></span></span></span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">&#125;</span><span class="token return-type class-name"><span class="token keyword">void</span></span> <span class="token function">Update</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>    <span class="token keyword">if</span><span class="token punctuation">(</span>charcterStates<span class="token punctuation">.</span>currentHealth <span class="token operator">==</span> <span class="token number">0</span><span class="token punctuation">)</span>        isDead <span class="token operator">=</span> <span class="token boolean">true</span><span class="token punctuation">;</span><span class="token comment">//血量变0则死亡状态为真</span>    <span class="token comment">//...</span><span class="token punctuation">&#125;</span><span class="token return-type class-name"><span class="token keyword">void</span></span> <span class="token function">SwitchAnimation</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>    <span class="token comment">//...</span>    anim<span class="token punctuation">.</span><span class="token function">SetBool</span><span class="token punctuation">(</span><span class="token string">"Death"</span><span class="token punctuation">,</span>isDead<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">//是否播放死亡动画</span><span class="token punctuation">&#125;</span><span class="token return-type class-name"><span class="token keyword">void</span></span> <span class="token function">SwitchEnemyStates</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>    <span class="token comment">//第一个判断是否为死亡</span>    <span class="token keyword">if</span><span class="token punctuation">(</span>isDead<span class="token punctuation">)</span><span class="token punctuation">&#123;</span>        enemyStates <span class="token operator">=</span> EnemyStates<span class="token punctuation">.</span>DEAD<span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span><span class="token keyword">else</span> <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token function">FoundPlayer</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span><span class="token comment">//如果发现player 切换到CHASE</span>        enemyStates <span class="token operator">=</span> EnemyStates<span class="token punctuation">.</span>CHASE<span class="token punctuation">;</span>        <span class="token comment">//Debug.LogFormat("敌人&#123;0&#125;发现了玩家",this.name);//测试代码</span>    <span class="token punctuation">&#125;</span>            <span class="token keyword">case</span> EnemyStates<span class="token punctuation">.</span>DEAD<span class="token punctuation">:</span>    collider<span class="token punctuation">.</span>enabled <span class="token operator">=</span> <span class="token boolean">false</span><span class="token punctuation">;</span><span class="token comment">//防止时候开业再次攻击</span>    agent<span class="token punctuation">.</span>enabled <span class="token operator">=</span> <span class="token boolean">false</span><span class="token punctuation">;</span><span class="token comment">//直接关闭导航组件</span>    <span class="token function">Destroy</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>gameObject<span class="token punctuation">,</span><span class="token number">2f</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">//销毁游戏对象，延迟为2秒</span>    <span class="token keyword">break</span><span class="token punctuation">;</span><span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>这里我们设置了<code>Death</code>的动画状态，注意开头<code>if(isDead)</code>的下一个是<code>else if</code>，而<code>Hit</code>的状态可以去到<code>CharcterStates.cs</code>中设置</p><pre class="line-numbers language-csharp" data-language="csharp"><code class="language-csharp"><span class="token keyword">public</span> <span class="token return-type class-name"><span class="token keyword">void</span></span> <span class="token function">TakeDamage</span><span class="token punctuation">(</span><span class="token class-name">CharcterStates</span> attacker<span class="token punctuation">,</span><span class="token class-name">CharcterStates</span> defener<span class="token punctuation">)</span><span class="token punctuation">&#123;</span>    <span class="token comment">//计算伤害数值</span>    <span class="token comment">//当前攻击力减去目标的防御力，如果防御力过高就是0伤害</span>    <span class="token class-name"><span class="token keyword">int</span></span> damage <span class="token operator">=</span> Mathf<span class="token punctuation">.</span><span class="token function">Max</span><span class="token punctuation">(</span>attacker<span class="token punctuation">.</span><span class="token function">CurrentDamage</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">-</span>defener<span class="token punctuation">.</span>currentDefence<span class="token punctuation">,</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    currentHealth <span class="token operator">=</span> Mathf<span class="token punctuation">.</span><span class="token function">Max</span><span class="token punctuation">(</span>currentHealth<span class="token operator">-</span>damage<span class="token punctuation">,</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">//血量也是最小值锁在0</span>    <span class="token keyword">if</span><span class="token punctuation">(</span>isCritical<span class="token punctuation">)</span><span class="token comment">//判断被打者是否受到暴击并且播放受伤动画</span>        defener<span class="token punctuation">.</span><span class="token generic-method"><span class="token function">GetComponent</span><span class="token generic class-name"><span class="token punctuation">&lt;</span>Animator<span class="token punctuation">></span></span></span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">SetTrigger</span><span class="token punctuation">(</span><span class="token string">"Hit"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token comment">//将来要做的事情</span>    <span class="token comment">//TODO:血量条UI</span>    <span class="token comment">//TODO:打死怪后加经验</span><span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>在中间我们打了一行代码，用来获取被打者的Animator并设置动画<code>Hit</code>状态，这样就可以集中管理暴击受伤动画了</p><p>最后对于主角我们也用相同的办法来写这些代码就大功告成了</p>]]></content>
    
    
      
      
    <summary type="html">&lt;p&gt; 这一章节我们来制作敌人的守卫状态和死亡状态&lt;/p&gt;
&lt;h1 id=&quot;敌人的守卫状态（Guard）&quot;&gt;&lt;a href=&quot;#敌人的守卫状态（Guard）&quot; class=&quot;headerlink&quot; title=&quot;敌人的守卫状态（Guard）&quot;&gt;&lt;/a&gt;敌人的守卫状态（Guard）</summary>
      
    
    
    
    <category term="Unity学习笔记" scheme="http://sakura-pub.ltd/categories/Unity%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/"/>
    
    
    <category term="Unity" scheme="http://sakura-pub.ltd/tags/Unity/"/>
    
  </entry>
  
  <entry>
    <title>Unity笔记12-实现攻击数值计算</title>
    <link href="http://sakura-pub.ltd/UnityNotes/Unity%E7%AC%94%E8%AE%B012-%E5%AE%9E%E7%8E%B0%E6%94%BB%E5%87%BB%E6%95%B0%E5%80%BC%E8%AE%A1%E7%AE%97/"/>
    <id>http://sakura-pub.ltd/UnityNotes/Unity%E7%AC%94%E8%AE%B012-%E5%AE%9E%E7%8E%B0%E6%94%BB%E5%87%BB%E6%95%B0%E5%80%BC%E8%AE%A1%E7%AE%97/</id>
    <published>2021-07-18T01:29:45.000Z</published>
    <updated>2021-07-26T01:10:45.401Z</updated>
    
    <content type="html"><![CDATA[<p> 这一章节中我们来实现攻击伤害的计算，给予人物或敌人真实的攻击伤害</p><h1 id="补充人物攻击动画"><a href="#补充人物攻击动画" class="headerlink" title="补充人物攻击动画"></a>补充人物攻击动画</h1><p>在之前我们要给人物添加一下暴击动画，和上一章节设置敌人动画类似，注意要设置动画切换效果</p><img src="https://p6-tt.byteimg.com/origin/pgc-image/db2c7f3914614d4ea5ec93211e2b47a7.png" alt="1.png" style="zoom:80%;" /><p>打开<code>PlayerController.cs</code>，修改一下</p><pre class="line-numbers language-csharp" data-language="csharp"><code class="language-csharp"><span class="token return-type class-name">IEnumerator</span> <span class="token function">MoveToAttackTarget</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>    agent<span class="token punctuation">.</span>isStopped <span class="token operator">=</span> <span class="token boolean">false</span><span class="token punctuation">;</span>    transform<span class="token punctuation">.</span><span class="token function">LookAt</span><span class="token punctuation">(</span>attactTarget<span class="token punctuation">.</span>transform<span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token keyword">while</span><span class="token punctuation">(</span>Vector3<span class="token punctuation">.</span><span class="token function">Distance</span><span class="token punctuation">(</span>transform<span class="token punctuation">.</span>position<span class="token punctuation">,</span>attactTarget<span class="token punctuation">.</span>transform<span class="token punctuation">.</span>position<span class="token punctuation">)</span><span class="token operator">></span>          charcterStates<span class="token punctuation">.</span>attackData<span class="token punctuation">.</span>attackRange<span class="token punctuation">)</span><span class="token punctuation">&#123;</span>        <span class="token comment">//比较人物和敌人的距离是否大于0攻击距离，Distance()可以比较两个Vector3距离</span>        <span class="token keyword">this</span><span class="token punctuation">.</span>agent<span class="token punctuation">.</span>destination <span class="token operator">=</span> attactTarget<span class="token punctuation">.</span>transform<span class="token punctuation">.</span>position<span class="token punctuation">;</span>        <span class="token keyword">yield</span> <span class="token keyword">return</span> <span class="token keyword">null</span><span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span>    agent<span class="token punctuation">.</span>isStopped <span class="token operator">=</span> <span class="token boolean">true</span><span class="token punctuation">;</span>    <span class="token comment">//攻击动画和CD都在下面</span>    <span class="token keyword">if</span><span class="token punctuation">(</span>lastAttactTime<span class="token operator">&lt;</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span><span class="token comment">//CD冷却完成可执行攻击</span>        animator<span class="token punctuation">.</span><span class="token function">SetBool</span><span class="token punctuation">(</span><span class="token string">"Critical"</span><span class="token punctuation">,</span>charcterStates<span class="token punctuation">.</span>isCritical<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">//增加了传递是否暴击</span>        animator<span class="token punctuation">.</span><span class="token function">SetTrigger</span><span class="token punctuation">(</span><span class="token string">"Attack"</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">//普通攻击</span>        lastAttactTime <span class="token operator">=</span> charcterStates<span class="token punctuation">.</span>attackData<span class="token punctuation">.</span>coolDown<span class="token punctuation">;</span><span class="token comment">//修改了这里的CD时间</span>    <span class="token punctuation">&#125;</span><span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>这里我们修改了两个地方，一个是增加了暴击判断，另一个是修改了CD时间判断</p><h1 id="增加攻击数值计算"><a href="#增加攻击数值计算" class="headerlink" title="增加攻击数值计算"></a>增加攻击数值计算</h1><p>前面补充完成后，我们就可以正式来写攻击伤害的数值计算了</p><p>打开<code>CharcterStates.cs</code>，我们在最下面加上我们的伤害计算代码</p><pre class="line-numbers language-csharp" data-language="csharp"><code class="language-csharp"><span class="token return-type class-name"><span class="token keyword">void</span></span> <span class="token function">EventAttact</span><span class="token punctuation">(</span><span class="token class-name">GameObject</span> target<span class="token punctuation">)</span><span class="token punctuation">&#123;</span>    <span class="token keyword">if</span><span class="token punctuation">(</span>target<span class="token operator">!=</span><span class="token keyword">null</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span><span class="token comment">//如果鼠标点击的目标不为空，或者点击的敌人不是属于死亡状态</span>        attactTarget <span class="token operator">=</span> target<span class="token punctuation">;</span>        <span class="token comment">//随机暴击率语句</span>        charcterStates<span class="token punctuation">.</span>isCritical <span class="token operator">=</span> Random<span class="token punctuation">.</span><span class="token keyword">value</span> <span class="token operator">&lt;</span> charcterStates<span class="token punctuation">.</span>attackData<span class="token punctuation">.</span>criticalChance<span class="token punctuation">;</span>        <span class="token function">StartCoroutine</span><span class="token punctuation">(</span><span class="token function">MoveToAttackTarget</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span><span class="token punctuation">&#125;</span><span class="token comment">//伤害计算区</span><span class="token preprocessor property">#<span class="token directive keyword">region</span> Charcter Combat</span>    <span class="token keyword">public</span> <span class="token return-type class-name"><span class="token keyword">void</span></span> <span class="token function">TakeDamage</span><span class="token punctuation">(</span><span class="token class-name">CharcterStates</span> attacker<span class="token punctuation">,</span><span class="token class-name">CharcterStates</span> defener<span class="token punctuation">)</span><span class="token punctuation">&#123;</span>    <span class="token comment">//计算伤害数值</span>    <span class="token comment">//当前攻击力减去目标的防御力，如果防御力过高就是0伤害</span>    <span class="token class-name"><span class="token keyword">int</span></span> damage <span class="token operator">=</span> Mathf<span class="token punctuation">.</span><span class="token function">Max</span><span class="token punctuation">(</span>attacker<span class="token punctuation">.</span><span class="token function">CurrentDamage</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">-</span>defener<span class="token punctuation">.</span>currentDefence<span class="token punctuation">,</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    currentHealth <span class="token operator">=</span> Mathf<span class="token punctuation">.</span><span class="token function">Max</span><span class="token punctuation">(</span>currentHealth<span class="token operator">-</span>damage<span class="token punctuation">,</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">//血量也是最小值锁在0</span>    <span class="token keyword">if</span><span class="token punctuation">(</span>attacker<span class="token punctuation">.</span>isCritical<span class="token punctuation">)</span><span class="token comment">//判断被打者是否受到暴击并且播放受伤动画</span>            defener<span class="token punctuation">.</span><span class="token generic-method"><span class="token function">GetComponent</span><span class="token generic class-name"><span class="token punctuation">&lt;</span>Animator<span class="token punctuation">></span></span></span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">SetTrigger</span><span class="token punctuation">(</span><span class="token string">"Hit"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token comment">//将来要做的事情</span>    <span class="token comment">//TODO:血量条UI</span>    <span class="token comment">//TODO:打死怪后加经验</span><span class="token punctuation">&#125;</span><span class="token keyword">private</span> <span class="token return-type class-name"><span class="token keyword">int</span></span> <span class="token function">CurrentDamage</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>    <span class="token comment">//在攻击力范围内取随机数返回一个随机攻击力</span>    <span class="token class-name"><span class="token keyword">float</span></span> coreDamage <span class="token operator">=</span> Random<span class="token punctuation">.</span><span class="token function">Range</span><span class="token punctuation">(</span>attackData<span class="token punctuation">.</span>minDamage<span class="token punctuation">,</span>attackData<span class="token punctuation">.</span>maxDamage<span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token keyword">if</span><span class="token punctuation">(</span>isCritical<span class="token punctuation">)</span><span class="token punctuation">&#123;</span><span class="token comment">//如果暴击的话还要计算上暴击率</span>        coreDamage <span class="token operator">*=</span>attackData<span class="token punctuation">.</span>criticalMultiplier<span class="token punctuation">;</span><span class="token comment">//乘等于</span>        Debug<span class="token punctuation">.</span><span class="token function">LogFormat</span><span class="token punctuation">(</span><span class="token string">"暴击了！伤害为（不算目标防御力）：&#123;0&#125;"</span><span class="token punctuation">,</span>coreDamage<span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span>    <span class="token keyword">return</span> <span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token keyword">int</span><span class="token punctuation">)</span>coreDamage<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">&#125;</span><span class="token preprocessor property">#<span class="token directive keyword">endregion</span></span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h1 id="调用伤害计算方法"><a href="#调用伤害计算方法" class="headerlink" title="调用伤害计算方法"></a>调用伤害计算方法</h1><p>伤害计算代码写好后，我们就要去想如何调用它，在哪里调用它了</p><p>参考一些RPG游戏，一般都是当你的武器挥出去后接触到敌人那一瞬间计算伤害，我们也可以按照这样来做</p><h2 id="在人物身上调用"><a href="#在人物身上调用" class="headerlink" title="在人物身上调用"></a>在人物身上调用</h2><p>首先要调出<code>Animation</code>窗口</p><img src="https://p26-tt.byteimg.com/origin/pgc-image/42623310028b4fbcafc6c49ce9fbc6a6.png" alt="2.png" style="zoom:80%;" /><p>然后窗口左上角选择上我们的攻击动画<code>Attack01</code>，我们就可以在攻击动画里面的某个特定帧添加事件了</p><p>我们再次编辑一下<code>PlayerController.cs</code>代码加一个用来调用的方法</p><pre class="line-numbers language-csharp" data-language="csharp"><code class="language-csharp"><span class="token comment">//Animation Event</span><span class="token return-type class-name"><span class="token keyword">void</span></span> <span class="token function">Hit</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>    <span class="token class-name"><span class="token keyword">var</span></span> targetStates <span class="token operator">=</span> attactTarget<span class="token punctuation">.</span><span class="token generic-method"><span class="token function">GetComponent</span><span class="token generic class-name"><span class="token punctuation">&lt;</span>CharcterStates<span class="token punctuation">></span></span></span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token comment">//计算伤害</span>    targetStates<span class="token punctuation">.</span><span class="token function">TakeDamage</span><span class="token punctuation">(</span>charcterStates<span class="token punctuation">,</span>targetStates<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>回到<code>Animation</code>窗口，将它添加为事件</p><img src="https://p5-tt.byteimg.com/origin/pgc-image/3ebdba5a85864a339407b9a8d21a740f.png" alt="4.png" style="zoom:80%;" /><p><strong>注意：同样的暴击动画也要加上</strong></p><h2 id="在敌人身上调用"><a href="#在敌人身上调用" class="headerlink" title="在敌人身上调用"></a>在敌人身上调用</h2><p>然后在敌人身上我们也要进行同样的操作，打开<code>EnemyController.cs</code></p><pre class="line-numbers language-csharp" data-language="csharp"><code class="language-csharp"><span class="token comment">//EnemyController.cs</span><span class="token return-type class-name"><span class="token keyword">void</span></span> <span class="token function">Hit</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>    <span class="token comment">//由于在敌人追主角的过程中主角可能会跑开，这时候如果攻击的话目标就丢失了</span>    <span class="token comment">//所以我们在攻击前判断目标是否为空，以防报错</span>    <span class="token keyword">if</span><span class="token punctuation">(</span>attackTarget <span class="token operator">!=</span> <span class="token keyword">null</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>        <span class="token class-name"><span class="token keyword">var</span></span> targetStates <span class="token operator">=</span> attackTarget<span class="token punctuation">.</span><span class="token generic-method"><span class="token function">GetComponent</span><span class="token generic class-name"><span class="token punctuation">&lt;</span>CharcterStates<span class="token punctuation">></span></span></span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        targetStates<span class="token punctuation">.</span><span class="token function">TakeDamage</span><span class="token punctuation">(</span>charcterStates<span class="token punctuation">,</span>targetStates<span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span><span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>然后在为<code>Animation</code>添加动画时我们发现当前史莱姆的动画是<code>只读</code>属性的，对于这种情况我们可以把动画单独复制到其它地方，再将复制出来的动画替换原来的，就可以进行事件添加了</p><p>如图对着动画文件按<code>Ctrl+D</code>可以快速复制</p><img src="https://p9-tt.byteimg.com/origin/pgc-image/3831ed71b8dc46cc8d7ce464438e15b3.png" alt="5.png" style="zoom:80%;" /><p>然后我们将复制出来的动画（这里有两个）分类放好</p><img src="https://p26-tt.byteimg.com/origin/pgc-image/cded851a377744a2a2c53f78e2573698.png" alt="6.png" style="zoom:80%;" /><p>然后进行动画替换</p><img src="https://p26-tt.byteimg.com/origin/pgc-image/99667e3e7b754c4f8b286410045bac15.png" alt="7.png" style="zoom:80%;" /><p>最后再进行动画帧事件添加操作就行了</p><p>到这我们就把伤害计算代码和效果都写出来了，下一章节中我们还会去补充如果敌人或人物血量到0了时候的状态</p>]]></content>
    
    
      
      
    <summary type="html">&lt;p&gt; 这一章节中我们来实现攻击伤害的计算，给予人物或敌人真实的攻击伤害&lt;/p&gt;
&lt;h1 id=&quot;补充人物攻击动画&quot;&gt;&lt;a href=&quot;#补充人物攻击动画&quot; class=&quot;headerlink&quot; title=&quot;补充人物攻击动画&quot;&gt;&lt;/a&gt;补充人物攻击动画&lt;/h1&gt;&lt;p&gt;在之前我们</summary>
      
    
    
    
    <category term="Unity学习笔记" scheme="http://sakura-pub.ltd/categories/Unity%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/"/>
    
    
    <category term="Unity" scheme="http://sakura-pub.ltd/tags/Unity/"/>
    
  </entry>
  
  <entry>
    <title>LeetCode刷题笔记第一期</title>
    <link href="http://sakura-pub.ltd/LeetCode/LeetCode%E5%88%B7%E9%A2%98%E7%AC%94%E8%AE%B0%E7%AC%AC%E4%B8%80%E6%9C%9F/"/>
    <id>http://sakura-pub.ltd/LeetCode/LeetCode%E5%88%B7%E9%A2%98%E7%AC%94%E8%AE%B0%E7%AC%AC%E4%B8%80%E6%9C%9F/</id>
    <published>2021-07-17T15:54:05.000Z</published>
    <updated>2021-08-03T16:01:08.636Z</updated>
    
    <content type="html"><![CDATA[<h1 id="LeetCode刷题笔记第一期"><a href="#LeetCode刷题笔记第一期" class="headerlink" title="LeetCode刷题笔记第一期"></a>LeetCode刷题笔记第一期</h1><h2 id="前言"><a href="#前言" class="headerlink" title="前言"></a>前言</h2><p>之前一直想在刷题的时候把想要记下的笔记记下来，但是没有找到很好的地方，但是现在有了博客之后就可以写在这的</p><p>写这个刷题笔记一个是想时不时回来巩固一下算法，另一个是想记录下自己的算法能力成长的过程，同时也是想为实习做准备</p><p>写这个笔记是大二暑假时期，之前也有一些算法基础，参加过的算法相关竞赛只有一次蓝桥杯，只拿到省赛二等奖，也希望能够通过刷题和做笔记能够有所长进</p><p>本人算法能力不是很强，一般都要想好一阵子，所以一般写出来的答案不是很好，望大佬们轻喷</p><p>✨注：我写算法的语言主打C++</p><p>那么，就开始吧！</p><hr><h1 id="贪心"><a href="#贪心" class="headerlink" title="贪心"></a>贪心</h1><h2 id="452-用最少数量的箭引爆气球"><a href="#452-用最少数量的箭引爆气球" class="headerlink" title="452.用最少数量的箭引爆气球"></a>452.<a href="https://leetcode-cn.com/problems/minimum-number-of-arrows-to-burst-balloons/">用最少数量的箭引爆气球</a></h2><p>在二维空间中有许多球形的气球。对于每个气球，提供的输入是水平方向上，气球直径的开始和结束坐标。由于它是水平的，所以纵坐标并不重要，因此只要知道开始和结束的横坐标就足够了。开始坐标总是小于结束坐标。</p><p>一支弓箭可以沿着 x 轴从不同点完全垂直地射出。在坐标 x 处射出一支箭，若有一个气球的直径的开始和结束坐标为 <code>xstart</code>，<code>xend</code>， 且满足  <code>xstart</code> ≤ x ≤ <code>xend</code>，则该气球会被引爆。可以射出的弓箭的数量没有限制。 弓箭一旦被射出之后，可以无限地前进。我们想找到使得所有气球全部被引爆，所需的弓箭的最小数量。</p><p>给你一个数组 points ，其中 points [i] = [xstart,xend] ，返回引爆所有气球所必须射出的最小弓箭数。</p><p>示例：</p><blockquote><p>输入：points = [[10,16],[2,8],[1,6],[7,12]]<br>输出：2<br>解释：对于该样例，x = 6 可以射爆 [2,8],[1,6] 两个气球，以及 x = 11 射爆另外两个气球</p></blockquote><p>这一题拿到题目时看了好几次都看不懂题目，看了一下别人画的图才明白题的意思，和另外题 <code>435. 无重叠区间</code>有点相似</p><p>我们可以在每一次射击箭的时候尽量往用少一点的方向去想，当气球重叠时便一起射，这是局部最优，然后每次局部最优所造成的就是全局最优，射完全部气球所用的弓箭是最少，这便可以用贪心算法来求解</p><p>借用官方解答所给的图来解释</p><p><img src="https://p9-tt.byteimg.com/origin/pgc-image/f83bd4a2e87746078b4cac68d1f4d1d5.png"></p><p>当把弓箭挪到右区间最小的时候（如第三个图的蓝色）就可以一箭四雕，因为题目所给的条件<code>xstart</code> ≤ x ≤ <code>xend</code>时气球就会给射爆，这里包含了边界值条件，所以在闭区间位置也满足</p><p>因此我就有了基本思路，先把这些气球排列，然后从第二个气球遍历，每次与前一个气球作比较，如果两个气球区间相交，那就可以略过当前气球进入下一次比较（做个标记，代表可以在这一个弓箭射完），具体如何略过看代码；如果气球不相交了，那就证明要用多一发弓箭了，此时弓箭数要加一，然后继续往下比较</p><p>下面是自己参考别人解答后写出来的代码：</p><pre class="line-numbers language-cpp" data-language="cpp"><code class="language-cpp"><span class="token keyword">class</span> <span class="token class-name">Solution</span> <span class="token punctuation">&#123;</span><span class="token keyword">public</span><span class="token operator">:</span>    <span class="token keyword">static</span> <span class="token keyword">inline</span> <span class="token keyword">bool</span> <span class="token function">VecSort</span><span class="token punctuation">(</span><span class="token keyword">const</span> vector<span class="token operator">&lt;</span><span class="token keyword">int</span><span class="token operator">></span><span class="token operator">&amp;</span>a<span class="token punctuation">,</span><span class="token keyword">const</span> vector<span class="token operator">&lt;</span><span class="token keyword">int</span><span class="token operator">></span><span class="token operator">&amp;</span>b<span class="token punctuation">)</span><span class="token punctuation">&#123;</span>        <span class="token keyword">if</span><span class="token punctuation">(</span>a<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token operator">&lt;</span>b<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">)</span>            <span class="token keyword">return</span> <span class="token boolean">true</span><span class="token punctuation">;</span>        <span class="token keyword">return</span> <span class="token boolean">false</span><span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span>    <span class="token keyword">int</span> <span class="token function">findMinArrowShots</span><span class="token punctuation">(</span>vector<span class="token operator">&lt;</span>vector<span class="token operator">&lt;</span><span class="token keyword">int</span><span class="token operator">>></span><span class="token operator">&amp;</span> points<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>        <span class="token keyword">int</span> size <span class="token operator">=</span> points<span class="token punctuation">.</span><span class="token function">size</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token operator">!</span>size<span class="token punctuation">)</span><span class="token comment">//数组为空</span>            <span class="token keyword">return</span> <span class="token number">0</span><span class="token punctuation">;</span>        <span class="token function">sort</span><span class="token punctuation">(</span>points<span class="token punctuation">.</span><span class="token function">begin</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span>points<span class="token punctuation">.</span><span class="token function">end</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span>VecSort<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">//按气球起点进行从小到大排序</span>        <span class="token keyword">int</span> res <span class="token operator">=</span> <span class="token number">1</span><span class="token punctuation">;</span><span class="token comment">//返回结果，不为空至少需要一只箭</span>        <span class="token keyword">for</span><span class="token punctuation">(</span><span class="token keyword">int</span> i<span class="token operator">=</span><span class="token number">1</span><span class="token punctuation">;</span>i<span class="token operator">&lt;</span>size<span class="token punctuation">;</span>i<span class="token operator">++</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>            <span class="token comment">//从前往后遍历气球</span>            <span class="token keyword">if</span><span class="token punctuation">(</span>points<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token operator">></span>points<span class="token punctuation">[</span>i<span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>                <span class="token comment">//当前气球与前一个气球不重叠</span>                res<span class="token operator">++</span><span class="token punctuation">;</span>            <span class="token punctuation">&#125;</span><span class="token keyword">else</span><span class="token punctuation">&#123;</span>                <span class="token comment">//重叠则跳过当前气球</span>                <span class="token comment">//（利用闭区间最右位置可以射到的规则让其长度变短，以达到可跳过的当前气球目的）</span>                points<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token operator">=</span>std<span class="token operator">::</span><span class="token function">min</span><span class="token punctuation">(</span>points<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">,</span>points<span class="token punctuation">[</span>i<span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>            <span class="token punctuation">&#125;</span>        <span class="token punctuation">&#125;</span>        <span class="token keyword">return</span> res<span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span><span class="token punctuation">&#125;</span><span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>这样做出来之后时间复杂度为<em>O(nlogn)<em>因为用了个快排，空间复杂度为</em>O(1)</em></p><img src="https://p6-tt.byteimg.com/origin/pgc-image/3af7d43845b04870bda4754ca1805c0e.jpg" alt="452.jpg" style="zoom:80%;" /><hr><h2 id="763-划分字母区间"><a href="#763-划分字母区间" class="headerlink" title="763. 划分字母区间"></a><a href="https://leetcode-cn.com/problems/partition-labels/">763. 划分字母区间</a></h2><p>字符串 <code>S</code> 由小写字母组成。我们要把这个字符串划分为尽可能多的片段，同一字母最多出现在一个片段中。返回一个表示每个字符串片段的长度的列表。</p><p>示例：</p><blockquote><p>输入：S = “ababcbacadefegdehijhklij”<br>输出：[9,7,8]<br>解释：<br>划分结果为 “ababcbaca”, “defegde”, “hijhklij”。<br>每个字母最多出现在一个片段中。<br>像 “ababcbacadefegde”, “hijhklij” 的划分是错误的，因为划分的片段数较少。</p></blockquote><p>这种题型第一次见，不怎么会，因为尽可能地要划分多个区域，从而达到某个或多个字母只出现在这片区域中，那么就可以先记录下每个字母最后出现的位置</p><p>然后再次遍历字符串，不断更新标识符<code>end</code>，该标识符指向的是当前遍历过的字母中，最持久的字符最后出现的位置，也相当于是这片区域最后的位置，所以我们只用找出这个标识符最终的位置就能够划分一个区域出来了</p><pre class="line-numbers language-cpp" data-language="cpp"><code class="language-cpp"><span class="token keyword">class</span> <span class="token class-name">Solution</span> <span class="token punctuation">&#123;</span><span class="token keyword">public</span><span class="token operator">:</span>    vector<span class="token operator">&lt;</span><span class="token keyword">int</span><span class="token operator">></span> <span class="token function">partitionLabels</span><span class="token punctuation">(</span>string s<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>        <span class="token keyword">int</span> str_size <span class="token operator">=</span> s<span class="token punctuation">.</span><span class="token function">size</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token operator">!</span>str_size<span class="token punctuation">)</span>            <span class="token keyword">return</span> <span class="token punctuation">&#123;</span><span class="token punctuation">&#125;</span><span class="token punctuation">;</span>        <span class="token keyword">else</span> <span class="token keyword">if</span><span class="token punctuation">(</span>str_size <span class="token operator">==</span> <span class="token number">1</span><span class="token punctuation">)</span>            <span class="token keyword">return</span> <span class="token punctuation">&#123;</span><span class="token number">1</span><span class="token punctuation">&#125;</span><span class="token punctuation">;</span>        vector<span class="token operator">&lt;</span><span class="token keyword">int</span><span class="token operator">></span>res<span class="token punctuation">;</span>        <span class="token keyword">int</span> map<span class="token punctuation">[</span><span class="token number">26</span><span class="token punctuation">]</span><span class="token punctuation">;</span><span class="token comment">//记录每个字母最后出现的位置</span>        <span class="token keyword">for</span><span class="token punctuation">(</span><span class="token keyword">int</span> i<span class="token operator">=</span><span class="token number">0</span><span class="token punctuation">;</span>i<span class="token operator">&lt;</span>str_size<span class="token punctuation">;</span>i<span class="token operator">++</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>            map<span class="token punctuation">[</span>s<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token operator">-</span><span class="token string">'a'</span><span class="token punctuation">]</span><span class="token operator">=</span>i<span class="token punctuation">;</span>        <span class="token punctuation">&#125;</span>        <span class="token keyword">int</span> start<span class="token operator">=</span><span class="token number">0</span><span class="token punctuation">;</span><span class="token keyword">int</span> end<span class="token operator">=</span><span class="token number">0</span><span class="token punctuation">;</span><span class="token comment">//记录分割数据的开头和结尾位置</span>        <span class="token keyword">for</span><span class="token punctuation">(</span><span class="token keyword">int</span> i<span class="token operator">=</span><span class="token number">0</span><span class="token punctuation">;</span>i<span class="token operator">&lt;</span>str_size<span class="token punctuation">;</span>i<span class="token operator">++</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>            end <span class="token operator">=</span> std<span class="token operator">::</span><span class="token function">max</span><span class="token punctuation">(</span>end<span class="token punctuation">,</span>map<span class="token punctuation">[</span>s<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token operator">-</span><span class="token string">'a'</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">//贪心策略地方，尽可能找到字母最后出现的位置从而划分区域</span>            <span class="token keyword">if</span><span class="token punctuation">(</span>i <span class="token operator">==</span> end<span class="token punctuation">)</span><span class="token punctuation">&#123;</span>                <span class="token comment">//如果找到之前遍历过的所有字母的最远边界，说明这个边界就是分割点了</span>                res<span class="token punctuation">.</span><span class="token function">push_back</span><span class="token punctuation">(</span>end<span class="token operator">-</span>start<span class="token operator">+</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>                start <span class="token operator">=</span> end <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">;</span>            <span class="token punctuation">&#125;</span>        <span class="token punctuation">&#125;</span>        <span class="token keyword">return</span> res<span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span><span class="token punctuation">&#125;</span><span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>时间复杂度<em>O(n)<em>，空间复杂度</em>O(1)</em></p><img src="https://p5-tt.byteimg.com/origin/pgc-image/c6d28e63caa845aba5e8479b6f016d58.jpg" alt="763.jpg" style="zoom:80%;" /><hr><h1 id="双指针"><a href="#双指针" class="headerlink" title="双指针"></a>双指针</h1><h2 id="88-合并两个有序数组—（简单）"><a href="#88-合并两个有序数组—（简单）" class="headerlink" title="88. 合并两个有序数组—（简单）"></a><a href="https://leetcode-cn.com/problems/merge-sorted-array/">88. 合并两个有序数组</a>—（简单）</h2><p>给你两个有序整数数组 nums1 和 nums2，请你将 nums2 合并到 nums1 中，使 nums1 成为一个有序数组。</p><p>初始化 nums1 和 nums2 的元素数量分别为 m 和 n 。你可以假设 nums1 的空间大小等于 m + n，这样它就有足够的空间保存来自 nums2 的元素。</p><p>示例1：</p><blockquote><p>输入：nums1 = [1,2,3,0,0,0], m = 3, nums2 = [2,5,6], n = 3<br>输出：[1,2,2,3,5,6]</p></blockquote><p>示例2：</p><blockquote><p>输入：nums1 = [1], m = 1, nums2 = [], n = 0<br>输出：[1]</p></blockquote><p>这道题是多指针中的一种题型，但是它需要的是逆向指针，知道原理后比较简单</p><p>因为这两个数组已经排好序，我们可以把两个指针分别放在两个数组的末尾，即 nums1 的m - 1 位和 nums2 的 n - 1 位每次将较大的那个数字复制到 nums1 的后边，然后向前移动一位。因为我们也要定位 nums1 的末尾，所以我们还需要第三个指针，以便复制。<br>在以下的代码里，我们直接利用 m 和 n 当作两个数组的指针，再额外创立一个 pos 指针，起始位置为 m + n - 1。每次向前移动 m 或 n 的时候，也要向前移动 pos。这里需要注意，如果 nums1的数字已经复制完，不要忘记把 nums2 的数字继续复制；如果 nums2 的数字已经复制完，剩余nums1 的数字不需要改变，因为它们已经被排好序。  </p><pre class="line-numbers language-cpp" data-language="cpp"><code class="language-cpp"><span class="token keyword">class</span> <span class="token class-name">Solution</span> <span class="token punctuation">&#123;</span><span class="token keyword">public</span><span class="token operator">:</span>    <span class="token keyword">void</span> <span class="token function">merge</span><span class="token punctuation">(</span>vector<span class="token operator">&lt;</span><span class="token keyword">int</span><span class="token operator">></span><span class="token operator">&amp;</span> nums1<span class="token punctuation">,</span> <span class="token keyword">int</span> m<span class="token punctuation">,</span> vector<span class="token operator">&lt;</span><span class="token keyword">int</span><span class="token operator">></span><span class="token operator">&amp;</span> nums2<span class="token punctuation">,</span> <span class="token keyword">int</span> n<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>        <span class="token keyword">int</span> size1 <span class="token operator">=</span> nums1<span class="token punctuation">.</span><span class="token function">size</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token keyword">int</span> size2 <span class="token operator">=</span> nums2<span class="token punctuation">.</span><span class="token function">size</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token operator">!</span>size2<span class="token punctuation">)</span>            <span class="token keyword">return</span><span class="token punctuation">;</span>        <span class="token comment">//需要三个指针，分别是m-1,n-1和m+n-1，前两个可以用m n 代替</span>        <span class="token keyword">int</span> pos <span class="token operator">=</span> m<span class="token operator">+</span>n<span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">;</span>        n<span class="token operator">--</span><span class="token punctuation">;</span>m<span class="token operator">--</span><span class="token punctuation">;</span>        <span class="token keyword">while</span><span class="token punctuation">(</span>n<span class="token operator">>=</span><span class="token number">0</span> <span class="token operator">&amp;&amp;</span> m<span class="token operator">>=</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>            nums1<span class="token punctuation">[</span>pos<span class="token operator">--</span><span class="token punctuation">]</span><span class="token operator">=</span>nums1<span class="token punctuation">[</span>m<span class="token punctuation">]</span><span class="token operator">></span>nums2<span class="token punctuation">[</span>n<span class="token punctuation">]</span><span class="token operator">?</span>nums1<span class="token punctuation">[</span>m<span class="token operator">--</span><span class="token punctuation">]</span><span class="token operator">:</span>nums2<span class="token punctuation">[</span>n<span class="token operator">--</span><span class="token punctuation">]</span><span class="token punctuation">;</span>        <span class="token punctuation">&#125;</span>        <span class="token keyword">while</span><span class="token punctuation">(</span>n<span class="token operator">>=</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>            nums1<span class="token punctuation">[</span>pos<span class="token operator">--</span><span class="token punctuation">]</span><span class="token operator">=</span>nums2<span class="token punctuation">[</span>n<span class="token operator">--</span><span class="token punctuation">]</span><span class="token punctuation">;</span>        <span class="token punctuation">&#125;</span>    <span class="token punctuation">&#125;</span><span class="token punctuation">&#125;</span><span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>时间复杂度<em>O(m+n)<em>，因为指针最多遍历m+n个数，空间复杂度</em>O(1)</em></p><hr><h2 id="142-环形链表-II—（中等）"><a href="#142-环形链表-II—（中等）" class="headerlink" title="142. 环形链表 II—（中等）"></a><a href="https://leetcode-cn.com/problems/linked-list-cycle-ii/">142. 环形链表 II</a>—（中等）</h2><p>给定一个链表，返回链表开始入环的第一个节点。 如果链表无环，则返回 null。</p><p>为了表示给定链表中的环，我们使用整数 pos 来表示链表尾连接到链表中的位置（索引从 0 开始）。 如果 pos 是 -1，则在该链表中没有环。注意，pos 仅仅是用于标识环的情况，并不会作为参数传递到函数中。</p><p>说明：不允许修改给定的链表。</p><p><em>进阶：</em></p><p><em>你是否可以使用 O(1) 空间解决此题？</em></p><blockquote><p>示例：</p><img src="https://p6-tt.byteimg.com/origin/pgc-image/aeba8d5b296441c6a8d25a7bc3e7eb31.png" alt="1" style="zoom:80%;" /><p>输入：head = [3,2,0,-4], pos = 1<br>输出：返回索引为 1 的链表节点<br>解释：链表中有一个环，其尾部连接到第二个节点。</p></blockquote><p>本题第一次做稍微有难度，涉及到一些数学知识</p><p>所使用的是快慢指针，两个指针都是从头结点开始，快指针每次走两格，慢指针每次走一格，如果他们可以相遇，就代表链表是有环的，因为快指针每次走的比慢指针多<code>1</code>格，只要是有环路肯定能相遇</p><p>其次，在第一次相遇后，我们将快指针重置为头结点位置，之后快慢指针<code>同时走</code>，每次都是走<code>1</code>步，直到两指针再一次相遇就是我们要找的环入口了，具体是为什么呢？我们看下面的图</p><img src="https://p5-tt.byteimg.com/origin/pgc-image/c1f26d9f0524448ebd0245449d12eb45.png" alt="code" style="zoom:80%;" /><p>我们设<code>x</code>是头结点到环形入口节点的节点数，<code>y</code>是从入口节点到两个指针第一次相遇的节点的节点数，当第一次两指针在同一个节点相遇时，慢指针走了<code>x+y</code>，快指针走了<code>x+y+n(z+y)</code>其中<code>n(z+y)</code>是在环内多走了<code>n</code>圈</p><p>又因为快指针走的节点数是慢指针的两倍则有方程：<code>2(x+y)=x+y+n(z+y)</code>，化简的出<code>x=n(y+z)-y</code>，从n(y+z)提出一个y+z得出公式：<code>x=(n-1)(y+z)+z</code>，这个时候我们假设<code>n=1</code>，即快指针只用在环内多走一圈就，就可以得出<code>x=z</code></p><p>这样就得出了最终的结论：当两个指针在第一次相遇后，此时相遇节点到环形入口节点长度<code>等于</code>头结点到环形入口长度，那么问题就很容易了，我们随便将一个指针<code>重置</code>回头结点，再让两个指针同时出发，并且每一步只走<code>一格</code>长度，当再次相遇时，位置就是环形入口节点了</p><pre class="line-numbers language-cpp" data-language="cpp"><code class="language-cpp"><span class="token comment">/** * Definition for singly-linked list. * struct ListNode &#123; *     int val; *     ListNode *next; *     ListNode(int x) : val(x), next(NULL) &#123;&#125; * &#125;; */</span><span class="token keyword">class</span> <span class="token class-name">Solution</span> <span class="token punctuation">&#123;</span><span class="token keyword">public</span><span class="token operator">:</span>    ListNode <span class="token operator">*</span><span class="token function">detectCycle</span><span class="token punctuation">(</span>ListNode <span class="token operator">*</span>head<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>        <span class="token keyword">if</span><span class="token punctuation">(</span>head <span class="token operator">==</span> <span class="token keyword">nullptr</span><span class="token operator">||</span>head<span class="token operator">-></span>next<span class="token operator">==</span><span class="token keyword">nullptr</span><span class="token punctuation">)</span>            <span class="token keyword">return</span> <span class="token keyword">nullptr</span><span class="token punctuation">;</span>        ListNode<span class="token operator">*</span> slow <span class="token operator">=</span> head<span class="token punctuation">;</span><span class="token comment">//快指针</span>        ListNode<span class="token operator">*</span> fast <span class="token operator">=</span> head<span class="token punctuation">;</span><span class="token comment">//慢指针</span>        <span class="token comment">//第一次相遇，判断是否有环路</span>        <span class="token keyword">do</span><span class="token punctuation">&#123;</span>            <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token operator">!</span>fast<span class="token operator">||</span><span class="token operator">!</span>fast<span class="token operator">-></span>next<span class="token punctuation">)</span><span class="token keyword">return</span> <span class="token keyword">nullptr</span><span class="token punctuation">;</span>            fast<span class="token operator">=</span>fast<span class="token operator">-></span>next<span class="token operator">-></span>next<span class="token punctuation">;</span>            slow<span class="token operator">=</span>slow<span class="token operator">-></span>next<span class="token punctuation">;</span>        <span class="token punctuation">&#125;</span><span class="token keyword">while</span><span class="token punctuation">(</span>slow<span class="token operator">!=</span>fast<span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token comment">//重置快指针</span>        fast <span class="token operator">=</span> head<span class="token punctuation">;</span>        <span class="token comment">//第二次相遇则是入口</span>        <span class="token keyword">while</span><span class="token punctuation">(</span>fast<span class="token operator">!=</span>slow<span class="token punctuation">)</span><span class="token punctuation">&#123;</span>            fast <span class="token operator">=</span> fast<span class="token operator">-></span>next<span class="token punctuation">;</span>            slow <span class="token operator">=</span> slow<span class="token operator">-></span>next<span class="token punctuation">;</span>        <span class="token punctuation">&#125;</span>        <span class="token keyword">return</span> slow<span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span><span class="token punctuation">&#125;</span><span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>时间复杂度为：<em>O(n)<em>，空间复杂度为</em>O(1)</em></p><hr><h2 id="76-最小覆盖子串—（困难）"><a href="#76-最小覆盖子串—（困难）" class="headerlink" title="76. 最小覆盖子串—（困难）"></a><a href="https://leetcode-cn.com/problems/minimum-window-substring/">76. 最小覆盖子串</a>—（困难）</h2><p>给你一个字符串 s 、一个字符串 t 。返回 s 中涵盖 t 所有字符的最小子串。如果 s 中不存在涵盖 t 所有字符的子串，则返回空字符串 “” 。</p><p>注意：</p><p>对于 t 中重复字符，我们寻找的子字符串中该字符数量必须不少于 t 中该字符数量。<br>如果 s 中存在这样的子串，我们保证它是唯一的答案。</p><p>示例 1：</p><blockquote><p>输入：s = “ADOBECODEBANC”, t = “ABC”<br>输出：”BANC”</p></blockquote><p>示例 2：</p><blockquote><p>输入：s = “a”, t = “a”<br>输出：”a”</p></blockquote><p>示例 3:</p><blockquote><p>输入: s = “a”, t = “aa”<br>输出: “”<br>解释: t 中两个字符 ‘a’ 均应包含在 s 的子串中，<br>因此没有符合条件的子字符串，返回空字符串。</p></blockquote><p>这个题目中要注意的是字符串t是可以包含<em>重复</em>字母的</p><p>所运用的是滑动窗口，由于之前没有做过滑动窗口的题，所以先看了解释才开始做的，更多细节在<a href="https://leetcode-cn.com/problems/minimum-window-substring/solution/zui-xiao-fu-gai-zi-chuan-by-leetcode-solution/">官方解析</a>和视频，滑动窗口图示如下：</p><img src="https://cube-resources.lenovo.com.cn/cube/86cf648e03a1a5daceab2cfbdb802819.gif" alt="滑动窗口" style="zoom:80%;" /><p>首先是运用两个数组，一个是记录滑动窗口中遍历到的t字符串含有的字母个数，而另一个则是记录t字符串每个字母的个数。然后还有个比较重要的就是<code>distance</code>，这个变量是用来记录当前滑动窗口区域中拥有对照字符串t中所需要的字符个数</p><p>整个滑动窗口流程大致是：</p><p>当右指针前进时遍历到一个所需字符则<code>distance+1</code>，直到<code>distance == t.size()</code>时停止前进，<strong>注意当一个字符出现超过所需数但是distance还没达标时，distance不增加</strong>，如下面代码中的<code>winFre[s[right]]&gt;=tFre[s[right]]</code>时distance不会再继续加1。</p><p>之后轮到左指针前进，它会跳过一些多余的字符以尽可能地缩小区域，它也要剔除重复的字符数，当<code>winFre[s[right]]&gt;tFre[s[right]]</code>时distance不会相减，因此<code>distance</code>的作用可以看做是两边字母的边界值。在左指针遇到不能再继续前进时会比较当前最小的覆盖子串区间是否要更新，最后下一次循环中又要恢复为右区间前进，直到右区间到达t字符串的长度才会退出循环。</p><pre class="line-numbers language-cpp" data-language="cpp"><code class="language-cpp"><span class="token keyword">class</span> <span class="token class-name">Solution</span> <span class="token punctuation">&#123;</span><span class="token keyword">public</span><span class="token operator">:</span>    string <span class="token function">minWindow</span><span class="token punctuation">(</span>string s<span class="token punctuation">,</span> string t<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>        <span class="token keyword">int</span> sLen <span class="token operator">=</span> s<span class="token punctuation">.</span><span class="token function">size</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token keyword">int</span> tLen <span class="token operator">=</span> t<span class="token punctuation">.</span><span class="token function">size</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token keyword">if</span><span class="token punctuation">(</span>sLen<span class="token operator">&lt;</span>tLen<span class="token punctuation">)</span>            <span class="token keyword">return</span> <span class="token string">""</span><span class="token punctuation">;</span><span class="token comment">//特殊情况</span>        <span class="token keyword">else</span> <span class="token keyword">if</span><span class="token punctuation">(</span>s<span class="token punctuation">.</span><span class="token function">compare</span><span class="token punctuation">(</span>t<span class="token punctuation">)</span><span class="token operator">==</span><span class="token number">0</span><span class="token punctuation">)</span>            <span class="token keyword">return</span> s<span class="token punctuation">;</span>        <span class="token keyword">int</span> left <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span><span class="token comment">//左指针</span>        <span class="token keyword">int</span> right <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span><span class="token comment">//右指针</span>        vector<span class="token operator">&lt;</span><span class="token keyword">int</span><span class="token operator">></span><span class="token function">winFre</span><span class="token punctuation">(</span><span class="token number">128</span><span class="token punctuation">,</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">//记录滑动窗口中所包含对照字符串每个字母的个数</span>        vector<span class="token operator">&lt;</span><span class="token keyword">int</span><span class="token operator">></span><span class="token function">tFre</span><span class="token punctuation">(</span><span class="token number">128</span><span class="token punctuation">,</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">//记录对照字符串中所含有的每个字母的个数</span>        <span class="token keyword">for</span><span class="token punctuation">(</span><span class="token keyword">char</span> i<span class="token operator">:</span>t<span class="token punctuation">)</span><span class="token punctuation">&#123;</span>            <span class="token comment">//遍历对照字符串t</span>            tFre<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token operator">++</span><span class="token punctuation">;</span>        <span class="token punctuation">&#125;</span>        <span class="token keyword">int</span> begin <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span><span class="token comment">//记录返回字符串的开始下标位置</span>        <span class="token keyword">int</span> minLen <span class="token operator">=</span> sLen<span class="token operator">+</span><span class="token number">10</span><span class="token punctuation">;</span><span class="token comment">//记录当前遍历得到的最小覆盖子串长度</span>        <span class="token keyword">int</span> distance <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span><span class="token comment">//记录滑动窗口中所包含的字母个数和对照字符串所需要的字母个数差距（相同时不加）</span>        <span class="token keyword">while</span><span class="token punctuation">(</span>right<span class="token operator">&lt;</span>sLen<span class="token punctuation">)</span><span class="token punctuation">&#123;</span><span class="token comment">//循环结束条件是右指针到达最后一个字符</span>            <span class="token keyword">if</span><span class="token punctuation">(</span>tFre<span class="token punctuation">[</span>s<span class="token punctuation">[</span>right<span class="token punctuation">]</span><span class="token punctuation">]</span> <span class="token operator">==</span> <span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>                <span class="token comment">//首先是右指针往右走，遇到不是所需要找的字符跳过</span>                right<span class="token operator">++</span><span class="token punctuation">;</span>                <span class="token keyword">continue</span><span class="token punctuation">;</span>            <span class="token punctuation">&#125;</span>            <span class="token keyword">if</span><span class="token punctuation">(</span>winFre<span class="token punctuation">[</span>s<span class="token punctuation">[</span>right<span class="token punctuation">]</span><span class="token punctuation">]</span><span class="token operator">&lt;</span>tFre<span class="token punctuation">[</span>s<span class="token punctuation">[</span>right<span class="token punctuation">]</span><span class="token punctuation">]</span><span class="token punctuation">)</span>                distance<span class="token operator">++</span><span class="token punctuation">;</span><span class="token comment">//滑动窗口遇到不够字母总数时distance加一</span>            winFre<span class="token punctuation">[</span>s<span class="token punctuation">[</span>right<span class="token punctuation">]</span><span class="token punctuation">]</span><span class="token operator">++</span><span class="token punctuation">;</span>            right<span class="token operator">++</span><span class="token punctuation">;</span>            <span class="token keyword">while</span><span class="token punctuation">(</span>distance <span class="token operator">==</span> tLen<span class="token punctuation">)</span><span class="token punctuation">&#123;</span>                <span class="token comment">//滑动窗口左指针前进</span>                <span class="token keyword">if</span><span class="token punctuation">(</span>tFre<span class="token punctuation">[</span>s<span class="token punctuation">[</span>left<span class="token punctuation">]</span><span class="token punctuation">]</span> <span class="token operator">==</span> <span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>                    left<span class="token operator">++</span><span class="token punctuation">;</span>                    <span class="token keyword">continue</span><span class="token punctuation">;</span>                <span class="token punctuation">&#125;</span>                <span class="token keyword">if</span><span class="token punctuation">(</span>winFre<span class="token punctuation">[</span>s<span class="token punctuation">[</span>left<span class="token punctuation">]</span><span class="token punctuation">]</span> <span class="token operator">==</span> tFre<span class="token punctuation">[</span>s<span class="token punctuation">[</span>left<span class="token punctuation">]</span><span class="token punctuation">]</span><span class="token punctuation">)</span>                    distance<span class="token operator">--</span><span class="token punctuation">;</span><span class="token comment">//遇到刚好满足字符数条件时减去distance，以使恢复下一次循环是右指针前进</span>                <span class="token keyword">int</span> tempWinLen <span class="token operator">=</span> right <span class="token operator">-</span> left<span class="token punctuation">;</span><span class="token comment">//当前滑动窗口的字符长度</span>                <span class="token keyword">if</span><span class="token punctuation">(</span>minLen<span class="token operator">></span>tempWinLen<span class="token punctuation">)</span><span class="token punctuation">&#123;</span>                    <span class="token comment">//如果当前记录在内的最小区间没有新的小则替换它</span>                    minLen <span class="token operator">=</span> tempWinLen<span class="token punctuation">;</span>                    begin <span class="token operator">=</span> left<span class="token punctuation">;</span>                <span class="token punctuation">&#125;</span>                                winFre<span class="token punctuation">[</span>s<span class="token punctuation">[</span>left<span class="token punctuation">]</span><span class="token punctuation">]</span><span class="token operator">--</span><span class="token punctuation">;</span>                left<span class="token operator">++</span><span class="token punctuation">;</span>            <span class="token punctuation">&#125;</span>        <span class="token punctuation">&#125;</span>        <span class="token comment">//cout&lt;&lt;begin&lt;&lt;" "&lt;&lt;minLen;</span>        <span class="token keyword">if</span><span class="token punctuation">(</span>minLen <span class="token operator">==</span> sLen <span class="token operator">+</span> <span class="token number">10</span><span class="token punctuation">)</span>            <span class="token keyword">return</span> <span class="token string">""</span><span class="token punctuation">;</span>        <span class="token keyword">else</span>            <span class="token keyword">return</span> s<span class="token punctuation">.</span><span class="token function">substr</span><span class="token punctuation">(</span>begin<span class="token punctuation">,</span>minLen<span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span><span class="token punctuation">&#125;</span><span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>时间复杂度O(n)，空间复杂度O(k)，k为两个传进来的字符串长度之和</p><hr><h2 id="524-通过删除字母匹配到字典里最长单词—（中等）"><a href="#524-通过删除字母匹配到字典里最长单词—（中等）" class="headerlink" title="524. 通过删除字母匹配到字典里最长单词—（中等）"></a><a href="https://leetcode-cn.com/problems/longest-word-in-dictionary-through-deleting/">524. 通过删除字母匹配到字典里最长单词</a>—（中等）</h2><p>给你一个字符串 s 和一个字符串数组 dictionary 作为字典，找出并返回字典中最长的字符串，该字符串可以通过删除 s 中的某些字符得到。</p><p>如果答案不止一个，返回长度最长且字典序最小的字符串。如果答案不存在，则返回空字符串。</p><p>示例 1：</p><blockquote><p>输入：s = “abpcplea”, dictionary = [“ale”,”apple”,”monkey”,”plea”]<br>输出：”apple”</p></blockquote><p>示例 2：</p><blockquote><p>输入：s = “abpcplea”, dictionary = [“a”,”b”,”c”]<br>输出：”a”</p></blockquote><p>注意这里的<code>字典序</code>概念：基于字母顺<em>序</em>排列的单词按字母顺<em>序</em>排列的方法，例：abc &lt; bbc，可以用C++中<code>string</code>类自带的成员函数（非static）<code>a.compare(string&amp; b)</code>来比较</p><p>这道题刚开始想就是普通地把字典中的字符串每个遍历，并作比较是否为s字符串的子串，比较之后再比较字典序。以为这个方法效率不行，想不到官方解答给出最有效率的就是这个了</p><pre class="line-numbers language-cpp" data-language="cpp"><code class="language-cpp"><span class="token keyword">class</span> <span class="token class-name">Solution</span> <span class="token punctuation">&#123;</span><span class="token keyword">public</span><span class="token operator">:</span>    string <span class="token function">findLongestWord</span><span class="token punctuation">(</span>string s<span class="token punctuation">,</span> vector<span class="token operator">&lt;</span>string<span class="token operator">></span><span class="token operator">&amp;</span> dictionary<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>        <span class="token keyword">int</span> sLen <span class="token operator">=</span> s<span class="token punctuation">.</span><span class="token function">size</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token keyword">int</span> dSize <span class="token operator">=</span> dictionary<span class="token punctuation">.</span><span class="token function">size</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        string maxStr <span class="token operator">=</span> <span class="token string">""</span><span class="token punctuation">;</span><span class="token comment">//记录最后要返回的长度最长且字典序最小的字符串</span>        <span class="token keyword">for</span><span class="token punctuation">(</span>string<span class="token operator">&amp;</span> str <span class="token operator">:</span> dictionary<span class="token punctuation">)</span><span class="token punctuation">&#123;</span>            <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token function">IsSubStr</span><span class="token punctuation">(</span>s<span class="token punctuation">,</span>str<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>                <span class="token keyword">if</span><span class="token punctuation">(</span>str<span class="token punctuation">.</span><span class="token function">size</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">></span> maxStr<span class="token punctuation">.</span><span class="token function">size</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">||</span> <span class="token punctuation">(</span>str<span class="token punctuation">.</span><span class="token function">size</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">==</span> maxStr<span class="token punctuation">.</span><span class="token function">size</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">&amp;&amp;</span> str<span class="token punctuation">.</span><span class="token function">compare</span><span class="token punctuation">(</span>maxStr<span class="token punctuation">)</span> <span class="token operator">&lt;</span> <span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">)</span>                    maxStr <span class="token operator">=</span> str<span class="token punctuation">;</span>            <span class="token punctuation">&#125;</span>        <span class="token punctuation">&#125;</span>        <span class="token keyword">return</span> maxStr<span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span>    <span class="token keyword">static</span> <span class="token keyword">bool</span> <span class="token function">IsSubStr</span><span class="token punctuation">(</span>string<span class="token operator">&amp;</span> a<span class="token punctuation">,</span>string<span class="token operator">&amp;</span> b<span class="token punctuation">)</span><span class="token punctuation">&#123;</span>        <span class="token comment">//检测b是不是a的子串</span>        <span class="token keyword">int</span> subSize <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>        <span class="token keyword">int</span> bLen <span class="token operator">=</span> b<span class="token punctuation">.</span><span class="token function">size</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token keyword">for</span><span class="token punctuation">(</span><span class="token keyword">char</span> ch <span class="token operator">:</span> a<span class="token punctuation">)</span><span class="token punctuation">&#123;</span>            <span class="token keyword">if</span><span class="token punctuation">(</span>ch <span class="token operator">==</span> b<span class="token punctuation">[</span>subSize<span class="token punctuation">]</span><span class="token punctuation">)</span>                <span class="token operator">++</span>subSize<span class="token punctuation">;</span>            <span class="token keyword">if</span><span class="token punctuation">(</span>subSize <span class="token operator">==</span> bLen<span class="token punctuation">)</span>                <span class="token keyword">return</span> <span class="token boolean">true</span><span class="token punctuation">;</span>        <span class="token punctuation">&#125;</span>        <span class="token keyword">return</span> <span class="token boolean">false</span><span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span><span class="token punctuation">&#125;</span><span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>时间复杂度为<em>O(n·x)<em>其中n是字典数组长度，x是数组中字符串平均长度，</em>O(x)</em></p><hr><h1 id="二分法"><a href="#二分法" class="headerlink" title="二分法"></a>二分法</h1><h2 id="154-寻找旋转排序数组中的最小值-II—（困难）"><a href="#154-寻找旋转排序数组中的最小值-II—（困难）" class="headerlink" title="154. 寻找旋转排序数组中的最小值 II—（困难）"></a><a href="https://leetcode-cn.com/problems/find-minimum-in-rotated-sorted-array-ii/">154. 寻找旋转排序数组中的最小值 II</a>—（困难）</h2><p>已知一个长度为 n 的数组，预先按照升序排列，经由 1 到 n 次 旋转 后，得到输入数组。例如，原数组 nums = [0,1,4,4,5,6,7] 在变化后可能得到：<br>若旋转 4 次，则可以得到 [4,5,6,7,0,1,4]<br>若旋转 7 次，则可以得到 [0,1,4,4,5,6,7]<br>注意，数组 [a[0], a[1], a[2], …, a[n-1]] 旋转一次 的结果为数组 [a[n-1], a[0], a[1], a[2], …, a[n-2]] 。</p><p>给你一个可能存在 重复 元素值的数组 nums ，它原来是一个升序排列的数组，并按上述情形进行了多次旋转。请你找出并返回数组中的 最小元素 。</p><p><strong>示例 1：</strong></p><blockquote><p>输入：nums = [1,3,5]<br>输出：1</p></blockquote><p><strong>示例 2：</strong></p><blockquote><p>输入：nums = [2,2,2,0,1]<br>输出：0</p></blockquote><p>这道题感觉LeetCode难度分的挺迷的，说是困难其实也没什么难度，也是使用<code>left,mid,right</code>三个指针，只要只要考虑几点就行了</p><p>这里有三种情况，分别是：</p><p>1、<code>nums[mid]</code>小于<code>nums[right]</code>，证明我们要找的最小值在前半段或者是<code>nums[mid]</code>本身，因此我们把<code>right = mid</code></p><p>2、<code>nums[mid]</code>大于<code>nums[right]</code>，证明最小值通过数组旋转给调到有半段去了，而且此时的<code>nums[mid]</code>肯定不是我们要找的数，所以我们将<code>left = mid + 1</code></p><p>3、排除上面两种情况之后，就要考虑数组中有重复的数字，而且可能就是当前指针指着的，我们只需要将右指针往前走就行了<code>--right</code>，至于为什么不是左指针往后走，是因为：</p><ul><li>此操作不会使数组越界：因为迭代条件保证了 right &gt; left &gt;= 0；</li><li>此操作不会使最小值丢失：假设<code>nums[right]</code>是最小值，有两种情况：</li><li>1）若 <code>nums[right]</code> 是唯一最小值：那就不可能满足判断条件 <code>nums[mid] == nums[right]</code>，因为 <code>mid &lt; right</code>（left != right  且 mid = (left + right) / 2 向下取整）；</li><li>2）若 nums[right] 不是唯一最小值，由于<code> mid &lt; right</code> 而 <code>nums[mid] == nums[right]</code>，即还有最小值存在于 <code>[left, right - 1]</code>区间，因此不会丢失最小值。</li></ul><pre class="line-numbers language-csharp" data-language="csharp"><code class="language-csharp"><span class="token keyword">class</span> <span class="token class-name">Solution</span> <span class="token punctuation">&#123;</span>    <span class="token keyword">public</span><span class="token punctuation">:</span>    <span class="token return-type class-name"><span class="token keyword">int</span></span> <span class="token function">findMin</span><span class="token punctuation">(</span>vector<span class="token operator">&lt;</span><span class="token keyword">int</span><span class="token operator">></span><span class="token operator">&amp;</span> nums<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>        <span class="token class-name"><span class="token keyword">int</span></span> nLen <span class="token operator">=</span> nums<span class="token punctuation">.</span><span class="token function">size</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token class-name"><span class="token keyword">int</span></span> left <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>        <span class="token class-name"><span class="token keyword">int</span></span> right <span class="token operator">=</span> nLen <span class="token operator">-</span> <span class="token number">1</span><span class="token punctuation">;</span>        <span class="token class-name"><span class="token keyword">int</span></span> mid <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>        <span class="token keyword">while</span><span class="token punctuation">(</span>left <span class="token operator">&lt;</span> right<span class="token punctuation">)</span><span class="token punctuation">&#123;</span>            mid <span class="token operator">=</span> <span class="token punctuation">(</span>left <span class="token operator">+</span> right<span class="token punctuation">)</span> <span class="token operator">>></span> <span class="token number">1</span><span class="token punctuation">;</span>            <span class="token keyword">if</span><span class="token punctuation">(</span>nums<span class="token punctuation">[</span>mid<span class="token punctuation">]</span> <span class="token operator">&lt;</span> nums<span class="token punctuation">[</span>right<span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>                <span class="token comment">//前半部分是增序序列</span>                right <span class="token operator">=</span> mid<span class="token punctuation">;</span>            <span class="token punctuation">&#125;</span><span class="token keyword">else</span> <span class="token keyword">if</span><span class="token punctuation">(</span>nums<span class="token punctuation">[</span>mid<span class="token punctuation">]</span> <span class="token operator">></span> nums<span class="token punctuation">[</span>right<span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>                <span class="token comment">//后半部分为降序序列</span>                left <span class="token operator">=</span> mid <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">;</span>            <span class="token punctuation">&#125;</span><span class="token keyword">else</span><span class="token punctuation">&#123;</span>                <span class="token operator">--</span>right<span class="token punctuation">;</span>            <span class="token punctuation">&#125;</span>        <span class="token punctuation">&#125;</span>        <span class="token keyword">return</span> nums<span class="token punctuation">[</span>left<span class="token punctuation">]</span><span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span>   <span class="token punctuation">&#125;</span><span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>时间复杂度 O(logN)，最坏情况也只到 O(N)，比如给定的数组每个数字都是一样的 {1,1,1,1,1}</p><hr><h2 id="540-有序数组中的单一元素—（中等）"><a href="#540-有序数组中的单一元素—（中等）" class="headerlink" title="540. 有序数组中的单一元素—（中等）"></a><a href="https://leetcode-cn.com/problems/single-element-in-a-sorted-array/">540. 有序数组中的单一元素</a>—（中等）</h2><p>给定一个只包含整数的有序数组，每个元素都会出现两次，唯有一个数只会出现一次，找出这个数。</p><p>示例 1:</p><blockquote><p>输入: nums = [1,1,2,3,3,4,4,8,8]<br>输出: 2</p></blockquote><p>示例 2:</p><blockquote><p>输入: nums =  [3,3,7,7,10,11,11]<br>输出: 10</p></blockquote><p><strong>提示:</strong></p><ul><li><code>1 &lt;= nums.length &lt;= 105</code></li><li><code>0 &lt;= nums[i] &lt;= 105</code></li></ul><p>这道题可以观察题意发现，在出现独立数之前，数组的下标都是有规律的，偶数（包含0）对应一对重复数的第一个，奇数对应第二个。一旦独立数出现之后，情况就反过来了</p><p>总体上看的话，整个数组肯定是奇数个的，因为其余重复数是偶数个再加上一个独立数就是奇数个</p><p>因此可以看下面的例子，当我们把一个数组的中中间的一对元素移除之后，剩下左边的数组全是重复的元素，个数为偶数；而右边含有一个独立数元素，个数为奇数。</p><p><img src="https://i.loli.net/2021/07/31/njUaBzt62Sv5OIf.png" alt="1.png"></p><p>此时我们就可以通过判断左右子数组含有元素的个数是奇还是偶来进行下一步往哪边判断</p><p>下面有几种情况我们可以来分析一下，假设左指针是<code>lo</code>，右指针是<code>hi</code></p><p>情况1：</p><p>中间元素的同一元素在右边，且被 mid 分成两半的数组为偶数。</p><p>我们将右子数组的第一个元素移除后，则右子数组元素个数变成奇数，我们应将 <code>lo</code> 设置为 <code>mid + 2</code></p><p><img src="https://i.loli.net/2021/07/31/bnv7lY6X3uTIWw9.png" alt="2.jpg"></p><p>情况2：</p><p>中间元素的同一元素在右边，且被 <code>mid</code> 分成两半的数组为奇数。</p><p>我们将右子数组的第一个元素移除后，则右子数组的元素个数变为偶数，我们应将 <code>hi</code> 设置为 <code>mid - 1</code></p><p><img src="https://i.loli.net/2021/07/31/mfnQIPMUGhT5sED.png" alt="3.png"></p><p>例子 3：中间元素的同一元素在左边，且被 mid 分成两半的数组为偶数。</p><p>我们将左子数组的最后一个元素移除后，则左子数组的元素个数变为奇数，我们应将 hi 设置为 mid - 2。</p><p><img src="https://i.loli.net/2021/07/31/25rqAzunOkFvGPU.png" alt="4.png"></p><p>例子 4：中间元素的同一元素在左边，且被 mid 分成两半的数组为奇数。</p><p>我们将左子数组的最后一个元素移除后，则左子数组的元素个数变为偶数，我们应将 lo 设置为 mid + 1。</p><p><img src="https://i.loli.net/2021/07/31/xSkLFir6aE1oIPc.png" alt="5.png"></p><p>还有最后一种情况，就是刚好我们的中间指针指向的数和前面后面的数都不相等，就代表这个数就是我们要找的独立数了，这个时候就可以直接return</p><p>明白原理之后就可以写代码了</p><pre class="line-numbers language-cpp" data-language="cpp"><code class="language-cpp"><span class="token keyword">class</span> <span class="token class-name">Solution</span> <span class="token punctuation">&#123;</span><span class="token keyword">public</span><span class="token operator">:</span>    <span class="token keyword">int</span> <span class="token function">singleNonDuplicate</span><span class="token punctuation">(</span>vector<span class="token operator">&lt;</span><span class="token keyword">int</span><span class="token operator">></span><span class="token operator">&amp;</span> nums<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>        <span class="token comment">//O(log n)时间复杂度方法</span>        <span class="token keyword">int</span> nLen <span class="token operator">=</span> nums<span class="token punctuation">.</span><span class="token function">size</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token keyword">if</span><span class="token punctuation">(</span>nLen <span class="token operator">==</span> <span class="token number">1</span><span class="token punctuation">)</span>            <span class="token keyword">return</span> nums<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">;</span><span class="token comment">//只有一个数直接返回</span>        <span class="token keyword">int</span> left <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>        <span class="token keyword">int</span> right <span class="token operator">=</span> nLen <span class="token operator">-</span> <span class="token number">1</span><span class="token punctuation">;</span>        <span class="token keyword">int</span> mid <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>        <span class="token keyword">while</span><span class="token punctuation">(</span>left <span class="token operator">&lt;</span> right<span class="token punctuation">)</span><span class="token punctuation">&#123;</span>            mid <span class="token operator">=</span> <span class="token punctuation">(</span>left <span class="token operator">+</span> right<span class="token punctuation">)</span><span class="token operator">>></span><span class="token number">1</span><span class="token punctuation">;</span>            <span class="token keyword">if</span><span class="token punctuation">(</span>nums<span class="token punctuation">[</span>mid<span class="token punctuation">]</span> <span class="token operator">==</span> nums<span class="token punctuation">[</span>mid <span class="token operator">-</span> <span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>                <span class="token comment">//中间指针的数与前一个数相等</span>                mid<span class="token operator">--</span><span class="token punctuation">;</span><span class="token comment">//中间指针后退以便计算左边子数组的个数</span>                <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token punctuation">(</span>mid<span class="token operator">-</span>left<span class="token punctuation">)</span><span class="token operator">%</span><span class="token number">2</span> <span class="token operator">==</span> <span class="token number">0</span><span class="token punctuation">)</span><span class="token comment">//左边是偶数的话唯一数在右边</span>                    left <span class="token operator">=</span> mid <span class="token operator">+</span> <span class="token number">2</span><span class="token punctuation">;</span>                <span class="token keyword">else</span><span class="token comment">//否则唯一数在左边</span>                    right <span class="token operator">=</span> mid <span class="token operator">-</span> <span class="token number">1</span><span class="token punctuation">;</span>            <span class="token punctuation">&#125;</span><span class="token keyword">else</span> <span class="token keyword">if</span><span class="token punctuation">(</span>nums<span class="token punctuation">[</span>mid<span class="token punctuation">]</span><span class="token operator">==</span>nums<span class="token punctuation">[</span>mid<span class="token operator">+</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>                <span class="token comment">//中间指针和后面一个数相等的话</span>                mid<span class="token operator">++</span><span class="token punctuation">;</span><span class="token comment">//中间指针前进一格，以便计算右边子数组的个数</span>                <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token punctuation">(</span>right <span class="token operator">-</span> mid<span class="token punctuation">)</span><span class="token operator">%</span><span class="token number">2</span> <span class="token operator">==</span> <span class="token number">0</span><span class="token punctuation">)</span>                    right <span class="token operator">=</span> mid <span class="token operator">-</span><span class="token number">2</span><span class="token punctuation">;</span>                <span class="token keyword">else</span>                    left <span class="token operator">=</span> mid <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">;</span>            <span class="token punctuation">&#125;</span><span class="token keyword">else</span><span class="token punctuation">&#123;</span>                <span class="token comment">//中间数与前后的数都不相等，代表我们找到了要的那个数</span>                <span class="token keyword">return</span> nums<span class="token punctuation">[</span>mid<span class="token punctuation">]</span><span class="token punctuation">;</span>            <span class="token punctuation">&#125;</span>        <span class="token punctuation">&#125;</span>        <span class="token keyword">return</span> nums<span class="token punctuation">[</span>left<span class="token punctuation">]</span><span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span><span class="token punctuation">&#125;</span><span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>这个算法时间复杂度为O(log n)，空间复杂度为O(1)</p><p>在此题目的官方题解中还有第三种解法，<a href="https://leetcode-cn.com/problems/single-element-in-a-sorted-array/solution/you-xu-shu-zu-zhong-de-dan-yi-yuan-su-by-leetcode/"><strong>方法三：仅对偶数索引进行二分搜索</strong></a>，这个解法时间复杂度为O(n/2) = O(n)，比起上面的算法更优雅一些，可以去看一下</p><hr><h1 id="排序算法"><a href="#排序算法" class="headerlink" title="排序算法"></a>排序算法</h1><p>排序要懂得常用的那几个排序，同时还要求可以默写出来，此后会有专门的文章来记录各种常用的排序算法的代码，这里暂时跳过，直接看一个基于快速排序的<strong>快速选择算法</strong>题目</p><h2 id="215-数组中的第K个最大元素—（中等）"><a href="#215-数组中的第K个最大元素—（中等）" class="headerlink" title="215. 数组中的第K个最大元素—（中等）"></a><a href="https://leetcode-cn.com/problems/kth-largest-element-in-an-array/">215. 数组中的第K个最大元素</a>—（中等）</h2><p>给定整数数组 nums 和整数 k，请返回数组中第 k 个最大的元素。</p><p>请注意，你需要找的是数组排序后的第 k 个最大的元素，而不是第 k 个不同的元素。</p><p>示例 1:</p><blockquote><p>输入: [3,2,1,5,6,4] 和 k = 2<br>输出: 5</p></blockquote><p>示例 2:</p><blockquote><p>输入: [3,2,3,1,2,4,5,5,6] 和 k = 4<br>输出: 4</p></blockquote><p><strong>提示：</strong></p><ul><li><code>1 &lt;= k &lt;= nums.length &lt;= 104</code></li><li><code>-104 &lt;= nums[i] &lt;= 104</code></li></ul><p>遇到这种寻找数组中第x个最大（小）元素的题目，我们都可以用快速选择的方法来解决</p><p>因为我们只用找某个第x个最大（小）的数，因此并不用对整个数组排序，从而把快速排序的O(n*log n)的平均时间复杂度降到O(n)，但是要注意的是最差情况下还是可能O(n^2)</p><p>快速排序是一种分治算法，而快速选择也类似，假设这里有一个数组<strong>a[l…r]<strong>，我们要找到数组</strong>第k大</strong>的数，快速选择可以分为以下步骤：</p><ul><li><strong>分解</strong>：将数组分为a[l…q-1]，a[q]，a[q+1…r]，其中左半边的子数组a[l…q-1]每一个元素都小于等于a[q]，而对于右半边的子数组，a[q]都会小于等于右半边子数组的每一个元素</li><li><strong>解决</strong>：不像快速排序，我们不用把左右两边子数组进行排序，只用处理好a[q]两边子数组满足<code>分解</code>步骤的要求就行了。因为当分解好后，a[q]在数组中的位置就是我们快排后最终它所在的位置，当分解到a[q]的下标q正好是我们要找的下标时就直接return a[q]</li></ul><p>时间复杂度：</p><p>我们知道快速排序的性能和「划分」出的子数组的长度密切相关。直观地理解如果每次规模为 n 的问题我们都划分成 1和 n - 1，每次递归的时候又向 n - 1 的集合中递归，这种情况是最坏的，时间代价是 O(n ^ 2)<br> )。我们可以引入随机化来加速这个过程，它的时间代价的期望是 O(n)，证明过程可以参考「《算法导论》9.2：期望为线性的选择算法」。</p><pre class="line-numbers language-cpp" data-language="cpp"><code class="language-cpp"><span class="token keyword">class</span> <span class="token class-name">Solution</span> <span class="token punctuation">&#123;</span><span class="token keyword">public</span><span class="token operator">:</span>    <span class="token keyword">inline</span> <span class="token keyword">int</span> <span class="token function">QuickSelect</span><span class="token punctuation">(</span>vector<span class="token operator">&lt;</span><span class="token keyword">int</span><span class="token operator">></span><span class="token operator">&amp;</span> nums<span class="token punctuation">,</span><span class="token keyword">int</span> left<span class="token punctuation">,</span><span class="token keyword">int</span> right<span class="token punctuation">)</span><span class="token punctuation">&#123;</span>        <span class="token keyword">int</span> i<span class="token operator">=</span>left<span class="token operator">+</span><span class="token number">1</span><span class="token punctuation">;</span><span class="token comment">//nums[l]是哨兵数</span>        <span class="token keyword">int</span> j<span class="token operator">=</span>right<span class="token punctuation">;</span>        <span class="token keyword">while</span><span class="token punctuation">(</span><span class="token boolean">true</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>            <span class="token keyword">while</span><span class="token punctuation">(</span>right<span class="token operator">></span>i<span class="token operator">&amp;&amp;</span>nums<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token operator">&lt;=</span>nums<span class="token punctuation">[</span>left<span class="token punctuation">]</span><span class="token punctuation">)</span>                <span class="token operator">++</span>i<span class="token punctuation">;</span>            <span class="token keyword">while</span><span class="token punctuation">(</span>j<span class="token operator">></span>left<span class="token operator">&amp;&amp;</span>nums<span class="token punctuation">[</span>j<span class="token punctuation">]</span><span class="token operator">>=</span>nums<span class="token punctuation">[</span>left<span class="token punctuation">]</span><span class="token punctuation">)</span>                <span class="token operator">--</span>j<span class="token punctuation">;</span>            <span class="token keyword">if</span><span class="token punctuation">(</span>i<span class="token operator">>=</span>j<span class="token punctuation">)</span><span class="token keyword">break</span><span class="token punctuation">;</span>            <span class="token function">swap</span><span class="token punctuation">(</span>nums<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">,</span>nums<span class="token punctuation">[</span>j<span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token punctuation">&#125;</span>        <span class="token function">swap</span><span class="token punctuation">(</span>nums<span class="token punctuation">[</span>left<span class="token punctuation">]</span><span class="token punctuation">,</span>nums<span class="token punctuation">[</span>j<span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token keyword">return</span> j<span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span>    <span class="token keyword">int</span> <span class="token function">findKthLargest</span><span class="token punctuation">(</span>vector<span class="token operator">&lt;</span><span class="token keyword">int</span><span class="token operator">></span><span class="token operator">&amp;</span> nums<span class="token punctuation">,</span> <span class="token keyword">int</span> k<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>        <span class="token keyword">int</span> l <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>        <span class="token keyword">int</span> r <span class="token operator">=</span> nums<span class="token punctuation">.</span><span class="token function">size</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">;</span>        <span class="token keyword">int</span> traget <span class="token operator">=</span> nums<span class="token punctuation">.</span><span class="token function">size</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">-</span>k<span class="token punctuation">;</span><span class="token comment">//目标</span>        <span class="token keyword">while</span><span class="token punctuation">(</span>l <span class="token operator">&lt;</span> r<span class="token punctuation">)</span><span class="token punctuation">&#123;</span>            <span class="token keyword">int</span> mid <span class="token operator">=</span> <span class="token function">QuickSelect</span><span class="token punctuation">(</span>nums<span class="token punctuation">,</span>l<span class="token punctuation">,</span>r<span class="token punctuation">)</span><span class="token punctuation">;</span>            <span class="token keyword">if</span><span class="token punctuation">(</span>mid<span class="token operator">==</span>traget<span class="token punctuation">)</span>                <span class="token keyword">return</span> nums<span class="token punctuation">[</span>mid<span class="token punctuation">]</span><span class="token punctuation">;</span>            <span class="token keyword">if</span><span class="token punctuation">(</span>mid <span class="token operator">&lt;</span> traget<span class="token punctuation">)</span><span class="token comment">//目标在右边子数组</span>                l<span class="token operator">=</span>mid<span class="token operator">+</span><span class="token number">1</span><span class="token punctuation">;</span>            <span class="token keyword">else</span><span class="token comment">//目标在左边子数组</span>                r<span class="token operator">=</span>mid<span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">;</span>        <span class="token punctuation">&#125;</span>        <span class="token keyword">return</span> nums<span class="token punctuation">[</span>l<span class="token punctuation">]</span><span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span><span class="token punctuation">&#125;</span><span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><hr><h1 id="搜索"><a href="#搜索" class="headerlink" title="搜索"></a>搜索</h1><p>搜索一般分为<strong>深度优先搜索（DFS）</strong>和<strong>广度优先搜索（BFS）</strong>，它们被广泛运用在图和树等结构中</p><p><strong>深度优先搜索（depth-first seach， DFS）</strong>：在搜索到一个新的节点时，立即对该新节点进行遍<br>历；因此遍历需要用<strong>先入后出的栈</strong>来实现，也可以通过与栈等价的<strong>递归</strong>来实现。对于树结构而言，<br>由于总是对新节点调用遍历，因此看起来是向着“深”的方向前进。  </p><p><strong>深度优先搜索</strong>也可以用来<strong>检测环路</strong>：记录每个遍历过的节点的父节点，若一个节点被再次遍<br>历且父节点不同，则说明有环。我们也可以用之后会讲到的拓扑排序判断是否有环路，若最后存<br>在入度不为零的点，则说明有环。<br>有时我们可能会需要对已经搜索过的节点进行标记，以防止在遍历时重复搜索某个节点，这<br>种做法叫做<strong>状态记录</strong>或<strong>记忆化（memoization）</strong>。  </p><p><strong>广度优先搜索（breadth-first search， BFS）</strong>：不同与深度优先搜索，它是一层层进行遍历的，因<br>此需要用<strong>先入先出的队列</strong>而非先入后出的栈进行遍历。由于是按层次进行遍历，广度优先搜索时<br>按照“广”的方向进行遍历的，也常常用来处理最短路径等问题。  </p><p>这里要注意，深度优先搜索和广度优先搜索都可以处理<strong>可达性</strong>问题，即从一个节点开始是否<br>能达到另一个节点。因为深度优先搜索可以利用递归快速实现，很多人会习惯使用深度优先搜索<br>刷此类题目。实际软件工程中，很少见到递归的写法，因为一方面难以理解，另一方面可能<br>产生栈溢出的情况；而用栈实现的深度优先搜索和用队列实现的广度优先搜索在写法上并没有太<br>大差异，因此使用哪一种搜索方式需要根据实际的功能需求来判断。  </p><h2 id="934-最短的桥—（中等）"><a href="#934-最短的桥—（中等）" class="headerlink" title="934. 最短的桥—（中等）"></a><a href="https://leetcode-cn.com/problems/shortest-bridge/">934. 最短的桥</a>—（中等）</h2><p>在给定的二维二进制数组 A 中，存在两座岛。（岛是由四面相连的 1 形成的一个最大组。）</p><p>现在，我们可以将 <code>0</code> 变为 <code>1</code>，以使两座岛连接起来，变成一座岛。</p><p>返回必须翻转的 <code>0</code> 的最小数目。（可以保证答案至少是 <code>1 </code>）</p><p>示例 1：</p><blockquote><p>输入：A = [[0,1],[1,0]]<br>输出：1</p></blockquote><p>示例 2：</p><blockquote><p>输入：A = [[0,1,0],[0,0,0],[0,0,1]]<br>输出：2</p></blockquote><p>示例 3：</p><blockquote><p>输入：A = [[1,1,1,1,1],[1,0,0,0,1],[1,0,1,0,1],[1,0,0,0,1],[1,1,1,1,1]]<br>输出：1</p></blockquote><p>示例4：</p><blockquote><p>输入：<br>[[1,1,1,1,1],<br>[1,0,0,0,1],<br>[1,0,1,0,1],<br>[1,0,0,0,1],<br>[1,1,1,1,1]]<br>输出：1  </p></blockquote><p><strong>提示：</strong></p><ul><li><code>2 &lt;= A.length == A[0].length &lt;= 100</code></li><li><code>A[i][j] == 0</code> 或 <code>A[i][j] == 1</code></li></ul><p>岛屿问题一般都是与dfs有关系，大多都是套模板</p><p>这里有题目得知一共有两个岛屿，其余的都是水，这里用示例4来说</p><p>刚开始两座岛屿是隔开的，因此我们可以先遍历其中一个岛屿，并把整个岛屿遍历完，同时边遍历边把这个岛的<code>1</code>改成<code>2</code>作为标记</p><p>当把这个岛全部遍历完时，此时地图上有三个部分，分别是：岛屿1、岛屿2和水</p><p>紧接着再选择一个岛屿（这里假设选择岛屿1），使用广度搜索层层遍历，当第一次遇到岛屿2时走过的层数就是最短桥</p><p>代码有点多，大致分为四个步骤</p><pre class="line-numbers language-cpp" data-language="cpp"><code class="language-cpp"><span class="token keyword">class</span> <span class="token class-name">Solution</span> <span class="token punctuation">&#123;</span><span class="token keyword">public</span><span class="token operator">:</span>    <span class="token keyword">int</span> direction<span class="token punctuation">[</span><span class="token number">4</span><span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token number">2</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token punctuation">&#123;</span><span class="token punctuation">&#123;</span><span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">,</span><span class="token number">0</span><span class="token punctuation">&#125;</span><span class="token punctuation">,</span><span class="token punctuation">&#123;</span><span class="token number">0</span><span class="token punctuation">,</span><span class="token number">1</span><span class="token punctuation">&#125;</span><span class="token punctuation">,</span><span class="token punctuation">&#123;</span><span class="token number">1</span><span class="token punctuation">,</span><span class="token number">0</span><span class="token punctuation">&#125;</span><span class="token punctuation">,</span><span class="token punctuation">&#123;</span><span class="token number">0</span><span class="token punctuation">,</span><span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">&#125;</span><span class="token punctuation">&#125;</span><span class="token punctuation">;</span><span class="token comment">//方向数组</span>    <span class="token keyword">int</span> <span class="token function">shortestBridge</span><span class="token punctuation">(</span>vector<span class="token operator">&lt;</span>vector<span class="token operator">&lt;</span><span class="token keyword">int</span><span class="token operator">>></span><span class="token operator">&amp;</span> map<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>        <span class="token comment">//步骤1：遍历一个岛，把1改成2作为标记</span>        <span class="token comment">//dfs</span>        <span class="token keyword">int</span> findFlag <span class="token operator">=</span> <span class="token boolean">false</span><span class="token punctuation">;</span><span class="token comment">//记录是否找到岛屿了</span>        <span class="token keyword">for</span><span class="token punctuation">(</span><span class="token keyword">int</span> i<span class="token operator">=</span><span class="token number">0</span><span class="token punctuation">;</span>i<span class="token operator">&lt;</span>map<span class="token punctuation">.</span><span class="token function">size</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token operator">++</span>i<span class="token punctuation">)</span><span class="token punctuation">&#123;</span>            <span class="token comment">//第一层</span>            <span class="token keyword">for</span><span class="token punctuation">(</span><span class="token keyword">int</span> j<span class="token operator">=</span><span class="token number">0</span><span class="token punctuation">;</span>j<span class="token operator">&lt;</span>map<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">.</span><span class="token function">size</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token operator">++</span>j<span class="token punctuation">)</span><span class="token punctuation">&#123;</span>                <span class="token comment">//第二层</span>                <span class="token keyword">if</span><span class="token punctuation">(</span>map<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">[</span>j<span class="token punctuation">]</span><span class="token operator">==</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>                    <span class="token comment">//找到了岛屿</span>                    map<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">[</span>j<span class="token punctuation">]</span><span class="token operator">=</span><span class="token number">2</span><span class="token punctuation">;</span>                    <span class="token function">dfs</span><span class="token punctuation">(</span>map<span class="token punctuation">,</span>i<span class="token punctuation">,</span>j<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">//步骤2：深度搜索同时把当前整个大陆涂上2</span>                    findFlag <span class="token operator">=</span> <span class="token boolean">true</span><span class="token punctuation">;</span><span class="token comment">//找到岛屿，标记以便退出循环，因为找到一块其它相连的都会在dfs中涂上2</span>                    <span class="token keyword">break</span><span class="token punctuation">;</span><span class="token comment">//找到后就退出了</span>                <span class="token punctuation">&#125;</span>            <span class="token punctuation">&#125;</span>            <span class="token keyword">if</span><span class="token punctuation">(</span>findFlag<span class="token punctuation">)</span>                <span class="token keyword">break</span><span class="token punctuation">;</span>        <span class="token punctuation">&#125;</span>        <span class="token comment">// 此时，连通块已涂色，分为三块，0是水，1和2代表两个连通块（岛1和岛2）</span>        <span class="token comment">//步骤3：再选择一个岛屿（这里选择岛屿1），为广度搜索队列做准备而入列</span>        <span class="token keyword">int</span> step<span class="token operator">=</span><span class="token number">0</span><span class="token punctuation">;</span><span class="token comment">//记录层数，最终返回的答案</span>        queue<span class="token operator">&lt;</span>pair<span class="token operator">&lt;</span><span class="token keyword">int</span><span class="token punctuation">,</span><span class="token keyword">int</span><span class="token operator">>></span> qMap<span class="token punctuation">;</span><span class="token comment">//选择pair是为了存储坐标</span>        <span class="token keyword">for</span><span class="token punctuation">(</span><span class="token keyword">int</span> i<span class="token operator">=</span><span class="token number">0</span><span class="token punctuation">;</span>i<span class="token operator">&lt;</span>map<span class="token punctuation">.</span><span class="token function">size</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token operator">++</span>i<span class="token punctuation">)</span>            <span class="token keyword">for</span><span class="token punctuation">(</span><span class="token keyword">int</span> j<span class="token operator">=</span><span class="token number">0</span><span class="token punctuation">;</span>j<span class="token operator">&lt;</span>map<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">.</span><span class="token function">size</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token operator">++</span>j<span class="token punctuation">)</span>                <span class="token keyword">if</span><span class="token punctuation">(</span>map<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">[</span>j<span class="token punctuation">]</span><span class="token operator">==</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token comment">//把岛屿1的点坐标全部入列</span>                    qMap<span class="token punctuation">.</span><span class="token function">push</span><span class="token punctuation">(</span><span class="token function">make_pair</span><span class="token punctuation">(</span>i<span class="token punctuation">,</span>j<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token comment">//步骤4：广度搜索队列中的岛屿，层层推进向外扩张</span>        <span class="token keyword">while</span><span class="token punctuation">(</span><span class="token operator">!</span>qMap<span class="token punctuation">.</span><span class="token function">empty</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span><span class="token comment">//队列不为空就在循环内</span>            <span class="token keyword">int</span> size <span class="token operator">=</span> qMap<span class="token punctuation">.</span><span class="token function">size</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">//当前层要遍历的次数</span>            <span class="token keyword">for</span><span class="token punctuation">(</span><span class="token keyword">int</span> i<span class="token operator">=</span><span class="token number">0</span><span class="token punctuation">;</span>i<span class="token operator">&lt;</span>size<span class="token punctuation">;</span><span class="token operator">++</span>i<span class="token punctuation">)</span><span class="token punctuation">&#123;</span>                pair<span class="token operator">&lt;</span><span class="token keyword">int</span><span class="token punctuation">,</span><span class="token keyword">int</span><span class="token operator">></span> cur <span class="token operator">=</span> qMap<span class="token punctuation">.</span><span class="token function">front</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>                <span class="token keyword">int</span> x<span class="token operator">=</span>cur<span class="token punctuation">.</span>first<span class="token punctuation">;</span>                <span class="token keyword">int</span> y<span class="token operator">=</span>cur<span class="token punctuation">.</span>second<span class="token punctuation">;</span>                qMap<span class="token punctuation">.</span><span class="token function">pop</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>                <span class="token keyword">for</span><span class="token punctuation">(</span><span class="token keyword">int</span> index<span class="token operator">=</span><span class="token number">0</span><span class="token punctuation">;</span>index<span class="token operator">&lt;</span><span class="token number">4</span><span class="token punctuation">;</span><span class="token operator">++</span>index<span class="token punctuation">)</span><span class="token punctuation">&#123;</span>                    <span class="token comment">//向四周扩散</span>                    <span class="token keyword">int</span> x_next<span class="token operator">=</span>x<span class="token operator">+</span>direction<span class="token punctuation">[</span>index<span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">;</span>                    <span class="token keyword">int</span> y_next<span class="token operator">=</span>y<span class="token operator">+</span>direction<span class="token punctuation">[</span>index<span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">;</span>                    <span class="token keyword">if</span><span class="token punctuation">(</span>x_next<span class="token operator">>=</span><span class="token number">0</span><span class="token operator">&amp;&amp;</span>y_next<span class="token operator">>=</span><span class="token number">0</span><span class="token operator">&amp;&amp;</span>x_next<span class="token operator">&lt;</span>map<span class="token punctuation">.</span><span class="token function">size</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">&amp;&amp;</span>y_next<span class="token operator">&lt;</span>map<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">.</span><span class="token function">size</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>                        <span class="token keyword">if</span><span class="token punctuation">(</span>map<span class="token punctuation">[</span>x_next<span class="token punctuation">]</span><span class="token punctuation">[</span>y_next<span class="token punctuation">]</span><span class="token operator">==</span><span class="token number">2</span><span class="token punctuation">)</span><span class="token comment">//找到岛屿2，可以返回了</span>                            <span class="token keyword">return</span> step<span class="token punctuation">;</span>                        <span class="token keyword">else</span> <span class="token keyword">if</span><span class="token punctuation">(</span>map<span class="token punctuation">[</span>x_next<span class="token punctuation">]</span><span class="token punctuation">[</span>y_next<span class="token punctuation">]</span><span class="token operator">==</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token comment">//遍历的还是当前岛屿的版块，继续搜索</span>                            <span class="token keyword">continue</span><span class="token punctuation">;</span>                        <span class="token keyword">else</span><span class="token punctuation">&#123;</span>                            <span class="token comment">//遍历的是海洋</span>                            qMap<span class="token punctuation">.</span><span class="token function">push</span><span class="token punctuation">(</span><span class="token function">make_pair</span><span class="token punctuation">(</span>x_next<span class="token punctuation">,</span>y_next<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">//入队列</span>                            map<span class="token punctuation">[</span>x_next<span class="token punctuation">]</span><span class="token punctuation">[</span>y_next<span class="token punctuation">]</span><span class="token operator">=</span><span class="token number">1</span><span class="token punctuation">;</span><span class="token comment">//涂色，防止遍历重复</span>                        <span class="token punctuation">&#125;</span>                    <span class="token punctuation">&#125;</span>                <span class="token punctuation">&#125;</span>            <span class="token punctuation">&#125;</span>            step<span class="token operator">++</span><span class="token punctuation">;</span><span class="token comment">//遍历一层结束，答案加一</span>        <span class="token punctuation">&#125;</span>        <span class="token keyword">return</span> <span class="token number">0</span><span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span>    <span class="token comment">//深度搜索，将整块大陆的1改成2</span>    <span class="token keyword">void</span> <span class="token function">dfs</span><span class="token punctuation">(</span>vector<span class="token operator">&lt;</span>vector<span class="token operator">&lt;</span><span class="token keyword">int</span><span class="token operator">>></span><span class="token operator">&amp;</span> map<span class="token punctuation">,</span><span class="token keyword">int</span> x<span class="token punctuation">,</span><span class="token keyword">int</span> y<span class="token punctuation">)</span><span class="token punctuation">&#123;</span>        <span class="token keyword">for</span><span class="token punctuation">(</span><span class="token keyword">int</span> index<span class="token operator">=</span><span class="token number">0</span><span class="token punctuation">;</span>index<span class="token operator">&lt;</span><span class="token number">4</span><span class="token punctuation">;</span><span class="token operator">++</span>index<span class="token punctuation">)</span><span class="token punctuation">&#123;</span>            <span class="token comment">//往四个方向扩张</span>            <span class="token keyword">int</span> x_next<span class="token operator">=</span>x<span class="token operator">+</span>direction<span class="token punctuation">[</span>index<span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">;</span>            <span class="token keyword">int</span> y_next<span class="token operator">=</span>y<span class="token operator">+</span>direction<span class="token punctuation">[</span>index<span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">;</span>            <span class="token keyword">if</span><span class="token punctuation">(</span>x_next<span class="token operator">>=</span><span class="token number">0</span><span class="token operator">&amp;&amp;</span>y_next<span class="token operator">>=</span><span class="token number">0</span><span class="token operator">&amp;&amp;</span>x_next<span class="token operator">&lt;</span>map<span class="token punctuation">.</span><span class="token function">size</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">&amp;&amp;</span>y_next<span class="token operator">&lt;</span>map<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">.</span><span class="token function">size</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">&amp;&amp;</span>map<span class="token punctuation">[</span>x_next<span class="token punctuation">]</span><span class="token punctuation">[</span>y_next<span class="token punctuation">]</span><span class="token operator">==</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>                <span class="token comment">//限制条件，所寻找的下一个点没有越界，同时下一个点也是属于陆地</span>                map<span class="token punctuation">[</span>x_next<span class="token punctuation">]</span><span class="token punctuation">[</span>y_next<span class="token punctuation">]</span><span class="token operator">=</span><span class="token number">2</span><span class="token punctuation">;</span><span class="token comment">//涂色</span>                <span class="token function">dfs</span><span class="token punctuation">(</span>map<span class="token punctuation">,</span>x_next<span class="token punctuation">,</span>y_next<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">//继续搜索</span>            <span class="token punctuation">&#125;</span>        <span class="token punctuation">&#125;</span>    <span class="token punctuation">&#125;</span><span class="token punctuation">&#125;</span><span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>时间复杂度：O(MN)，其中 M 和 N 分别是数组行数和列数</p><p>空间复杂度：O(MN)</p><hr><h2 id="126-单词接龙-II-—（困难）"><a href="#126-单词接龙-II-—（困难）" class="headerlink" title="126. 单词接龙 II  —（困难）"></a><a href="https://leetcode-cn.com/problems/word-ladder-ii/">126. 单词接龙 II</a>  —（困难）</h2><p>按字典 wordList 完成从单词 beginWord 到单词 endWord 转化，一个表示此过程的 转换序列 是形式上像 beginWord -&gt; s1 -&gt; s2 -&gt; … -&gt; sk 这样的单词序列，并满足：</p><ul><li>每对相邻的单词之间仅有单个字母不同。</li><li>转换过程中的每个单词 si（1 &lt;= i &lt;= k）必须是字典 wordList 中的单词。注意，beginWord 不必是字典 wordList 中的单词。</li><li>sk == endWord</li></ul><p>给你两个单词 beginWord 和 endWord ，以及一个字典 wordList 。请你找出并返回所有从 beginWord 到 endWord 的 最短转换序列 ，如果不存在这样的转换序列，返回一个空列表。每个序列都应该以单词列表 [beginWord, s1, s2, …, sk] 的形式返回</p><p>示例 1：</p><blockquote><p>输入：beginWord = “hit”, endWord = “cog”, wordList = [“hot”,”dot”,”dog”,”lot”,”log”,”cog”]<br>输出：[[“hit”,”hot”,”dot”,”dog”,”cog”],[“hit”,”hot”,”lot”,”log”,”cog”]]<br>解释：存在 2 种最短的转换序列：<br>“hit” -&gt; “hot” -&gt; “dot” -&gt; “dog” -&gt; “cog”<br>“hit” -&gt; “hot” -&gt; “lot” -&gt; “log” -&gt; “cog”</p></blockquote><p>示例 2：</p><blockquote><p>输入：beginWord = “hit”, endWord = “cog”, wordList = [“hot”,”dot”,”dog”,”lot”,”log”]<br>输出：[]<br>解释：endWord “cog” 不在字典 wordList 中，所以不存在符合要求的转换序列。</p></blockquote><p><strong>提示：</strong></p><ul><li>1 &lt;= beginWord.length &lt;= 7</li><li>endWord.length == beginWord.length</li><li>1 &lt;= wordList.length &lt;= 5000</li><li>wordList[i].length == beginWord.length</li><li>beginWord、endWord 和 wordList[i] 由小写英文字母组成</li><li>beginWord != endWord</li><li>wordList 中的所有单词 <strong>互不相同</strong></li></ul><p>题目第一眼看上去很复杂，需要多读几遍，注意到示例1中假设有多条最短的转换序列，这些序列都要返回，这个点不能忘记。其次是<code>beginWord</code>可以不在字典内，但是<code>endWord</code>一定要在里边，如果不在的话就要返回空数组</p><p>这道题我们把字典里的每个单词看成不同的节点，借用LeetCode官方解答的图就是下面这样</p><p><img src="https://i.loli.net/2021/08/02/JtMma8hzRXOT4uS.png"></p><p>然后从开始的单词循序渐进到最后一个单词的过程如下</p><p><img src="F:\编程\LeetCode刷题笔记\图片\第一期\深度搜索\126\126_fig2.png" alt="126_fig2"></p><p>明白这个之后，我们就要思考怎么遍历它们</p><p>我们可以把起始字符串、终止字符串、以及单词表里所有的字符串想象成节点。若两个字符<br>串只有一个字符不同，那么它们相连。因为题目需要输出修改次数最少的所有修改方式，因此我<br>们可以使用广度优先搜索，求得起始节点到终止节点的最短距离</p><p>为什么不用DFS的原因是DFS需要剪枝，处理起来比较麻烦</p><p>一般的BFS模板套路如下</p><blockquote><p>定义 层节点 容器<br>根节点 压入容器内<br>while (容器非空) {<br>    获取容器内节点的个数（即当前处理层节点个数）<br>    for (当前层节点个数) {<br>        从容器中获取一个节点<br>        按业务逻辑处理单个节点<br>        获取当前节点的 子节点 压入容器内<br>    }<br>}</p></blockquote><p>这题同样是可以套用这个模版来解决，需要修改的点：</p><ul><li>需要改一下 单个节点 的 数据结构</li><li>处理单个节点的业务逻辑（回溯做业务，HashMap辅助业务逻辑）</li></ul><p>单个节点的结构使用 <code>vector&lt;string&gt;</code> 类型，也就是自上而下单次 转换序 的累加值。</p><pre><code>      hit         \         hit,hot      /          \  hit,hot,dot    hit,hot,lot  /                 \hit,hot,dot,dog     hit,hot,lot,log   /                      \hit,hot,dot,dog,cog       hit,hot,lot,log,cog</code></pre><p>而节点内的最后一个 string 元素决定了 下层（也就是树型结构的子节点）节点，也就是 wordList 内的值。<br>在获取到下层节点时，是需要把从 wordList 里面找到的元素给删除，避免 重复转换 进入死循环。</p><p>我们也可以双向来搜索，即从起始节点和终止节点分别进行广度优先搜索，每次只延展当前层节点数最少<br>的那一端，这样我们可以减少搜索的总结点数。举例来说，假设最短距离为 4，如果我们只从一<br>端搜索 4 层，总遍历节点数最多是 1 + 2 + 4 + 8 + 16 = 31；而如果我们从两端各搜索两层，总遍<br>历节点数最多只有 2 × (1 + 2 + 4) = 14。  </p><p><strong>双向遍历理解起来比较难，不强求一下子就能明白，可以先理解好单向遍历，到时候回来再看看双向的可能就明白了</strong></p><p>这里先放单向遍历的代码</p><pre class="line-numbers language-cpp" data-language="cpp"><code class="language-cpp"><span class="token keyword">class</span> <span class="token class-name">Solution</span> <span class="token punctuation">&#123;</span><span class="token keyword">public</span><span class="token operator">:</span>    vector<span class="token operator">&lt;</span>vector<span class="token operator">&lt;</span>string<span class="token operator">>></span> <span class="token function">findLadders</span><span class="token punctuation">(</span>string beginWord<span class="token punctuation">,</span> string endWord<span class="token punctuation">,</span> vector<span class="token operator">&lt;</span>string<span class="token operator">></span><span class="token operator">&amp;</span> wordList<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>        <span class="token comment">//将字典的每个单词录入哈希表中，方便后面查找</span>        unordered_set<span class="token operator">&lt;</span>string<span class="token operator">></span> <span class="token function">search</span><span class="token punctuation">(</span>wordList<span class="token punctuation">.</span><span class="token function">begin</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span>wordList<span class="token punctuation">.</span><span class="token function">end</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        vector<span class="token operator">&lt;</span>vector<span class="token operator">&lt;</span>string<span class="token operator">>></span> res<span class="token punctuation">;</span><span class="token comment">//待返回答案</span>        deque<span class="token operator">&lt;</span>vector<span class="token operator">&lt;</span>string<span class="token operator">>></span> worker<span class="token punctuation">;</span><span class="token comment">//层节点容器，记录每一层中得到的转换序列</span>        worker<span class="token punctuation">.</span><span class="token function">push_back</span><span class="token punctuation">(</span><span class="token punctuation">&#123;</span>beginWord<span class="token punctuation">&#125;</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">//由第一个字符串开始出发，将他作为根节点</span>        <span class="token comment">//bfs</span>        <span class="token keyword">while</span><span class="token punctuation">(</span><span class="token operator">!</span>worker<span class="token punctuation">.</span><span class="token function">empty</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>            <span class="token comment">//记录这一层已经转化的点，在这一轮结束时在字典中删除，防止下次再访问</span>            unordered_set<span class="token operator">&lt;</span>string<span class="token operator">></span> visited<span class="token punctuation">;</span>            <span class="token keyword">for</span><span class="token punctuation">(</span><span class="token keyword">int</span> i <span class="token operator">=</span> worker<span class="token punctuation">.</span><span class="token function">size</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> i <span class="token operator">></span> <span class="token number">0</span><span class="token punctuation">;</span> <span class="token operator">--</span>i<span class="token punctuation">)</span><span class="token punctuation">&#123;</span><span class="token comment">//层遍历，</span>                <span class="token comment">//（这里换成int i = 0; i &lt; worker.size(); ++i会超时）</span>                <span class="token comment">//获取节点容器的第一个节点，并pop掉</span>                vector<span class="token operator">&lt;</span>string<span class="token operator">></span> sub <span class="token operator">=</span> worker<span class="token punctuation">.</span><span class="token function">front</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>worker<span class="token punctuation">.</span><span class="token function">pop_front</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>                                <span class="token comment">//取得这一行转换序列的最后一个字符串，因为它决定下一个要寻找的元素</span>                string tail <span class="token operator">=</span> sub<span class="token punctuation">.</span><span class="token function">back</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>                <span class="token keyword">if</span><span class="token punctuation">(</span>tail<span class="token operator">==</span>endWord<span class="token punctuation">)</span><span class="token punctuation">&#123;</span><span class="token comment">//如果取得的是想要的字符串</span>                    res<span class="token punctuation">.</span><span class="token function">push_back</span><span class="token punctuation">(</span>sub<span class="token punctuation">)</span><span class="token punctuation">;</span>                    <span class="token keyword">continue</span><span class="token punctuation">;</span><span class="token comment">//?</span>                <span class="token punctuation">&#125;</span>                <span class="token keyword">for</span><span class="token punctuation">(</span><span class="token keyword">int</span> j<span class="token operator">=</span><span class="token number">0</span><span class="token punctuation">;</span>j<span class="token operator">&lt;</span>tail<span class="token punctuation">.</span><span class="token function">size</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token operator">++</span>j<span class="token punctuation">)</span><span class="token punctuation">&#123;</span>                    <span class="token comment">//回溯试探，改变不同字符来获取下一个要走的点</span>                    <span class="token keyword">char</span> temp <span class="token operator">=</span> tail<span class="token punctuation">[</span>j<span class="token punctuation">]</span><span class="token punctuation">;</span><span class="token comment">//保存原来的字符以便恢复</span>                    <span class="token keyword">for</span><span class="token punctuation">(</span><span class="token keyword">char</span> c<span class="token operator">=</span><span class="token string">'a'</span><span class="token punctuation">;</span>c<span class="token operator">&lt;=</span><span class="token string">'z'</span><span class="token punctuation">;</span><span class="token operator">++</span>c<span class="token punctuation">)</span><span class="token punctuation">&#123;</span>                        <span class="token keyword">if</span><span class="token punctuation">(</span>c<span class="token operator">==</span>temp<span class="token punctuation">)</span>                            <span class="token keyword">continue</span><span class="token punctuation">;</span>                        tail<span class="token punctuation">[</span>j<span class="token punctuation">]</span><span class="token operator">=</span>c<span class="token punctuation">;</span>                        <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token operator">!</span>search<span class="token punctuation">.</span><span class="token function">count</span><span class="token punctuation">(</span>tail<span class="token punctuation">)</span><span class="token punctuation">)</span>                            <span class="token keyword">continue</span><span class="token punctuation">;</span>                        <span class="token keyword">else</span><span class="token punctuation">&#123;</span>                            <span class="token comment">//试探字典中是否包含当前临时字符串</span>                            <span class="token comment">//如果包含的话</span>                            visited<span class="token punctuation">.</span><span class="token function">insert</span><span class="token punctuation">(</span>tail<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">//将该字符串记录为已转化的点</span>                                                        <span class="token comment">//记录当前层</span>                            sub<span class="token punctuation">.</span><span class="token function">push_back</span><span class="token punctuation">(</span>tail<span class="token punctuation">)</span><span class="token punctuation">;</span>                            worker<span class="token punctuation">.</span><span class="token function">push_back</span><span class="token punctuation">(</span>sub<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">//向容器保存好子节点</span>                            sub<span class="token punctuation">.</span><span class="token function">pop_back</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">//回溯恢复</span>                        <span class="token punctuation">&#125;</span>                                            <span class="token punctuation">&#125;</span>                    tail<span class="token punctuation">[</span>j<span class="token punctuation">]</span><span class="token operator">=</span>temp<span class="token punctuation">;</span><span class="token comment">//把字符串恢复好，以备下一个字符的试探</span>                <span class="token punctuation">&#125;</span>            <span class="token punctuation">&#125;</span>                        <span class="token keyword">if</span><span class="token punctuation">(</span>res<span class="token punctuation">.</span><span class="token function">size</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token keyword">return</span> res<span class="token punctuation">;</span><span class="token comment">//当res的数目大于0就证明找到了所有路径了</span>            <span class="token keyword">for</span><span class="token punctuation">(</span><span class="token keyword">auto</span><span class="token operator">&amp;</span> str<span class="token operator">:</span>visited<span class="token punctuation">)</span>                search<span class="token punctuation">.</span><span class="token function">erase</span><span class="token punctuation">(</span>str<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">//删除字典中已经用过的单词，防止下次循环继续赋值</span>        <span class="token punctuation">&#125;</span><span class="token comment">//end while</span>        <span class="token keyword">return</span> <span class="token punctuation">&#123;</span><span class="token punctuation">&#125;</span><span class="token punctuation">;</span><span class="token comment">//默认情况返回空</span>    <span class="token punctuation">&#125;</span><span class="token punctuation">&#125;</span><span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>时间复杂度：O(n)，n 为 wordList 的个数；忽略 string 的复制带来时间，和 26 个字母遍历的系数。</p><p><strong>双向遍历解法这里待补充，只放个代码先，具体讲解可以去看<a href="https://leetcode-cn.com/problems/word-ladder-ii/solution/2chong-jie-fa-jian-ji-dai-ma-qing-xi-jie-3sjt/">这个题解</a></strong></p><pre class="line-numbers language-cpp" data-language="cpp"><code class="language-cpp"><span class="token keyword">class</span> <span class="token class-name">Solution</span> <span class="token punctuation">&#123;</span><span class="token keyword">public</span><span class="token operator">:</span>    vector<span class="token operator">&lt;</span>vector<span class="token operator">&lt;</span>string<span class="token operator">>></span> <span class="token function">findLadders</span><span class="token punctuation">(</span>string beginWord<span class="token punctuation">,</span> string endWord<span class="token punctuation">,</span> vector<span class="token operator">&lt;</span>string<span class="token operator">></span><span class="token operator">&amp;</span> wordList<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>        <span class="token comment">//首先需要使用集合保存wordList，因为需要判断某单词是否在单词表中(count方法)</span>        vector<span class="token operator">&lt;</span>vector<span class="token operator">&lt;</span>string<span class="token operator">>></span> result<span class="token punctuation">;</span>        unordered_set<span class="token operator">&lt;</span>string<span class="token operator">></span> words<span class="token punctuation">;</span>        <span class="token keyword">for</span><span class="token punctuation">(</span><span class="token keyword">const</span> <span class="token keyword">auto</span> <span class="token operator">&amp;</span> str <span class="token operator">:</span> wordList<span class="token punctuation">)</span><span class="token punctuation">&#123;</span>            words<span class="token punctuation">.</span><span class="token function">insert</span><span class="token punctuation">(</span>str<span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token punctuation">&#125;</span>        <span class="token comment">//判断结束单词是否在单词列表中，如果不在，则直接返回空表</span>        <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token operator">!</span>words<span class="token punctuation">.</span><span class="token function">count</span><span class="token punctuation">(</span>endWord<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>            <span class="token keyword">return</span> result<span class="token punctuation">;</span>        <span class="token punctuation">&#125;</span>        <span class="token comment">//创建两个集合，实现双向查找</span>        unordered_set<span class="token operator">&lt;</span>string<span class="token operator">></span> q1<span class="token punctuation">&#123;</span>beginWord<span class="token punctuation">&#125;</span><span class="token punctuation">,</span> q2<span class="token punctuation">&#123;</span>endWord<span class="token punctuation">&#125;</span><span class="token punctuation">;</span>        words<span class="token punctuation">.</span><span class="token function">erase</span><span class="token punctuation">(</span>beginWord<span class="token punctuation">)</span><span class="token punctuation">;</span>        words<span class="token punctuation">.</span><span class="token function">erase</span><span class="token punctuation">(</span>endWord<span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token comment">//创建map集合保存每个单词中一个字母发生变化并且存在于单词表中的单词列表</span>        <span class="token comment">//此map用于广度遍历</span>        unordered_map<span class="token operator">&lt;</span>string<span class="token punctuation">,</span> vector<span class="token operator">&lt;</span>string<span class="token operator">>></span> next<span class="token punctuation">;</span>        <span class="token comment">//双集合寻找，标志具体是哪个集合寻找</span>        <span class="token keyword">bool</span> reversed <span class="token operator">=</span> <span class="token boolean">false</span><span class="token punctuation">;</span>        <span class="token keyword">bool</span> find <span class="token operator">=</span> <span class="token boolean">false</span><span class="token punctuation">;</span>        <span class="token comment">//next数据的搜寻</span>        <span class="token keyword">while</span><span class="token punctuation">(</span><span class="token operator">!</span>q1<span class="token punctuation">.</span><span class="token function">empty</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>            <span class="token comment">//需要创建新的集合保存一轮遍历下来，每个单词只改变一个字母且在单词表中的单词</span>            <span class="token comment">//即保存第二层需要遍历的单词</span>            unordered_set<span class="token operator">&lt;</span>string<span class="token operator">></span> q<span class="token punctuation">;</span>            <span class="token comment">//遍历q1中的每个单词</span>            <span class="token keyword">for</span><span class="token punctuation">(</span><span class="token keyword">const</span> <span class="token keyword">auto</span> <span class="token operator">&amp;</span> w <span class="token operator">:</span> q1<span class="token punctuation">)</span><span class="token punctuation">&#123;</span>                string s <span class="token operator">=</span> w<span class="token punctuation">;</span>                <span class="token keyword">for</span><span class="token punctuation">(</span><span class="token keyword">int</span> j <span class="token operator">=</span> <span class="token number">0</span> <span class="token punctuation">;</span> j <span class="token operator">&lt;</span> s<span class="token punctuation">.</span><span class="token function">length</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">;</span> <span class="token operator">++</span>j<span class="token punctuation">)</span><span class="token punctuation">&#123;</span>                    <span class="token comment">//保存改变的字符，在每一轮最后复原单词</span>                    <span class="token keyword">char</span> ch <span class="token operator">=</span> s<span class="token punctuation">[</span>j<span class="token punctuation">]</span><span class="token punctuation">;</span>                    <span class="token keyword">for</span><span class="token punctuation">(</span><span class="token keyword">char</span> i <span class="token operator">=</span> <span class="token number">0</span> <span class="token punctuation">;</span> i <span class="token operator">&lt;</span> <span class="token number">26</span> <span class="token punctuation">;</span> <span class="token operator">++</span>i<span class="token punctuation">)</span><span class="token punctuation">&#123;</span>                        s<span class="token punctuation">[</span>j<span class="token punctuation">]</span> <span class="token operator">=</span> i <span class="token operator">+</span> <span class="token string">'a'</span><span class="token punctuation">;</span>                        <span class="token comment">//如果q2集合中有此单词则说明查找成功</span>                        <span class="token keyword">if</span><span class="token punctuation">(</span>q2<span class="token punctuation">.</span><span class="token function">count</span><span class="token punctuation">(</span>s<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>                            reversed <span class="token operator">?</span> next<span class="token punctuation">[</span>s<span class="token punctuation">]</span><span class="token punctuation">.</span><span class="token function">push_back</span><span class="token punctuation">(</span>w<span class="token punctuation">)</span> <span class="token operator">:</span> next<span class="token punctuation">[</span>w<span class="token punctuation">]</span><span class="token punctuation">.</span><span class="token function">push_back</span><span class="token punctuation">(</span>s<span class="token punctuation">)</span><span class="token punctuation">;</span>                            find <span class="token operator">=</span> <span class="token boolean">true</span><span class="token punctuation">;</span>                        <span class="token punctuation">&#125;</span>                        <span class="token keyword">if</span><span class="token punctuation">(</span>words<span class="token punctuation">.</span><span class="token function">count</span><span class="token punctuation">(</span>s<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>                            reversed <span class="token operator">?</span> next<span class="token punctuation">[</span>s<span class="token punctuation">]</span><span class="token punctuation">.</span><span class="token function">push_back</span><span class="token punctuation">(</span>w<span class="token punctuation">)</span> <span class="token operator">:</span> next<span class="token punctuation">[</span>w<span class="token punctuation">]</span><span class="token punctuation">.</span><span class="token function">push_back</span><span class="token punctuation">(</span>s<span class="token punctuation">)</span><span class="token punctuation">;</span>                            q<span class="token punctuation">.</span><span class="token function">insert</span><span class="token punctuation">(</span>s<span class="token punctuation">)</span><span class="token punctuation">;</span>                            <span class="token comment">//words.erase(s);</span>                        <span class="token punctuation">&#125;</span>                    <span class="token punctuation">&#125;</span>                    <span class="token comment">//改回来</span>                    s<span class="token punctuation">[</span>j<span class="token punctuation">]</span> <span class="token operator">=</span> ch<span class="token punctuation">;</span>                <span class="token punctuation">&#125;</span>            <span class="token punctuation">&#125;</span>                        <span class="token keyword">if</span><span class="token punctuation">(</span>find<span class="token punctuation">)</span><span class="token punctuation">&#123;</span>                <span class="token keyword">break</span><span class="token punctuation">;</span>            <span class="token punctuation">&#125;</span>            <span class="token keyword">for</span><span class="token punctuation">(</span><span class="token keyword">const</span> <span class="token keyword">auto</span> <span class="token operator">&amp;</span> s<span class="token operator">:</span> q<span class="token punctuation">)</span><span class="token punctuation">&#123;</span>                words<span class="token punctuation">.</span><span class="token function">erase</span><span class="token punctuation">(</span>s<span class="token punctuation">)</span><span class="token punctuation">;</span>            <span class="token punctuation">&#125;</span>            <span class="token comment">//q1保存下一趟需要遍历的单词集合</span>            <span class="token comment">//q2则保存另一个集合</span>            <span class="token comment">//谁小遍历谁，减小开销</span>            <span class="token keyword">if</span><span class="token punctuation">(</span>q<span class="token punctuation">.</span><span class="token function">size</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">&lt;=</span> q2<span class="token punctuation">.</span><span class="token function">size</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>                q1 <span class="token operator">=</span> q<span class="token punctuation">;</span>            <span class="token punctuation">&#125;</span><span class="token keyword">else</span><span class="token punctuation">&#123;</span>                q1 <span class="token operator">=</span> q2<span class="token punctuation">;</span>                q2 <span class="token operator">=</span> q<span class="token punctuation">;</span>                reversed <span class="token operator">=</span> <span class="token operator">!</span>reversed<span class="token punctuation">;</span>            <span class="token punctuation">&#125;</span>         <span class="token punctuation">&#125;</span>        <span class="token comment">//现在需要对构造好的next进行查找,并找到所有路径</span>        vector<span class="token operator">&lt;</span>string<span class="token operator">></span> path<span class="token punctuation">&#123;</span> beginWord <span class="token punctuation">&#125;</span><span class="token punctuation">;</span>        <span class="token function">bfs</span><span class="token punctuation">(</span>next<span class="token punctuation">,</span> result<span class="token punctuation">,</span> path<span class="token punctuation">,</span> beginWord<span class="token punctuation">,</span> endWord<span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token keyword">return</span> result<span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span>    <span class="token keyword">void</span> <span class="token function">bfs</span><span class="token punctuation">(</span>unordered_map<span class="token operator">&lt;</span>string<span class="token punctuation">,</span>vector<span class="token operator">&lt;</span>string<span class="token operator">>></span><span class="token operator">&amp;</span> next<span class="token punctuation">,</span> vector<span class="token operator">&lt;</span>vector<span class="token operator">&lt;</span>string<span class="token operator">>></span> <span class="token operator">&amp;</span>result<span class="token punctuation">,</span> vector<span class="token operator">&lt;</span>string<span class="token operator">></span> <span class="token operator">&amp;</span>path <span class="token punctuation">,</span> string <span class="token operator">&amp;</span> src<span class="token punctuation">,</span> string <span class="token operator">&amp;</span> des<span class="token punctuation">)</span><span class="token punctuation">&#123;</span>        <span class="token keyword">if</span><span class="token punctuation">(</span>src <span class="token operator">==</span> des<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>            result<span class="token punctuation">.</span><span class="token function">push_back</span><span class="token punctuation">(</span>path<span class="token punctuation">)</span><span class="token punctuation">;</span>            <span class="token keyword">return</span> <span class="token punctuation">;</span>        <span class="token punctuation">&#125;</span>        <span class="token keyword">for</span><span class="token punctuation">(</span> <span class="token keyword">auto</span> <span class="token operator">&amp;</span> s <span class="token operator">:</span> next<span class="token punctuation">[</span>src<span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>            path<span class="token punctuation">.</span><span class="token function">push_back</span><span class="token punctuation">(</span>s<span class="token punctuation">)</span><span class="token punctuation">;</span>            <span class="token function">bfs</span><span class="token punctuation">(</span>next <span class="token punctuation">,</span> result <span class="token punctuation">,</span> path <span class="token punctuation">,</span> s <span class="token punctuation">,</span> des<span class="token punctuation">)</span><span class="token punctuation">;</span>            path<span class="token punctuation">.</span><span class="token function">pop_back</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token punctuation">&#125;</span>    <span class="token punctuation">&#125;</span><span class="token punctuation">&#125;</span><span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><hr><h2 id="130-被围绕的区域-—（中等）"><a href="#130-被围绕的区域-—（中等）" class="headerlink" title="130. 被围绕的区域  —（中等）"></a><a href="https://leetcode-cn.com/problems/surrounded-regions/">130. 被围绕的区域</a>  —（中等）</h2><p>给你一个 <code>m x n</code> 的矩阵 <code>board</code> ，由若干字符 <code>&#39;X&#39;</code> 和 <code>&#39;O&#39;</code> ，找到所有被 <code>&#39;X&#39;</code> 围绕的区域，并将这些区域里所有的 <code>&#39;O&#39;</code> 用 <code>&#39;X&#39;</code> 填充。</p><p>示例1：</p><img src="https://i.loli.net/2021/08/03/uURHlsoYcjTyCXt.jpg" style="zoom:80%;" /><blockquote><p>输入：board = [[“X”,”X”,”X”,”X”],[“X”,”O”,”O”,”X”],[“X”,”X”,”O”,”X”],[“X”,”O”,”X”,”X”]]<br>输出：[[“X”,”X”,”X”,”X”],[“X”,”X”,”X”,”X”],[“X”,”X”,”X”,”X”],[“X”,”O”,”X”,”X”]]<br>解释：被围绕的区间不会存在于边界上，换句话说，任何边界上的 ‘O’ 都不会被填充为 ‘X’。 任何不在边界上，或不与边界上的 ‘O’ 相连的 ‘O’ 最终都会被填充为 ‘X’。如果两个元素在水平或垂直方向相邻，则称它们是“相连”的。</p></blockquote><p>示例2：</p><blockquote><p>输入：board = [[“X”]]<br>输出：[[“X”]]</p></blockquote><p>提示：</p><ul><li>m == board.length</li><li>n == board[i].length</li><li>1 &lt;= m, n &lt;= 200</li><li>board[i][j] 为 ‘X’ 或 ‘O’</li></ul><p>这道题刚开始我就拿来自己做，做法是按顺序扫描，然后做标记等，但是做到后面的用例都会有几个过不了，一直改来改去导致代码臃肿，达到了一百多行，因此只能换种方法</p><p>先来分析题干，本题给定的矩阵中有三种元素：  字母 X； 被字母 X 包围的字母 O； 没有被字母 X 包围的字母 O。本题要求将所有被字母 X 包围的字母 O都变为字母 X ，但很难判断哪些 O 是被包围的，哪些 O 不是被包围的。</p><p>此题目中要注意的是在<strong>边界</strong>中的 <code>O</code>都不会给填充成<code>X</code>，因此我们可以从这里下手，先探测边界中有<code>O</code>的地方，之后再由此延展到内部，将相连的O都标记为一个值（假设标记为<code>B</code>）</p><p>待到全部边界O以及与它相连的O都标记完后，此时的平面上只有三种值，一个是<code>X</code>，一个是<code>O</code>，还有一个是<code>B</code>，这个时候的B都是不可以填充的，因为他们都与边界值相连，不满足条件。因此我们只用把剩下的O填充为X就行了</p><p>我们就可以再次按顺序扫描，遇到B回滚为O，遇到O则填充为X，这里不用担心会搞混，因为是按顺序扫描的</p><pre class="line-numbers language-cpp" data-language="cpp"><code class="language-cpp"><span class="token keyword">class</span> <span class="token class-name">Solution</span> <span class="token punctuation">&#123;</span><span class="token keyword">public</span><span class="token operator">:</span>    <span class="token comment">//全局变量，不用重复计算</span>    <span class="token keyword">int</span> row <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>    <span class="token keyword">int</span> col <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>    <span class="token keyword">int</span> direction<span class="token punctuation">[</span><span class="token number">4</span><span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token number">2</span><span class="token punctuation">]</span><span class="token operator">=</span><span class="token punctuation">&#123;</span><span class="token punctuation">&#123;</span><span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">,</span><span class="token number">0</span><span class="token punctuation">&#125;</span><span class="token punctuation">,</span><span class="token punctuation">&#123;</span><span class="token number">0</span><span class="token punctuation">,</span><span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">&#125;</span><span class="token punctuation">,</span><span class="token punctuation">&#123;</span><span class="token number">1</span><span class="token punctuation">,</span><span class="token number">0</span><span class="token punctuation">&#125;</span><span class="token punctuation">,</span><span class="token punctuation">&#123;</span><span class="token number">0</span><span class="token punctuation">,</span><span class="token number">1</span><span class="token punctuation">&#125;</span><span class="token punctuation">&#125;</span><span class="token punctuation">;</span><span class="token comment">//方向上、左、下、右</span><span class="token keyword">public</span><span class="token operator">:</span>    <span class="token keyword">void</span> <span class="token function">solve</span><span class="token punctuation">(</span>vector<span class="token operator">&lt;</span>vector<span class="token operator">&lt;</span><span class="token keyword">char</span><span class="token operator">>></span><span class="token operator">&amp;</span> board<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>        row <span class="token operator">=</span> board<span class="token punctuation">.</span><span class="token function">size</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">//行数</span>        col <span class="token operator">=</span> board<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">.</span><span class="token function">size</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">//列数</span>        <span class="token keyword">for</span><span class="token punctuation">(</span><span class="token keyword">int</span> x <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>x <span class="token operator">&lt;</span> row<span class="token punctuation">;</span><span class="token operator">++</span>x<span class="token punctuation">)</span><span class="token punctuation">&#123;</span>            <span class="token comment">//第一层遍历</span>            <span class="token keyword">for</span><span class="token punctuation">(</span><span class="token keyword">int</span> y <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>y <span class="token operator">&lt;</span> col<span class="token punctuation">;</span><span class="token operator">++</span>y<span class="token punctuation">)</span><span class="token punctuation">&#123;</span>                <span class="token comment">//第二层遍历</span>                <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token punctuation">(</span>x<span class="token operator">==</span><span class="token number">0</span><span class="token operator">||</span>x<span class="token operator">==</span>row<span class="token operator">-</span><span class="token number">1</span><span class="token operator">||</span>y<span class="token operator">==</span><span class="token number">0</span><span class="token operator">||</span>y<span class="token operator">==</span>col<span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">)</span> <span class="token operator">&amp;&amp;</span> board<span class="token punctuation">[</span>x<span class="token punctuation">]</span><span class="token punctuation">[</span>y<span class="token punctuation">]</span><span class="token operator">==</span><span class="token string">'O'</span><span class="token punctuation">)</span>                    <span class="token function">dfs</span><span class="token punctuation">(</span>board<span class="token punctuation">,</span>x<span class="token punctuation">,</span>y<span class="token punctuation">)</span><span class="token punctuation">;</span>            <span class="token punctuation">&#125;</span><span class="token comment">//end y</span>        <span class="token punctuation">&#125;</span><span class="token comment">//end x</span>        <span class="token keyword">for</span><span class="token punctuation">(</span><span class="token keyword">int</span> x <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>x <span class="token operator">&lt;</span> row<span class="token punctuation">;</span><span class="token operator">++</span>x<span class="token punctuation">)</span><span class="token punctuation">&#123;</span>            <span class="token comment">//第一层遍历</span>            <span class="token keyword">for</span><span class="token punctuation">(</span><span class="token keyword">int</span> y <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>y <span class="token operator">&lt;</span> col<span class="token punctuation">;</span><span class="token operator">++</span>y<span class="token punctuation">)</span><span class="token punctuation">&#123;</span>                <span class="token comment">//第二层遍历</span>                <span class="token keyword">if</span><span class="token punctuation">(</span>board<span class="token punctuation">[</span>x<span class="token punctuation">]</span><span class="token punctuation">[</span>y<span class="token punctuation">]</span><span class="token operator">==</span><span class="token string">'B'</span><span class="token punctuation">)</span>                    board<span class="token punctuation">[</span>x<span class="token punctuation">]</span><span class="token punctuation">[</span>y<span class="token punctuation">]</span><span class="token operator">=</span><span class="token string">'O'</span><span class="token punctuation">;</span>                <span class="token keyword">else</span> <span class="token keyword">if</span><span class="token punctuation">(</span>board<span class="token punctuation">[</span>x<span class="token punctuation">]</span><span class="token punctuation">[</span>y<span class="token punctuation">]</span><span class="token operator">==</span><span class="token string">'O'</span><span class="token punctuation">)</span>                    board<span class="token punctuation">[</span>x<span class="token punctuation">]</span><span class="token punctuation">[</span>y<span class="token punctuation">]</span><span class="token operator">=</span><span class="token string">'X'</span><span class="token punctuation">;</span>            <span class="token punctuation">&#125;</span><span class="token comment">//end y</span>        <span class="token punctuation">&#125;</span><span class="token comment">//end x</span>    <span class="token punctuation">&#125;</span>    <span class="token keyword">void</span> <span class="token function">dfs</span><span class="token punctuation">(</span>vector<span class="token operator">&lt;</span>vector<span class="token operator">&lt;</span><span class="token keyword">char</span><span class="token operator">>></span><span class="token operator">&amp;</span> board<span class="token punctuation">,</span><span class="token keyword">int</span> x<span class="token punctuation">,</span><span class="token keyword">int</span> y<span class="token punctuation">)</span><span class="token punctuation">&#123;</span>        <span class="token comment">//是O的话就标记为B</span>        <span class="token keyword">if</span><span class="token punctuation">(</span>x<span class="token operator">&lt;</span><span class="token number">0</span><span class="token operator">||</span>x<span class="token operator">></span>row<span class="token operator">-</span><span class="token number">1</span><span class="token operator">||</span>y<span class="token operator">&lt;</span><span class="token number">0</span><span class="token operator">||</span>y<span class="token operator">></span>col<span class="token operator">-</span><span class="token number">1</span><span class="token operator">||</span>board<span class="token punctuation">[</span>x<span class="token punctuation">]</span><span class="token punctuation">[</span>y<span class="token punctuation">]</span><span class="token operator">!=</span><span class="token string">'O'</span><span class="token punctuation">)</span>            <span class="token keyword">return</span><span class="token punctuation">;</span>                <span class="token keyword">if</span><span class="token punctuation">(</span>board<span class="token punctuation">[</span>x<span class="token punctuation">]</span><span class="token punctuation">[</span>y<span class="token punctuation">]</span><span class="token operator">==</span><span class="token string">'O'</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>            board<span class="token punctuation">[</span>x<span class="token punctuation">]</span><span class="token punctuation">[</span>y<span class="token punctuation">]</span><span class="token operator">=</span><span class="token string">'B'</span><span class="token punctuation">;</span>        <span class="token punctuation">&#125;</span>        <span class="token comment">//从边界往里面扩展，标记为B</span>        <span class="token keyword">int</span> x_next<span class="token punctuation">;</span>        <span class="token keyword">int</span> y_next<span class="token punctuation">;</span>        <span class="token keyword">for</span><span class="token punctuation">(</span><span class="token keyword">int</span> i<span class="token operator">=</span><span class="token number">0</span><span class="token punctuation">;</span>i<span class="token operator">&lt;</span><span class="token number">4</span><span class="token punctuation">;</span><span class="token operator">++</span>i<span class="token punctuation">)</span><span class="token punctuation">&#123;</span>            <span class="token comment">//往不同方向搜索</span>            x_next<span class="token operator">=</span>x<span class="token operator">+</span>direction<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">;</span>            y_next<span class="token operator">=</span>y<span class="token operator">+</span>direction<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">;</span>            <span class="token function">dfs</span><span class="token punctuation">(</span>board<span class="token punctuation">,</span>x_next<span class="token punctuation">,</span>y_next<span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token punctuation">&#125;</span>    <span class="token punctuation">&#125;</span><span class="token punctuation">&#125;</span><span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>时间复杂度为O(M*N)，M为平面行数，N为平面列数，深度优先搜索过程中，每一个点至多只会被标记一次。</p><p>空间复杂度为O(M*N)，主要为深度优先搜索的栈的开销。</p><hr>]]></content>
    
    
      
      
    <summary type="html">&lt;h1 id=&quot;LeetCode刷题笔记第一期&quot;&gt;&lt;a href=&quot;#LeetCode刷题笔记第一期&quot; class=&quot;headerlink&quot; title=&quot;LeetCode刷题笔记第一期&quot;&gt;&lt;/a&gt;LeetCode刷题笔记第一期&lt;/h1&gt;&lt;h2 id=&quot;前言&quot;&gt;&lt;a href=&quot;</summary>
      
    
    
    
    <category term="LeetCode刷题笔记" scheme="http://sakura-pub.ltd/categories/LeetCode%E5%88%B7%E9%A2%98%E7%AC%94%E8%AE%B0/"/>
    
    
    <category term="LeetCode" scheme="http://sakura-pub.ltd/tags/LeetCode/"/>
    
  </entry>
  
  <entry>
    <title>Unity笔记11-添加攻击属性</title>
    <link href="http://sakura-pub.ltd/UnityNotes/Unity%E7%AC%94%E8%AE%B011-%E6%B7%BB%E5%8A%A0%E6%94%BB%E5%87%BB%E5%B1%9E%E6%80%A7/"/>
    <id>http://sakura-pub.ltd/UnityNotes/Unity%E7%AC%94%E8%AE%B011-%E6%B7%BB%E5%8A%A0%E6%94%BB%E5%87%BB%E5%B1%9E%E6%80%A7/</id>
    <published>2021-07-17T01:11:59.000Z</published>
    <updated>2021-07-17T06:34:40.384Z</updated>
    
    <content type="html"><![CDATA[<p>在这一章节中我们来给人物还有史莱姆添加攻击的属性，同时也给史莱姆补充上攻击的动作，那么我们就开始吧</p><h1 id="创建有关攻击的ScriptableObject"><a href="#创建有关攻击的ScriptableObject" class="headerlink" title="创建有关攻击的ScriptableObject"></a>创建有关攻击的ScriptableObject</h1><p>首先还是新建文件夹和代码文件👇</p><img src="https://p5-tt.byteimg.com/origin/pgc-image/b58fb07a9dd74e99a87414a252bf97d5.png" alt="1.png" style="zoom:80%;" /><p>打开这个代码，我们来写一下有关攻击的属性</p><pre class="line-numbers language-csharp" data-language="csharp"><code class="language-csharp"><span class="token punctuation">[</span><span class="token attribute"><span class="token class-name">CreateAssetMenu</span><span class="token attribute-arguments"><span class="token punctuation">(</span>fileName <span class="token operator">=</span> <span class="token string">"New Data"</span><span class="token punctuation">,</span>menuName <span class="token operator">=</span> <span class="token string">"Attack/Attack Data"</span><span class="token punctuation">)</span></span></span><span class="token punctuation">]</span><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">AttackData_SO</span> <span class="token punctuation">:</span> <span class="token type-list"><span class="token class-name">ScriptableObject</span></span><span class="token punctuation">&#123;</span>    <span class="token comment">//记录攻击相关属性</span>    <span class="token keyword">public</span> <span class="token class-name"><span class="token keyword">float</span></span> attackRange<span class="token punctuation">;</span><span class="token comment">//近战攻击范围</span>    <span class="token keyword">public</span> <span class="token class-name"><span class="token keyword">float</span></span> skillRange<span class="token punctuation">;</span><span class="token comment">//远程攻击范围</span>    <span class="token keyword">public</span> <span class="token class-name"><span class="token keyword">float</span></span> coolDown<span class="token punctuation">;</span><span class="token comment">//CD冷却</span>    <span class="token keyword">public</span> <span class="token class-name"><span class="token keyword">float</span></span> minDamage<span class="token punctuation">;</span><span class="token comment">//攻击最小伤害</span>    <span class="token keyword">public</span> <span class="token class-name"><span class="token keyword">float</span></span> maxDamage<span class="token punctuation">;</span><span class="token comment">//攻击最大伤害</span>    <span class="token keyword">public</span> <span class="token class-name"><span class="token keyword">float</span></span> criticalMultiplier<span class="token punctuation">;</span><span class="token comment">//暴击加成百分比</span>    <span class="token keyword">public</span> <span class="token class-name"><span class="token keyword">float</span></span> criticalChance<span class="token punctuation">;</span><span class="token comment">//暴击率</span><span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>打完代码之后我们就可以建立一个有关攻击的<code>ScriptableObject</code>了</p><img src="https://p6-tt.byteimg.com/origin/pgc-image/ab9faff156ca410f9a77dd7090b983e8.png" alt="2.png" style="zoom:80%;" /><p>然后我们可以根据自己需求进行属性值设定</p><img src="https://p6-tt.byteimg.com/origin/pgc-image/cc0abf9d1c1f4e6d8accc357cba98c51.png" alt="3.png" style="zoom:80%;" /><p>同时我们还要将它挂载到人物和敌人身上，我们打开<code>Monobehavior</code>文件夹下的<code>CharcterStates.cs</code>代码文件，这个代码文件是挂辅助将ScriptableObject挂载的</p><p>然后添加一行代码，接受外界提供的<code>Player BaseAttackData</code>的ScriptableObject</p><pre class="line-numbers language-csharp" data-language="csharp"><code class="language-csharp"><span class="token keyword">public</span> <span class="token class-name">AttackData_SO</span> attackData<span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><p>之后我们就可以回到史莱姆上挂载了</p><img src="https://p9-tt.byteimg.com/origin/pgc-image/ba22aeebd6224df78664695acf1c927f.png" alt="4.png" style="zoom:80%;" /><h1 id="补充之前的攻击相关代码"><a href="#补充之前的攻击相关代码" class="headerlink" title="补充之前的攻击相关代码"></a>补充之前的攻击相关代码</h1><p>还记得之前在写人物和史莱姆攻击时留下来的一些待补充代码吗？我们现在就可以逐步来完善它们了</p><p>第一个要修改的是<code>PlayerController.cs</code>里面人物的攻击距离，之前我们一直是默认为1，但是现在我们可以来补充它了</p><pre class="line-numbers language-csharp" data-language="csharp"><code class="language-csharp"><span class="token comment">//ScriptableObject相关变量</span><span class="token keyword">private</span> <span class="token class-name">CharcterStates</span> charcterStates<span class="token punctuation">;</span><span class="token return-type class-name"><span class="token keyword">void</span></span> <span class="token function">Awake</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>    charcterStates <span class="token operator">=</span> <span class="token generic-method"><span class="token function">GetComponent</span><span class="token generic class-name"><span class="token punctuation">&lt;</span>CharcterStates<span class="token punctuation">></span></span></span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">&#125;</span><span class="token return-type class-name">IEnumerator</span> <span class="token function">MoveToAttackTarget</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>    agent<span class="token punctuation">.</span>isStopped <span class="token operator">=</span> <span class="token boolean">false</span><span class="token punctuation">;</span>    transform<span class="token punctuation">.</span><span class="token function">LookAt</span><span class="token punctuation">(</span>attactTarget<span class="token punctuation">.</span>transform<span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token comment">//TODO:添加人物攻击距离</span>    <span class="token keyword">while</span><span class="token punctuation">(</span>Vector3<span class="token punctuation">.</span><span class="token function">Distance</span><span class="token punctuation">(</span>transform<span class="token punctuation">.</span>position<span class="token punctuation">,</span>attactTarget<span class="token punctuation">.</span>transform<span class="token punctuation">.</span>position<span class="token punctuation">)</span><span class="token operator">></span>          charcterStates<span class="token punctuation">.</span>attackData<span class="token punctuation">.</span>attackRange<span class="token punctuation">)</span><span class="token punctuation">&#123;</span>        <span class="token comment">//比较人物和敌人的距离是否大于0攻击距离，Distance()可以比较两个Vector3距离</span>        <span class="token keyword">this</span><span class="token punctuation">.</span>agent<span class="token punctuation">.</span>destination <span class="token operator">=</span> attactTarget<span class="token punctuation">.</span>transform<span class="token punctuation">.</span>position<span class="token punctuation">;</span>        <span class="token keyword">yield</span> <span class="token keyword">return</span> <span class="token keyword">null</span><span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span><span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>在声明一个<code>CharcterStates</code>后，我们要把这里的while判断条件右边的1改成<code>charcterStates.attackData.attackRange</code>以获取攻击距离判断</p><p>然后是<code>EnemyController.cs</code>，这里修改量比较大</p><pre class="line-numbers language-csharp" data-language="csharp"><code class="language-csharp"><span class="token comment">//ScriptableObject相关变量</span><span class="token keyword">private</span> <span class="token class-name">CharcterStates</span> charcterStates<span class="token punctuation">;</span><span class="token comment">//这个敌人攻击相关的</span><span class="token keyword">private</span> <span class="token class-name"><span class="token keyword">float</span></span> lastAttackTime<span class="token punctuation">;</span><span class="token comment">//上一次攻击的时间（用来实现CD冷却效果）</span><span class="token return-type class-name"><span class="token keyword">void</span></span> <span class="token function">Awake</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>    <span class="token comment">//...</span>    charcterStates <span class="token operator">=</span> <span class="token generic-method"><span class="token function">GetComponent</span><span class="token generic class-name"><span class="token punctuation">&lt;</span>CharcterStates<span class="token punctuation">></span></span></span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    lastAttackTime <span class="token operator">=</span> charcterStates<span class="token punctuation">.</span>attackData<span class="token punctuation">.</span>coolDown<span class="token punctuation">;</span><span class="token comment">//开始获取冷却时间</span><span class="token punctuation">&#125;</span><span class="token return-type class-name"><span class="token keyword">void</span></span> <span class="token function">Update</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span><span class="token comment">//...</span>    lastAttackTime<span class="token operator">-=</span>Time<span class="token punctuation">.</span>deltaTime<span class="token punctuation">;</span><span class="token comment">//每一帧都减冷却</span><span class="token punctuation">&#125;</span><span class="token comment">//判断攻击距离函数</span><span class="token return-type class-name"><span class="token keyword">bool</span></span> <span class="token function">TargetInAttackRange</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>    <span class="token comment">//人物在敌人的攻击距离内</span>    <span class="token keyword">if</span><span class="token punctuation">(</span>attackTarget<span class="token operator">!=</span><span class="token keyword">null</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>        <span class="token keyword">return</span> Vector3<span class="token punctuation">.</span><span class="token function">Distance</span><span class="token punctuation">(</span>attackTarget<span class="token punctuation">.</span>transform<span class="token punctuation">.</span>position<span class="token punctuation">,</span>transform<span class="token punctuation">.</span>position<span class="token punctuation">)</span>            <span class="token operator">&lt;=</span> charcterStates<span class="token punctuation">.</span>attackData<span class="token punctuation">.</span>attackRange<span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span>    <span class="token keyword">return</span> <span class="token boolean">false</span><span class="token punctuation">;</span><span class="token punctuation">&#125;</span><span class="token return-type class-name"><span class="token keyword">bool</span></span> <span class="token function">TargetInSkillRange</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>    <span class="token comment">//人物在敌人的远程攻击距离内</span>    <span class="token keyword">if</span><span class="token punctuation">(</span>attackTarget<span class="token operator">!=</span><span class="token keyword">null</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>        <span class="token keyword">return</span> Vector3<span class="token punctuation">.</span><span class="token function">Distance</span><span class="token punctuation">(</span>attackTarget<span class="token punctuation">.</span>transform<span class="token punctuation">.</span>position<span class="token punctuation">,</span>transform<span class="token punctuation">.</span>position<span class="token punctuation">)</span>            <span class="token operator">&lt;=</span> charcterStates<span class="token punctuation">.</span>attackData<span class="token punctuation">.</span>skillRange<span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span>    <span class="token keyword">return</span> <span class="token boolean">false</span><span class="token punctuation">;</span><span class="token punctuation">&#125;</span><span class="token return-type class-name"><span class="token keyword">void</span></span> <span class="token function">SwitchEnemyStates</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>    <span class="token comment">//...</span>    <span class="token keyword">switch</span><span class="token punctuation">(</span>enemyStates<span class="token punctuation">)</span><span class="token punctuation">&#123;</span>        <span class="token keyword">case</span> EnemyStates<span class="token punctuation">.</span>CHASE<span class="token punctuation">:</span><span class="token operator">/</span><span class="token operator">/</span>追击            <span class="token comment">//...</span>            <span class="token comment">//TODO:在攻击范围攻击</span>            <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token function">TargetInAttackRange</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">||</span><span class="token function">TargetInSkillRange</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>                isFollow <span class="token operator">=</span> <span class="token boolean">false</span><span class="token punctuation">;</span><span class="token comment">//停止跟随</span>                agent<span class="token punctuation">.</span>isStopped <span class="token operator">=</span> <span class="token boolean">true</span><span class="token punctuation">;</span><span class="token comment">//停下来</span>                <span class="token comment">//攻击冷却完成进行攻击，在前面声明了</span>                <span class="token keyword">if</span><span class="token punctuation">(</span>lastAttackTime <span class="token operator">&lt;</span> <span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>                    lastAttackTime <span class="token operator">=</span> charcterStates<span class="token punctuation">.</span>attackData<span class="token punctuation">.</span>coolDown<span class="token punctuation">;</span>                    <span class="token comment">//暴击判断，随机获取的数值（0到1之间）在暴击率内则是暴击</span>                    <span class="token comment">//charcterStates.isCritical下面会讲，用来记录是否暴击的变量</span>                    charcterStates<span class="token punctuation">.</span>isCritical <span class="token operator">=</span> Random<span class="token punctuation">.</span><span class="token keyword">value</span> <span class="token operator">&lt;</span>                        charcterStates<span class="token punctuation">.</span>attackData<span class="token punctuation">.</span>criticalChance<span class="token punctuation">;</span>                    <span class="token comment">//执行攻击</span>                    <span class="token function">Attack</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>                <span class="token punctuation">&#125;</span>                            <span class="token punctuation">&#125;</span>            <span class="token keyword">break</span><span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span><span class="token punctuation">&#125;</span><span class="token comment">//攻击控制函数</span><span class="token return-type class-name"><span class="token keyword">void</span></span> <span class="token function">Attack</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>    transform<span class="token punctuation">.</span><span class="token function">LookAt</span><span class="token punctuation">(</span>attackTarget<span class="token punctuation">.</span>transform<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">//攻击时敌人看向目标</span>    <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token function">TargetInAttackRange</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>        <span class="token comment">//近身攻击动画</span>    <span class="token punctuation">&#125;</span>    <span class="token keyword">else</span> <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token function">TargetInSkillRange</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>        <span class="token comment">//远程或技能攻击动画</span>    <span class="token punctuation">&#125;</span><span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>我们看到中间控制攻击的时候有一个<code>charcterStates.isCritical</code>的新变量，这是在<code>CharcterStates.cs</code>中新声明的，可以供外界访问的布尔值，用来记录当前是否为暴击，同时虽然它是public属性，但是我们可以用<code>[HideInInspector]</code>将其隐藏起来</p><pre class="line-numbers language-csharp" data-language="csharp"><code class="language-csharp"><span class="token comment">//CharcterStates.cs</span><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">CharcterStates</span> <span class="token punctuation">:</span> <span class="token type-list"><span class="token class-name">MonoBehaviour</span></span><span class="token punctuation">&#123;</span>    <span class="token punctuation">[</span><span class="token attribute"><span class="token class-name">HideInInspector</span></span><span class="token punctuation">]</span>    <span class="token keyword">public</span> <span class="token class-name"><span class="token keyword">bool</span></span> isCritical<span class="token punctuation">;</span><span class="token comment">//是否暴击</span><span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>代码开始复杂了起来，需要好好理解哦</p><h1 id="添加攻击动画"><a href="#添加攻击动画" class="headerlink" title="添加攻击动画"></a>添加攻击动画</h1><p>我们看到上面的代码有两个动画需要我们来添加，一个是近身攻击动画，一个是远程或技能动画</p><img src="https://p6-tt.byteimg.com/origin/pgc-image/3d2834012c04439d824cd2b2bbb56556.png" alt="5.png" style="zoom:80%;" /><p>我们按上图这样编辑动画控制器，建立两个<code>Trigger</code>类型的变量来分别控制<code>Attack01</code>和<code>Attack02</code>的动画触发条件，其次要注意的地方就是由巡逻状态切换过去攻击状态时并不需要动画的过渡效果，同时记得不要忘记把触发条件选择上</p><p>然后我们回到代码中，找到控制攻击的<code>Attack()</code>函数补充一下</p><pre class="line-numbers language-csharp" data-language="csharp"><code class="language-csharp"><span class="token return-type class-name"><span class="token keyword">void</span></span> <span class="token function">Attack</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>    <span class="token comment">//控制敌人攻击的函数</span>    transform<span class="token punctuation">.</span><span class="token function">LookAt</span><span class="token punctuation">(</span>attackTarget<span class="token punctuation">.</span>transform<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">//攻击时敌人看向目标</span>    <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token function">TargetInAttackRange</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>        <span class="token comment">//近身攻击动画</span>        anim<span class="token punctuation">.</span><span class="token function">SetTrigger</span><span class="token punctuation">(</span><span class="token string">"Attack"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span>    <span class="token keyword">else</span> <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token function">TargetInSkillRange</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>        <span class="token comment">//远程或技能攻击动画</span>        anim<span class="token punctuation">.</span><span class="token function">SetTrigger</span><span class="token punctuation">(</span><span class="token string">"Skill"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span><span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>这样我们就实现了基本的攻击效果</p><p>我们还可以把暴击效果加上，可以把Skill动画换成我们的暴击效果动画</p><p>再次打开动画控制器，添加一个布尔类型的变量<code>Critical</code></p><p>我们把<code>Attack02</code>当做暴击动画，然后调整一下动画的切换过程</p><img src="https://p5-tt.byteimg.com/origin/pgc-image/d665b2ca32e840c8868baf19b0e587cf.png" alt="6.png" style="zoom:80%;" /><p>这里注意一点就是还要区别普通攻击时<code>Critical</code>触发状态应该是<code>false</code>，以防动画冲突</p><img src="https://p26-tt.byteimg.com/origin/pgc-image/4745d79d02704b0c9ef1bf7903896d5b.png" alt="7.png" style="zoom:80%;" /><p>然后返回代码，我们要时刻获取是否为暴击状态，那么可以如下操作</p><pre class="line-numbers language-csharp" data-language="csharp"><code class="language-csharp"><span class="token comment">//实时更新Animator里面史莱姆的状态布尔值</span><span class="token return-type class-name"><span class="token keyword">void</span></span> <span class="token function">SwitchAnimation</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>    anim<span class="token punctuation">.</span><span class="token function">SetBool</span><span class="token punctuation">(</span><span class="token string">"Critical"</span><span class="token punctuation">,</span>charcterStates<span class="token punctuation">.</span>isCritical<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">//时刻获取是否为暴击</span><span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span></span></code></pre><p>由于<code>SwitchAnimation()</code>是放在Update()里面运行的，所以可以把暴击状态放在这里让它每一刻都获取暴击状态</p><h1 id="修复人物脱离敌人攻击范围后敌人不动问题"><a href="#修复人物脱离敌人攻击范围后敌人不动问题" class="headerlink" title="修复人物脱离敌人攻击范围后敌人不动问题"></a>修复人物脱离敌人攻击范围后敌人不动问题</h1><p>最后，我们有个小问题要修复一下</p><p>由于之前我们写了发现敌人时敌人就要停下来</p><pre class="line-numbers language-csharp" data-language="csharp"><code class="language-csharp">agent<span class="token punctuation">.</span>isStopped <span class="token operator">=</span> <span class="token boolean">true</span><span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><p>所以，如果人物脱离敌人攻击范围时我们就要把停止状态取消掉，不然就会出现敌人停留在原地的现象</p><pre class="line-numbers language-csharp" data-language="csharp"><code class="language-csharp"><span class="token keyword">case</span> EnemyStates<span class="token punctuation">.</span>CHASE<span class="token punctuation">:</span><span class="token operator">/</span><span class="token operator">/</span>追击<span class="token comment">//...</span>    <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token operator">!</span><span class="token function">FoundPlayer</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>        <span class="token comment">//拉脱回上一个状态</span>        agent<span class="token punctuation">.</span>destination <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span>transform<span class="token punctuation">.</span>position<span class="token punctuation">;</span><span class="token comment">//人物脱离追击范围后，敌人停在当前位置</span>        isFollow <span class="token operator">=</span> <span class="token boolean">false</span><span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span><span class="token keyword">else</span><span class="token punctuation">&#123;</span>        isFollow <span class="token operator">=</span> <span class="token boolean">true</span><span class="token punctuation">;</span><span class="token comment">//找到人物就跑着追</span>        agent<span class="token punctuation">.</span>isStopped <span class="token operator">=</span> <span class="token boolean">false</span><span class="token punctuation">;</span><span class="token comment">//&lt;-----------停止状态取消</span>        agent<span class="token punctuation">.</span>speed<span class="token operator">=</span>speed<span class="token punctuation">;</span>        <span class="token comment">//人物进到敌人的范围会给追击</span>        agent<span class="token punctuation">.</span>destination<span class="token operator">=</span>attackTarget<span class="token punctuation">.</span>transform<span class="token punctuation">.</span>position<span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>那么到这，我们就完成了给人物和敌人添加攻击属性，并且还为敌人加了普通攻击和暴击等攻击动画，让游戏开始变得有模有样起来</p>]]></content>
    
    
      
      
    <summary type="html">&lt;p&gt;在这一章节中我们来给人物还有史莱姆添加攻击的属性，同时也给史莱姆补充上攻击的动作，那么我们就开始吧&lt;/p&gt;
&lt;h1 id=&quot;创建有关攻击的ScriptableObject&quot;&gt;&lt;a href=&quot;#创建有关攻击的ScriptableObject&quot; class=&quot;headerli</summary>
      
    
    
    
    <category term="Unity学习笔记" scheme="http://sakura-pub.ltd/categories/Unity%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/"/>
    
    
    <category term="Unity" scheme="http://sakura-pub.ltd/tags/Unity/"/>
    
  </entry>
  
</feed>
